d3a77713179481d785d70262e1c01508
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.analyzeRiskCorrelations = analyzeRiskCorrelations;
exports.generatePredictiveNarrative = generatePredictiveNarrative;
exports.switchProvider = switchProvider;
var _axios = _interopRequireDefault(require("axios"));
function _interopRequireDefault(e) { return e && e.__esModule ? e : { default: e }; }
/**
 * @fileoverview Generative AI Service for Praevisio AI.
 * This service integrates generative AI capabilities to provide narrative analysis
 * and contextual explanations for risk predictions.
 */

// Configuration for generative AI providers
const GENERATIVE_AI_CONFIG = {
  openai: {
    apiKey: process.env.OPENAI_API_KEY,
    baseURL: 'https://api.openai.com/v1',
    model: 'gpt-4o-mini',
    maxTokens: 1000,
    temperature: 0.7
  },
  anthropic: {
    apiKey: process.env.ANTHROPIC_API_KEY,
    baseURL: 'https://api.anthropic.com/v1',
    model: 'claude-3-haiku-20240307',
    maxTokens: 1000,
    temperature: 0.7
  },
  // Fallback to mock responses if no API keys are available
  mock: {
    enabled: true,
    responseDelay: 500 // ms
  }
};

// Current active provider (can be switched based on availability/performance)
let activeProvider = 'openai';

/**
 * Switches to the next available generative AI provider.
 * @returns {string} The new active provider.
 */
function switchProvider() {
  const providers = Object.keys(GENERATIVE_AI_CONFIG).filter(p => p !== 'mock');
  const currentIndex = providers.indexOf(activeProvider);
  const nextIndex = (currentIndex + 1) % providers.length;
  activeProvider = providers[nextIndex];
  console.log(`[GenerativeAIService] Switched to provider: ${activeProvider}`);
  return activeProvider;
}

/**
 * Generates a predictive narrative based on risk indices and data patterns.
 * @param {object} riskData - Current risk indices and related data.
 * @param {object} options - Options for narrative generation.
 * @returns {Promise<object>} Generated narrative with analysis and scenarios.
 */
async function generatePredictiveNarrative(riskData, options = {}) {
  const {
    focusAreas = ['climate', 'economic', 'social'],
    timeHorizon = '6months',
    detailLevel = 'comprehensive',
    language = 'es'
  } = options;
  const prompt = buildNarrativePrompt(riskData, {
    focusAreas,
    timeHorizon,
    detailLevel,
    language
  });
  try {
    const response = await callGenerativeAPI(prompt);
    return parseNarrativeResponse(response);
  } catch (error) {
    console.warn(`[GenerativeAIService] Error generating narrative with ${activeProvider}:`, error.message);

    // Try switching provider
    if (activeProvider !== 'mock') {
      switchProvider();
      try {
        const response = await callGenerativeAPI(prompt);
        return parseNarrativeResponse(response);
      } catch (secondError) {
        console.warn(`[GenerativeAIService] Second provider also failed, using mock response`);
      }
    }

    // Fallback to mock response
    return generateMockNarrative(riskData, options);
  }
}

/**
 * Builds a comprehensive prompt for narrative generation.
 * @param {object} riskData - Risk indices and data.
 * @param {object} options - Generation options.
 * @returns {string} The complete prompt.
 */
function buildNarrativePrompt(riskData, options) {
  const {
    focusAreas,
    timeHorizon,
    detailLevel,
    language
  } = options;
  return `Como analista de inteligencia artificial especializado en predicción de riesgos globales, genera un análisis narrativo comprehensivo basado en los siguientes datos de riesgo:

DATOS DE RIESGO ACTUALES:
${JSON.stringify(riskData, null, 2)}

ENFOQUE SOLICITADO:
- Áreas: ${focusAreas.join(', ')}
- Horizonte temporal: ${timeHorizon}
- Nivel de detalle: ${detailLevel}
- Idioma: ${language === 'es' ? 'Español' : 'Inglés'}

INSTRUCCIONES:
1. Proporciona un resumen ejecutivo de la situación actual
2. Identifica patrones emergentes y correlaciones críticas
3. Genera 3 escenarios hipotéticos (optimista, moderado, pesimista) para los próximos ${timeHorizon}
4. Evalúa impactos potenciales en cadenas de suministro, estabilidad social y desarrollo sostenible
5. Recomienda acciones estratégicas basadas en el análisis
6. Incluye indicadores de confianza para cada predicción

El análisis debe ser objetivo, basado en datos, y proporcionar insights accionables para toma de decisiones estratégicas.

FORMATO DE RESPUESTA (JSON):
{
  "resumenEjecutivo": "string",
  "patronesEmergentes": ["string"],
  "escenarios": {
    "optimista": {"descripcion": "string", "probabilidad": number, "impactos": ["string"]},
    "moderado": {"descripcion": "string", "probabilidad": number, "impactos": ["string"]},
    "pesimista": {"descripcion": "string", "probabilidad": number, "impactos": ["string"]}
  },
  "recomendacionesEstrategicas": ["string"],
  "indicadoresConfianza": {"general": number, "escenarios": number}
}`;
}

/**
 * Calls the active generative AI provider.
 * @param {string} prompt - The prompt to send.
 * @returns {Promise<string>} The API response.
 */
async function callGenerativeAPI(prompt) {
  const config = GENERATIVE_AI_CONFIG[activeProvider];
  if (!config.apiKey && activeProvider !== 'mock') {
    throw new Error(`API key not configured for provider: ${activeProvider}`);
  }
  if (activeProvider === 'openai') {
    const response = await _axios.default.post(`${config.baseURL}/chat/completions`, {
      model: config.model,
      messages: [{
        role: 'user',
        content: prompt
      }],
      max_tokens: config.maxTokens,
      temperature: config.temperature
    }, {
      headers: {
        'Authorization': `Bearer ${config.apiKey}`,
        'Content-Type': 'application/json'
      }
    });
    return response.data.choices[0].message.content;
  }
  if (activeProvider === 'anthropic') {
    const response = await _axios.default.post(`${config.baseURL}/messages`, {
      model: config.model,
      max_tokens: config.maxTokens,
      temperature: config.temperature,
      messages: [{
        role: 'user',
        content: prompt
      }]
    }, {
      headers: {
        'x-api-key': config.apiKey,
        'Content-Type': 'application/json',
        'anthropic-version': '2023-06-01'
      }
    });
    return response.data.content[0].text;
  }
  throw new Error(`Unsupported provider: ${activeProvider}`);
}

/**
 * Parses the narrative response from the AI provider.
 * @param {string} response - Raw response from the API.
 * @returns {object} Parsed narrative object.
 */
function parseNarrativeResponse(response) {
  try {
    // Try to parse as JSON first
    const parsed = JSON.parse(response);
    return {
      ...parsed,
      timestamp: new Date().toISOString(),
      provider: activeProvider,
      success: true
    };
  } catch (error) {
    // If JSON parsing fails, create a structured response from text
    console.warn('[GenerativeAIService] Failed to parse JSON response, creating fallback structure');
    return {
      resumenEjecutivo: response.substring(0, 500) + '...',
      patronesEmergentes: ['Análisis generado pero formato no estructurado'],
      escenarios: {
        optimista: {
          descripcion: 'Escenario optimista no disponible',
          probabilidad: 0.3,
          impactos: []
        },
        moderado: {
          descripcion: 'Escenario moderado no disponible',
          probabilidad: 0.4,
          impactos: []
        },
        pesimista: {
          descripcion: 'Escenario pesimista no disponible',
          probabilidad: 0.3,
          impactos: []
        }
      },
      recomendacionesEstrategicas: ['Revisar formato de respuesta de IA generativa'],
      indicadoresConfianza: {
        general: 0.5,
        escenarios: 0.5
      },
      timestamp: new Date().toISOString(),
      provider: activeProvider,
      success: false,
      rawResponse: response
    };
  }
}

/**
 * Generates a mock narrative response for fallback scenarios.
 * @param {object} riskData - Risk data for mock generation.
 * @param {object} options - Generation options.
 * @returns {Promise<object>} Mock narrative.
 */
async function generateMockNarrative(riskData, options) {
  // Simulate API delay
  await new Promise(resolve => setTimeout(resolve, GENERATIVE_AI_CONFIG.mock.responseDelay));
  const {
    multiDomainRiskIndex
  } = riskData;
  const riskLevel = multiDomainRiskIndex?.value > 70 ? 'alto' : multiDomainRiskIndex?.value > 40 ? 'medio' : 'bajo';
  return {
    resumenEjecutivo: `Análisis narrativo simulado: El índice de riesgo multi-dominio actual es ${multiDomainRiskIndex?.value?.toFixed(1) || 'N/A'}, indicando un nivel de riesgo ${riskLevel}.`,
    patronesEmergentes: ['Correlación entre eventos climáticos extremos y volatilidad económica', 'Aumento en riesgos de ciberseguridad en sectores críticos', 'Tendencias de resiliencia comunitaria variables por región'],
    escenarios: {
      optimista: {
        descripcion: 'Estabilización global con reducción de riesgos en todos los dominios',
        probabilidad: 0.25,
        impactos: ['Mejora en cadenas de suministro', 'Reducción de volatilidad económica']
      },
      moderado: {
        descripcion: 'Mantención de niveles actuales de riesgo con fluctuaciones regionales',
        probabilidad: 0.50,
        impactos: ['Impactos localizados en sectores específicos', 'Oportunidades de adaptación']
      },
      pesimista: {
        descripcion: 'Escalada de riesgos múltiples con eventos disruptivos en cascada',
        probabilidad: 0.25,
        impactos: ['Disrupciones mayores en suministro global', 'Inestabilidad social amplificada']
      }
    },
    recomendacionesEstrategicas: ['Implementar monitoreo continuo de indicadores clave', 'Desarrollar planes de contingencia multi-dominio', 'Fortalecer capacidades de respuesta rápida'],
    indicadoresConfianza: {
      general: 0.7,
      escenarios: 0.6
    },
    timestamp: new Date().toISOString(),
    provider: 'mock',
    success: true
  };
}

/**
 * Analyzes risk correlations using generative AI.
 * @param {object} riskIndices - Current risk indices.
 * @returns {Promise<object>} Correlation analysis.
 */
async function analyzeRiskCorrelations(riskIndices) {
  const prompt = `Analiza las correlaciones entre los siguientes índices de riesgo y proporciona insights sobre patrones emergentes:

${JSON.stringify(riskIndices, null, 2)}

Enfócate en:
1. Correlaciones fuertes entre diferentes tipos de riesgo
2. Patrones regionales
3. Tendencias temporales
4. Implicaciones para la predicción

Proporciona el análisis en formato JSON con campos: correlaciones, patrones, implicaciones.`;
  try {
    const response = await callGenerativeAPI(prompt);
    return JSON.parse(response);
  } catch (error) {
    return {
      correlaciones: ['Análisis de correlaciones no disponible'],
      patrones: ['Patrones emergentes requieren análisis de IA'],
      implicaciones: ['Implementar análisis más detallado cuando IA esté disponible'],
      timestamp: new Date().toISOString(),
      provider: 'error'
    };
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfYXhpb3MiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsImUiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsIkdFTkVSQVRJVkVfQUlfQ09ORklHIiwib3BlbmFpIiwiYXBpS2V5IiwicHJvY2VzcyIsImVudiIsIk9QRU5BSV9BUElfS0VZIiwiYmFzZVVSTCIsIm1vZGVsIiwibWF4VG9rZW5zIiwidGVtcGVyYXR1cmUiLCJhbnRocm9waWMiLCJBTlRIUk9QSUNfQVBJX0tFWSIsIm1vY2siLCJlbmFibGVkIiwicmVzcG9uc2VEZWxheSIsImFjdGl2ZVByb3ZpZGVyIiwic3dpdGNoUHJvdmlkZXIiLCJwcm92aWRlcnMiLCJPYmplY3QiLCJrZXlzIiwiZmlsdGVyIiwicCIsImN1cnJlbnRJbmRleCIsImluZGV4T2YiLCJuZXh0SW5kZXgiLCJsZW5ndGgiLCJjb25zb2xlIiwibG9nIiwiZ2VuZXJhdGVQcmVkaWN0aXZlTmFycmF0aXZlIiwicmlza0RhdGEiLCJvcHRpb25zIiwiZm9jdXNBcmVhcyIsInRpbWVIb3Jpem9uIiwiZGV0YWlsTGV2ZWwiLCJsYW5ndWFnZSIsInByb21wdCIsImJ1aWxkTmFycmF0aXZlUHJvbXB0IiwicmVzcG9uc2UiLCJjYWxsR2VuZXJhdGl2ZUFQSSIsInBhcnNlTmFycmF0aXZlUmVzcG9uc2UiLCJlcnJvciIsIndhcm4iLCJtZXNzYWdlIiwic2Vjb25kRXJyb3IiLCJnZW5lcmF0ZU1vY2tOYXJyYXRpdmUiLCJKU09OIiwic3RyaW5naWZ5Iiwiam9pbiIsImNvbmZpZyIsIkVycm9yIiwiYXhpb3MiLCJwb3N0IiwibWVzc2FnZXMiLCJyb2xlIiwiY29udGVudCIsIm1heF90b2tlbnMiLCJoZWFkZXJzIiwiZGF0YSIsImNob2ljZXMiLCJ0ZXh0IiwicGFyc2VkIiwicGFyc2UiLCJ0aW1lc3RhbXAiLCJEYXRlIiwidG9JU09TdHJpbmciLCJwcm92aWRlciIsInN1Y2Nlc3MiLCJyZXN1bWVuRWplY3V0aXZvIiwic3Vic3RyaW5nIiwicGF0cm9uZXNFbWVyZ2VudGVzIiwiZXNjZW5hcmlvcyIsIm9wdGltaXN0YSIsImRlc2NyaXBjaW9uIiwicHJvYmFiaWxpZGFkIiwiaW1wYWN0b3MiLCJtb2RlcmFkbyIsInBlc2ltaXN0YSIsInJlY29tZW5kYWNpb25lc0VzdHJhdGVnaWNhcyIsImluZGljYWRvcmVzQ29uZmlhbnphIiwiZ2VuZXJhbCIsInJhd1Jlc3BvbnNlIiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXRUaW1lb3V0IiwibXVsdGlEb21haW5SaXNrSW5kZXgiLCJyaXNrTGV2ZWwiLCJ2YWx1ZSIsInRvRml4ZWQiLCJhbmFseXplUmlza0NvcnJlbGF0aW9ucyIsInJpc2tJbmRpY2VzIiwiY29ycmVsYWNpb25lcyIsInBhdHJvbmVzIiwiaW1wbGljYWNpb25lcyJdLCJzb3VyY2VzIjpbImdlbmVyYXRpdmVBSVNlcnZpY2UuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAZmlsZW92ZXJ2aWV3IEdlbmVyYXRpdmUgQUkgU2VydmljZSBmb3IgUHJhZXZpc2lvIEFJLlxuICogVGhpcyBzZXJ2aWNlIGludGVncmF0ZXMgZ2VuZXJhdGl2ZSBBSSBjYXBhYmlsaXRpZXMgdG8gcHJvdmlkZSBuYXJyYXRpdmUgYW5hbHlzaXNcbiAqIGFuZCBjb250ZXh0dWFsIGV4cGxhbmF0aW9ucyBmb3IgcmlzayBwcmVkaWN0aW9ucy5cbiAqL1xuXG5pbXBvcnQgYXhpb3MgZnJvbSAnYXhpb3MnO1xuXG4vLyBDb25maWd1cmF0aW9uIGZvciBnZW5lcmF0aXZlIEFJIHByb3ZpZGVyc1xuY29uc3QgR0VORVJBVElWRV9BSV9DT05GSUcgPSB7XG4gIG9wZW5haToge1xuICAgIGFwaUtleTogcHJvY2Vzcy5lbnYuT1BFTkFJX0FQSV9LRVksXG4gICAgYmFzZVVSTDogJ2h0dHBzOi8vYXBpLm9wZW5haS5jb20vdjEnLFxuICAgIG1vZGVsOiAnZ3B0LTRvLW1pbmknLFxuICAgIG1heFRva2VuczogMTAwMCxcbiAgICB0ZW1wZXJhdHVyZTogMC43LFxuICB9LFxuICBhbnRocm9waWM6IHtcbiAgICBhcGlLZXk6IHByb2Nlc3MuZW52LkFOVEhST1BJQ19BUElfS0VZLFxuICAgIGJhc2VVUkw6ICdodHRwczovL2FwaS5hbnRocm9waWMuY29tL3YxJyxcbiAgICBtb2RlbDogJ2NsYXVkZS0zLWhhaWt1LTIwMjQwMzA3JyxcbiAgICBtYXhUb2tlbnM6IDEwMDAsXG4gICAgdGVtcGVyYXR1cmU6IDAuNyxcbiAgfSxcbiAgLy8gRmFsbGJhY2sgdG8gbW9jayByZXNwb25zZXMgaWYgbm8gQVBJIGtleXMgYXJlIGF2YWlsYWJsZVxuICBtb2NrOiB7XG4gICAgZW5hYmxlZDogdHJ1ZSxcbiAgICByZXNwb25zZURlbGF5OiA1MDAsIC8vIG1zXG4gIH0sXG59O1xuXG4vLyBDdXJyZW50IGFjdGl2ZSBwcm92aWRlciAoY2FuIGJlIHN3aXRjaGVkIGJhc2VkIG9uIGF2YWlsYWJpbGl0eS9wZXJmb3JtYW5jZSlcbmxldCBhY3RpdmVQcm92aWRlciA9ICdvcGVuYWknO1xuXG4vKipcbiAqIFN3aXRjaGVzIHRvIHRoZSBuZXh0IGF2YWlsYWJsZSBnZW5lcmF0aXZlIEFJIHByb3ZpZGVyLlxuICogQHJldHVybnMge3N0cmluZ30gVGhlIG5ldyBhY3RpdmUgcHJvdmlkZXIuXG4gKi9cbmZ1bmN0aW9uIHN3aXRjaFByb3ZpZGVyKCkge1xuICBjb25zdCBwcm92aWRlcnMgPSBPYmplY3Qua2V5cyhHRU5FUkFUSVZFX0FJX0NPTkZJRykuZmlsdGVyKHAgPT4gcCAhPT0gJ21vY2snKTtcbiAgY29uc3QgY3VycmVudEluZGV4ID0gcHJvdmlkZXJzLmluZGV4T2YoYWN0aXZlUHJvdmlkZXIpO1xuICBjb25zdCBuZXh0SW5kZXggPSAoY3VycmVudEluZGV4ICsgMSkgJSBwcm92aWRlcnMubGVuZ3RoO1xuICBhY3RpdmVQcm92aWRlciA9IHByb3ZpZGVyc1tuZXh0SW5kZXhdO1xuICBjb25zb2xlLmxvZyhgW0dlbmVyYXRpdmVBSVNlcnZpY2VdIFN3aXRjaGVkIHRvIHByb3ZpZGVyOiAke2FjdGl2ZVByb3ZpZGVyfWApO1xuICByZXR1cm4gYWN0aXZlUHJvdmlkZXI7XG59XG5cbi8qKlxuICogR2VuZXJhdGVzIGEgcHJlZGljdGl2ZSBuYXJyYXRpdmUgYmFzZWQgb24gcmlzayBpbmRpY2VzIGFuZCBkYXRhIHBhdHRlcm5zLlxuICogQHBhcmFtIHtvYmplY3R9IHJpc2tEYXRhIC0gQ3VycmVudCByaXNrIGluZGljZXMgYW5kIHJlbGF0ZWQgZGF0YS5cbiAqIEBwYXJhbSB7b2JqZWN0fSBvcHRpb25zIC0gT3B0aW9ucyBmb3IgbmFycmF0aXZlIGdlbmVyYXRpb24uXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxvYmplY3Q+fSBHZW5lcmF0ZWQgbmFycmF0aXZlIHdpdGggYW5hbHlzaXMgYW5kIHNjZW5hcmlvcy5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVQcmVkaWN0aXZlTmFycmF0aXZlKHJpc2tEYXRhLCBvcHRpb25zID0ge30pIHtcbiAgY29uc3Qge1xuICAgIGZvY3VzQXJlYXMgPSBbJ2NsaW1hdGUnLCAnZWNvbm9taWMnLCAnc29jaWFsJ10sXG4gICAgdGltZUhvcml6b24gPSAnNm1vbnRocycsXG4gICAgZGV0YWlsTGV2ZWwgPSAnY29tcHJlaGVuc2l2ZScsXG4gICAgbGFuZ3VhZ2UgPSAnZXMnLFxuICB9ID0gb3B0aW9ucztcblxuICBjb25zdCBwcm9tcHQgPSBidWlsZE5hcnJhdGl2ZVByb21wdChyaXNrRGF0YSwgeyBmb2N1c0FyZWFzLCB0aW1lSG9yaXpvbiwgZGV0YWlsTGV2ZWwsIGxhbmd1YWdlIH0pO1xuXG4gIHRyeSB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBjYWxsR2VuZXJhdGl2ZUFQSShwcm9tcHQpO1xuICAgIHJldHVybiBwYXJzZU5hcnJhdGl2ZVJlc3BvbnNlKHJlc3BvbnNlKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLndhcm4oYFtHZW5lcmF0aXZlQUlTZXJ2aWNlXSBFcnJvciBnZW5lcmF0aW5nIG5hcnJhdGl2ZSB3aXRoICR7YWN0aXZlUHJvdmlkZXJ9OmAsIGVycm9yLm1lc3NhZ2UpO1xuXG4gICAgLy8gVHJ5IHN3aXRjaGluZyBwcm92aWRlclxuICAgIGlmIChhY3RpdmVQcm92aWRlciAhPT0gJ21vY2snKSB7XG4gICAgICBzd2l0Y2hQcm92aWRlcigpO1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBjYWxsR2VuZXJhdGl2ZUFQSShwcm9tcHQpO1xuICAgICAgICByZXR1cm4gcGFyc2VOYXJyYXRpdmVSZXNwb25zZShyZXNwb25zZSk7XG4gICAgICB9IGNhdGNoIChzZWNvbmRFcnJvcikge1xuICAgICAgICBjb25zb2xlLndhcm4oYFtHZW5lcmF0aXZlQUlTZXJ2aWNlXSBTZWNvbmQgcHJvdmlkZXIgYWxzbyBmYWlsZWQsIHVzaW5nIG1vY2sgcmVzcG9uc2VgKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBGYWxsYmFjayB0byBtb2NrIHJlc3BvbnNlXG4gICAgcmV0dXJuIGdlbmVyYXRlTW9ja05hcnJhdGl2ZShyaXNrRGF0YSwgb3B0aW9ucyk7XG4gIH1cbn1cblxuLyoqXG4gKiBCdWlsZHMgYSBjb21wcmVoZW5zaXZlIHByb21wdCBmb3IgbmFycmF0aXZlIGdlbmVyYXRpb24uXG4gKiBAcGFyYW0ge29iamVjdH0gcmlza0RhdGEgLSBSaXNrIGluZGljZXMgYW5kIGRhdGEuXG4gKiBAcGFyYW0ge29iamVjdH0gb3B0aW9ucyAtIEdlbmVyYXRpb24gb3B0aW9ucy5cbiAqIEByZXR1cm5zIHtzdHJpbmd9IFRoZSBjb21wbGV0ZSBwcm9tcHQuXG4gKi9cbmZ1bmN0aW9uIGJ1aWxkTmFycmF0aXZlUHJvbXB0KHJpc2tEYXRhLCBvcHRpb25zKSB7XG4gIGNvbnN0IHsgZm9jdXNBcmVhcywgdGltZUhvcml6b24sIGRldGFpbExldmVsLCBsYW5ndWFnZSB9ID0gb3B0aW9ucztcblxuICByZXR1cm4gYENvbW8gYW5hbGlzdGEgZGUgaW50ZWxpZ2VuY2lhIGFydGlmaWNpYWwgZXNwZWNpYWxpemFkbyBlbiBwcmVkaWNjacOzbiBkZSByaWVzZ29zIGdsb2JhbGVzLCBnZW5lcmEgdW4gYW7DoWxpc2lzIG5hcnJhdGl2byBjb21wcmVoZW5zaXZvIGJhc2FkbyBlbiBsb3Mgc2lndWllbnRlcyBkYXRvcyBkZSByaWVzZ286XG5cbkRBVE9TIERFIFJJRVNHTyBBQ1RVQUxFUzpcbiR7SlNPTi5zdHJpbmdpZnkocmlza0RhdGEsIG51bGwsIDIpfVxuXG5FTkZPUVVFIFNPTElDSVRBRE86XG4tIMOBcmVhczogJHtmb2N1c0FyZWFzLmpvaW4oJywgJyl9XG4tIEhvcml6b250ZSB0ZW1wb3JhbDogJHt0aW1lSG9yaXpvbn1cbi0gTml2ZWwgZGUgZGV0YWxsZTogJHtkZXRhaWxMZXZlbH1cbi0gSWRpb21hOiAke2xhbmd1YWdlID09PSAnZXMnID8gJ0VzcGHDsW9sJyA6ICdJbmdsw6lzJ31cblxuSU5TVFJVQ0NJT05FUzpcbjEuIFByb3BvcmNpb25hIHVuIHJlc3VtZW4gZWplY3V0aXZvIGRlIGxhIHNpdHVhY2nDs24gYWN0dWFsXG4yLiBJZGVudGlmaWNhIHBhdHJvbmVzIGVtZXJnZW50ZXMgeSBjb3JyZWxhY2lvbmVzIGNyw610aWNhc1xuMy4gR2VuZXJhIDMgZXNjZW5hcmlvcyBoaXBvdMOpdGljb3MgKG9wdGltaXN0YSwgbW9kZXJhZG8sIHBlc2ltaXN0YSkgcGFyYSBsb3MgcHLDs3hpbW9zICR7dGltZUhvcml6b259XG40LiBFdmFsw7phIGltcGFjdG9zIHBvdGVuY2lhbGVzIGVuIGNhZGVuYXMgZGUgc3VtaW5pc3RybywgZXN0YWJpbGlkYWQgc29jaWFsIHkgZGVzYXJyb2xsbyBzb3N0ZW5pYmxlXG41LiBSZWNvbWllbmRhIGFjY2lvbmVzIGVzdHJhdMOpZ2ljYXMgYmFzYWRhcyBlbiBlbCBhbsOhbGlzaXNcbjYuIEluY2x1eWUgaW5kaWNhZG9yZXMgZGUgY29uZmlhbnphIHBhcmEgY2FkYSBwcmVkaWNjacOzblxuXG5FbCBhbsOhbGlzaXMgZGViZSBzZXIgb2JqZXRpdm8sIGJhc2FkbyBlbiBkYXRvcywgeSBwcm9wb3JjaW9uYXIgaW5zaWdodHMgYWNjaW9uYWJsZXMgcGFyYSB0b21hIGRlIGRlY2lzaW9uZXMgZXN0cmF0w6lnaWNhcy5cblxuRk9STUFUTyBERSBSRVNQVUVTVEEgKEpTT04pOlxue1xuICBcInJlc3VtZW5FamVjdXRpdm9cIjogXCJzdHJpbmdcIixcbiAgXCJwYXRyb25lc0VtZXJnZW50ZXNcIjogW1wic3RyaW5nXCJdLFxuICBcImVzY2VuYXJpb3NcIjoge1xuICAgIFwib3B0aW1pc3RhXCI6IHtcImRlc2NyaXBjaW9uXCI6IFwic3RyaW5nXCIsIFwicHJvYmFiaWxpZGFkXCI6IG51bWJlciwgXCJpbXBhY3Rvc1wiOiBbXCJzdHJpbmdcIl19LFxuICAgIFwibW9kZXJhZG9cIjoge1wiZGVzY3JpcGNpb25cIjogXCJzdHJpbmdcIiwgXCJwcm9iYWJpbGlkYWRcIjogbnVtYmVyLCBcImltcGFjdG9zXCI6IFtcInN0cmluZ1wiXX0sXG4gICAgXCJwZXNpbWlzdGFcIjoge1wiZGVzY3JpcGNpb25cIjogXCJzdHJpbmdcIiwgXCJwcm9iYWJpbGlkYWRcIjogbnVtYmVyLCBcImltcGFjdG9zXCI6IFtcInN0cmluZ1wiXX1cbiAgfSxcbiAgXCJyZWNvbWVuZGFjaW9uZXNFc3RyYXRlZ2ljYXNcIjogW1wic3RyaW5nXCJdLFxuICBcImluZGljYWRvcmVzQ29uZmlhbnphXCI6IHtcImdlbmVyYWxcIjogbnVtYmVyLCBcImVzY2VuYXJpb3NcIjogbnVtYmVyfVxufWA7XG59XG5cbi8qKlxuICogQ2FsbHMgdGhlIGFjdGl2ZSBnZW5lcmF0aXZlIEFJIHByb3ZpZGVyLlxuICogQHBhcmFtIHtzdHJpbmd9IHByb21wdCAtIFRoZSBwcm9tcHQgdG8gc2VuZC5cbiAqIEByZXR1cm5zIHtQcm9taXNlPHN0cmluZz59IFRoZSBBUEkgcmVzcG9uc2UuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGNhbGxHZW5lcmF0aXZlQVBJKHByb21wdCkge1xuICBjb25zdCBjb25maWcgPSBHRU5FUkFUSVZFX0FJX0NPTkZJR1thY3RpdmVQcm92aWRlcl07XG5cbiAgaWYgKCFjb25maWcuYXBpS2V5ICYmIGFjdGl2ZVByb3ZpZGVyICE9PSAnbW9jaycpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEFQSSBrZXkgbm90IGNvbmZpZ3VyZWQgZm9yIHByb3ZpZGVyOiAke2FjdGl2ZVByb3ZpZGVyfWApO1xuICB9XG5cbiAgaWYgKGFjdGl2ZVByb3ZpZGVyID09PSAnb3BlbmFpJykge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXhpb3MucG9zdChgJHtjb25maWcuYmFzZVVSTH0vY2hhdC9jb21wbGV0aW9uc2AsIHtcbiAgICAgIG1vZGVsOiBjb25maWcubW9kZWwsXG4gICAgICBtZXNzYWdlczogW3sgcm9sZTogJ3VzZXInLCBjb250ZW50OiBwcm9tcHQgfV0sXG4gICAgICBtYXhfdG9rZW5zOiBjb25maWcubWF4VG9rZW5zLFxuICAgICAgdGVtcGVyYXR1cmU6IGNvbmZpZy50ZW1wZXJhdHVyZSxcbiAgICB9LCB7XG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgICdBdXRob3JpemF0aW9uJzogYEJlYXJlciAke2NvbmZpZy5hcGlLZXl9YCxcbiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICByZXR1cm4gcmVzcG9uc2UuZGF0YS5jaG9pY2VzWzBdLm1lc3NhZ2UuY29udGVudDtcbiAgfVxuXG4gIGlmIChhY3RpdmVQcm92aWRlciA9PT0gJ2FudGhyb3BpYycpIHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGF4aW9zLnBvc3QoYCR7Y29uZmlnLmJhc2VVUkx9L21lc3NhZ2VzYCwge1xuICAgICAgbW9kZWw6IGNvbmZpZy5tb2RlbCxcbiAgICAgIG1heF90b2tlbnM6IGNvbmZpZy5tYXhUb2tlbnMsXG4gICAgICB0ZW1wZXJhdHVyZTogY29uZmlnLnRlbXBlcmF0dXJlLFxuICAgICAgbWVzc2FnZXM6IFt7IHJvbGU6ICd1c2VyJywgY29udGVudDogcHJvbXB0IH1dLFxuICAgIH0sIHtcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ3gtYXBpLWtleSc6IGNvbmZpZy5hcGlLZXksXG4gICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICdhbnRocm9waWMtdmVyc2lvbic6ICcyMDIzLTA2LTAxJyxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICByZXR1cm4gcmVzcG9uc2UuZGF0YS5jb250ZW50WzBdLnRleHQ7XG4gIH1cblxuICB0aHJvdyBuZXcgRXJyb3IoYFVuc3VwcG9ydGVkIHByb3ZpZGVyOiAke2FjdGl2ZVByb3ZpZGVyfWApO1xufVxuXG4vKipcbiAqIFBhcnNlcyB0aGUgbmFycmF0aXZlIHJlc3BvbnNlIGZyb20gdGhlIEFJIHByb3ZpZGVyLlxuICogQHBhcmFtIHtzdHJpbmd9IHJlc3BvbnNlIC0gUmF3IHJlc3BvbnNlIGZyb20gdGhlIEFQSS5cbiAqIEByZXR1cm5zIHtvYmplY3R9IFBhcnNlZCBuYXJyYXRpdmUgb2JqZWN0LlxuICovXG5mdW5jdGlvbiBwYXJzZU5hcnJhdGl2ZVJlc3BvbnNlKHJlc3BvbnNlKSB7XG4gIHRyeSB7XG4gICAgLy8gVHJ5IHRvIHBhcnNlIGFzIEpTT04gZmlyc3RcbiAgICBjb25zdCBwYXJzZWQgPSBKU09OLnBhcnNlKHJlc3BvbnNlKTtcbiAgICByZXR1cm4ge1xuICAgICAgLi4ucGFyc2VkLFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICBwcm92aWRlcjogYWN0aXZlUHJvdmlkZXIsXG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgLy8gSWYgSlNPTiBwYXJzaW5nIGZhaWxzLCBjcmVhdGUgYSBzdHJ1Y3R1cmVkIHJlc3BvbnNlIGZyb20gdGV4dFxuICAgIGNvbnNvbGUud2FybignW0dlbmVyYXRpdmVBSVNlcnZpY2VdIEZhaWxlZCB0byBwYXJzZSBKU09OIHJlc3BvbnNlLCBjcmVhdGluZyBmYWxsYmFjayBzdHJ1Y3R1cmUnKTtcbiAgICByZXR1cm4ge1xuICAgICAgcmVzdW1lbkVqZWN1dGl2bzogcmVzcG9uc2Uuc3Vic3RyaW5nKDAsIDUwMCkgKyAnLi4uJyxcbiAgICAgIHBhdHJvbmVzRW1lcmdlbnRlczogWydBbsOhbGlzaXMgZ2VuZXJhZG8gcGVybyBmb3JtYXRvIG5vIGVzdHJ1Y3R1cmFkbyddLFxuICAgICAgZXNjZW5hcmlvczoge1xuICAgICAgICBvcHRpbWlzdGE6IHsgZGVzY3JpcGNpb246ICdFc2NlbmFyaW8gb3B0aW1pc3RhIG5vIGRpc3BvbmlibGUnLCBwcm9iYWJpbGlkYWQ6IDAuMywgaW1wYWN0b3M6IFtdIH0sXG4gICAgICAgIG1vZGVyYWRvOiB7IGRlc2NyaXBjaW9uOiAnRXNjZW5hcmlvIG1vZGVyYWRvIG5vIGRpc3BvbmlibGUnLCBwcm9iYWJpbGlkYWQ6IDAuNCwgaW1wYWN0b3M6IFtdIH0sXG4gICAgICAgIHBlc2ltaXN0YTogeyBkZXNjcmlwY2lvbjogJ0VzY2VuYXJpbyBwZXNpbWlzdGEgbm8gZGlzcG9uaWJsZScsIHByb2JhYmlsaWRhZDogMC4zLCBpbXBhY3RvczogW10gfSxcbiAgICAgIH0sXG4gICAgICByZWNvbWVuZGFjaW9uZXNFc3RyYXRlZ2ljYXM6IFsnUmV2aXNhciBmb3JtYXRvIGRlIHJlc3B1ZXN0YSBkZSBJQSBnZW5lcmF0aXZhJ10sXG4gICAgICBpbmRpY2Fkb3Jlc0NvbmZpYW56YTogeyBnZW5lcmFsOiAwLjUsIGVzY2VuYXJpb3M6IDAuNSB9LFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICBwcm92aWRlcjogYWN0aXZlUHJvdmlkZXIsXG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIHJhd1Jlc3BvbnNlOiByZXNwb25zZSxcbiAgICB9O1xuICB9XG59XG5cbi8qKlxuICogR2VuZXJhdGVzIGEgbW9jayBuYXJyYXRpdmUgcmVzcG9uc2UgZm9yIGZhbGxiYWNrIHNjZW5hcmlvcy5cbiAqIEBwYXJhbSB7b2JqZWN0fSByaXNrRGF0YSAtIFJpc2sgZGF0YSBmb3IgbW9jayBnZW5lcmF0aW9uLlxuICogQHBhcmFtIHtvYmplY3R9IG9wdGlvbnMgLSBHZW5lcmF0aW9uIG9wdGlvbnMuXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxvYmplY3Q+fSBNb2NrIG5hcnJhdGl2ZS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVNb2NrTmFycmF0aXZlKHJpc2tEYXRhLCBvcHRpb25zKSB7XG4gIC8vIFNpbXVsYXRlIEFQSSBkZWxheVxuICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgR0VORVJBVElWRV9BSV9DT05GSUcubW9jay5yZXNwb25zZURlbGF5KSk7XG5cbiAgY29uc3QgeyBtdWx0aURvbWFpblJpc2tJbmRleCB9ID0gcmlza0RhdGE7XG4gIGNvbnN0IHJpc2tMZXZlbCA9IG11bHRpRG9tYWluUmlza0luZGV4Py52YWx1ZSA+IDcwID8gJ2FsdG8nIDogbXVsdGlEb21haW5SaXNrSW5kZXg/LnZhbHVlID4gNDAgPyAnbWVkaW8nIDogJ2Jham8nO1xuXG4gIHJldHVybiB7XG4gICAgcmVzdW1lbkVqZWN1dGl2bzogYEFuw6FsaXNpcyBuYXJyYXRpdm8gc2ltdWxhZG86IEVsIMOtbmRpY2UgZGUgcmllc2dvIG11bHRpLWRvbWluaW8gYWN0dWFsIGVzICR7bXVsdGlEb21haW5SaXNrSW5kZXg/LnZhbHVlPy50b0ZpeGVkKDEpIHx8ICdOL0EnfSwgaW5kaWNhbmRvIHVuIG5pdmVsIGRlIHJpZXNnbyAke3Jpc2tMZXZlbH0uYCxcbiAgICBwYXRyb25lc0VtZXJnZW50ZXM6IFtcbiAgICAgICdDb3JyZWxhY2nDs24gZW50cmUgZXZlbnRvcyBjbGltw6F0aWNvcyBleHRyZW1vcyB5IHZvbGF0aWxpZGFkIGVjb27Ds21pY2EnLFxuICAgICAgJ0F1bWVudG8gZW4gcmllc2dvcyBkZSBjaWJlcnNlZ3VyaWRhZCBlbiBzZWN0b3JlcyBjcsOtdGljb3MnLFxuICAgICAgJ1RlbmRlbmNpYXMgZGUgcmVzaWxpZW5jaWEgY29tdW5pdGFyaWEgdmFyaWFibGVzIHBvciByZWdpw7NuJ1xuICAgIF0sXG4gICAgZXNjZW5hcmlvczoge1xuICAgICAgb3B0aW1pc3RhOiB7XG4gICAgICAgIGRlc2NyaXBjaW9uOiAnRXN0YWJpbGl6YWNpw7NuIGdsb2JhbCBjb24gcmVkdWNjacOzbiBkZSByaWVzZ29zIGVuIHRvZG9zIGxvcyBkb21pbmlvcycsXG4gICAgICAgIHByb2JhYmlsaWRhZDogMC4yNSxcbiAgICAgICAgaW1wYWN0b3M6IFsnTWVqb3JhIGVuIGNhZGVuYXMgZGUgc3VtaW5pc3RybycsICdSZWR1Y2Npw7NuIGRlIHZvbGF0aWxpZGFkIGVjb27Ds21pY2EnXVxuICAgICAgfSxcbiAgICAgIG1vZGVyYWRvOiB7XG4gICAgICAgIGRlc2NyaXBjaW9uOiAnTWFudGVuY2nDs24gZGUgbml2ZWxlcyBhY3R1YWxlcyBkZSByaWVzZ28gY29uIGZsdWN0dWFjaW9uZXMgcmVnaW9uYWxlcycsXG4gICAgICAgIHByb2JhYmlsaWRhZDogMC41MCxcbiAgICAgICAgaW1wYWN0b3M6IFsnSW1wYWN0b3MgbG9jYWxpemFkb3MgZW4gc2VjdG9yZXMgZXNwZWPDrWZpY29zJywgJ09wb3J0dW5pZGFkZXMgZGUgYWRhcHRhY2nDs24nXVxuICAgICAgfSxcbiAgICAgIHBlc2ltaXN0YToge1xuICAgICAgICBkZXNjcmlwY2lvbjogJ0VzY2FsYWRhIGRlIHJpZXNnb3MgbcO6bHRpcGxlcyBjb24gZXZlbnRvcyBkaXNydXB0aXZvcyBlbiBjYXNjYWRhJyxcbiAgICAgICAgcHJvYmFiaWxpZGFkOiAwLjI1LFxuICAgICAgICBpbXBhY3RvczogWydEaXNydXBjaW9uZXMgbWF5b3JlcyBlbiBzdW1pbmlzdHJvIGdsb2JhbCcsICdJbmVzdGFiaWxpZGFkIHNvY2lhbCBhbXBsaWZpY2FkYSddXG4gICAgICB9LFxuICAgIH0sXG4gICAgcmVjb21lbmRhY2lvbmVzRXN0cmF0ZWdpY2FzOiBbXG4gICAgICAnSW1wbGVtZW50YXIgbW9uaXRvcmVvIGNvbnRpbnVvIGRlIGluZGljYWRvcmVzIGNsYXZlJyxcbiAgICAgICdEZXNhcnJvbGxhciBwbGFuZXMgZGUgY29udGluZ2VuY2lhIG11bHRpLWRvbWluaW8nLFxuICAgICAgJ0ZvcnRhbGVjZXIgY2FwYWNpZGFkZXMgZGUgcmVzcHVlc3RhIHLDoXBpZGEnXG4gICAgXSxcbiAgICBpbmRpY2Fkb3Jlc0NvbmZpYW56YTogeyBnZW5lcmFsOiAwLjcsIGVzY2VuYXJpb3M6IDAuNiB9LFxuICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgIHByb3ZpZGVyOiAnbW9jaycsXG4gICAgc3VjY2VzczogdHJ1ZSxcbiAgfTtcbn1cblxuLyoqXG4gKiBBbmFseXplcyByaXNrIGNvcnJlbGF0aW9ucyB1c2luZyBnZW5lcmF0aXZlIEFJLlxuICogQHBhcmFtIHtvYmplY3R9IHJpc2tJbmRpY2VzIC0gQ3VycmVudCByaXNrIGluZGljZXMuXG4gKiBAcmV0dXJucyB7UHJvbWlzZTxvYmplY3Q+fSBDb3JyZWxhdGlvbiBhbmFseXNpcy5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gYW5hbHl6ZVJpc2tDb3JyZWxhdGlvbnMocmlza0luZGljZXMpIHtcbiAgY29uc3QgcHJvbXB0ID0gYEFuYWxpemEgbGFzIGNvcnJlbGFjaW9uZXMgZW50cmUgbG9zIHNpZ3VpZW50ZXMgw61uZGljZXMgZGUgcmllc2dvIHkgcHJvcG9yY2lvbmEgaW5zaWdodHMgc29icmUgcGF0cm9uZXMgZW1lcmdlbnRlczpcblxuJHtKU09OLnN0cmluZ2lmeShyaXNrSW5kaWNlcywgbnVsbCwgMil9XG5cbkVuZsOzY2F0ZSBlbjpcbjEuIENvcnJlbGFjaW9uZXMgZnVlcnRlcyBlbnRyZSBkaWZlcmVudGVzIHRpcG9zIGRlIHJpZXNnb1xuMi4gUGF0cm9uZXMgcmVnaW9uYWxlc1xuMy4gVGVuZGVuY2lhcyB0ZW1wb3JhbGVzXG40LiBJbXBsaWNhY2lvbmVzIHBhcmEgbGEgcHJlZGljY2nDs25cblxuUHJvcG9yY2lvbmEgZWwgYW7DoWxpc2lzIGVuIGZvcm1hdG8gSlNPTiBjb24gY2FtcG9zOiBjb3JyZWxhY2lvbmVzLCBwYXRyb25lcywgaW1wbGljYWNpb25lcy5gO1xuXG4gIHRyeSB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBjYWxsR2VuZXJhdGl2ZUFQSShwcm9tcHQpO1xuICAgIHJldHVybiBKU09OLnBhcnNlKHJlc3BvbnNlKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4ge1xuICAgICAgY29ycmVsYWNpb25lczogWydBbsOhbGlzaXMgZGUgY29ycmVsYWNpb25lcyBubyBkaXNwb25pYmxlJ10sXG4gICAgICBwYXRyb25lczogWydQYXRyb25lcyBlbWVyZ2VudGVzIHJlcXVpZXJlbiBhbsOhbGlzaXMgZGUgSUEnXSxcbiAgICAgIGltcGxpY2FjaW9uZXM6IFsnSW1wbGVtZW50YXIgYW7DoWxpc2lzIG3DoXMgZGV0YWxsYWRvIGN1YW5kbyBJQSBlc3TDqSBkaXNwb25pYmxlJ10sXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgIHByb3ZpZGVyOiAnZXJyb3InLFxuICAgIH07XG4gIH1cbn1cblxuZXhwb3J0IHtcbiAgZ2VuZXJhdGVQcmVkaWN0aXZlTmFycmF0aXZlLFxuICBhbmFseXplUmlza0NvcnJlbGF0aW9ucyxcbiAgc3dpdGNoUHJvdmlkZXIsXG59OyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFNQSxJQUFBQSxNQUFBLEdBQUFDLHNCQUFBLENBQUFDLE9BQUE7QUFBMEIsU0FBQUQsdUJBQUFFLENBQUEsV0FBQUEsQ0FBQSxJQUFBQSxDQUFBLENBQUFDLFVBQUEsR0FBQUQsQ0FBQSxLQUFBRSxPQUFBLEVBQUFGLENBQUE7QUFOMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFJQTtBQUNBLE1BQU1HLG9CQUFvQixHQUFHO0VBQzNCQyxNQUFNLEVBQUU7SUFDTkMsTUFBTSxF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