780282113619f4b28ce81a4dad967d67
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _safeFetch = _interopRequireDefault(require("../lib/safeFetch.js"));
var _forceMocks = require("../lib/force-mocks.js");
function _interopRequireDefault(e) { return e && e.__esModule ? e : { default: e }; }
class SIMIntegration {
  constructor() {
    // SIM (Sistema de Información de Mercados) MINAGRI API
    this.baseUrl = process.env.TEST_MODE === 'true' ? 'http://mock-api-server:3001/sim' // internal mock server
    : 'https://sim.minagri.gob.pe/api/v1';
  }
  async getFoodPrices(product, region) {
    try {
      // Attempt to fetch real SIM food prices
      const url = `${this.baseUrl}/precios?producto=${encodeURIComponent(product)}&region=${encodeURIComponent(region)}&fecha=${new Date().toISOString().split('T')[0]}`;
      const data = await (0, _safeFetch.default)(url, {}, {
        timeout: 10000,
        retries: 2
      });

      // Process price data
      const priceData = {
        product: product,
        region: region || 'Lima',
        currentPrice: data.precio_actual || 0,
        minPrice: data.precio_minimo || 0,
        maxPrice: data.precio_maximo || 0,
        averagePrice: data.precio_promedio || 0,
        unit: data.unidad || 'PEN/kg',
        date: data.fecha || new Date().toISOString(),
        source: 'SIM MINAGRI'
      };
      return {
        product,
        region,
        priceData,
        isMock: false
      };
    } catch (error) {
      console.log(`SIMIntegration: API failed for ${product} in ${region}: ${error && error.message}`);
      if (!(0, _forceMocks.forceMocksEnabled)()) {
        throw new Error(`SIMIntegration failure: ${error && error.message ? error.message : String(error)}`);
      }
      const mockPrices = {
        'rice': {
          current: 4.50,
          min: 4.20,
          max: 4.80,
          avg: 4.45
        },
        'potatoes': {
          current: 2.20,
          min: 1.80,
          max: 2.60,
          avg: 2.25
        },
        'corn': {
          current: 3.10,
          min: 2.80,
          max: 3.40,
          avg: 3.15
        },
        'beans': {
          current: 5.80,
          min: 5.20,
          max: 6.50,
          avg: 5.85
        }
      };
      const productData = mockPrices[product.toLowerCase()] || {
        current: 3.00,
        min: 2.50,
        max: 3.50,
        avg: 3.00
      };
      return {
        product,
        region,
        priceData: {
          product,
          region: region || 'Lima',
          currentPrice: productData.current,
          minPrice: productData.min,
          maxPrice: productData.max,
          averagePrice: productData.avg,
          unit: 'PEN/kg',
          date: new Date().toISOString(),
          source: 'FALLBACK_MOCK:SIM'
        },
        isMock: true
      };
    }
  }
  async getPriceHistory(product, region, days = 30) {
    try {
      // Attempt to fetch real SIM price history
      const endDate = new Date();
      const startDate = new Date();
      startDate.setDate(endDate.getDate() - days);
      const url = `${this.baseUrl}/precios/historico?producto=${encodeURIComponent(product)}&region=${encodeURIComponent(region)}&fecha_inicio=${startDate.toISOString().split('T')[0]}&fecha_fin=${endDate.toISOString().split('T')[0]}`;
      const data = await (0, _safeFetch.default)(url, {}, {
        timeout: 10000,
        retries: 2
      });

      // Process historical price data
      const historyData = (data.precios || []).map(item => ({
        date: item.fecha,
        price: item.precio,
        volume: item.volumen || 0
      }));
      return {
        product,
        region,
        historyData,
        isMock: false
      };
    } catch (error) {
      console.log(`SIMIntegration: API failed for ${product} in ${region}: ${error && error.message}`);
      if (!(0, _forceMocks.forceMocksEnabled)()) {
        throw new Error(`SIMIntegration failure: ${error && error.message ? error.message : String(error)}`);
      }
      // Generate mock historical data
      const historyData = [];
      const basePrice = {
        rice: 4.50,
        potatoes: 2.20,
        corn: 3.10,
        beans: 5.80
      }[product.toLowerCase()] || 3.00;
      for (let i = days; i >= 0; i--) {
        const date = new Date();
        date.setDate(date.getDate() - i);
        const variation = (Math.random() - 0.5) * 0.4; // ±20% variation
        const price = Math.max(0.1, basePrice + variation);
        historyData.push({
          date: date.toISOString().split('T')[0],
          price: Math.round(price * 100) / 100,
          volume: Math.floor(Math.random() * 1000) + 100
        });
      }
      return {
        product,
        region,
        historyData,
        isMock: true,
        source: 'FALLBACK_MOCK:SIM'
      };
    }
  }
  async getVolatilityIndex(product, region) {
    try {
      // Attempt to fetch real SIM volatility data
      const url = `${this.baseUrl}/volatilidad?producto=${encodeURIComponent(product)}&region=${encodeURIComponent(region)}`;
      const data = await (0, _safeFetch.default)(url, {}, {
        timeout: 10000,
        retries: 2
      });
      return {
        product,
        region,
        volatilityIndex: data.indice_volatilidad || 0,
        riskLevel: data.nivel_riesgo || 'medium',
        isMock: false
      };
    } catch (error) {
      console.log(`SIMIntegration: API failed for ${product} in ${region}: ${error && error.message}`);
      if (!(0, _forceMocks.forceMocksEnabled)()) {
        throw new Error(`SIMIntegration failure: ${error && error.message ? error.message : String(error)}`);
      }
      const volatilities = {
        'rice': 0.12,
        'potatoes': 0.18,
        'corn': 0.15,
        'beans': 0.09
      };
      const volatility = volatilities[product.toLowerCase()] || 0.15;
      const riskLevel = volatility > 0.15 ? 'high' : volatility > 0.10 ? 'medium' : 'low';
      return {
        product,
        region,
        volatilityIndex: volatility,
        riskLevel,
        isMock: true,
        source: 'FALLBACK_MOCK:SIM'
      };
    }
  }
}
var _default = exports.default = SIMIntegration;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfc2FmZUZldGNoIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJfZm9yY2VNb2NrcyIsImUiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsIlNJTUludGVncmF0aW9uIiwiY29uc3RydWN0b3IiLCJiYXNlVXJsIiwicHJvY2VzcyIsImVudiIsIlRFU1RfTU9ERSIsImdldEZvb2RQcmljZXMiLCJwcm9kdWN0IiwicmVnaW9uIiwidXJsIiwiZW5jb2RlVVJJQ29tcG9uZW50IiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwic3BsaXQiLCJkYXRhIiwic2FmZUZldGNoIiwidGltZW91dCIsInJldHJpZXMiLCJwcmljZURhdGEiLCJjdXJyZW50UHJpY2UiLCJwcmVjaW9fYWN0dWFsIiwibWluUHJpY2UiLCJwcmVjaW9fbWluaW1vIiwibWF4UHJpY2UiLCJwcmVjaW9fbWF4aW1vIiwiYXZlcmFnZVByaWNlIiwicHJlY2lvX3Byb21lZGlvIiwidW5pdCIsInVuaWRhZCIsImRhdGUiLCJmZWNoYSIsInNvdXJjZSIsImlzTW9jayIsImVycm9yIiwiY29uc29sZSIsImxvZyIsIm1lc3NhZ2UiLCJmb3JjZU1vY2tzRW5hYmxlZCIsIkVycm9yIiwiU3RyaW5nIiwibW9ja1ByaWNlcyIsImN1cnJlbnQiLCJtaW4iLCJtYXgiLCJhdmciLCJwcm9kdWN0RGF0YSIsInRvTG93ZXJDYXNlIiwiZ2V0UHJpY2VIaXN0b3J5IiwiZGF5cyIsImVuZERhdGUiLCJzdGFydERhdGUiLCJzZXREYXRlIiwiZ2V0RGF0ZSIsImhpc3RvcnlEYXRhIiwicHJlY2lvcyIsIm1hcCIsIml0ZW0iLCJwcmljZSIsInByZWNpbyIsInZvbHVtZSIsInZvbHVtZW4iLCJiYXNlUHJpY2UiLCJyaWNlIiwicG90YXRvZXMiLCJjb3JuIiwiYmVhbnMiLCJpIiwidmFyaWF0aW9uIiwiTWF0aCIsInJhbmRvbSIsInB1c2giLCJyb3VuZCIsImZsb29yIiwiZ2V0Vm9sYXRpbGl0eUluZGV4Iiwidm9sYXRpbGl0eUluZGV4IiwiaW5kaWNlX3ZvbGF0aWxpZGFkIiwicmlza0xldmVsIiwibml2ZWxfcmllc2dvIiwidm9sYXRpbGl0aWVzIiwidm9sYXRpbGl0eSIsIl9kZWZhdWx0IiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbIlNJTUludGVncmF0aW9uLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBzYWZlRmV0Y2ggZnJvbSAnLi4vbGliL3NhZmVGZXRjaC5qcyc7XG5pbXBvcnQgeyBmb3JjZU1vY2tzRW5hYmxlZCB9IGZyb20gJy4uL2xpYi9mb3JjZS1tb2Nrcy5qcyc7XG5cbmNsYXNzIFNJTUludGVncmF0aW9uIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgLy8gU0lNIChTaXN0ZW1hIGRlIEluZm9ybWFjacOzbiBkZSBNZXJjYWRvcykgTUlOQUdSSSBBUElcbiAgICB0aGlzLmJhc2VVcmwgPSBwcm9jZXNzLmVudi5URVNUX01PREUgPT09ICd0cnVlJ1xuICAgICAgPyAnaHR0cDovL21vY2stYXBpLXNlcnZlcjozMDAxL3NpbScgLy8gaW50ZXJuYWwgbW9jayBzZXJ2ZXJcbiAgICAgIDogJ2h0dHBzOi8vc2ltLm1pbmFncmkuZ29iLnBlL2FwaS92MSc7XG4gIH1cblxuICBhc3luYyBnZXRGb29kUHJpY2VzKHByb2R1Y3QsIHJlZ2lvbikge1xuICAgIHRyeSB7XG4gICAgICAvLyBBdHRlbXB0IHRvIGZldGNoIHJlYWwgU0lNIGZvb2QgcHJpY2VzXG4gICAgICBjb25zdCB1cmwgPSBgJHt0aGlzLmJhc2VVcmx9L3ByZWNpb3M/cHJvZHVjdG89JHtlbmNvZGVVUklDb21wb25lbnQocHJvZHVjdCl9JnJlZ2lvbj0ke2VuY29kZVVSSUNvbXBvbmVudChyZWdpb24pfSZmZWNoYT0ke25ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdfWA7XG5cbiAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCBzYWZlRmV0Y2godXJsLCB7fSwgeyB0aW1lb3V0OiAxMDAwMCwgcmV0cmllczogMiB9KTtcblxuICAgICAgLy8gUHJvY2VzcyBwcmljZSBkYXRhXG4gICAgICBjb25zdCBwcmljZURhdGEgPSB7XG4gICAgICAgIHByb2R1Y3Q6IHByb2R1Y3QsXG4gICAgICAgIHJlZ2lvbjogcmVnaW9uIHx8ICdMaW1hJyxcbiAgICAgICAgY3VycmVudFByaWNlOiBkYXRhLnByZWNpb19hY3R1YWwgfHwgMCxcbiAgICAgICAgbWluUHJpY2U6IGRhdGEucHJlY2lvX21pbmltbyB8fCAwLFxuICAgICAgICBtYXhQcmljZTogZGF0YS5wcmVjaW9fbWF4aW1vIHx8IDAsXG4gICAgICAgIGF2ZXJhZ2VQcmljZTogZGF0YS5wcmVjaW9fcHJvbWVkaW8gfHwgMCxcbiAgICAgICAgdW5pdDogZGF0YS51bmlkYWQgfHwgJ1BFTi9rZycsXG4gICAgICAgIGRhdGU6IGRhdGEuZmVjaGEgfHwgbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICBzb3VyY2U6ICdTSU0gTUlOQUdSSSdcbiAgICAgIH07XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHByb2R1Y3QsXG4gICAgICAgIHJlZ2lvbixcbiAgICAgICAgcHJpY2VEYXRhLFxuICAgICAgICBpc01vY2s6IGZhbHNlXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmxvZyhgU0lNSW50ZWdyYXRpb246IEFQSSBmYWlsZWQgZm9yICR7cHJvZHVjdH0gaW4gJHtyZWdpb259OiAke2Vycm9yICYmIGVycm9yLm1lc3NhZ2V9YCk7XG4gICAgICBpZiAoIWZvcmNlTW9ja3NFbmFibGVkKCkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBTSU1JbnRlZ3JhdGlvbiBmYWlsdXJlOiAke2Vycm9yICYmIGVycm9yLm1lc3NhZ2UgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKX1gKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IG1vY2tQcmljZXMgPSB7XG4gICAgICAgICdyaWNlJzogeyBjdXJyZW50OiA0LjUwLCBtaW46IDQuMjAsIG1heDogNC44MCwgYXZnOiA0LjQ1IH0sXG4gICAgICAgICdwb3RhdG9lcyc6IHsgY3VycmVudDogMi4yMCwgbWluOiAxLjgwLCBtYXg6IDIuNjAsIGF2ZzogMi4yNSB9LFxuICAgICAgICAnY29ybic6IHsgY3VycmVudDogMy4xMCwgbWluOiAyLjgwLCBtYXg6IDMuNDAsIGF2ZzogMy4xNSB9LFxuICAgICAgICAnYmVhbnMnOiB7IGN1cnJlbnQ6IDUuODAsIG1pbjogNS4yMCwgbWF4OiA2LjUwLCBhdmc6IDUuODUgfVxuICAgICAgfTtcblxuICAgICAgY29uc3QgcHJvZHVjdERhdGEgPSBtb2NrUHJpY2VzW3Byb2R1Y3QudG9Mb3dlckNhc2UoKV0gfHwgeyBjdXJyZW50OiAzLjAwLCBtaW46IDIuNTAsIG1heDogMy41MCwgYXZnOiAzLjAwIH07XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHByb2R1Y3QsXG4gICAgICAgIHJlZ2lvbixcbiAgICAgICAgcHJpY2VEYXRhOiB7XG4gICAgICAgICAgcHJvZHVjdCxcbiAgICAgICAgICByZWdpb246IHJlZ2lvbiB8fCAnTGltYScsXG4gICAgICAgICAgY3VycmVudFByaWNlOiBwcm9kdWN0RGF0YS5jdXJyZW50LFxuICAgICAgICAgIG1pblByaWNlOiBwcm9kdWN0RGF0YS5taW4sXG4gICAgICAgICAgbWF4UHJpY2U6IHByb2R1Y3REYXRhLm1heCxcbiAgICAgICAgICBhdmVyYWdlUHJpY2U6IHByb2R1Y3REYXRhLmF2ZyxcbiAgICAgICAgICB1bml0OiAnUEVOL2tnJyxcbiAgICAgICAgICBkYXRlOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgc291cmNlOiAnRkFMTEJBQ0tfTU9DSzpTSU0nXG4gICAgICAgIH0sXG4gICAgICAgIGlzTW9jazogdHJ1ZVxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBnZXRQcmljZUhpc3RvcnkocHJvZHVjdCwgcmVnaW9uLCBkYXlzID0gMzApIHtcbiAgICB0cnkge1xuICAgICAgLy8gQXR0ZW1wdCB0byBmZXRjaCByZWFsIFNJTSBwcmljZSBoaXN0b3J5XG4gICAgICBjb25zdCBlbmREYXRlID0gbmV3IERhdGUoKTtcbiAgICAgIGNvbnN0IHN0YXJ0RGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICBzdGFydERhdGUuc2V0RGF0ZShlbmREYXRlLmdldERhdGUoKSAtIGRheXMpO1xuXG4gICAgICBjb25zdCB1cmwgPSBgJHt0aGlzLmJhc2VVcmx9L3ByZWNpb3MvaGlzdG9yaWNvP3Byb2R1Y3RvPSR7ZW5jb2RlVVJJQ29tcG9uZW50KHByb2R1Y3QpfSZyZWdpb249JHtlbmNvZGVVUklDb21wb25lbnQocmVnaW9uKX0mZmVjaGFfaW5pY2lvPSR7c3RhcnREYXRlLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXX0mZmVjaGFfZmluPSR7ZW5kRGF0ZS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF19YDtcblxuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHNhZmVGZXRjaCh1cmwsIHt9LCB7IHRpbWVvdXQ6IDEwMDAwLCByZXRyaWVzOiAyIH0pO1xuXG4gICAgICAvLyBQcm9jZXNzIGhpc3RvcmljYWwgcHJpY2UgZGF0YVxuICAgICAgY29uc3QgaGlzdG9yeURhdGEgPSAoZGF0YS5wcmVjaW9zIHx8IFtdKS5tYXAoaXRlbSA9PiAoe1xuICAgICAgICBkYXRlOiBpdGVtLmZlY2hhLFxuICAgICAgICBwcmljZTogaXRlbS5wcmVjaW8sXG4gICAgICAgIHZvbHVtZTogaXRlbS52b2x1bWVuIHx8IDBcbiAgICAgIH0pKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcHJvZHVjdCxcbiAgICAgICAgcmVnaW9uLFxuICAgICAgICBoaXN0b3J5RGF0YSxcbiAgICAgICAgaXNNb2NrOiBmYWxzZVxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5sb2coYFNJTUludGVncmF0aW9uOiBBUEkgZmFpbGVkIGZvciAke3Byb2R1Y3R9IGluICR7cmVnaW9ufTogJHtlcnJvciAmJiBlcnJvci5tZXNzYWdlfWApO1xuICAgICAgaWYgKCFmb3JjZU1vY2tzRW5hYmxlZCgpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgU0lNSW50ZWdyYXRpb24gZmFpbHVyZTogJHtlcnJvciAmJiBlcnJvci5tZXNzYWdlID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvcil9YCk7XG4gICAgICB9XG4gICAgICAvLyBHZW5lcmF0ZSBtb2NrIGhpc3RvcmljYWwgZGF0YVxuICAgICAgY29uc3QgaGlzdG9yeURhdGEgPSBbXTtcbiAgICAgIGNvbnN0IGJhc2VQcmljZSA9IHsgcmljZTogNC41MCwgcG90YXRvZXM6IDIuMjAsIGNvcm46IDMuMTAsIGJlYW5zOiA1LjgwIH1bcHJvZHVjdC50b0xvd2VyQ2FzZSgpXSB8fCAzLjAwO1xuXG4gICAgICBmb3IgKGxldCBpID0gZGF5czsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGRhdGUuc2V0RGF0ZShkYXRlLmdldERhdGUoKSAtIGkpO1xuICAgICAgICBjb25zdCB2YXJpYXRpb24gPSAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKiAwLjQ7IC8vIMKxMjAlIHZhcmlhdGlvblxuICAgICAgICBjb25zdCBwcmljZSA9IE1hdGgubWF4KDAuMSwgYmFzZVByaWNlICsgdmFyaWF0aW9uKTtcblxuICAgICAgICBoaXN0b3J5RGF0YS5wdXNoKHtcbiAgICAgICAgICBkYXRlOiBkYXRlLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXSxcbiAgICAgICAgICBwcmljZTogTWF0aC5yb3VuZChwcmljZSAqIDEwMCkgLyAxMDAsXG4gICAgICAgICAgdm9sdW1lOiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDAwKSArIDEwMFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcHJvZHVjdCxcbiAgICAgICAgcmVnaW9uLFxuICAgICAgICBoaXN0b3J5RGF0YSxcbiAgICAgICAgaXNNb2NrOiB0cnVlLFxuICAgICAgICBzb3VyY2U6ICdGQUxMQkFDS19NT0NLOlNJTSdcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZ2V0Vm9sYXRpbGl0eUluZGV4KHByb2R1Y3QsIHJlZ2lvbikge1xuICAgIHRyeSB7XG4gICAgICAvLyBBdHRlbXB0IHRvIGZldGNoIHJlYWwgU0lNIHZvbGF0aWxpdHkgZGF0YVxuICAgICAgY29uc3QgdXJsID0gYCR7dGhpcy5iYXNlVXJsfS92b2xhdGlsaWRhZD9wcm9kdWN0bz0ke2VuY29kZVVSSUNvbXBvbmVudChwcm9kdWN0KX0mcmVnaW9uPSR7ZW5jb2RlVVJJQ29tcG9uZW50KHJlZ2lvbil9YDtcblxuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHNhZmVGZXRjaCh1cmwsIHt9LCB7IHRpbWVvdXQ6IDEwMDAwLCByZXRyaWVzOiAyIH0pO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBwcm9kdWN0LFxuICAgICAgICByZWdpb24sXG4gICAgICAgIHZvbGF0aWxpdHlJbmRleDogZGF0YS5pbmRpY2Vfdm9sYXRpbGlkYWQgfHwgMCxcbiAgICAgICAgcmlza0xldmVsOiBkYXRhLm5pdmVsX3JpZXNnbyB8fCAnbWVkaXVtJyxcbiAgICAgICAgaXNNb2NrOiBmYWxzZVxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5sb2coYFNJTUludGVncmF0aW9uOiBBUEkgZmFpbGVkIGZvciAke3Byb2R1Y3R9IGluICR7cmVnaW9ufTogJHtlcnJvciAmJiBlcnJvci5tZXNzYWdlfWApO1xuICAgICAgaWYgKCFmb3JjZU1vY2tzRW5hYmxlZCgpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgU0lNSW50ZWdyYXRpb24gZmFpbHVyZTogJHtlcnJvciAmJiBlcnJvci5tZXNzYWdlID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvcil9YCk7XG4gICAgICB9XG4gICAgICBjb25zdCB2b2xhdGlsaXRpZXMgPSB7XG4gICAgICAgICdyaWNlJzogMC4xMixcbiAgICAgICAgJ3BvdGF0b2VzJzogMC4xOCxcbiAgICAgICAgJ2Nvcm4nOiAwLjE1LFxuICAgICAgICAnYmVhbnMnOiAwLjA5XG4gICAgICB9O1xuXG4gICAgICBjb25zdCB2b2xhdGlsaXR5ID0gdm9sYXRpbGl0aWVzW3Byb2R1Y3QudG9Mb3dlckNhc2UoKV0gfHwgMC4xNTtcbiAgICAgIGNvbnN0IHJpc2tMZXZlbCA9IHZvbGF0aWxpdHkgPiAwLjE1ID8gJ2hpZ2gnIDogdm9sYXRpbGl0eSA+IDAuMTAgPyAnbWVkaXVtJyA6ICdsb3cnO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBwcm9kdWN0LFxuICAgICAgICByZWdpb24sXG4gICAgICAgIHZvbGF0aWxpdHlJbmRleDogdm9sYXRpbGl0eSxcbiAgICAgICAgcmlza0xldmVsLFxuICAgICAgICBpc01vY2s6IHRydWUsXG4gICAgICAgIHNvdXJjZTogJ0ZBTExCQUNLX01PQ0s6U0lNJ1xuICAgICAgfTtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgU0lNSW50ZWdyYXRpb247Il0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFBQSxVQUFBLEdBQUFDLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBQyxXQUFBLEdBQUFELE9BQUE7QUFBMEQsU0FBQUQsdUJBQUFHLENBQUEsV0FBQUEsQ0FBQSxJQUFBQSxDQUFBLENBQUFDLFVBQUEsR0FBQUQsQ0FBQSxLQUFBRSxPQUFBLEVBQUFGLENBQUE7QUFFMUQsTUFBTUcsY0FBYyxDQUFDO0VBQ25CQyxXQUFXQSxDQUFBLEVBQUc7SUFDWjtJQUNBLElBQUksQ0FBQ0MsT0FBTyxHQUFHQyxPQUFPLENBQUNDLEdBQUcsQ0FBQ0MsU0FBUyxLQUFLLE1BQU0sR0FDM0MsaUNBQWlDLENBQUM7SUFBQSxFQUNsQyxtQ0FBbUM7RUFDekM7RUFFQSxNQUFNQyxhQUFhQSxDQUFDQyxPQUFPLEVBQUVDLE1BQU0sRUFBRTtJQUNuQyxJQUFJ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