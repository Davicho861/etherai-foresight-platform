5cddea4ef79d9318370bc8b64e528493
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.closeConnections = closeConnections;
exports.getChromaClient = getChromaClient;
exports.getNeo4jDriver = getNeo4jDriver;
function _neo4jDriver() {
  const data = _interopRequireDefault(require("neo4j-driver"));
  _neo4jDriver = function () {
    return data;
  };
  return data;
}
require("dotenv/config");
function _promises() {
  const data = _interopRequireDefault(require("fs/promises"));
  _promises = function () {
    return data;
  };
  return data;
}
function _path() {
  const data = _interopRequireDefault(require("path"));
  _path = function () {
    return data;
  };
  return data;
}
function _interopRequireDefault(e) { return e && e.__esModule ? e : { default: e }; }
// Prefer process.cwd() when import.meta isn't available (Jest test envs)
let _dirname = process.cwd();
try {
  // When running as ESM, fileURLToPath(import.meta.url) gives accurate dirname
  // but in some test runners import.meta may not be supported in transformed code.
  // Guard it with a try/catch to remain robust.

  // Note: fileURLToPath may not be available when tests transform modules; fallback above
  // keeps behavior stable across environments.
  // ...existing code...
} catch (e) {
  // keep process.cwd() as __dirname
}
// Paths for persisting chroma fallback to disk so native mode can survive restarts
const FALLBACK_DIR = _path().default.join(_dirname, '..', 'data');
const FALLBACK_FILE = _path().default.join(FALLBACK_DIR, 'chroma_fallback.json');
async function loadFallbackFromDisk() {
  try {
    const txt = await _promises().default.readFile(FALLBACK_FILE, 'utf8');
    global.__praevisio_chroma_fallback = JSON.parse(txt);
    console.log('Loaded chroma fallback from disk');
  } catch (e) {
    global.__praevisio_chroma_fallback = global.__praevisio_chroma_fallback || {};
  }
}
async function persistFallbackToDisk() {
  try {
    await _promises().default.mkdir(FALLBACK_DIR, {
      recursive: true
    });
    await _promises().default.writeFile(FALLBACK_FILE, JSON.stringify(global.__praevisio_chroma_fallback || {}, null, 2), 'utf8');
  } catch (e) {
    console.warn('Failed to persist chroma fallback to disk:', e.message);
  }
}

// Load persisted fallback if present (fire-and-forget)
loadFallbackFromDisk().catch(() => {});
let chromaClient;
let neo4jDriver;
const CHROMA_URL = process.env.CHROMA_URL || process.env.OLLAMA_CHROMA_URL || 'http://chromadb:8000';
function textToEmbedding(text, dims = 8) {
  // Lightweight deterministic embedding fallback for local usage.
  // Produces a vector of length `dims` using a simple hash-based scheme.
  const v = new Array(dims).fill(0);
  for (let i = 0; i < text.length; i++) {
    const code = text.charCodeAt(i);
    v[i % dims] = (v[i % dims] + code) % 1000;
  }
  // normalize to floats between -1 and 1
  const max = Math.max(...v.map(Math.abs)) || 1;
  return v.map(x => x / max);
}
function getChromaClient() {
  // If running in native dev mode, avoid calling external Chroma service and
  // provide an in-memory fallback client so the app remains fully functional
  // without external dependencies.
  if (process.env.NATIVE_DEV_MODE === 'true') {
    if (!chromaClient) {
      chromaClient = {
        url: 'native-disabled',
        async isAlive() {
          return false;
        },
        async ensureCollection() {
          return;
        },
        async upsertLog(missionId, log) {
          // keep fallback storage in memory
          const col = `missions_logs`;
          const text = typeof log === 'string' ? log : log.description || JSON.stringify(log);
          const id = `${missionId}-${Date.now().toString(36)}-${Math.floor(Math.random() * 10000)}`;
          const embedding = textToEmbedding(text, 8);
          if (!global.__praevisio_chroma_fallback) global.__praevisio_chroma_fallback = {};
          if (!global.__praevisio_chroma_fallback[col]) global.__praevisio_chroma_fallback[col] = [];
          global.__praevisio_chroma_fallback[col].push({
            id,
            missionId,
            log,
            embedding,
            ts: Date.now()
          });
        },
        async querySimilar(text, topK = 5) {
          if (global.__praevisio_chroma_fallback && global.__praevisio_chroma_fallback['missions_logs']) {
            return global.__praevisio_chroma_fallback['missions_logs'].slice(-topK);
          }
          return [];
        }
      };
    }
    return chromaClient;
  }
  if (!chromaClient) {
    chromaClient = {
      url: CHROMA_URL,
      async isAlive() {
        try {
          const resp = await fetch(`${this.url}/api/v1/heartbeat`, {
            method: 'GET'
          });
          return resp.ok;
        } catch {
          return false;
        }
      },
      async ensureCollection(name) {
        try {
          // Attempt to create collection if it doesn't exist. API surface may differ
          // between Chroma versions; silent-ignore on failure and rely on fallback.
          await fetch(`${this.url}/api/collections`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              name
            })
          }).catch(() => {});
        } catch {
          // ignore
        }
      },
      async upsertLog(missionId, log) {
        const col = `missions_logs`;
        const text = typeof log === 'string' ? log : log.description || JSON.stringify(log);
        const id = `${missionId}-${Date.now().toString(36)}-${Math.floor(Math.random() * 10000)}`;
        const embedding = textToEmbedding(text, 8);
        try {
          const alive = await this.isAlive();
          if (!alive) throw new Error('Chroma unreachable');
          await this.ensureCollection(col);

          // Try the common Chroma REST shape: /api/collections/{name}/points
          const body = {
            ids: [id],
            embeddings: [embedding],
            metadatas: [{
              missionId,
              ...(log || {})
            }],
            documents: [text]
          };
          await fetch(`${this.url}/api/collections/${encodeURIComponent(col)}/points`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(body)
          });
        } catch {
          // Fallback: write to a simple in-memory map so system continues to operate.
          if (!global.__praevisio_chroma_fallback) global.__praevisio_chroma_fallback = {};
          if (!global.__praevisio_chroma_fallback[col]) global.__praevisio_chroma_fallback[col] = [];
          global.__praevisio_chroma_fallback[col].push({
            id,
            missionId,
            log,
            embedding,
            ts: Date.now()
          });
          // Persist fallback to disk asynchronously (best-effort)
          persistFallbackToDisk().catch(() => {});
        }
      },
      async querySimilar(text, topK = 5) {
        try {
          const alive = await this.isAlive();
          if (!alive) throw new Error('Chroma unreachable');
          const embedding = textToEmbedding(text, 8);
          const resp = await fetch(`${this.url}/api/collections/missions_logs/points/search`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              query_embeddings: [embedding],
              n_results: topK
            })
          });
          if (!resp.ok) return [];
          const data = await resp.json();
          return data;
        } catch {
          if (global.__praevisio_chroma_fallback && global.__praevisio_chroma_fallback['missions_logs']) {
            return global.__praevisio_chroma_fallback['missions_logs'].slice(-topK);
          }
          return [];
        }
      }
    };
  }
  return chromaClient;
}
async function getNeo4jDriver() {
  // Prevent Neo4j connections during unit tests to avoid external side effects
  if (process.env.NODE_ENV === 'test') return null;

  // Always attempt to connect to Neo4j - no fallback to null

  if (!neo4jDriver) {
    const host = process.env.NEO4J_HOST || 'localhost';
    const port = process.env.NEO4J_PORT || '7687';
    const user = process.env.NEO4J_USER || 'neo4j';
    const password = process.env.NEO4J_PASSWORD || 'praevisio_password';
    const maxRetries = 5;
    const retryDelay = 2000; // 2 seconds

    for (let attempt = 1; attempt <= maxRetries; attempt++) {
      try {
        neo4jDriver = _neo4jDriver().default.driver(`bolt://${host}:${port}`, _neo4jDriver().default.auth.basic(user, password), {
          maxConnectionPoolSize: 10,
          connectionTimeout: 30000,
          maxTransactionRetryTime: 30000
        });

        // Test the connection
        const session = neo4jDriver.session();
        await session.run('RETURN 1 as test');
        await session.close();
        console.log('Neo4j connection established successfully');
        break;
      } catch (error) {
        console.warn(`Neo4j connection attempt ${attempt}/${maxRetries} failed:`, error.message);
        if (neo4jDriver) {
          await neo4jDriver.close();
          neo4jDriver = null;
        }
        if (attempt === maxRetries) {
          console.error(`Failed to connect to Neo4j after ${maxRetries} attempts: ${error.message}`);
          process.exit(1);
        }
        await new Promise(resolve => setTimeout(resolve, retryDelay));
      }
    }
  }
  return neo4jDriver;
}
async function closeConnections() {
  if (neo4jDriver) {
    await neo4jDriver.close();
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbmVvNGpEcml2ZXIiLCJkYXRhIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJfcHJvbWlzZXMiLCJfcGF0aCIsImUiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsIl9fZGlybmFtZSIsInByb2Nlc3MiLCJjd2QiLCJGQUxMQkFDS19ESVIiLCJwYXRoIiwiam9pbiIsIkZBTExCQUNLX0ZJTEUiLCJsb2FkRmFsbGJhY2tGcm9tRGlzayIsInR4dCIsImZzIiwicmVhZEZpbGUiLCJnbG9iYWwiLCJfX3ByYWV2aXNpb19jaHJvbWFfZmFsbGJhY2siLCJKU09OIiwicGFyc2UiLCJjb25zb2xlIiwibG9nIiwicGVyc2lzdEZhbGxiYWNrVG9EaXNrIiwibWtkaXIiLCJyZWN1cnNpdmUiLCJ3cml0ZUZpbGUiLCJzdHJpbmdpZnkiLCJ3YXJuIiwibWVzc2FnZSIsImNhdGNoIiwiY2hyb21hQ2xpZW50IiwibmVvNGpEcml2ZXIiLCJDSFJPTUFfVVJMIiwiZW52IiwiT0xMQU1BX0NIUk9NQV9VUkwiLCJ0ZXh0VG9FbWJlZGRpbmciLCJ0ZXh0IiwiZGltcyIsInYiLCJBcnJheSIsImZpbGwiLCJpIiwibGVuZ3RoIiwiY29kZSIsImNoYXJDb2RlQXQiLCJtYXgiLCJNYXRoIiwibWFwIiwiYWJzIiwieCIsImdldENocm9tYUNsaWVudCIsIk5BVElWRV9ERVZfTU9ERSIsInVybCIsImlzQWxpdmUiLCJlbnN1cmVDb2xsZWN0aW9uIiwidXBzZXJ0TG9nIiwibWlzc2lvbklkIiwiY29sIiwiZGVzY3JpcHRpb24iLCJpZCIsIkRhdGUiLCJub3ciLCJ0b1N0cmluZyIsImZsb29yIiwicmFuZG9tIiwiZW1iZWRkaW5nIiwicHVzaCIsInRzIiwicXVlcnlTaW1pbGFyIiwidG9wSyIsInNsaWNlIiwicmVzcCIsImZldGNoIiwibWV0aG9kIiwib2siLCJuYW1lIiwiaGVhZGVycyIsImJvZHkiLCJhbGl2ZSIsIkVycm9yIiwiaWRzIiwiZW1iZWRkaW5ncyIsIm1ldGFkYXRhcyIsImRvY3VtZW50cyIsImVuY29kZVVSSUNvbXBvbmVudCIsInF1ZXJ5X2VtYmVkZGluZ3MiLCJuX3Jlc3VsdHMiLCJqc29uIiwiZ2V0TmVvNGpEcml2ZXIiLCJOT0RFX0VOViIsImhvc3QiLCJORU80Sl9IT1NUIiwicG9ydCIsIk5FTzRKX1BPUlQiLCJ1c2VyIiwiTkVPNEpfVVNFUiIsInBhc3N3b3JkIiwiTkVPNEpfUEFTU1dPUkQiLCJtYXhSZXRyaWVzIiwicmV0cnlEZWxheSIsImF0dGVtcHQiLCJuZW80aiIsImRyaXZlciIsImF1dGgiLCJiYXNpYyIsIm1heENvbm5lY3Rpb25Qb29sU2l6ZSIsImNvbm5lY3Rpb25UaW1lb3V0IiwibWF4VHJhbnNhY3Rpb25SZXRyeVRpbWUiLCJzZXNzaW9uIiwicnVuIiwiY2xvc2UiLCJlcnJvciIsImV4aXQiLCJQcm9taXNlIiwicmVzb2x2ZSIsInNldFRpbWVvdXQiLCJjbG9zZUNvbm5lY3Rpb25zIl0sInNvdXJjZXMiOlsiZGF0YWJhc2UuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IG5lbzRqIGZyb20gJ25lbzRqLWRyaXZlcic7XG5pbXBvcnQgJ2RvdGVudi9jb25maWcnO1xuaW1wb3J0IGZzIGZyb20gJ2ZzL3Byb21pc2VzJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuLy8gUHJlZmVyIHByb2Nlc3MuY3dkKCkgd2hlbiBpbXBvcnQubWV0YSBpc24ndCBhdmFpbGFibGUgKEplc3QgdGVzdCBlbnZzKVxubGV0IF9fZGlybmFtZSA9IHByb2Nlc3MuY3dkKCk7XG50cnkge1xuICAvLyBXaGVuIHJ1bm5pbmcgYXMgRVNNLCBmaWxlVVJMVG9QYXRoKGltcG9ydC5tZXRhLnVybCkgZ2l2ZXMgYWNjdXJhdGUgZGlybmFtZVxuICAvLyBidXQgaW4gc29tZSB0ZXN0IHJ1bm5lcnMgaW1wb3J0Lm1ldGEgbWF5IG5vdCBiZSBzdXBwb3J0ZWQgaW4gdHJhbnNmb3JtZWQgY29kZS5cbiAgLy8gR3VhcmQgaXQgd2l0aCBhIHRyeS9jYXRjaCB0byByZW1haW4gcm9idXN0LlxuICAgXG4gIC8vIE5vdGU6IGZpbGVVUkxUb1BhdGggbWF5IG5vdCBiZSBhdmFpbGFibGUgd2hlbiB0ZXN0cyB0cmFuc2Zvcm0gbW9kdWxlczsgZmFsbGJhY2sgYWJvdmVcbiAgLy8ga2VlcHMgYmVoYXZpb3Igc3RhYmxlIGFjcm9zcyBlbnZpcm9ubWVudHMuXG4gIC8vIC4uLmV4aXN0aW5nIGNvZGUuLi5cbn0gY2F0Y2ggKGUpIHtcbiAgLy8ga2VlcCBwcm9jZXNzLmN3ZCgpIGFzIF9fZGlybmFtZVxufVxuLy8gUGF0aHMgZm9yIHBlcnNpc3RpbmcgY2hyb21hIGZhbGxiYWNrIHRvIGRpc2sgc28gbmF0aXZlIG1vZGUgY2FuIHN1cnZpdmUgcmVzdGFydHNcbmNvbnN0IEZBTExCQUNLX0RJUiA9IHBhdGguam9pbihfX2Rpcm5hbWUsICcuLicsICdkYXRhJyk7XG5jb25zdCBGQUxMQkFDS19GSUxFID0gcGF0aC5qb2luKEZBTExCQUNLX0RJUiwgJ2Nocm9tYV9mYWxsYmFjay5qc29uJyk7XG5cbmFzeW5jIGZ1bmN0aW9uIGxvYWRGYWxsYmFja0Zyb21EaXNrKCkge1xuICB0cnkge1xuICAgIGNvbnN0IHR4dCA9IGF3YWl0IGZzLnJlYWRGaWxlKEZBTExCQUNLX0ZJTEUsICd1dGY4Jyk7XG4gICAgZ2xvYmFsLl9fcHJhZXZpc2lvX2Nocm9tYV9mYWxsYmFjayA9IEpTT04ucGFyc2UodHh0KTtcbiAgICBjb25zb2xlLmxvZygnTG9hZGVkIGNocm9tYSBmYWxsYmFjayBmcm9tIGRpc2snKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGdsb2JhbC5fX3ByYWV2aXNpb19jaHJvbWFfZmFsbGJhY2sgPSBnbG9iYWwuX19wcmFldmlzaW9fY2hyb21hX2ZhbGxiYWNrIHx8IHt9O1xuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHBlcnNpc3RGYWxsYmFja1RvRGlzaygpIHtcbiAgdHJ5IHtcbiAgICBhd2FpdCBmcy5ta2RpcihGQUxMQkFDS19ESVIsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xuICAgIGF3YWl0IGZzLndyaXRlRmlsZShGQUxMQkFDS19GSUxFLCBKU09OLnN0cmluZ2lmeShnbG9iYWwuX19wcmFldmlzaW9fY2hyb21hX2ZhbGxiYWNrIHx8IHt9LCBudWxsLCAyKSwgJ3V0ZjgnKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGNvbnNvbGUud2FybignRmFpbGVkIHRvIHBlcnNpc3QgY2hyb21hIGZhbGxiYWNrIHRvIGRpc2s6JywgZS5tZXNzYWdlKTtcbiAgfVxufVxuXG4vLyBMb2FkIHBlcnNpc3RlZCBmYWxsYmFjayBpZiBwcmVzZW50IChmaXJlLWFuZC1mb3JnZXQpXG5sb2FkRmFsbGJhY2tGcm9tRGlzaygpLmNhdGNoKCgpID0+IHt9KTtcblxubGV0IGNocm9tYUNsaWVudDtcbmxldCBuZW80akRyaXZlcjtcblxuY29uc3QgQ0hST01BX1VSTCA9IHByb2Nlc3MuZW52LkNIUk9NQV9VUkwgfHwgcHJvY2Vzcy5lbnYuT0xMQU1BX0NIUk9NQV9VUkwgfHwgJ2h0dHA6Ly9jaHJvbWFkYjo4MDAwJztcblxuZnVuY3Rpb24gdGV4dFRvRW1iZWRkaW5nKHRleHQsIGRpbXMgPSA4KSB7XG4gIC8vIExpZ2h0d2VpZ2h0IGRldGVybWluaXN0aWMgZW1iZWRkaW5nIGZhbGxiYWNrIGZvciBsb2NhbCB1c2FnZS5cbiAgLy8gUHJvZHVjZXMgYSB2ZWN0b3Igb2YgbGVuZ3RoIGBkaW1zYCB1c2luZyBhIHNpbXBsZSBoYXNoLWJhc2VkIHNjaGVtZS5cbiAgY29uc3QgdiA9IG5ldyBBcnJheShkaW1zKS5maWxsKDApO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IHRleHQubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBjb2RlID0gdGV4dC5jaGFyQ29kZUF0KGkpO1xuICAgIHZbaSAlIGRpbXNdID0gKHZbaSAlIGRpbXNdICsgY29kZSkgJSAxMDAwO1xuICB9XG4gIC8vIG5vcm1hbGl6ZSB0byBmbG9hdHMgYmV0d2VlbiAtMSBhbmQgMVxuICBjb25zdCBtYXggPSBNYXRoLm1heCguLi52Lm1hcChNYXRoLmFicykpIHx8IDE7XG4gIHJldHVybiB2Lm1hcCgoeCkgPT4gKHggLyBtYXgpKTtcbn1cblxuZnVuY3Rpb24gZ2V0Q2hyb21hQ2xpZW50KCkge1xuICAvLyBJZiBydW5uaW5nIGluIG5hdGl2ZSBkZXYgbW9kZSwgYXZvaWQgY2FsbGluZyBleHRlcm5hbCBDaHJvbWEgc2VydmljZSBhbmRcbiAgLy8gcHJvdmlkZSBhbiBpbi1tZW1vcnkgZmFsbGJhY2sgY2xpZW50IHNvIHRoZSBhcHAgcmVtYWlucyBmdWxseSBmdW5jdGlvbmFsXG4gIC8vIHdpdGhvdXQgZXh0ZXJuYWwgZGVwZW5kZW5jaWVzLlxuICBpZiAocHJvY2Vzcy5lbnYuTkFUSVZFX0RFVl9NT0RFID09PSAndHJ1ZScpIHtcbiAgICBpZiAoIWNocm9tYUNsaWVudCkge1xuICAgICAgY2hyb21hQ2xpZW50ID0ge1xuICAgICAgICB1cmw6ICduYXRpdmUtZGlzYWJsZWQnLFxuICAgICAgICBhc3luYyBpc0FsaXZlKCkgeyByZXR1cm4gZmFsc2U7IH0sXG4gICAgICAgIGFzeW5jIGVuc3VyZUNvbGxlY3Rpb24oKSB7IHJldHVybjsgfSxcbiAgICAgICAgYXN5bmMgdXBzZXJ0TG9nKG1pc3Npb25JZCwgbG9nKSB7XG4gICAgICAgICAgLy8ga2VlcCBmYWxsYmFjayBzdG9yYWdlIGluIG1lbW9yeVxuICAgICAgICAgIGNvbnN0IGNvbCA9IGBtaXNzaW9uc19sb2dzYDtcbiAgICAgICAgICBjb25zdCB0ZXh0ID0gdHlwZW9mIGxvZyA9PT0gJ3N0cmluZycgPyBsb2cgOiAobG9nLmRlc2NyaXB0aW9uIHx8IEpTT04uc3RyaW5naWZ5KGxvZykpO1xuICAgICAgICAgIGNvbnN0IGlkID0gYCR7bWlzc2lvbklkfS0keyhEYXRlLm5vdygpKS50b1N0cmluZygzNil9LSR7TWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwMDApfWA7XG4gICAgICAgICAgY29uc3QgZW1iZWRkaW5nID0gdGV4dFRvRW1iZWRkaW5nKHRleHQsIDgpO1xuICAgICAgICAgIGlmICghZ2xvYmFsLl9fcHJhZXZpc2lvX2Nocm9tYV9mYWxsYmFjaykgZ2xvYmFsLl9fcHJhZXZpc2lvX2Nocm9tYV9mYWxsYmFjayA9IHt9O1xuICAgICAgICAgIGlmICghZ2xvYmFsLl9fcHJhZXZpc2lvX2Nocm9tYV9mYWxsYmFja1tjb2xdKSBnbG9iYWwuX19wcmFldmlzaW9fY2hyb21hX2ZhbGxiYWNrW2NvbF0gPSBbXTtcbiAgICAgICAgICBnbG9iYWwuX19wcmFldmlzaW9fY2hyb21hX2ZhbGxiYWNrW2NvbF0ucHVzaCh7IGlkLCBtaXNzaW9uSWQsIGxvZywgZW1iZWRkaW5nLCB0czogRGF0ZS5ub3coKSB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgYXN5bmMgcXVlcnlTaW1pbGFyKHRleHQsIHRvcEsgPSA1KSB7XG4gICAgICAgICAgaWYgKGdsb2JhbC5fX3ByYWV2aXNpb19jaHJvbWFfZmFsbGJhY2sgJiYgZ2xvYmFsLl9fcHJhZXZpc2lvX2Nocm9tYV9mYWxsYmFja1snbWlzc2lvbnNfbG9ncyddKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2xvYmFsLl9fcHJhZXZpc2lvX2Nocm9tYV9mYWxsYmFja1snbWlzc2lvbnNfbG9ncyddLnNsaWNlKC10b3BLKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4gY2hyb21hQ2xpZW50O1xuICB9XG5cbiAgaWYgKCFjaHJvbWFDbGllbnQpIHtcbiAgICBjaHJvbWFDbGllbnQgPSB7XG4gICAgICB1cmw6IENIUk9NQV9VUkwsXG4gICAgICBhc3luYyBpc0FsaXZlKCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IHJlc3AgPSBhd2FpdCBmZXRjaChgJHt0aGlzLnVybH0vYXBpL3YxL2hlYXJ0YmVhdGAsIHsgbWV0aG9kOiAnR0VUJyB9KTtcbiAgICAgICAgICByZXR1cm4gcmVzcC5vaztcbiAgICAgICAgfSBjYXRjaCB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgYXN5bmMgZW5zdXJlQ29sbGVjdGlvbihuYW1lKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgLy8gQXR0ZW1wdCB0byBjcmVhdGUgY29sbGVjdGlvbiBpZiBpdCBkb2Vzbid0IGV4aXN0LiBBUEkgc3VyZmFjZSBtYXkgZGlmZmVyXG4gICAgICAgICAgLy8gYmV0d2VlbiBDaHJvbWEgdmVyc2lvbnM7IHNpbGVudC1pZ25vcmUgb24gZmFpbHVyZSBhbmQgcmVseSBvbiBmYWxsYmFjay5cbiAgICAgICAgICBhd2FpdCBmZXRjaChgJHt0aGlzLnVybH0vYXBpL2NvbGxlY3Rpb25zYCwge1xuICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfSxcbiAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgbmFtZSB9KSxcbiAgICAgICAgICB9KS5jYXRjaCgoKSA9PiB7fSk7XG4gICAgICAgIH0gY2F0Y2gge1xuICAgICAgICAgIC8vIGlnbm9yZVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgYXN5bmMgdXBzZXJ0TG9nKG1pc3Npb25JZCwgbG9nKSB7XG4gICAgICAgIGNvbnN0IGNvbCA9IGBtaXNzaW9uc19sb2dzYDtcbiAgICAgICAgY29uc3QgdGV4dCA9IHR5cGVvZiBsb2cgPT09ICdzdHJpbmcnID8gbG9nIDogKGxvZy5kZXNjcmlwdGlvbiB8fCBKU09OLnN0cmluZ2lmeShsb2cpKTtcbiAgICAgICAgY29uc3QgaWQgPSBgJHttaXNzaW9uSWR9LSR7KERhdGUubm93KCkpLnRvU3RyaW5nKDM2KX0tJHtNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDAwMCl9YDtcbiAgICAgICAgY29uc3QgZW1iZWRkaW5nID0gdGV4dFRvRW1iZWRkaW5nKHRleHQsIDgpO1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBhbGl2ZSA9IGF3YWl0IHRoaXMuaXNBbGl2ZSgpO1xuICAgICAgICAgICAgaWYgKCFhbGl2ZSkgdGhyb3cgbmV3IEVycm9yKCdDaHJvbWEgdW5yZWFjaGFibGUnKTtcblxuICAgICAgICAgICAgYXdhaXQgdGhpcy5lbnN1cmVDb2xsZWN0aW9uKGNvbCk7XG5cbiAgICAgICAgICAgIC8vIFRyeSB0aGUgY29tbW9uIENocm9tYSBSRVNUIHNoYXBlOiAvYXBpL2NvbGxlY3Rpb25zL3tuYW1lfS9wb2ludHNcbiAgICAgICAgICAgIGNvbnN0IGJvZHkgPSB7XG4gICAgICAgICAgICAgIGlkczogW2lkXSxcbiAgICAgICAgICAgICAgZW1iZWRkaW5nczogW2VtYmVkZGluZ10sXG4gICAgICAgICAgICAgIG1ldGFkYXRhczogW3sgbWlzc2lvbklkLCAuLi4obG9nIHx8IHt9KSB9XSxcbiAgICAgICAgICAgICAgZG9jdW1lbnRzOiBbdGV4dF0sXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgYXdhaXQgZmV0Y2goYCR7dGhpcy51cmx9L2FwaS9jb2xsZWN0aW9ucy8ke2VuY29kZVVSSUNvbXBvbmVudChjb2wpfS9wb2ludHNgLCB7XG4gICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfSxcbiAgICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoYm9keSksXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9IGNhdGNoIHtcbiAgICAgICAgICAgIC8vIEZhbGxiYWNrOiB3cml0ZSB0byBhIHNpbXBsZSBpbi1tZW1vcnkgbWFwIHNvIHN5c3RlbSBjb250aW51ZXMgdG8gb3BlcmF0ZS5cbiAgICAgICAgICAgIGlmICghZ2xvYmFsLl9fcHJhZXZpc2lvX2Nocm9tYV9mYWxsYmFjaykgZ2xvYmFsLl9fcHJhZXZpc2lvX2Nocm9tYV9mYWxsYmFjayA9IHt9O1xuICAgICAgICAgICAgaWYgKCFnbG9iYWwuX19wcmFldmlzaW9fY2hyb21hX2ZhbGxiYWNrW2NvbF0pIGdsb2JhbC5fX3ByYWV2aXNpb19jaHJvbWFfZmFsbGJhY2tbY29sXSA9IFtdO1xuICAgICAgICAgICAgZ2xvYmFsLl9fcHJhZXZpc2lvX2Nocm9tYV9mYWxsYmFja1tjb2xdLnB1c2goeyBpZCwgbWlzc2lvbklkLCBsb2csIGVtYmVkZGluZywgdHM6IERhdGUubm93KCkgfSk7XG4gICAgICAgICAgICAvLyBQZXJzaXN0IGZhbGxiYWNrIHRvIGRpc2sgYXN5bmNocm9ub3VzbHkgKGJlc3QtZWZmb3J0KVxuICAgICAgICAgICAgcGVyc2lzdEZhbGxiYWNrVG9EaXNrKCkuY2F0Y2goKCkgPT4ge30pO1xuICAgICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBhc3luYyBxdWVyeVNpbWlsYXIodGV4dCwgdG9wSyA9IDUpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCBhbGl2ZSA9IGF3YWl0IHRoaXMuaXNBbGl2ZSgpO1xuICAgICAgICAgIGlmICghYWxpdmUpIHRocm93IG5ldyBFcnJvcignQ2hyb21hIHVucmVhY2hhYmxlJyk7XG4gICAgICAgICAgY29uc3QgZW1iZWRkaW5nID0gdGV4dFRvRW1iZWRkaW5nKHRleHQsIDgpO1xuICAgICAgICAgIGNvbnN0IHJlc3AgPSBhd2FpdCBmZXRjaChgJHt0aGlzLnVybH0vYXBpL2NvbGxlY3Rpb25zL21pc3Npb25zX2xvZ3MvcG9pbnRzL3NlYXJjaGAsIHtcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH0sXG4gICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IHF1ZXJ5X2VtYmVkZGluZ3M6IFtlbWJlZGRpbmddLCBuX3Jlc3VsdHM6IHRvcEsgfSksXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgaWYgKCFyZXNwLm9rKSByZXR1cm4gW107XG4gICAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3AuanNvbigpO1xuICAgICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICB9IGNhdGNoIHtcbiAgICAgICAgICBpZiAoZ2xvYmFsLl9fcHJhZXZpc2lvX2Nocm9tYV9mYWxsYmFjayAmJiBnbG9iYWwuX19wcmFldmlzaW9fY2hyb21hX2ZhbGxiYWNrWydtaXNzaW9uc19sb2dzJ10pIHtcbiAgICAgICAgICAgIHJldHVybiBnbG9iYWwuX19wcmFldmlzaW9fY2hyb21hX2ZhbGxiYWNrWydtaXNzaW9uc19sb2dzJ10uc2xpY2UoLXRvcEspO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuICB9XG4gIHJldHVybiBjaHJvbWFDbGllbnQ7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldE5lbzRqRHJpdmVyKCkge1xuICAvLyBQcmV2ZW50IE5lbzRqIGNvbm5lY3Rpb25zIGR1cmluZyB1bml0IHRlc3RzIHRvIGF2b2lkIGV4dGVybmFsIHNpZGUgZWZmZWN0c1xuICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICd0ZXN0JykgcmV0dXJuIG51bGw7XG5cbiAgLy8gQWx3YXlzIGF0dGVtcHQgdG8gY29ubmVjdCB0byBOZW80aiAtIG5vIGZhbGxiYWNrIHRvIG51bGxcblxuICBpZiAoIW5lbzRqRHJpdmVyKSB7XG4gICAgY29uc3QgaG9zdCA9IHByb2Nlc3MuZW52Lk5FTzRKX0hPU1QgfHwgJ2xvY2FsaG9zdCc7XG4gICAgY29uc3QgcG9ydCA9IHByb2Nlc3MuZW52Lk5FTzRKX1BPUlQgfHwgJzc2ODcnO1xuICAgIGNvbnN0IHVzZXIgPSBwcm9jZXNzLmVudi5ORU80Sl9VU0VSIHx8ICduZW80aic7XG4gICAgY29uc3QgcGFzc3dvcmQgPSBwcm9jZXNzLmVudi5ORU80Sl9QQVNTV09SRCB8fCAncHJhZXZpc2lvX3Bhc3N3b3JkJztcbiAgICBjb25zdCBtYXhSZXRyaWVzID0gNTtcbiAgICBjb25zdCByZXRyeURlbGF5ID0gMjAwMDsgLy8gMiBzZWNvbmRzXG5cbiAgICBmb3IgKGxldCBhdHRlbXB0ID0gMTsgYXR0ZW1wdCA8PSBtYXhSZXRyaWVzOyBhdHRlbXB0KyspIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIG5lbzRqRHJpdmVyID0gbmVvNGouZHJpdmVyKGBib2x0Oi8vJHtob3N0fToke3BvcnR9YCwgbmVvNGouYXV0aC5iYXNpYyh1c2VyLCBwYXNzd29yZCksIHtcbiAgICAgICAgICBtYXhDb25uZWN0aW9uUG9vbFNpemU6IDEwLFxuICAgICAgICAgIGNvbm5lY3Rpb25UaW1lb3V0OiAzMDAwMCxcbiAgICAgICAgICBtYXhUcmFuc2FjdGlvblJldHJ5VGltZTogMzAwMDAsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFRlc3QgdGhlIGNvbm5lY3Rpb25cbiAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IG5lbzRqRHJpdmVyLnNlc3Npb24oKTtcbiAgICAgICAgYXdhaXQgc2Vzc2lvbi5ydW4oJ1JFVFVSTiAxIGFzIHRlc3QnKTtcbiAgICAgICAgYXdhaXQgc2Vzc2lvbi5jbG9zZSgpO1xuXG4gICAgICAgIGNvbnNvbGUubG9nKCdOZW80aiBjb25uZWN0aW9uIGVzdGFibGlzaGVkIHN1Y2Nlc3NmdWxseScpO1xuICAgICAgICBicmVhaztcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUud2FybihgTmVvNGogY29ubmVjdGlvbiBhdHRlbXB0ICR7YXR0ZW1wdH0vJHttYXhSZXRyaWVzfSBmYWlsZWQ6YCwgZXJyb3IubWVzc2FnZSk7XG4gICAgICAgIGlmIChuZW80akRyaXZlcikge1xuICAgICAgICAgIGF3YWl0IG5lbzRqRHJpdmVyLmNsb3NlKCk7XG4gICAgICAgICAgbmVvNGpEcml2ZXIgPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGlmIChhdHRlbXB0ID09PSBtYXhSZXRyaWVzKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGNvbm5lY3QgdG8gTmVvNGogYWZ0ZXIgJHttYXhSZXRyaWVzfSBhdHRlbXB0czogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgICAgICAgIHByb2Nlc3MuZXhpdCgxKTtcbiAgICAgICAgfVxuICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgcmV0cnlEZWxheSkpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gbmVvNGpEcml2ZXI7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGNsb3NlQ29ubmVjdGlvbnMoKSB7XG4gIGlmIChuZW80akRyaXZlcikge1xuICAgIGF3YWl0IG5lbzRqRHJpdmVyLmNsb3NlKCk7XG4gIH1cbn1cblxuZXhwb3J0IHtcbiAgZ2V0Q2hyb21hQ2xpZW50LFxuICBnZXROZW80akRyaXZlcixcbiAgY2xvc2VDb25uZWN0aW9ucyxcbn07XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUEsU0FBQUEsYUFBQTtFQUFBLE1BQUFDLElBQUEsR0FBQUMsc0JBQUEsQ0FBQUMsT0FBQTtFQUFBSCxZQUFBLFlBQUFBLENBQUE7SUFBQSxPQUFBQyxJQUFBO0VBQUE7RUFBQSxPQUFBQSxJQUFBO0FBQUE7QUFDQUUsT0FBQTtBQUNBLFNBQUFDLFVBQUE7RUFBQSxNQUFBSCxJQUFBLEdBQUFDLHNCQUFBLENBQUFDLE9BQUE7RUFBQUMsU0FBQSxZQUFBQSxDQUFBO0lBQUEsT0FBQUgsSUFBQTtFQUFBO0VBQUEsT0FBQUEsSUFBQTtBQUFBO0FBQ0EsU0FBQUksTUFBQTtFQUFBLE1BQUFKLElBQUEsR0FBQUMsc0JBQUEsQ0FBQUMsT0FBQTtFQUFBRSxLQUFBLFlBQUFBLENBQUE7SUFBQSxPQUFBSixJQUFBO0VBQUE7RUFBQSxPQUFBQSxJQUFBO0FBQUE7QUFBd0IsU0FBQUMsdUJBQUFJLENBQUEsV0FBQUEsQ0FBQSxJQUFBQSxDQUFBLENBQUFDLFVBQUEsR0FBQUQsQ0FBQSxLQUFBRSxPQUFBLEVBQUFGLENBQUE7QUFDeEI7QUFDQSxJQUFJRyxR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