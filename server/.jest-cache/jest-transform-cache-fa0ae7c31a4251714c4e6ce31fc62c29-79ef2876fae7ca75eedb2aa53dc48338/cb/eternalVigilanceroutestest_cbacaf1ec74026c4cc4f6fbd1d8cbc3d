ee93833dfca9f9ba7c279f8205932990
"use strict";

var _server = require("../mocks/server.js");
const express = require('express');
const request = require('supertest');
describe('eternalVigilance routes - stream and token', () => {
  beforeAll(() => {
    _server.server.listen();
  });
  afterAll(() => {
    _server.server.close();
  });
  beforeEach(() => {
    jest.resetModules();
    process.env.NODE_ENV = 'test';
    // ensure predictable default bearer token unless overridden in test
    process.env.PRAEVISIO_BEARER_TOKEN = process.env.PRAEVISIO_BEARER_TOKEN || 'demo-token';
  });
  afterEach(() => {
    delete process.env.PRAEVISIO_BEARER_TOKEN;
    jest.clearAllMocks();
  });
  test('GET /stream returns 401 when no token provided or invalid', async () => {
    // mock sseTokenService.validateToken -> false
    jest.doMock('../../src/sseTokenService.js', () => ({
      validateToken: jest.fn().mockResolvedValue(false)
    }));
    const router = require('../../src/routes/eternalVigilanceStream.js').default || require('../../src/routes/eternalVigilanceStream.js');
    const app = express();
    app.use('/api/eternal-vigilance', router);
    const res = await request(app).get('/api/eternal-vigilance/stream');
    expect(res.status).toBe(401);
    expect(res.body).toHaveProperty('error');
  });
  test('GET /stream allows static token via cookie and writes initial SSE state', async () => {
    // mock vigilance service
    // make subscribe end the response immediately to avoid leaving SSE open
    const mockSubscribe = jest.fn(res => {
      try {
        res.end();
      } catch (e) {/* ignore */}
    });
    const mockUnsubscribe = jest.fn();
    const mockGetState = jest.fn().mockReturnValue({
      hello: 'world'
    });
    jest.doMock('../../src/eternalVigilanceService.js', () => ({
      subscribe: mockSubscribe,
      unsubscribe: mockUnsubscribe,
      getState: mockGetState
    }));
    // mock sseTokenService.validateToken -> false to force static check path
    jest.doMock('../../src/sseTokenService.js', () => ({
      validateToken: jest.fn().mockResolvedValue(false)
    }));

    // ensure static token
    process.env.PRAEVISIO_BEARER_TOKEN = 'STATIC-TOKEN';
    const router = require('../../src/routes/eternalVigilanceStream.js').default || require('../../src/routes/eternalVigilanceStream.js');
    const cookieParser = require('cookie-parser');
    const app = express();
    app.use(cookieParser());
    app.use('/api/eternal-vigilance', router);
    const res = await request(app).get('/api/eternal-vigilance/stream').set('Cookie', 'praevisio_sse_token=STATIC-TOKEN');
    expect(res.status).toBe(200);
    expect(res.headers['content-type']).toMatch(/text\/event-stream/);
    // initial SSE data includes event:init and the JSON state
    expect(res.text).toMatch(/"event":"init"/);
    expect(mockSubscribe).toHaveBeenCalled();
  });
  test('GET /stream allows temporary tokens validated by sseTokenService', async () => {
    const mockSubscribe = jest.fn(res => {
      try {
        res.end();
      } catch (e) {}
    });
    const mockGetState = jest.fn().mockReturnValue({
      ok: true
    });
    jest.doMock('../../src/eternalVigilanceService.js', () => ({
      subscribe: mockSubscribe,
      unsubscribe: jest.fn(),
      getState: mockGetState
    }));

    // mock validateToken -> true
    jest.doMock('../../src/sseTokenService.js', () => ({
      validateToken: jest.fn().mockResolvedValue(true)
    }));
    const router = require('../../src/routes/eternalVigilanceStream.js').default || require('../../src/routes/eternalVigilanceStream.js');
    const app = express();
    app.use(require('cookie-parser')());
    app.use('/api/eternal-vigilance', router);
    const res = await request(app).get('/api/eternal-vigilance/stream').query({
      token: 'TEMP-TOKEN'
    });
    expect(res.status).toBe(200);
    expect(res.headers['content-type']).toMatch(/text\/event-stream/);
    expect(res.text).toMatch(/"event":"init"/);
    expect(mockSubscribe).toHaveBeenCalled();
  });
  test('POST /token returns token, sets cookie on success', async () => {
    // mock express-rate-limit to bypass limiter middleware
    jest.doMock('express-rate-limit', () => opts => (req, res, next) => next());
    const now = Date.now();
    const mocked = {
      token: 'GEN-TOKEN',
      expiresAt: now + 60000
    };
    jest.doMock('../../src/sseTokenService.js', () => ({
      generateToken: jest.fn().mockResolvedValue(mocked)
    }));
    const router = require('../../src/routes/eternalVigilanceToken.js').default || require('../../src/routes/eternalVigilanceToken.js');
    const app = express();
    app.use(express.json());
    app.use('/api/eternal-vigilance', router);
    const res = await request(app).post('/api/eternal-vigilance/token').send({
      ttl: 30
    });
    expect(res.status).toBe(200);
    expect(res.body).toHaveProperty('token', 'GEN-TOKEN');
    expect(res.body).toHaveProperty('expiresAt');
    // cookie header should be set
    expect(res.headers['set-cookie']).toBeDefined();
    expect(res.headers['set-cookie'][0]).toMatch(/praevisio_sse_token=GEN-TOKEN/);
  });
  test('POST /token returns 500 when generateToken throws', async () => {
    jest.doMock('express-rate-limit', () => opts => (req, res, next) => next());
    jest.doMock('../../src/sseTokenService.js', () => ({
      generateToken: jest.fn().mockRejectedValue(new Error('boom'))
    }));
    const router = require('../../src/routes/eternalVigilanceToken.js').default || require('../../src/routes/eternalVigilanceToken.js');
    const app = express();
    app.use(express.json());
    app.use('/api/eternal-vigilance', router);
    const res = await request(app).post('/api/eternal-vigilance/token').send({
      ttl: 30
    });
    expect(res.status).toBe(500);
    expect(res.body).toHaveProperty('error');
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfc2VydmVyIiwicmVxdWlyZSIsImV4cHJlc3MiLCJyZXF1ZXN0IiwiZGVzY3JpYmUiLCJiZWZvcmVBbGwiLCJzZXJ2ZXIiLCJsaXN0ZW4iLCJhZnRlckFsbCIsImNsb3NlIiwiYmVmb3JlRWFjaCIsImplc3QiLCJyZXNldE1vZHVsZXMiLCJwcm9jZXNzIiwiZW52IiwiTk9ERV9FTlYiLCJQUkFFVklTSU9fQkVBUkVSX1RPS0VOIiwiYWZ0ZXJFYWNoIiwiY2xlYXJBbGxNb2NrcyIsInRlc3QiLCJkb01vY2siLCJ2YWxpZGF0ZVRva2VuIiwiZm4iLCJtb2NrUmVzb2x2ZWRWYWx1ZSIsInJvdXRlciIsImRlZmF1bHQiLCJhcHAiLCJ1c2UiLCJyZXMiLCJnZXQiLCJleHBlY3QiLCJzdGF0dXMiLCJ0b0JlIiwiYm9keSIsInRvSGF2ZVByb3BlcnR5IiwibW9ja1N1YnNjcmliZSIsImVuZCIsImUiLCJtb2NrVW5zdWJzY3JpYmUiLCJtb2NrR2V0U3RhdGUiLCJtb2NrUmV0dXJuVmFsdWUiLCJoZWxsbyIsInN1YnNjcmliZSIsInVuc3Vic2NyaWJlIiwiZ2V0U3RhdGUiLCJjb29raWVQYXJzZXIiLCJzZXQiLCJoZWFkZXJzIiwidG9NYXRjaCIsInRleHQiLCJ0b0hhdmVCZWVuQ2FsbGVkIiwib2siLCJxdWVyeSIsInRva2VuIiwib3B0cyIsInJlcSIsIm5leHQiLCJub3ciLCJEYXRlIiwibW9ja2VkIiwiZXhwaXJlc0F0IiwiZ2VuZXJhdGVUb2tlbiIsImpzb24iLCJwb3N0Iiwic2VuZCIsInR0bCIsInRvQmVEZWZpbmVkIiwibW9ja1JlamVjdGVkVmFsdWUiLCJFcnJvciJdLCJzb3VyY2VzIjpbImV0ZXJuYWxWaWdpbGFuY2Uucm91dGVzLnRlc3QuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgc2VydmVyIH0gZnJvbSAnLi4vbW9ja3Mvc2VydmVyLmpzJztcbmNvbnN0IGV4cHJlc3MgPSByZXF1aXJlKCdleHByZXNzJylcbmNvbnN0IHJlcXVlc3QgPSByZXF1aXJlKCdzdXBlcnRlc3QnKVxuXG5kZXNjcmliZSgnZXRlcm5hbFZpZ2lsYW5jZSByb3V0ZXMgLSBzdHJlYW0gYW5kIHRva2VuJywgKCkgPT4ge1xuICBiZWZvcmVBbGwoKCkgPT4ge1xuICAgIHNlcnZlci5saXN0ZW4oKTtcbiAgfSk7XG5cbiAgYWZ0ZXJBbGwoKCkgPT4ge1xuICAgIHNlcnZlci5jbG9zZSgpO1xuICB9KTtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBqZXN0LnJlc2V0TW9kdWxlcygpXG4gICAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPSAndGVzdCdcbiAgICAvLyBlbnN1cmUgcHJlZGljdGFibGUgZGVmYXVsdCBiZWFyZXIgdG9rZW4gdW5sZXNzIG92ZXJyaWRkZW4gaW4gdGVzdFxuICAgIHByb2Nlc3MuZW52LlBSQUVWSVNJT19CRUFSRVJfVE9LRU4gPSBwcm9jZXNzLmVudi5QUkFFVklTSU9fQkVBUkVSX1RPS0VOIHx8ICdkZW1vLXRva2VuJ1xuICB9KVxuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgZGVsZXRlIHByb2Nlc3MuZW52LlBSQUVWSVNJT19CRUFSRVJfVE9LRU5cbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKVxuICB9KVxuXG4gIHRlc3QoJ0dFVCAvc3RyZWFtIHJldHVybnMgNDAxIHdoZW4gbm8gdG9rZW4gcHJvdmlkZWQgb3IgaW52YWxpZCcsIGFzeW5jICgpID0+IHtcbiAgICAvLyBtb2NrIHNzZVRva2VuU2VydmljZS52YWxpZGF0ZVRva2VuIC0+IGZhbHNlXG4gICAgamVzdC5kb01vY2soJy4uLy4uL3NyYy9zc2VUb2tlblNlcnZpY2UuanMnLCAoKSA9PiAoe1xuICAgICAgdmFsaWRhdGVUb2tlbjogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKGZhbHNlKVxuICAgIH0pKVxuXG4gICAgY29uc3Qgcm91dGVyID0gcmVxdWlyZSgnLi4vLi4vc3JjL3JvdXRlcy9ldGVybmFsVmlnaWxhbmNlU3RyZWFtLmpzJykuZGVmYXVsdCB8fCByZXF1aXJlKCcuLi8uLi9zcmMvcm91dGVzL2V0ZXJuYWxWaWdpbGFuY2VTdHJlYW0uanMnKVxuICAgIGNvbnN0IGFwcCA9IGV4cHJlc3MoKVxuICAgIGFwcC51c2UoJy9hcGkvZXRlcm5hbC12aWdpbGFuY2UnLCByb3V0ZXIpXG5cbiAgICBjb25zdCByZXMgPSBhd2FpdCByZXF1ZXN0KGFwcCkuZ2V0KCcvYXBpL2V0ZXJuYWwtdmlnaWxhbmNlL3N0cmVhbScpXG4gICAgZXhwZWN0KHJlcy5zdGF0dXMpLnRvQmUoNDAxKVxuICAgIGV4cGVjdChyZXMuYm9keSkudG9IYXZlUHJvcGVydHkoJ2Vycm9yJylcbiAgfSlcblxuICB0ZXN0KCdHRVQgL3N0cmVhbSBhbGxvd3Mgc3RhdGljIHRva2VuIHZpYSBjb29raWUgYW5kIHdyaXRlcyBpbml0aWFsIFNTRSBzdGF0ZScsIGFzeW5jICgpID0+IHtcbiAgICAvLyBtb2NrIHZpZ2lsYW5jZSBzZXJ2aWNlXG4gICAgLy8gbWFrZSBzdWJzY3JpYmUgZW5kIHRoZSByZXNwb25zZSBpbW1lZGlhdGVseSB0byBhdm9pZCBsZWF2aW5nIFNTRSBvcGVuXG4gICAgY29uc3QgbW9ja1N1YnNjcmliZSA9IGplc3QuZm4oKHJlcykgPT4ge1xuICAgICAgdHJ5IHsgcmVzLmVuZCgpIH0gY2F0Y2ggKGUpIHsgLyogaWdub3JlICovIH1cbiAgICB9KVxuICAgIGNvbnN0IG1vY2tVbnN1YnNjcmliZSA9IGplc3QuZm4oKVxuICAgIGNvbnN0IG1vY2tHZXRTdGF0ZSA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyBoZWxsbzogJ3dvcmxkJyB9KVxuICAgIGplc3QuZG9Nb2NrKCcuLi8uLi9zcmMvZXRlcm5hbFZpZ2lsYW5jZVNlcnZpY2UuanMnLCAoKSA9PiAoe1xuICAgICAgc3Vic2NyaWJlOiBtb2NrU3Vic2NyaWJlLFxuICAgICAgdW5zdWJzY3JpYmU6IG1vY2tVbnN1YnNjcmliZSxcbiAgICAgIGdldFN0YXRlOiBtb2NrR2V0U3RhdGVcbiAgICB9KSlcbiAgICAvLyBtb2NrIHNzZVRva2VuU2VydmljZS52YWxpZGF0ZVRva2VuIC0+IGZhbHNlIHRvIGZvcmNlIHN0YXRpYyBjaGVjayBwYXRoXG4gICAgamVzdC5kb01vY2soJy4uLy4uL3NyYy9zc2VUb2tlblNlcnZpY2UuanMnLCAoKSA9PiAoe1xuICAgICAgdmFsaWRhdGVUb2tlbjogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKGZhbHNlKVxuICAgIH0pKVxuXG4gICAgLy8gZW5zdXJlIHN0YXRpYyB0b2tlblxuICAgIHByb2Nlc3MuZW52LlBSQUVWSVNJT19CRUFSRVJfVE9LRU4gPSAnU1RBVElDLVRPS0VOJ1xuXG4gIGNvbnN0IHJvdXRlciA9IHJlcXVpcmUoJy4uLy4uL3NyYy9yb3V0ZXMvZXRlcm5hbFZpZ2lsYW5jZVN0cmVhbS5qcycpLmRlZmF1bHQgfHwgcmVxdWlyZSgnLi4vLi4vc3JjL3JvdXRlcy9ldGVybmFsVmlnaWxhbmNlU3RyZWFtLmpzJylcbiAgY29uc3QgY29va2llUGFyc2VyID0gcmVxdWlyZSgnY29va2llLXBhcnNlcicpXG4gIGNvbnN0IGFwcCA9IGV4cHJlc3MoKVxuICBhcHAudXNlKGNvb2tpZVBhcnNlcigpKVxuICBhcHAudXNlKCcvYXBpL2V0ZXJuYWwtdmlnaWxhbmNlJywgcm91dGVyKVxuXG4gICAgY29uc3QgcmVzID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAuZ2V0KCcvYXBpL2V0ZXJuYWwtdmlnaWxhbmNlL3N0cmVhbScpXG4gICAgICAuc2V0KCdDb29raWUnLCAncHJhZXZpc2lvX3NzZV90b2tlbj1TVEFUSUMtVE9LRU4nKVxuXG4gICAgZXhwZWN0KHJlcy5zdGF0dXMpLnRvQmUoMjAwKVxuICAgIGV4cGVjdChyZXMuaGVhZGVyc1snY29udGVudC10eXBlJ10pLnRvTWF0Y2goL3RleHRcXC9ldmVudC1zdHJlYW0vKVxuICAgIC8vIGluaXRpYWwgU1NFIGRhdGEgaW5jbHVkZXMgZXZlbnQ6aW5pdCBhbmQgdGhlIEpTT04gc3RhdGVcbiAgICBleHBlY3QocmVzLnRleHQpLnRvTWF0Y2goL1wiZXZlbnRcIjpcImluaXRcIi8pXG4gICAgZXhwZWN0KG1vY2tTdWJzY3JpYmUpLnRvSGF2ZUJlZW5DYWxsZWQoKVxuICB9KVxuXG4gIHRlc3QoJ0dFVCAvc3RyZWFtIGFsbG93cyB0ZW1wb3JhcnkgdG9rZW5zIHZhbGlkYXRlZCBieSBzc2VUb2tlblNlcnZpY2UnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgbW9ja1N1YnNjcmliZSA9IGplc3QuZm4oKHJlcykgPT4geyB0cnkgeyByZXMuZW5kKCkgfSBjYXRjaCAoZSkge30gfSlcbiAgICBjb25zdCBtb2NrR2V0U3RhdGUgPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHsgb2s6IHRydWUgfSlcbiAgICBqZXN0LmRvTW9jaygnLi4vLi4vc3JjL2V0ZXJuYWxWaWdpbGFuY2VTZXJ2aWNlLmpzJywgKCkgPT4gKHtcbiAgICAgIHN1YnNjcmliZTogbW9ja1N1YnNjcmliZSxcbiAgICAgIHVuc3Vic2NyaWJlOiBqZXN0LmZuKCksXG4gICAgICBnZXRTdGF0ZTogbW9ja0dldFN0YXRlXG4gICAgfSkpXG5cbiAgICAvLyBtb2NrIHZhbGlkYXRlVG9rZW4gLT4gdHJ1ZVxuICAgIGplc3QuZG9Nb2NrKCcuLi8uLi9zcmMvc3NlVG9rZW5TZXJ2aWNlLmpzJywgKCkgPT4gKHtcbiAgICAgIHZhbGlkYXRlVG9rZW46IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKVxuICAgIH0pKVxuXG4gIGNvbnN0IHJvdXRlciA9IHJlcXVpcmUoJy4uLy4uL3NyYy9yb3V0ZXMvZXRlcm5hbFZpZ2lsYW5jZVN0cmVhbS5qcycpLmRlZmF1bHQgfHwgcmVxdWlyZSgnLi4vLi4vc3JjL3JvdXRlcy9ldGVybmFsVmlnaWxhbmNlU3RyZWFtLmpzJylcbiAgY29uc3QgYXBwID0gZXhwcmVzcygpXG4gIGFwcC51c2UocmVxdWlyZSgnY29va2llLXBhcnNlcicpKCkpXG4gIGFwcC51c2UoJy9hcGkvZXRlcm5hbC12aWdpbGFuY2UnLCByb3V0ZXIpXG5cbiAgICBjb25zdCByZXMgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgIC5nZXQoJy9hcGkvZXRlcm5hbC12aWdpbGFuY2Uvc3RyZWFtJylcbiAgICAgIC5xdWVyeSh7IHRva2VuOiAnVEVNUC1UT0tFTicgfSlcblxuICAgIGV4cGVjdChyZXMuc3RhdHVzKS50b0JlKDIwMClcbiAgICBleHBlY3QocmVzLmhlYWRlcnNbJ2NvbnRlbnQtdHlwZSddKS50b01hdGNoKC90ZXh0XFwvZXZlbnQtc3RyZWFtLylcbiAgICBleHBlY3QocmVzLnRleHQpLnRvTWF0Y2goL1wiZXZlbnRcIjpcImluaXRcIi8pXG4gICAgZXhwZWN0KG1vY2tTdWJzY3JpYmUpLnRvSGF2ZUJlZW5DYWxsZWQoKVxuICB9KVxuXG4gIHRlc3QoJ1BPU1QgL3Rva2VuIHJldHVybnMgdG9rZW4sIHNldHMgY29va2llIG9uIHN1Y2Nlc3MnLCBhc3luYyAoKSA9PiB7XG4gICAgLy8gbW9jayBleHByZXNzLXJhdGUtbGltaXQgdG8gYnlwYXNzIGxpbWl0ZXIgbWlkZGxld2FyZVxuICAgIGplc3QuZG9Nb2NrKCdleHByZXNzLXJhdGUtbGltaXQnLCAoKSA9PiAob3B0cykgPT4gKHJlcSwgcmVzLCBuZXh0KSA9PiBuZXh0KCkpXG5cbiAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpXG4gICAgY29uc3QgbW9ja2VkID0geyB0b2tlbjogJ0dFTi1UT0tFTicsIGV4cGlyZXNBdDogbm93ICsgNjAwMDAgfVxuICAgIGplc3QuZG9Nb2NrKCcuLi8uLi9zcmMvc3NlVG9rZW5TZXJ2aWNlLmpzJywgKCkgPT4gKHtcbiAgICAgIGdlbmVyYXRlVG9rZW46IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrZWQpXG4gICAgfSkpXG5cbiAgICBjb25zdCByb3V0ZXIgPSByZXF1aXJlKCcuLi8uLi9zcmMvcm91dGVzL2V0ZXJuYWxWaWdpbGFuY2VUb2tlbi5qcycpLmRlZmF1bHQgfHwgcmVxdWlyZSgnLi4vLi4vc3JjL3JvdXRlcy9ldGVybmFsVmlnaWxhbmNlVG9rZW4uanMnKVxuICAgIGNvbnN0IGFwcCA9IGV4cHJlc3MoKVxuICAgIGFwcC51c2UoZXhwcmVzcy5qc29uKCkpXG4gICAgYXBwLnVzZSgnL2FwaS9ldGVybmFsLXZpZ2lsYW5jZScsIHJvdXRlcilcblxuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgLnBvc3QoJy9hcGkvZXRlcm5hbC12aWdpbGFuY2UvdG9rZW4nKVxuICAgICAgLnNlbmQoeyB0dGw6IDMwIH0pXG5cbiAgICBleHBlY3QocmVzLnN0YXR1cykudG9CZSgyMDApXG4gICAgZXhwZWN0KHJlcy5ib2R5KS50b0hhdmVQcm9wZXJ0eSgndG9rZW4nLCAnR0VOLVRPS0VOJylcbiAgICBleHBlY3QocmVzLmJvZHkpLnRvSGF2ZVByb3BlcnR5KCdleHBpcmVzQXQnKVxuICAgIC8vIGNvb2tpZSBoZWFkZXIgc2hvdWxkIGJlIHNldFxuICAgIGV4cGVjdChyZXMuaGVhZGVyc1snc2V0LWNvb2tpZSddKS50b0JlRGVmaW5lZCgpXG4gICAgZXhwZWN0KHJlcy5oZWFkZXJzWydzZXQtY29va2llJ11bMF0pLnRvTWF0Y2goL3ByYWV2aXNpb19zc2VfdG9rZW49R0VOLVRPS0VOLylcbiAgfSlcblxuICB0ZXN0KCdQT1NUIC90b2tlbiByZXR1cm5zIDUwMCB3aGVuIGdlbmVyYXRlVG9rZW4gdGhyb3dzJywgYXN5bmMgKCkgPT4ge1xuICAgIGplc3QuZG9Nb2NrKCdleHByZXNzLXJhdGUtbGltaXQnLCAoKSA9PiAob3B0cykgPT4gKHJlcSwgcmVzLCBuZXh0KSA9PiBuZXh0KCkpXG4gICAgamVzdC5kb01vY2soJy4uLy4uL3NyYy9zc2VUb2tlblNlcnZpY2UuanMnLCAoKSA9PiAoe1xuICAgICAgZ2VuZXJhdGVUb2tlbjogamVzdC5mbigpLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignYm9vbScpKVxuICAgIH0pKVxuXG4gICAgY29uc3Qgcm91dGVyID0gcmVxdWlyZSgnLi4vLi4vc3JjL3JvdXRlcy9ldGVybmFsVmlnaWxhbmNlVG9rZW4uanMnKS5kZWZhdWx0IHx8IHJlcXVpcmUoJy4uLy4uL3NyYy9yb3V0ZXMvZXRlcm5hbFZpZ2lsYW5jZVRva2VuLmpzJylcbiAgICBjb25zdCBhcHAgPSBleHByZXNzKClcbiAgICBhcHAudXNlKGV4cHJlc3MuanNvbigpKVxuICAgIGFwcC51c2UoJy9hcGkvZXRlcm5hbC12aWdpbGFuY2UnLCByb3V0ZXIpXG5cbiAgICBjb25zdCByZXMgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgIC5wb3N0KCcvYXBpL2V0ZXJuYWwtdmlnaWxhbmNlL3Rva2VuJylcbiAgICAgIC5zZW5kKHsgdHRsOiAzMCB9KVxuXG4gICAgZXhwZWN0KHJlcy5zdGF0dXMpLnRvQmUoNTAwKVxuICAgIGV4cGVjdChyZXMuYm9keSkudG9IYXZlUHJvcGVydHkoJ2Vycm9yJylcbiAgfSlcbn0pXG4iXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBQUEsT0FBQSxHQUFBQyxPQUFBO0FBQ0EsTUFBTUMsT0FBTyxHQUFHRCxPQUFPLENBQUMsU0FBUyxDQUFDO0FBQ2xDLE1BQU1FLE9BQU8sR0FBR0YsT0FBTyxDQUFDLFdBQVcsQ0FBQztBQUVwQ0csUUFBUSxDQUFDLDRDQUE0QyxFQUFFLE1BQU07RUFDM0RDLFNBQVMsQ0FBQyxNQUFNO0lBQ2RDLGNBQU0sQ0FBQ0MsTUFBTSxDQUFDLENBQUM7RUFDakIsQ0FBQyxDQUFDO0VBRUZDLFFBQVEsQ0FBQyxNQUFNO0lBQ2JGLGNBQU0sQ0FBQ0csS0FBSyxDQUFDLENBQUM7RUFDaEIsQ0FBQyxDQUFDO0VBRUZDLFVBQVUsQ0FBQyxNQUFNO0lBQ2ZDLElBQUksQ0FBQ0MsWUFBWSxDQUFDLENBQUM7SUFDbkJDLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDQyxRQUFRLEdBQUcsTUFBTTtJQUM3QjtJQUNBRixPQUFPLENBQUNDLEdBQUcsQ0FBQ0Usc0JBQXNCLEdBQUdILE9BQU8sQ0FBQ0MsR0FBRyxDQUFDRSxzQkFBc0IsSUFBSSxZQUFZO0VBQ3pGLENBQUMsQ0FBQztFQUVGQyxTQUFTLENBQUMsTUFB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