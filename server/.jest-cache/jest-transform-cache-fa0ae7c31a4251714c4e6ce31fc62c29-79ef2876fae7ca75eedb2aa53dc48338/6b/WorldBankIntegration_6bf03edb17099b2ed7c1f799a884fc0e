0a9f38cc18627a30cbd244e1030d9820
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _safeFetch = _interopRequireDefault(require("../lib/safeFetch.js"));
var _forceMocks = require("../lib/force-mocks.js");
function _interopRequireDefault(e) { return e && e.__esModule ? e : { default: e }; }
class WorldBankIntegration {
  constructor() {
    this.baseUrl = process.env.TEST_MODE === 'true' ? 'http://mock-api-server:3001/world-bank' : 'https://api.worldbank.org/v2';
  }
  async getEconomicIndicators(country, indicators, startYear, endYear) {
    try {
      const results = {};
      for (const indicator of indicators) {
        const url = `${this.baseUrl}/country/${country.toLowerCase()}/indicator/${indicator}?format=json&date=${startYear}:${endYear}&per_page=1000`;
        let data;
        try {
          data = await (0, _safeFetch.default)(url, {
            headers: {
              'User-Agent': 'Praevisio/1.0 (+https://praevisio.local)',
              Accept: 'application/json'
            }
          }, {
            timeout: 10000,
            retries: 3
          });
        } catch (err) {
          console.warn(`World Bank API error for ${indicator}: ${err.message}`);
          results[indicator] = {
            error: `API error: ${err.message}`
          };
          continue;
        }
        // If no data for the requested year range, retry once with a broader window (safe fallback)
        if (!(data && Array.isArray(data) && data[1] && data[1].length > 0)) {
          try {
            const broaderUrl = `${this.baseUrl}/country/${country.toLowerCase()}/indicator/${indicator}?format=json&date=2010:${endYear}&per_page=1000`;
            const fallback = await (0, _safeFetch.default)(broaderUrl, {
              headers: {
                'User-Agent': 'Praevisio/1.0 (+https://praevisio.local)',
                Accept: 'application/json'
              }
            }, {
              timeout: 10000,
              retries: 2
            });
            if (fallback && Array.isArray(fallback) && fallback[1] && fallback[1].length > 0) {
              data = fallback;
            }
          } catch (err) {
            // swallow fallback error and continue with original empty result
            console.warn(`World Bank fallback error for ${indicator}: ${err.message}`);
          }
        }
        if (data && data[1] && data[1].length > 0) {
          // Get the most recent value
          const sortedData = data[1].sort((a, b) => parseInt(b.date) - parseInt(a.date));
          const latest = sortedData[0];
          results[indicator] = {
            value: latest.value,
            year: latest.date,
            country: latest.country.value
          };
        } else {
          // No data in requested range - attempt to report last available year/value if present in data[1]
          let lastAvailable = null;
          try {
            if (data && data[1] && data[1].length === 0) {
              // nothing
            } else if (data && data[1]) {
              const anyEntry = data[1].find(d => d && d.value !== null && d.value !== undefined);
              if (anyEntry) lastAvailable = anyEntry;
            }
          } catch (e) {
            // ignore
          }
          if (lastAvailable) {
            results[indicator] = {
              value: lastAvailable.value,
              year: lastAvailable.date,
              country: lastAvailable.country ? lastAvailable.country.value : country,
              note: 'No data for requested range â€” returning last available value'
            };
            console.warn(`WorldBank: no data in ${startYear}:${endYear} for ${indicator} (${country}), returning last available year ${lastAvailable.date}`);
          } else {
            results[indicator] = {
              value: null,
              note: 'No data available'
            };
            console.warn(`WorldBank: no data in ${startYear}:${endYear} for ${indicator} (${country}) and no fallback available`);
          }
        }

        // Rate limiting: small delay between requests
        await new Promise(resolve => setTimeout(resolve, 100));
      }
      return {
        country,
        period: {
          startYear,
          endYear
        },
        indicators: results
      };
    } catch (error) {
      console.error('Error fetching World Bank data:', error);
      // Only return mock data when explicitly forced (tests or demo). Otherwise
      // propagate the error so callers can handle the failure and we don't silently
      // pretend we have real data.
      if ((0, _forceMocks.forceMocksEnabled)()) {
        const mockData = this.getMockEconomicIndicators(country, indicators, startYear, endYear);
        return mockData;
      }
      throw new Error(`WorldBank API failure: ${error && error.message ? error.message : String(error)}`);
    }
  }

  // Helper method for common economic indicators relevant to social instability
  async getKeyEconomicData(country, startYear = '2020', endYear = '2024') {
    const indicators = ['NY.GDP.PCAP.CD',
    // GDP per capita (current US$)
    'FP.CPI.TOTL.ZG',
    // Inflation, consumer prices (annual %)
    'SL.UEM.TOTL.ZS',
    // Unemployment, total (% of total labor force)
    'PA.NUS.FCRF',
    // Official exchange rate (LCU per US$, period average)
    'DT.DOD.DECT.CD',
    // External debt stocks, total (DOD, current US$)
    'FI.RES.TOTL.CD' // Total reserves (includes gold, current US$)
    ];
    return await this.getEconomicIndicators(country, indicators, startYear, endYear);
  }

  // Method for food security data
  async getFoodSecurityData(countries = ['COL', 'PER', 'ARG'], startYear = '2020', endYear = '2024') {
    const indicator = 'SN.ITK.DEFC.ZS'; // Prevalence of undernourishment (% of population)
    try {
      const results = {};
      for (const country of countries) {
        const url = `${this.baseUrl}/country/${country.toLowerCase()}/indicator/${indicator}?format=json&date=${startYear}:${endYear}&per_page=1000`;
        let data;
        try {
          data = await (0, _safeFetch.default)(url, {
            headers: {
              'User-Agent': 'Praevisio/1.0 (+https://praevisio.local)',
              Accept: 'application/json'
            }
          }, {
            timeout: 10000,
            retries: 3
          });
        } catch (err) {
          console.warn(`World Bank API error for food security ${country}: ${err.message}`);
          results[country] = {
            error: `API error: ${err.message}`
          };
          continue;
        }
        // Retry with broader date range if no data found
        if (!(data && Array.isArray(data) && data[1] && data[1].length > 0)) {
          try {
            const fallbackUrl = `${this.baseUrl}/country/${country.toLowerCase()}/indicator/${indicator}?format=json&date=2010:${endYear}&per_page=1000`;
            const fallback = await (0, _safeFetch.default)(fallbackUrl, {
              headers: {
                'User-Agent': 'Praevisio/1.0 (+https://praevisio.local)',
                Accept: 'application/json'
              }
            }, {
              timeout: 10000,
              retries: 2
            });
            if (fallback && Array.isArray(fallback) && fallback[1] && fallback[1].length > 0) {
              data = fallback;
            }
          } catch (err) {
            console.warn(`World Bank fallback error for food security ${country}: ${err.message}`);
          }
        }
        if (data && data[1] && data[1].length > 0) {
          // Get the most recent value
          const sortedData = data[1].sort((a, b) => parseInt(b.date) - parseInt(a.date));
          const latest = sortedData[0];
          results[country] = {
            value: latest.value,
            year: latest.date,
            country: latest.country.value,
            indicator: 'Prevalence of undernourishment (% of population)'
          };
        } else {
          results[country] = {
            value: null,
            note: 'No data available'
          };
        }

        // Rate limiting
        await new Promise(resolve => setTimeout(resolve, 100));
      }
      return {
        countries,
        period: {
          startYear,
          endYear
        },
        indicator: 'SN.ITK.DEFC.ZS',
        data: results
      };
    } catch (error) {
      console.error('Error fetching food security data:', error);
      // Fallback to high-fidelity mock data
      const mockData = this.getMockFoodSecurityData(countries, startYear, endYear);
      return mockData;
    }
  }

  // High-fidelity mock data for fallback when API fails
  getMockEconomicIndicators(country, indicators, startYear, endYear) {
    const mockIndicators = {};

    // Mock data for common indicators
    const mockValues = {
      'NY.GDP.PCAP.CD': {
        value: 6500,
        year: endYear,
        country: country
      },
      'FP.CPI.TOTL.ZG': {
        value: 4.2,
        year: endYear,
        country: country
      },
      'SL.UEM.TOTL.ZS': {
        value: 8.5,
        year: endYear,
        country: country
      },
      'PA.NUS.FCRF': {
        value: 1.15,
        year: endYear,
        country: country
      },
      'DT.DOD.DECT.CD': {
        value: 45000000000,
        year: endYear,
        country: country
      },
      'FI.RES.TOTL.CD': {
        value: 12000000000,
        year: endYear,
        country: country
      }
    };
    indicators.forEach(indicator => {
      if (mockValues[indicator]) {
        mockIndicators[indicator] = mockValues[indicator];
      } else {
        // Generic mock for unknown indicators
        mockIndicators[indicator] = {
          value: Math.random() * 100,
          year: endYear,
          country: country,
          note: 'Mock data - API unavailable'
        };
      }
    });
    return {
      country,
      period: {
        startYear,
        endYear
      },
      indicators: mockIndicators,
      isMock: true,
      note: 'High-fidelity mock data - API unavailable'
    };
  }

  // High-fidelity mock data for food security fallback
  getMockFoodSecurityData(countries, startYear, endYear) {
    const mockData = {};
    countries.forEach(country => {
      mockData[country] = {
        value: 5.2 + Math.random() * 2,
        // Random value between 5.2-7.2
        year: endYear,
        country: country,
        indicator: 'Prevalence of undernourishment (% of population)'
      };
    });
    return {
      countries,
      period: {
        startYear,
        endYear
      },
      indicator: 'SN.ITK.DEFC.ZS',
      data: mockData,
      isMock: true,
      note: 'High-fidelity mock data - API unavailable'
    };
  }
}
var _default = exports.default = WorldBankIntegration;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfc2FmZUZldGNoIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJfZm9yY2VNb2NrcyIsImUiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsIldvcmxkQmFua0ludGVncmF0aW9uIiwiY29uc3RydWN0b3IiLCJiYXNlVXJsIiwicHJvY2VzcyIsImVudiIsIlRFU1RfTU9ERSIsImdldEVjb25vbWljSW5kaWNhdG9ycyIsImNvdW50cnkiLCJpbmRpY2F0b3JzIiwic3RhcnRZZWFyIiwiZW5kWWVhciIsInJlc3VsdHMiLCJpbmRpY2F0b3IiLCJ1cmwiLCJ0b0xvd2VyQ2FzZSIsImRhdGEiLCJzYWZlRmV0Y2giLCJoZWFkZXJzIiwiQWNjZXB0IiwidGltZW91dCIsInJldHJpZXMiLCJlcnIiLCJjb25zb2xlIiwid2FybiIsIm1lc3NhZ2UiLCJlcnJvciIsIkFycmF5IiwiaXNBcnJheSIsImxlbmd0aCIsImJyb2FkZXJVcmwiLCJmYWxsYmFjayIsInNvcnRlZERhdGEiLCJzb3J0IiwiYSIsImIiLCJwYXJzZUludCIsImRhdGUiLCJsYXRlc3QiLCJ2YWx1ZSIsInllYXIiLCJsYXN0QXZhaWxhYmxlIiwiYW55RW50cnkiLCJmaW5kIiwiZCIsInVuZGVmaW5lZCIsIm5vdGUiLCJQcm9taXNlIiwicmVzb2x2ZSIsInNldFRpbWVvdXQiLCJwZXJpb2QiLCJmb3JjZU1vY2tzRW5hYmxlZCIsIm1vY2tEYXRhIiwiZ2V0TW9ja0Vjb25vbWljSW5kaWNhdG9ycyIsIkVycm9yIiwiU3RyaW5nIiwiZ2V0S2V5RWNvbm9taWNEYXRhIiwiZ2V0Rm9vZFNlY3VyaXR5RGF0YSIsImNvdW50cmllcyIsImZhbGxiYWNrVXJsIiwiZ2V0TW9ja0Zvb2RTZWN1cml0eURhdGEiLCJtb2NrSW5kaWNhdG9ycyIsIm1vY2tWYWx1ZXMiLCJmb3JFYWNoIiwiTWF0aCIsInJhbmRvbSIsImlzTW9jayIsIl9kZWZhdWx0IiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbIldvcmxkQmFua0ludGVncmF0aW9uLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBzYWZlRmV0Y2ggZnJvbSAnLi4vbGliL3NhZmVGZXRjaC5qcyc7XG5pbXBvcnQgeyBmb3JjZU1vY2tzRW5hYmxlZCB9IGZyb20gJy4uL2xpYi9mb3JjZS1tb2Nrcy5qcyc7XG5cbmNsYXNzIFdvcmxkQmFua0ludGVncmF0aW9uIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5iYXNlVXJsID0gcHJvY2Vzcy5lbnYuVEVTVF9NT0RFID09PSAndHJ1ZSdcbiAgICAgID8gJ2h0dHA6Ly9tb2NrLWFwaS1zZXJ2ZXI6MzAwMS93b3JsZC1iYW5rJ1xuICAgICAgOiAnaHR0cHM6Ly9hcGkud29ybGRiYW5rLm9yZy92Mic7XG4gIH1cblxuICBhc3luYyBnZXRFY29ub21pY0luZGljYXRvcnMoY291bnRyeSwgaW5kaWNhdG9ycywgc3RhcnRZZWFyLCBlbmRZZWFyKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3VsdHMgPSB7fTtcblxuICAgICAgZm9yIChjb25zdCBpbmRpY2F0b3Igb2YgaW5kaWNhdG9ycykge1xuICAgICAgICBjb25zdCB1cmwgPSBgJHt0aGlzLmJhc2VVcmx9L2NvdW50cnkvJHtjb3VudHJ5LnRvTG93ZXJDYXNlKCl9L2luZGljYXRvci8ke2luZGljYXRvcn0/Zm9ybWF0PWpzb24mZGF0ZT0ke3N0YXJ0WWVhcn06JHtlbmRZZWFyfSZwZXJfcGFnZT0xMDAwYDtcblxuICAgICAgICBsZXQgZGF0YTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBkYXRhID0gYXdhaXQgc2FmZUZldGNoKHVybCwgeyBoZWFkZXJzOiB7ICdVc2VyLUFnZW50JzogJ1ByYWV2aXNpby8xLjAgKCtodHRwczovL3ByYWV2aXNpby5sb2NhbCknLCBBY2NlcHQ6ICdhcHBsaWNhdGlvbi9qc29uJyB9IH0sIHsgdGltZW91dDogMTAwMDAsIHJldHJpZXM6IDMgfSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgIGNvbnNvbGUud2FybihgV29ybGQgQmFuayBBUEkgZXJyb3IgZm9yICR7aW5kaWNhdG9yfTogJHtlcnIubWVzc2FnZX1gKTtcbiAgICAgICAgICByZXN1bHRzW2luZGljYXRvcl0gPSB7IGVycm9yOiBgQVBJIGVycm9yOiAke2Vyci5tZXNzYWdlfWAgfTtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICAvLyBJZiBubyBkYXRhIGZvciB0aGUgcmVxdWVzdGVkIHllYXIgcmFuZ2UsIHJldHJ5IG9uY2Ugd2l0aCBhIGJyb2FkZXIgd2luZG93IChzYWZlIGZhbGxiYWNrKVxuICAgICAgICBpZiAoIShkYXRhICYmIEFycmF5LmlzQXJyYXkoZGF0YSkgJiYgZGF0YVsxXSAmJiBkYXRhWzFdLmxlbmd0aCA+IDApKSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IGJyb2FkZXJVcmwgPSBgJHt0aGlzLmJhc2VVcmx9L2NvdW50cnkvJHtjb3VudHJ5LnRvTG93ZXJDYXNlKCl9L2luZGljYXRvci8ke2luZGljYXRvcn0/Zm9ybWF0PWpzb24mZGF0ZT0yMDEwOiR7ZW5kWWVhcn0mcGVyX3BhZ2U9MTAwMGA7XG4gICAgICAgICAgICBjb25zdCBmYWxsYmFjayA9IGF3YWl0IHNhZmVGZXRjaChicm9hZGVyVXJsLCB7IGhlYWRlcnM6IHsgJ1VzZXItQWdlbnQnOiAnUHJhZXZpc2lvLzEuMCAoK2h0dHBzOi8vcHJhZXZpc2lvLmxvY2FsKScsIEFjY2VwdDogJ2FwcGxpY2F0aW9uL2pzb24nIH0gfSwgeyB0aW1lb3V0OiAxMDAwMCwgcmV0cmllczogMiB9KTtcbiAgICAgICAgICAgIGlmIChmYWxsYmFjayAmJiBBcnJheS5pc0FycmF5KGZhbGxiYWNrKSAmJiBmYWxsYmFja1sxXSAmJiBmYWxsYmFja1sxXS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgIGRhdGEgPSBmYWxsYmFjaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIC8vIHN3YWxsb3cgZmFsbGJhY2sgZXJyb3IgYW5kIGNvbnRpbnVlIHdpdGggb3JpZ2luYWwgZW1wdHkgcmVzdWx0XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oYFdvcmxkIEJhbmsgZmFsbGJhY2sgZXJyb3IgZm9yICR7aW5kaWNhdG9yfTogJHtlcnIubWVzc2FnZX1gKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZGF0YSAmJiBkYXRhWzFdICYmIGRhdGFbMV0ubGVuZ3RoID4gMCkge1xuICAgICAgICAgIC8vIEdldCB0aGUgbW9zdCByZWNlbnQgdmFsdWVcbiAgICAgICAgICBjb25zdCBzb3J0ZWREYXRhID0gZGF0YVsxXS5zb3J0KChhLCBiKSA9PiBwYXJzZUludChiLmRhdGUpIC0gcGFyc2VJbnQoYS5kYXRlKSk7XG4gICAgICAgICAgY29uc3QgbGF0ZXN0ID0gc29ydGVkRGF0YVswXTtcbiAgICAgICAgICByZXN1bHRzW2luZGljYXRvcl0gPSB7XG4gICAgICAgICAgICB2YWx1ZTogbGF0ZXN0LnZhbHVlLFxuICAgICAgICAgICAgeWVhcjogbGF0ZXN0LmRhdGUsXG4gICAgICAgICAgICBjb3VudHJ5OiBsYXRlc3QuY291bnRyeS52YWx1ZVxuICAgICAgICAgIH07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gTm8gZGF0YSBpbiByZXF1ZXN0ZWQgcmFuZ2UgLSBhdHRlbXB0IHRvIHJlcG9ydCBsYXN0IGF2YWlsYWJsZSB5ZWFyL3ZhbHVlIGlmIHByZXNlbnQgaW4gZGF0YVsxXVxuICAgICAgICAgIGxldCBsYXN0QXZhaWxhYmxlID0gbnVsbDtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgaWYgKGRhdGEgJiYgZGF0YVsxXSAmJiBkYXRhWzFdLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAvLyBub3RoaW5nXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGRhdGEgJiYgZGF0YVsxXSkge1xuICAgICAgICAgICAgICBjb25zdCBhbnlFbnRyeSA9IGRhdGFbMV0uZmluZChkID0+IGQgJiYgKGQudmFsdWUgIT09IG51bGwgJiYgZC52YWx1ZSAhPT0gdW5kZWZpbmVkKSk7XG4gICAgICAgICAgICAgIGlmIChhbnlFbnRyeSkgbGFzdEF2YWlsYWJsZSA9IGFueUVudHJ5O1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIC8vIGlnbm9yZVxuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChsYXN0QXZhaWxhYmxlKSB7XG4gICAgICAgICAgICByZXN1bHRzW2luZGljYXRvcl0gPSB7XG4gICAgICAgICAgICAgIHZhbHVlOiBsYXN0QXZhaWxhYmxlLnZhbHVlLFxuICAgICAgICAgICAgICB5ZWFyOiBsYXN0QXZhaWxhYmxlLmRhdGUsXG4gICAgICAgICAgICAgIGNvdW50cnk6IGxhc3RBdmFpbGFibGUuY291bnRyeSA/IGxhc3RBdmFpbGFibGUuY291bnRyeS52YWx1ZSA6IGNvdW50cnksXG4gICAgICAgICAgICAgIG5vdGU6ICdObyBkYXRhIGZvciByZXF1ZXN0ZWQgcmFuZ2Ug4oCUIHJldHVybmluZyBsYXN0IGF2YWlsYWJsZSB2YWx1ZSdcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oYFdvcmxkQmFuazogbm8gZGF0YSBpbiAke3N0YXJ0WWVhcn06JHtlbmRZZWFyfSBmb3IgJHtpbmRpY2F0b3J9ICgke2NvdW50cnl9KSwgcmV0dXJuaW5nIGxhc3QgYXZhaWxhYmxlIHllYXIgJHtsYXN0QXZhaWxhYmxlLmRhdGV9YCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlc3VsdHNbaW5kaWNhdG9yXSA9IHsgdmFsdWU6IG51bGwsIG5vdGU6ICdObyBkYXRhIGF2YWlsYWJsZScgfTtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybihgV29ybGRCYW5rOiBubyBkYXRhIGluICR7c3RhcnRZZWFyfToke2VuZFllYXJ9IGZvciAke2luZGljYXRvcn0gKCR7Y291bnRyeX0pIGFuZCBubyBmYWxsYmFjayBhdmFpbGFibGVgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBSYXRlIGxpbWl0aW5nOiBzbWFsbCBkZWxheSBiZXR3ZWVuIHJlcXVlc3RzXG4gICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMDApKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY291bnRyeSxcbiAgICAgICAgcGVyaW9kOiB7IHN0YXJ0WWVhciwgZW5kWWVhciB9LFxuICAgICAgICBpbmRpY2F0b3JzOiByZXN1bHRzXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBXb3JsZCBCYW5rIGRhdGE6JywgZXJyb3IpO1xuICAgICAgLy8gT25seSByZXR1cm4gbW9jayBkYXRhIHdoZW4gZXhwbGljaXRseSBmb3JjZWQgKHRlc3RzIG9yIGRlbW8pLiBPdGhlcndpc2VcbiAgICAgIC8vIHByb3BhZ2F0ZSB0aGUgZXJyb3Igc28gY2FsbGVycyBjYW4gaGFuZGxlIHRoZSBmYWlsdXJlIGFuZCB3ZSBkb24ndCBzaWxlbnRseVxuICAgICAgLy8gcHJldGVuZCB3ZSBoYXZlIHJlYWwgZGF0YS5cbiAgICAgIGlmIChmb3JjZU1vY2tzRW5hYmxlZCgpKSB7XG4gICAgICAgIGNvbnN0IG1vY2tEYXRhID0gdGhpcy5nZXRNb2NrRWNvbm9taWNJbmRpY2F0b3JzKGNvdW50cnksIGluZGljYXRvcnMsIHN0YXJ0WWVhciwgZW5kWWVhcik7XG4gICAgICAgIHJldHVybiBtb2NrRGF0YTtcbiAgICAgIH1cbiAgICAgIHRocm93IG5ldyBFcnJvcihgV29ybGRCYW5rIEFQSSBmYWlsdXJlOiAke2Vycm9yICYmIGVycm9yLm1lc3NhZ2UgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKX1gKTtcbiAgICB9XG4gIH1cblxuICAvLyBIZWxwZXIgbWV0aG9kIGZvciBjb21tb24gZWNvbm9taWMgaW5kaWNhdG9ycyByZWxldmFudCB0byBzb2NpYWwgaW5zdGFiaWxpdHlcbiAgYXN5bmMgZ2V0S2V5RWNvbm9taWNEYXRhKGNvdW50cnksIHN0YXJ0WWVhciA9ICcyMDIwJywgZW5kWWVhciA9ICcyMDI0Jykge1xuICAgIGNvbnN0IGluZGljYXRvcnMgPSBbXG4gICAgICAnTlkuR0RQLlBDQVAuQ0QnLCAvLyBHRFAgcGVyIGNhcGl0YSAoY3VycmVudCBVUyQpXG4gICAgICAnRlAuQ1BJLlRPVEwuWkcnLCAvLyBJbmZsYXRpb24sIGNvbnN1bWVyIHByaWNlcyAoYW5udWFsICUpXG4gICAgICAnU0wuVUVNLlRPVEwuWlMnLCAvLyBVbmVtcGxveW1lbnQsIHRvdGFsICglIG9mIHRvdGFsIGxhYm9yIGZvcmNlKVxuICAgICAgJ1BBLk5VUy5GQ1JGJywgICAgLy8gT2ZmaWNpYWwgZXhjaGFuZ2UgcmF0ZSAoTENVIHBlciBVUyQsIHBlcmlvZCBhdmVyYWdlKVxuICAgICAgJ0RULkRPRC5ERUNULkNEJywgLy8gRXh0ZXJuYWwgZGVidCBzdG9ja3MsIHRvdGFsIChET0QsIGN1cnJlbnQgVVMkKVxuICAgICAgJ0ZJLlJFUy5UT1RMLkNEJyAgLy8gVG90YWwgcmVzZXJ2ZXMgKGluY2x1ZGVzIGdvbGQsIGN1cnJlbnQgVVMkKVxuICAgIF07XG5cbiAgICByZXR1cm4gYXdhaXQgdGhpcy5nZXRFY29ub21pY0luZGljYXRvcnMoY291bnRyeSwgaW5kaWNhdG9ycywgc3RhcnRZZWFyLCBlbmRZZWFyKTtcbiAgfVxuXG4gIC8vIE1ldGhvZCBmb3IgZm9vZCBzZWN1cml0eSBkYXRhXG4gIGFzeW5jIGdldEZvb2RTZWN1cml0eURhdGEoY291bnRyaWVzID0gWydDT0wnLCAnUEVSJywgJ0FSRyddLCBzdGFydFllYXIgPSAnMjAyMCcsIGVuZFllYXIgPSAnMjAyNCcpIHtcbiAgICBjb25zdCBpbmRpY2F0b3IgPSAnU04uSVRLLkRFRkMuWlMnOyAvLyBQcmV2YWxlbmNlIG9mIHVuZGVybm91cmlzaG1lbnQgKCUgb2YgcG9wdWxhdGlvbilcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0cyA9IHt9O1xuXG4gICAgICBmb3IgKGNvbnN0IGNvdW50cnkgb2YgY291bnRyaWVzKSB7XG4gICAgICAgIGNvbnN0IHVybCA9IGAke3RoaXMuYmFzZVVybH0vY291bnRyeS8ke2NvdW50cnkudG9Mb3dlckNhc2UoKX0vaW5kaWNhdG9yLyR7aW5kaWNhdG9yfT9mb3JtYXQ9anNvbiZkYXRlPSR7c3RhcnRZZWFyfToke2VuZFllYXJ9JnBlcl9wYWdlPTEwMDBgO1xuXG4gICAgICAgIGxldCBkYXRhO1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGRhdGEgPSBhd2FpdCBzYWZlRmV0Y2godXJsLCB7IGhlYWRlcnM6IHsgJ1VzZXItQWdlbnQnOiAnUHJhZXZpc2lvLzEuMCAoK2h0dHBzOi8vcHJhZXZpc2lvLmxvY2FsKScsIEFjY2VwdDogJ2FwcGxpY2F0aW9uL2pzb24nIH0gfSwgeyB0aW1lb3V0OiAxMDAwMCwgcmV0cmllczogMyB9KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgY29uc29sZS53YXJuKGBXb3JsZCBCYW5rIEFQSSBlcnJvciBmb3IgZm9vZCBzZWN1cml0eSAke2NvdW50cnl9OiAke2Vyci5tZXNzYWdlfWApO1xuICAgICAgICAgIHJlc3VsdHNbY291bnRyeV0gPSB7IGVycm9yOiBgQVBJIGVycm9yOiAke2Vyci5tZXNzYWdlfWAgfTtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICAvLyBSZXRyeSB3aXRoIGJyb2FkZXIgZGF0ZSByYW5nZSBpZiBubyBkYXRhIGZvdW5kXG4gICAgICAgIGlmICghKGRhdGEgJiYgQXJyYXkuaXNBcnJheShkYXRhKSAmJiBkYXRhWzFdICYmIGRhdGFbMV0ubGVuZ3RoID4gMCkpIHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgZmFsbGJhY2tVcmwgPSBgJHt0aGlzLmJhc2VVcmx9L2NvdW50cnkvJHtjb3VudHJ5LnRvTG93ZXJDYXNlKCl9L2luZGljYXRvci8ke2luZGljYXRvcn0/Zm9ybWF0PWpzb24mZGF0ZT0yMDEwOiR7ZW5kWWVhcn0mcGVyX3BhZ2U9MTAwMGA7XG4gICAgICAgICAgICBjb25zdCBmYWxsYmFjayA9IGF3YWl0IHNhZmVGZXRjaChmYWxsYmFja1VybCwgeyBoZWFkZXJzOiB7ICdVc2VyLUFnZW50JzogJ1ByYWV2aXNpby8xLjAgKCtodHRwczovL3ByYWV2aXNpby5sb2NhbCknLCBBY2NlcHQ6ICdhcHBsaWNhdGlvbi9qc29uJyB9IH0sIHsgdGltZW91dDogMTAwMDAsIHJldHJpZXM6IDIgfSk7XG4gICAgICAgICAgICBpZiAoZmFsbGJhY2sgJiYgQXJyYXkuaXNBcnJheShmYWxsYmFjaykgJiYgZmFsbGJhY2tbMV0gJiYgZmFsbGJhY2tbMV0ubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICBkYXRhID0gZmFsbGJhY2s7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oYFdvcmxkIEJhbmsgZmFsbGJhY2sgZXJyb3IgZm9yIGZvb2Qgc2VjdXJpdHkgJHtjb3VudHJ5fTogJHtlcnIubWVzc2FnZX1gKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRhdGEgJiYgZGF0YVsxXSAmJiBkYXRhWzFdLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAvLyBHZXQgdGhlIG1vc3QgcmVjZW50IHZhbHVlXG4gICAgICAgICAgY29uc3Qgc29ydGVkRGF0YSA9IGRhdGFbMV0uc29ydCgoYSwgYikgPT4gcGFyc2VJbnQoYi5kYXRlKSAtIHBhcnNlSW50KGEuZGF0ZSkpO1xuICAgICAgICAgIGNvbnN0IGxhdGVzdCA9IHNvcnRlZERhdGFbMF07XG4gICAgICAgICAgcmVzdWx0c1tjb3VudHJ5XSA9IHtcbiAgICAgICAgICAgIHZhbHVlOiBsYXRlc3QudmFsdWUsXG4gICAgICAgICAgICB5ZWFyOiBsYXRlc3QuZGF0ZSxcbiAgICAgICAgICAgIGNvdW50cnk6IGxhdGVzdC5jb3VudHJ5LnZhbHVlLFxuICAgICAgICAgICAgaW5kaWNhdG9yOiAnUHJldmFsZW5jZSBvZiB1bmRlcm5vdXJpc2htZW50ICglIG9mIHBvcHVsYXRpb24pJ1xuICAgICAgICAgIH07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzdWx0c1tjb3VudHJ5XSA9IHsgdmFsdWU6IG51bGwsIG5vdGU6ICdObyBkYXRhIGF2YWlsYWJsZScgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFJhdGUgbGltaXRpbmdcbiAgICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDEwMCkpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBjb3VudHJpZXMsXG4gICAgICAgIHBlcmlvZDogeyBzdGFydFllYXIsIGVuZFllYXIgfSxcbiAgICAgICAgaW5kaWNhdG9yOiAnU04uSVRLLkRFRkMuWlMnLFxuICAgICAgICBkYXRhOiByZXN1bHRzXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBmb29kIHNlY3VyaXR5IGRhdGE6JywgZXJyb3IpO1xuICAgICAgLy8gRmFsbGJhY2sgdG8gaGlnaC1maWRlbGl0eSBtb2NrIGRhdGFcbiAgICAgIGNvbnN0IG1vY2tEYXRhID0gdGhpcy5nZXRNb2NrRm9vZFNlY3VyaXR5RGF0YShjb3VudHJpZXMsIHN0YXJ0WWVhciwgZW5kWWVhcik7XG4gICAgICByZXR1cm4gbW9ja0RhdGE7XG4gICAgfVxuICB9XG5cbiAgLy8gSGlnaC1maWRlbGl0eSBtb2NrIGRhdGEgZm9yIGZhbGxiYWNrIHdoZW4gQVBJIGZhaWxzXG4gIGdldE1vY2tFY29ub21pY0luZGljYXRvcnMoY291bnRyeSwgaW5kaWNhdG9ycywgc3RhcnRZZWFyLCBlbmRZZWFyKSB7XG4gICAgY29uc3QgbW9ja0luZGljYXRvcnMgPSB7fTtcblxuICAgIC8vIE1vY2sgZGF0YSBmb3IgY29tbW9uIGluZGljYXRvcnNcbiAgICBjb25zdCBtb2NrVmFsdWVzID0ge1xuICAgICAgJ05ZLkdEUC5QQ0FQLkNEJzogeyB2YWx1ZTogNjUwMCwgeWVhcjogZW5kWWVhciwgY291bnRyeTogY291bnRyeSB9LFxuICAgICAgJ0ZQLkNQSS5UT1RMLlpHJzogeyB2YWx1ZTogNC4yLCB5ZWFyOiBlbmRZZWFyLCBjb3VudHJ5OiBjb3VudHJ5IH0sXG4gICAgICAnU0wuVUVNLlRPVEwuWlMnOiB7IHZhbHVlOiA4LjUsIHllYXI6IGVuZFllYXIsIGNvdW50cnk6IGNvdW50cnkgfSxcbiAgICAgICdQQS5OVVMuRkNSRic6IHsgdmFsdWU6IDEuMTUsIHllYXI6IGVuZFllYXIsIGNvdW50cnk6IGNvdW50cnkgfSxcbiAgICAgICdEVC5ET0QuREVDVC5DRCc6IHsgdmFsdWU6IDQ1MDAwMDAwMDAwLCB5ZWFyOiBlbmRZZWFyLCBjb3VudHJ5OiBjb3VudHJ5IH0sXG4gICAgICAnRkkuUkVTLlRPVEwuQ0QnOiB7IHZhbHVlOiAxMjAwMDAwMDAwMCwgeWVhcjogZW5kWWVhciwgY291bnRyeTogY291bnRyeSB9XG4gICAgfTtcblxuICAgIGluZGljYXRvcnMuZm9yRWFjaChpbmRpY2F0b3IgPT4ge1xuICAgICAgaWYgKG1vY2tWYWx1ZXNbaW5kaWNhdG9yXSkge1xuICAgICAgICBtb2NrSW5kaWNhdG9yc1tpbmRpY2F0b3JdID0gbW9ja1ZhbHVlc1tpbmRpY2F0b3JdO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gR2VuZXJpYyBtb2NrIGZvciB1bmtub3duIGluZGljYXRvcnNcbiAgICAgICAgbW9ja0luZGljYXRvcnNbaW5kaWNhdG9yXSA9IHtcbiAgICAgICAgICB2YWx1ZTogTWF0aC5yYW5kb20oKSAqIDEwMCxcbiAgICAgICAgICB5ZWFyOiBlbmRZZWFyLFxuICAgICAgICAgIGNvdW50cnk6IGNvdW50cnksXG4gICAgICAgICAgbm90ZTogJ01vY2sgZGF0YSAtIEFQSSB1bmF2YWlsYWJsZSdcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiB7XG4gICAgICBjb3VudHJ5LFxuICAgICAgcGVyaW9kOiB7IHN0YXJ0WWVhciwgZW5kWWVhciB9LFxuICAgICAgaW5kaWNhdG9yczogbW9ja0luZGljYXRvcnMsXG4gICAgICBpc01vY2s6IHRydWUsXG4gICAgICBub3RlOiAnSGlnaC1maWRlbGl0eSBtb2NrIGRhdGEgLSBBUEkgdW5hdmFpbGFibGUnXG4gICAgfTtcbiAgfVxuXG4gIC8vIEhpZ2gtZmlkZWxpdHkgbW9jayBkYXRhIGZvciBmb29kIHNlY3VyaXR5IGZhbGxiYWNrXG4gIGdldE1vY2tGb29kU2VjdXJpdHlEYXRhKGNvdW50cmllcywgc3RhcnRZZWFyLCBlbmRZZWFyKSB7XG4gICAgY29uc3QgbW9ja0RhdGEgPSB7fTtcblxuICAgIGNvdW50cmllcy5mb3JFYWNoKGNvdW50cnkgPT4ge1xuICAgICAgbW9ja0RhdGFbY291bnRyeV0gPSB7XG4gICAgICAgIHZhbHVlOiA1LjIgKyBNYXRoLnJhbmRvbSgpICogMiwgLy8gUmFuZG9tIHZhbHVlIGJldHdlZW4gNS4yLTcuMlxuICAgICAgICB5ZWFyOiBlbmRZZWFyLFxuICAgICAgICBjb3VudHJ5OiBjb3VudHJ5LFxuICAgICAgICBpbmRpY2F0b3I6ICdQcmV2YWxlbmNlIG9mIHVuZGVybm91cmlzaG1lbnQgKCUgb2YgcG9wdWxhdGlvbiknXG4gICAgICB9O1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGNvdW50cmllcyxcbiAgICAgIHBlcmlvZDogeyBzdGFydFllYXIsIGVuZFllYXIgfSxcbiAgICAgIGluZGljYXRvcjogJ1NOLklUSy5ERUZDLlpTJyxcbiAgICAgIGRhdGE6IG1vY2tEYXRhLFxuICAgICAgaXNNb2NrOiB0cnVlLFxuICAgICAgbm90ZTogJ0hpZ2gtZmlkZWxpdHkgbW9jayBkYXRhIC0gQVBJIHVuYXZhaWxhYmxlJ1xuICAgIH07XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgV29ybGRCYW5rSW50ZWdyYXRpb247Il0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFBQSxVQUFBLEdBQUFDLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBQyxXQUFBLEdBQUFELE9BQUE7QUFBMEQsU0FBQUQsdUJBQUFHLENBQUEsV0FBQUEsQ0FBQSxJQUFBQSxDQUFBLENBQUFDLFVBQUEsR0FBQUQsQ0FBQSxLQUFBRSxPQUFBLEVBQUFGLENBQUE7QUFFMUQsTUFBTUcsb0JBQW9CLENBQUM7RUFDekJDLFdBQVdBLENBQUEsRUFBRztJQUNaLElBQUksQ0FBQ0MsT0FBTyxHQUFHQyxPQUFPLENBQUNDLEdBQUcsQ0FBQ0MsU0FBUyxLQUFLLE1BQU0sR0FDM0Msd0NBQXdDLEdBQ3hDLDhCQUE4QjtFQUNwQztFQUVBLE1BQU1DLHFCQUFxQkEsQ0FBQ0MsT0FBTyxFQUFFQyxVQUFVLEVBQUVDLFNBQVMsRUFBRUMsT0FBTyxFQUFFO0lBQ25FLElBQUk7TUFDRixNQUFNQyxPQUFPLEdBQUcsQ0FBQyxDQUFDO01BRWxCLEtBQUssTUFBTUMsU0FBUyxJQUFJSixVQUFVLEVBQUU7UUFDbEMsTUFBTUssR0FBRyxHQUFHLEdBQUcsSUFBSSxDQUFDWCxPQUFPLFlBQVlLLE9BQU8sQ0FBQ08sV0FBVyxDQUFDLENBQUMsY0FBY0YsU0FBUyxxQkFBcUJILFNBQVMsSUFBSUMsT0FBTyxnQkFBZ0I7UUFFNUksSUFBSUssSUFBSTtRQUNSLElBQUk7VUFDRkEsSUFBSSxHQUFHLE1BQU0sSUFBQUMsa0JBQVMsRUFBQ0gsR0FBRyxFQUFFO1lBQUVJLE9BQU8sRUFBRTtjQUFFLFlBQVksRUFBRSwwQ0FBMEM7Y0FBRUMsTUFBTSxFQUFFO1lBQW1CO1VBQUUsQ0FBQyxFQUFFO1lBQUVDLE9BQU8sRUFBRSxLQUFLO1lBQUVDLE9BQU8sRUFBRTtVQUFFLENBQUMsQ0FBQztRQUNwSyxDQUFDLENBQUMsT0FBT0MsR0FBRyxFQUFFO1VBQ1pDLE9B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QUUrQixLQUFLLEVBQUUsV0FBVztRQUFFQyxJQUFJLEVBQUU3QixPQUFPO1FBQUVILE9BQU8sRUFBRUE7TUFBUTtJQUMxRSxDQUFDO0lBRURDLFVBQVUsQ0FBQ3NELE9BQU8sQ0FBQ2xELFNBQVMsSUFBSTtNQUM5QixJQUFJaUQsVUFBVSxDQUFDakQsU0FBUyxDQUFDLEVBQUU7UUFDekJnRCxjQUFjLENBQUNoRCxTQUFTLENBQUMsR0FBR2lELFVBQVUsQ0FBQ2pELFNBQVMsQ0FBQztNQUNuRCxDQUFDLE1BQU07UUFDTDtRQUNBZ0QsY0FBYyxDQUFDaEQsU0FBUyxDQUFDLEdBQUc7VUFDMUIwQixLQUFLLEVBQUV5QixJQUFJLENBQUNDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsR0FBRztVQUMxQnpCLElBQUksRUFBRTdCLE9BQU87VUFDYkgsT0FBTyxFQUFFQSxPQUFPO1VBQ2hCc0MsSUFBSSxFQUFFO1FBQ1IsQ0FBQztNQUNIO0lBQ0YsQ0FBQyxDQUFDO0lBRUYsT0FBTztNQUNMdEMsT0FBTztNQUNQMEMsTUFBTSxFQUFFO1FBQUV4QyxTQUFTO1FBQUVDO01BQVEsQ0FBQztNQUM5QkYsVUFBVSxFQUFFb0QsY0FBYztNQUMxQkssTUFBTSxFQUFFLElBQUk7TUFDWnBCLElBQUksRUFBRTtJQUNSLENBQUM7RUFDSDs7RUFFQTtFQUNBYyx1QkFBdUJBLENBQUNGLFNBQVMsRUFBRWhELFNBQVMsRUFBRUMsT0FBTyxFQUFFO0lBQ3JELE1BQU15QyxRQUFRLEdBQUcsQ0FBQyxDQUFDO0lBRW5CTSxTQUFTLENBQUNLLE9BQU8sQ0FBQ3ZELE9BQU8sSUFBSTtNQUMzQjRDLFFBQVEsQ0FBQzVDLE9BQU8sQ0FBQyxHQUFHO1FBQ2xCK0IsS0FBSyxFQUFFLEdBQUcsR0FBR3lCLElBQUksQ0FBQ0MsTUFBTSxDQUFDLENBQUMsR0FBRyxDQUFDO1FBQUU7UUFDaEN6QixJQUFJLEVBQUU3QixPQUFPO1FBQ2JILE9BQU8sRUFBRUEsT0FBTztRQUNoQkssU0FBUyxFQUFFO01BQ2IsQ0FBQztJQUNILENBQUMsQ0FBQztJQUVGLE9BQU87TUFDTDZDLFNBQVM7TUFDVFIsTUFBTSxFQUFFO1FBQUV4QyxTQUFTO1FBQUVDO01BQVEsQ0FBQztNQUM5QkUsU0FBUyxFQUFFLGdCQUFnQjtNQUMzQkcsSUFBSSxFQUFFb0MsUUFBUTtNQUNkYyxNQUFNLEVBQUUsSUFBSTtNQUNacEIsSUFBSSxFQUFFO0lBQ1IsQ0FBQztFQUNIO0FBQ0Y7QUFBQyxJQUFBcUIsUUFBQSxHQUFBQyxPQUFBLENBQUFwRSxPQUFBLEdBRWNDLG9CQUFvQiIsImlnbm9yZUxpc3QiOltdfQ==