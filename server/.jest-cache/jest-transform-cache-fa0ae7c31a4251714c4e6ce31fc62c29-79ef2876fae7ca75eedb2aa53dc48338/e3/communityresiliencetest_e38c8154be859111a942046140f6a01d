aaa47070fd711a6426eea2fec41dfa14
"use strict";

function _supertest() {
  const data = _interopRequireDefault(require("supertest"));
  _supertest = function () {
    return data;
  };
  return data;
}
function _express() {
  const data = _interopRequireDefault(require("express"));
  _express = function () {
    return data;
  };
  return data;
}
var _communityResilience = _interopRequireDefault(require("../../src/routes/community-resilience.js"));
function _interopRequireDefault(e) { return e && e.__esModule ? e : { default: e }; }
describe('Community Resilience Routes', () => {
  let app;
  beforeEach(() => {
    // Clear mock history before each test for purity
    global.mockFetch.mockClear();

    // Create express app with the router
    app = (0, _express().default)();
    app.use(_express().default.json());
    app.use('/api/community-resilience', _communityResilience.default);
  });
  describe('GET /api/community-resilience', () => {
    it('should return community resilience analysis for default countries', async () => {
      // Mock successful GDELT API response
      global.mockFetch.mockResolvedValue(new global.Response(JSON.stringify({
        eventCount: 5,
        events: []
      }), {
        status: 200
      }));
      const response = await (0, _supertest().default)(app).get('/api/community-resilience');
      expect(response.status).toBe(200);
      expect(response.body).toBeDefined();
      expect(typeof response.body.resilience).toBe('number');
    });
    it('should accept custom countries and days parameters', async () => {
      global.mockFetch.mockResolvedValue(new global.Response(JSON.stringify({
        eventCount: 3,
        events: []
      }), {
        status: 200
      }));
      const response = await (0, _supertest().default)(app).get('/api/community-resilience?countries=COL,PER&days=15');
      expect(response.status).toBe(200);
      expect(response.body).toBeDefined();
      expect(typeof response.body.resilience).toBe('number');
    });
    it('should handle API failures gracefully with fallback data', async () => {
      // Simulate GDELT API failure
      global.mockFetch.mockRejectedValue(new Error('GDELT API failure'));
      const response = await (0, _supertest().default)(app).get('/api/community-resilience');
      expect(response.status).toBe(200);
      expect(response.body).toBeDefined();
      expect(typeof response.body.resilience).toBe('number');
    });
  });
  describe('GET /api/community-resilience/report', () => {
    it('should return formatted resilience report', async () => {
      global.mockFetch.mockResolvedValue(new global.Response(JSON.stringify({
        eventCount: 4,
        events: []
      }), {
        status: 200
      }));
      const response = await (0, _supertest().default)(app).get('/api/community-resilience/report');
      expect(response.status).toBe(200);
      expect(typeof response.body).toBe('string');
      expect(response.body).toContain('# COMMUNITY_RESILIENCE_REPORT.md');
    });
    it('should include recommendations in the report', async () => {
      global.mockFetch.mockResolvedValue(new global.Response(JSON.stringify({
        eventCount: 10,
        events: []
      }), {
        status: 200
      }));
      const response = await (0, _supertest().default)(app).get('/api/community-resilience/report');
      expect(response.status).toBe(200);
      expect(response.body.report).toContain('Recomendaciones:');
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfc3VwZXJ0ZXN0IiwiZGF0YSIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX2V4cHJlc3MiLCJfY29tbXVuaXR5UmVzaWxpZW5jZSIsImUiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsImRlc2NyaWJlIiwiYXBwIiwiYmVmb3JlRWFjaCIsImdsb2JhbCIsIm1vY2tGZXRjaCIsIm1vY2tDbGVhciIsImV4cHJlc3MiLCJ1c2UiLCJqc29uIiwiY29tbXVuaXR5UmVzaWxpZW5jZVJvdXRlciIsIml0IiwibW9ja1Jlc29sdmVkVmFsdWUiLCJSZXNwb25zZSIsIkpTT04iLCJzdHJpbmdpZnkiLCJldmVudENvdW50IiwiZXZlbnRzIiwic3RhdHVzIiwicmVzcG9uc2UiLCJyZXF1ZXN0IiwiZ2V0IiwiZXhwZWN0IiwidG9CZSIsImJvZHkiLCJ0b0JlRGVmaW5lZCIsInJlc2lsaWVuY2UiLCJtb2NrUmVqZWN0ZWRWYWx1ZSIsIkVycm9yIiwidG9Db250YWluIiwicmVwb3J0Il0sInNvdXJjZXMiOlsiY29tbXVuaXR5LXJlc2lsaWVuY2UudGVzdC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgcmVxdWVzdCBmcm9tICdzdXBlcnRlc3QnO1xuaW1wb3J0IGV4cHJlc3MgZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgY29tbXVuaXR5UmVzaWxpZW5jZVJvdXRlciBmcm9tICcuLi8uLi9zcmMvcm91dGVzL2NvbW11bml0eS1yZXNpbGllbmNlLmpzJztcblxuZGVzY3JpYmUoJ0NvbW11bml0eSBSZXNpbGllbmNlIFJvdXRlcycsICgpID0+IHtcbiAgbGV0IGFwcDtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAvLyBDbGVhciBtb2NrIGhpc3RvcnkgYmVmb3JlIGVhY2ggdGVzdCBmb3IgcHVyaXR5XG4gICAgZ2xvYmFsLm1vY2tGZXRjaC5tb2NrQ2xlYXIoKTtcblxuICAgIC8vIENyZWF0ZSBleHByZXNzIGFwcCB3aXRoIHRoZSByb3V0ZXJcbiAgICBhcHAgPSBleHByZXNzKCk7XG4gICAgYXBwLnVzZShleHByZXNzLmpzb24oKSk7XG4gICAgYXBwLnVzZSgnL2FwaS9jb21tdW5pdHktcmVzaWxpZW5jZScsIGNvbW11bml0eVJlc2lsaWVuY2VSb3V0ZXIpO1xuICB9KTtcblxuICBkZXNjcmliZSgnR0VUIC9hcGkvY29tbXVuaXR5LXJlc2lsaWVuY2UnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gY29tbXVuaXR5IHJlc2lsaWVuY2UgYW5hbHlzaXMgZm9yIGRlZmF1bHQgY291bnRyaWVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gTW9jayBzdWNjZXNzZnVsIEdERUxUIEFQSSByZXNwb25zZVxuICAgICAgZ2xvYmFsLm1vY2tGZXRjaC5tb2NrUmVzb2x2ZWRWYWx1ZShuZXcgZ2xvYmFsLlJlc3BvbnNlKEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgZXZlbnRDb3VudDogNSxcbiAgICAgICAgZXZlbnRzOiBbXVxuICAgICAgfSksIHsgc3RhdHVzOiAyMDAgfSkpO1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKS5nZXQoJy9hcGkvY29tbXVuaXR5LXJlc2lsaWVuY2UnKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZSgyMDApO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QodHlwZW9mIHJlc3BvbnNlLmJvZHkucmVzaWxpZW5jZSkudG9CZSgnbnVtYmVyJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFjY2VwdCBjdXN0b20gY291bnRyaWVzIGFuZCBkYXlzIHBhcmFtZXRlcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBnbG9iYWwubW9ja0ZldGNoLm1vY2tSZXNvbHZlZFZhbHVlKG5ldyBnbG9iYWwuUmVzcG9uc2UoSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBldmVudENvdW50OiAzLFxuICAgICAgICBldmVudHM6IFtdXG4gICAgICB9KSwgeyBzdGF0dXM6IDIwMCB9KSk7XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5nZXQoJy9hcGkvY29tbXVuaXR5LXJlc2lsaWVuY2U/Y291bnRyaWVzPUNPTCxQRVImZGF5cz0xNScpO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKDIwMCk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keSkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdCh0eXBlb2YgcmVzcG9uc2UuYm9keS5yZXNpbGllbmNlKS50b0JlKCdudW1iZXInKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIEFQSSBmYWlsdXJlcyBncmFjZWZ1bGx5IHdpdGggZmFsbGJhY2sgZGF0YScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFNpbXVsYXRlIEdERUxUIEFQSSBmYWlsdXJlXG4gICAgICBnbG9iYWwubW9ja0ZldGNoLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignR0RFTFQgQVBJIGZhaWx1cmUnKSk7XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApLmdldCgnL2FwaS9jb21tdW5pdHktcmVzaWxpZW5jZScpO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKDIwMCk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keSkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdCh0eXBlb2YgcmVzcG9uc2UuYm9keS5yZXNpbGllbmNlKS50b0JlKCdudW1iZXInKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0dFVCAvYXBpL2NvbW11bml0eS1yZXNpbGllbmNlL3JlcG9ydCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBmb3JtYXR0ZWQgcmVzaWxpZW5jZSByZXBvcnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBnbG9iYWwubW9ja0ZldGNoLm1vY2tSZXNvbHZlZFZhbHVlKG5ldyBnbG9iYWwuUmVzcG9uc2UoSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBldmVudENvdW50OiA0LFxuICAgICAgICBldmVudHM6IFtdXG4gICAgICB9KSwgeyBzdGF0dXM6IDIwMCB9KSk7XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApLmdldCgnL2FwaS9jb21tdW5pdHktcmVzaWxpZW5jZS9yZXBvcnQnKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZSgyMDApO1xuICAgICAgZXhwZWN0KHR5cGVvZiByZXNwb25zZS5ib2R5KS50b0JlKCdzdHJpbmcnKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5KS50b0NvbnRhaW4oJyMgQ09NTVVOSVRZX1JFU0lMSUVOQ0VfUkVQT1JULm1kJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGluY2x1ZGUgcmVjb21tZW5kYXRpb25zIGluIHRoZSByZXBvcnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBnbG9iYWwubW9ja0ZldGNoLm1vY2tSZXNvbHZlZFZhbHVlKG5ldyBnbG9iYWwuUmVzcG9uc2UoSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBldmVudENvdW50OiAxMCxcbiAgICAgICAgZXZlbnRzOiBbXVxuICAgICAgfSksIHsgc3RhdHVzOiAyMDAgfSkpO1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKS5nZXQoJy9hcGkvY29tbXVuaXR5LXJlc2lsaWVuY2UvcmVwb3J0Jyk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmUoMjAwKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LnJlcG9ydCkudG9Db250YWluKCdSZWNvbWVuZGFjaW9uZXM6Jyk7XG4gICAgfSk7XG4gIH0pO1xufSk7Il0sIm1hcHBpbmdzIjoiOztBQUFBLFNBQUFBLFdBQUE7RUFBQSxNQUFBQyxJQUFBLEdB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