{"version":3,"names":["_server","require","describe","beforeAll","server","listen","afterAll","close","afterEach","jest","resetModules","restoreAllMocks","test","doMock","fn","mockImplementation","getFoodSecurityData","mockRejectedValue","Error","global","fetch","mockResolvedValue","ok","json","data","countryCode","value","year","country","summary","averageValue","getFoodSecurityIndex","res","expect","toBeDefined","countries","toEqual","COL","toBeCloseTo","globalAverage","status","source","toMatch"],"sources":["worldBankService.unit.test.js"],"sourcesContent":["import { server } from '../mocks/server.js';\n\ndescribe('worldBankService', () => {\n  beforeAll(() => {\n    server.listen();\n  });\n\n  afterAll(() => {\n    server.close();\n  });\n\n  afterEach(() => {\n    jest.resetModules();\n    jest.restoreAllMocks();\n  });\n\n  test('returns transformed data from serverless endpoint', async () => {\n    // Ensure integration throws so the serverless endpoint path is used\n    jest.doMock('../../src/integrations/WorldBankIntegration.js', () => {\n      return jest.fn().mockImplementation(() => ({\n        getFoodSecurityData: jest.fn().mockRejectedValue(new Error('integration unavailable'))\n      }));\n    });\n\n    // Mock fetch to return a serverless endpoint shape\n    global.fetch = jest.fn().mockResolvedValue({\n      ok: true,\n      json: async () => ({\n        data: [\n          { countryCode: 'COL', value: 5.2, year: '2024', country: 'Colombia' },\n          { countryCode: 'PER', value: 7.1, year: '2024', country: 'Peru' }\n        ],\n        summary: { averageValue: 6.15 }\n      })\n    });\n\n    const { getFoodSecurityIndex } = require('../../src/services/worldBankService');\n\n    const res = await getFoodSecurityIndex();\n\n    expect(res).toBeDefined();\n    expect(res.countries).toEqual(['COL', 'PER']);\n    expect(res.data.COL.value).toBeCloseTo(5.2);\n    expect(res.globalAverage).toBeCloseTo(6.15);\n  });\n\n  test('falls back to mock data on fetch error', async () => {\n    // Mock integration to throw so function reaches fetch path\n    jest.doMock('../../src/integrations/WorldBankIntegration.js', () => {\n      return jest.fn().mockImplementation(() => ({\n        getFoodSecurityData: jest.fn().mockRejectedValue(new Error('nope'))\n      }));\n    });\n\n    global.fetch = jest.fn().mockResolvedValue({ ok: false, status: 500 });\n\n    const { getFoodSecurityIndex } = require('../../src/services/worldBankService');\n\n    const res = await getFoodSecurityIndex();\n    expect(res.source).toMatch(/Fallback Mock Data/);\n    expect(res.data.COL).toBeDefined();\n  });\n});\n"],"mappings":"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","ignoreList":[]}