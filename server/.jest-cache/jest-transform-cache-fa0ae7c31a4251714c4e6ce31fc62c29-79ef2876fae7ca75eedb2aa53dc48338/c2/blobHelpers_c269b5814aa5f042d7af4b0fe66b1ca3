39c8ffde57e646d8c80334fbd3c6eb7e
"use strict";

/*! Based on fetch-blob. MIT License. Jimmy WÃ¤rting <https://jimmy.warting.se/opensource> & David Frank */
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.sliceBlob = exports.consumeBlobParts = void 0;
const isFunction_1 = require("./isFunction");
const CHUNK_SIZE = 65536;
async function* clonePart(part) {
  const end = part.byteOffset + part.byteLength;
  let position = part.byteOffset;
  while (position !== end) {
    const size = Math.min(end - position, CHUNK_SIZE);
    const chunk = part.buffer.slice(position, position + size);
    position += chunk.byteLength;
    yield new Uint8Array(chunk);
  }
}
async function* consumeNodeBlob(blob) {
  let position = 0;
  while (position !== blob.size) {
    const chunk = blob.slice(position, Math.min(blob.size, position + CHUNK_SIZE));
    const buffer = await chunk.arrayBuffer();
    position += buffer.byteLength;
    yield new Uint8Array(buffer);
  }
}
async function* consumeBlobParts(parts, clone = false) {
  for (const part of parts) {
    if (ArrayBuffer.isView(part)) {
      if (clone) {
        yield* clonePart(part);
      } else {
        yield part;
      }
    } else if ((0, isFunction_1.isFunction)(part.stream)) {
      yield* part.stream();
    } else {
      yield* consumeNodeBlob(part);
    }
  }
}
exports.consumeBlobParts = consumeBlobParts;
function* sliceBlob(blobParts, blobSize, start = 0, end) {
  end !== null && end !== void 0 ? end : end = blobSize;
  let relativeStart = start < 0 ? Math.max(blobSize + start, 0) : Math.min(start, blobSize);
  let relativeEnd = end < 0 ? Math.max(blobSize + end, 0) : Math.min(end, blobSize);
  const span = Math.max(relativeEnd - relativeStart, 0);
  let added = 0;
  for (const part of blobParts) {
    if (added >= span) {
      break;
    }
    const partSize = ArrayBuffer.isView(part) ? part.byteLength : part.size;
    if (relativeStart && partSize <= relativeStart) {
      relativeStart -= partSize;
      relativeEnd -= partSize;
    } else {
      let chunk;
      if (ArrayBuffer.isView(part)) {
        chunk = part.subarray(relativeStart, Math.min(partSize, relativeEnd));
        added += chunk.byteLength;
      } else {
        chunk = part.slice(relativeStart, Math.min(partSize, relativeEnd));
        added += chunk.size;
      }
      relativeEnd -= partSize;
      relativeStart = 0;
      yield chunk;
    }
  }
}
exports.sliceBlob = sliceBlob;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsInNsaWNlQmxvYiIsImNvbnN1bWVCbG9iUGFydHMiLCJpc0Z1bmN0aW9uXzEiLCJyZXF1aXJlIiwiQ0hVTktfU0laRSIsImNsb25lUGFydCIsInBhcnQiLCJlbmQiLCJieXRlT2Zmc2V0IiwiYnl0ZUxlbmd0aCIsInBvc2l0aW9uIiwic2l6ZSIsIk1hdGgiLCJtaW4iLCJjaHVuayIsImJ1ZmZlciIsInNsaWNlIiwiVWludDhBcnJheSIsImNvbnN1bWVOb2RlQmxvYiIsImJsb2IiLCJhcnJheUJ1ZmZlciIsInBhcnRzIiwiY2xvbmUiLCJBcnJheUJ1ZmZlciIsImlzVmlldyIsImlzRnVuY3Rpb24iLCJzdHJlYW0iLCJibG9iUGFydHMiLCJibG9iU2l6ZSIsInN0YXJ0IiwicmVsYXRpdmVTdGFydCIsIm1heCIsInJlbGF0aXZlRW5kIiwic3BhbiIsImFkZGVkIiwicGFydFNpemUiLCJzdWJhcnJheSJdLCJzb3VyY2VzIjpbImJsb2JIZWxwZXJzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuLyohIEJhc2VkIG9uIGZldGNoLWJsb2IuIE1JVCBMaWNlbnNlLiBKaW1teSBXw6RydGluZyA8aHR0cHM6Ly9qaW1teS53YXJ0aW5nLnNlL29wZW5zb3VyY2U+ICYgRGF2aWQgRnJhbmsgKi9cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuc2xpY2VCbG9iID0gZXhwb3J0cy5jb25zdW1lQmxvYlBhcnRzID0gdm9pZCAwO1xuY29uc3QgaXNGdW5jdGlvbl8xID0gcmVxdWlyZShcIi4vaXNGdW5jdGlvblwiKTtcbmNvbnN0IENIVU5LX1NJWkUgPSA2NTUzNjtcbmFzeW5jIGZ1bmN0aW9uKiBjbG9uZVBhcnQocGFydCkge1xuICAgIGNvbnN0IGVuZCA9IHBhcnQuYnl0ZU9mZnNldCArIHBhcnQuYnl0ZUxlbmd0aDtcbiAgICBsZXQgcG9zaXRpb24gPSBwYXJ0LmJ5dGVPZmZzZXQ7XG4gICAgd2hpbGUgKHBvc2l0aW9uICE9PSBlbmQpIHtcbiAgICAgICAgY29uc3Qgc2l6ZSA9IE1hdGgubWluKGVuZCAtIHBvc2l0aW9uLCBDSFVOS19TSVpFKTtcbiAgICAgICAgY29uc3QgY2h1bmsgPSBwYXJ0LmJ1ZmZlci5zbGljZShwb3NpdGlvbiwgcG9zaXRpb24gKyBzaXplKTtcbiAgICAgICAgcG9zaXRpb24gKz0gY2h1bmsuYnl0ZUxlbmd0aDtcbiAgICAgICAgeWllbGQgbmV3IFVpbnQ4QXJyYXkoY2h1bmspO1xuICAgIH1cbn1cbmFzeW5jIGZ1bmN0aW9uKiBjb25zdW1lTm9kZUJsb2IoYmxvYikge1xuICAgIGxldCBwb3NpdGlvbiA9IDA7XG4gICAgd2hpbGUgKHBvc2l0aW9uICE9PSBibG9iLnNpemUpIHtcbiAgICAgICAgY29uc3QgY2h1bmsgPSBibG9iLnNsaWNlKHBvc2l0aW9uLCBNYXRoLm1pbihibG9iLnNpemUsIHBvc2l0aW9uICsgQ0hVTktfU0laRSkpO1xuICAgICAgICBjb25zdCBidWZmZXIgPSBhd2FpdCBjaHVuay5hcnJheUJ1ZmZlcigpO1xuICAgICAgICBwb3NpdGlvbiArPSBidWZmZXIuYnl0ZUxlbmd0aDtcbiAgICAgICAgeWllbGQgbmV3IFVpbnQ4QXJyYXkoYnVmZmVyKTtcbiAgICB9XG59XG5hc3luYyBmdW5jdGlvbiogY29uc3VtZUJsb2JQYXJ0cyhwYXJ0cywgY2xvbmUgPSBmYWxzZSkge1xuICAgIGZvciAoY29uc3QgcGFydCBvZiBwYXJ0cykge1xuICAgICAgICBpZiAoQXJyYXlCdWZmZXIuaXNWaWV3KHBhcnQpKSB7XG4gICAgICAgICAgICBpZiAoY2xvbmUpIHtcbiAgICAgICAgICAgICAgICB5aWVsZCogY2xvbmVQYXJ0KHBhcnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgeWllbGQgcGFydDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICgoMCwgaXNGdW5jdGlvbl8xLmlzRnVuY3Rpb24pKHBhcnQuc3RyZWFtKSkge1xuICAgICAgICAgICAgeWllbGQqIHBhcnQuc3RyZWFtKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB5aWVsZCogY29uc3VtZU5vZGVCbG9iKHBhcnQpO1xuICAgICAgICB9XG4gICAgfVxufVxuZXhwb3J0cy5jb25zdW1lQmxvYlBhcnRzID0gY29uc3VtZUJsb2JQYXJ0cztcbmZ1bmN0aW9uKiBzbGljZUJsb2IoYmxvYlBhcnRzLCBibG9iU2l6ZSwgc3RhcnQgPSAwLCBlbmQpIHtcbiAgICBlbmQgIT09IG51bGwgJiYgZW5kICE9PSB2b2lkIDAgPyBlbmQgOiAoZW5kID0gYmxvYlNpemUpO1xuICAgIGxldCByZWxhdGl2ZVN0YXJ0ID0gc3RhcnQgPCAwXG4gICAgICAgID8gTWF0aC5tYXgoYmxvYlNpemUgKyBzdGFydCwgMClcbiAgICAgICAgOiBNYXRoLm1pbihzdGFydCwgYmxvYlNpemUpO1xuICAgIGxldCByZWxhdGl2ZUVuZCA9IGVuZCA8IDBcbiAgICAgICAgPyBNYXRoLm1heChibG9iU2l6ZSArIGVuZCwgMClcbiAgICAgICAgOiBNYXRoLm1pbihlbmQsIGJsb2JTaXplKTtcbiAgICBjb25zdCBzcGFuID0gTWF0aC5tYXgocmVsYXRpdmVFbmQgLSByZWxhdGl2ZVN0YXJ0LCAwKTtcbiAgICBsZXQgYWRkZWQgPSAwO1xuICAgIGZvciAoY29uc3QgcGFydCBvZiBibG9iUGFydHMpIHtcbiAgICAgICAgaWYgKGFkZGVkID49IHNwYW4pIHtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHBhcnRTaXplID0gQXJyYXlCdWZmZXIuaXNWaWV3KHBhcnQpID8gcGFydC5ieXRlTGVuZ3RoIDogcGFydC5zaXplO1xuICAgICAgICBpZiAocmVsYXRpdmVTdGFydCAmJiBwYXJ0U2l6ZSA8PSByZWxhdGl2ZVN0YXJ0KSB7XG4gICAgICAgICAgICByZWxhdGl2ZVN0YXJ0IC09IHBhcnRTaXplO1xuICAgICAgICAgICAgcmVsYXRpdmVFbmQgLT0gcGFydFNpemU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBsZXQgY2h1bms7XG4gICAgICAgICAgICBpZiAoQXJyYXlCdWZmZXIuaXNWaWV3KHBhcnQpKSB7XG4gICAgICAgICAgICAgICAgY2h1bmsgPSBwYXJ0LnN1YmFycmF5KHJlbGF0aXZlU3RhcnQsIE1hdGgubWluKHBhcnRTaXplLCByZWxhdGl2ZUVuZCkpO1xuICAgICAgICAgICAgICAgIGFkZGVkICs9IGNodW5rLmJ5dGVMZW5ndGg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjaHVuayA9IHBhcnQuc2xpY2UocmVsYXRpdmVTdGFydCwgTWF0aC5taW4ocGFydFNpemUsIHJlbGF0aXZlRW5kKSk7XG4gICAgICAgICAgICAgICAgYWRkZWQgKz0gY2h1bmsuc2l6ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlbGF0aXZlRW5kIC09IHBhcnRTaXplO1xuICAgICAgICAgICAgcmVsYXRpdmVTdGFydCA9IDA7XG4gICAgICAgICAgICB5aWVsZCBjaHVuaztcbiAgICAgICAgfVxuICAgIH1cbn1cbmV4cG9ydHMuc2xpY2VCbG9iID0gc2xpY2VCbG9iO1xuIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUFZOztBQUNaO0FBQ0FBLE1BQU0sQ0FBQ0MsY0FBYyxDQUFDQyxPQUFPLEVBQUUsWUFBWSxFQUFFO0VBQUVDLEtBQUssRUFBRTtBQUFLLENBQUMsQ0FBQztBQUM3REQsT0FBTyxDQUFDRSxTQUFTLEdBQUdGLE9BQU8sQ0FBQ0csZ0JBQWdCLEdBQUcsS0FBSyxDQUFDO0FBQ3JELE1BQU1DLFlBQVksR0FBR0MsT0FBTyxDQUFDLGNBQWMsQ0FBQztBQUM1QyxNQUFNQyxVQUFVLEdBQUcsS0FBSztBQUN4QixnQkFB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