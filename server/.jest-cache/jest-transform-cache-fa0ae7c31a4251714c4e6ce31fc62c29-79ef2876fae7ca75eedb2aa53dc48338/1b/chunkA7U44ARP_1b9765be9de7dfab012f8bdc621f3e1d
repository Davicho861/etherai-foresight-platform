df6231937e8f5c37770710490a9c0f07
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
}); // src/Interceptor.ts
var _logger = require('@open-draft/logger');
var _stricteventemitter = require('strict-event-emitter');
var INTERNAL_REQUEST_ID_HEADER_NAME = "x-interceptors-internal-request-id";
function getGlobalSymbol(symbol) {
  return (
    // @ts-ignore https://github.com/Microsoft/TypeScript/issues/24587
    globalThis[symbol] || void 0
  );
}
function setGlobalSymbol(symbol, value) {
  globalThis[symbol] = value;
}
function deleteGlobalSymbol(symbol) {
  delete globalThis[symbol];
}
var InterceptorReadyState = /* @__PURE__ */(InterceptorReadyState2 => {
  InterceptorReadyState2["INACTIVE"] = "INACTIVE";
  InterceptorReadyState2["APPLYING"] = "APPLYING";
  InterceptorReadyState2["APPLIED"] = "APPLIED";
  InterceptorReadyState2["DISPOSING"] = "DISPOSING";
  InterceptorReadyState2["DISPOSED"] = "DISPOSED";
  return InterceptorReadyState2;
})(InterceptorReadyState || {});
var Interceptor = class {
  constructor(symbol) {
    this.symbol = symbol;
    this.readyState = "INACTIVE" /* INACTIVE */;
    this.emitter = new (0, _stricteventemitter.Emitter)();
    this.subscriptions = [];
    this.logger = new (0, _logger.Logger)(symbol.description);
    this.emitter.setMaxListeners(0);
    this.logger.info("constructing the interceptor...");
  }
  /**
   * Determine if this interceptor can be applied
   * in the current environment.
   */
  checkEnvironment() {
    return true;
  }
  /**
   * Apply this interceptor to the current process.
   * Returns an already running interceptor instance if it's present.
   */
  apply() {
    const logger = this.logger.extend("apply");
    logger.info("applying the interceptor...");
    if (this.readyState === "APPLIED" /* APPLIED */) {
      logger.info("intercepted already applied!");
      return;
    }
    const shouldApply = this.checkEnvironment();
    if (!shouldApply) {
      logger.info("the interceptor cannot be applied in this environment!");
      return;
    }
    this.readyState = "APPLYING" /* APPLYING */;
    const runningInstance = this.getInstance();
    if (runningInstance) {
      logger.info("found a running instance, reusing...");
      this.on = (event, listener) => {
        logger.info('proxying the "%s" listener', event);
        runningInstance.emitter.addListener(event, listener);
        this.subscriptions.push(() => {
          runningInstance.emitter.removeListener(event, listener);
          logger.info('removed proxied "%s" listener!', event);
        });
        return this;
      };
      this.readyState = "APPLIED" /* APPLIED */;
      return;
    }
    logger.info("no running instance found, setting up a new instance...");
    this.setup();
    this.setInstance();
    this.readyState = "APPLIED" /* APPLIED */;
  }
  /**
   * Setup the module augments and stubs necessary for this interceptor.
   * This method is not run if there's a running interceptor instance
   * to prevent instantiating an interceptor multiple times.
   */
  setup() {}
  /**
   * Listen to the interceptor's public events.
   */
  on(event, listener) {
    const logger = this.logger.extend("on");
    if (this.readyState === "DISPOSING" /* DISPOSING */ || this.readyState === "DISPOSED" /* DISPOSED */) {
      logger.info("cannot listen to events, already disposed!");
      return this;
    }
    logger.info('adding "%s" event listener:', event, listener);
    this.emitter.on(event, listener);
    return this;
  }
  once(event, listener) {
    this.emitter.once(event, listener);
    return this;
  }
  off(event, listener) {
    this.emitter.off(event, listener);
    return this;
  }
  removeAllListeners(event) {
    this.emitter.removeAllListeners(event);
    return this;
  }
  /**
   * Disposes of any side-effects this interceptor has introduced.
   */
  dispose() {
    const logger = this.logger.extend("dispose");
    if (this.readyState === "DISPOSED" /* DISPOSED */) {
      logger.info("cannot dispose, already disposed!");
      return;
    }
    logger.info("disposing the interceptor...");
    this.readyState = "DISPOSING" /* DISPOSING */;
    if (!this.getInstance()) {
      logger.info("no interceptors running, skipping dispose...");
      return;
    }
    this.clearInstance();
    logger.info("global symbol deleted:", getGlobalSymbol(this.symbol));
    if (this.subscriptions.length > 0) {
      logger.info("disposing of %d subscriptions...", this.subscriptions.length);
      for (const dispose of this.subscriptions) {
        dispose();
      }
      this.subscriptions = [];
      logger.info("disposed of all subscriptions!", this.subscriptions.length);
    }
    this.emitter.removeAllListeners();
    logger.info("destroyed the listener!");
    this.readyState = "DISPOSED" /* DISPOSED */;
  }
  getInstance() {
    var _a;
    const instance = getGlobalSymbol(this.symbol);
    this.logger.info("retrieved global instance:", (_a = instance == null ? void 0 : instance.constructor) == null ? void 0 : _a.name);
    return instance;
  }
  setInstance() {
    setGlobalSymbol(this.symbol, this);
    this.logger.info("set global instance!", this.symbol.description);
  }
  clearInstance() {
    deleteGlobalSymbol(this.symbol);
    this.logger.info("cleared global instance!", this.symbol.description);
  }
};

// src/createRequestId.ts
function createRequestId() {
  return Math.random().toString(16).slice(2);
}

// src/utils/canParseUrl.ts
function canParseUrl(url) {
  try {
    new URL(url);
    return true;
  } catch (_error) {
    return false;
  }
}

// src/utils/getValueBySymbol.ts
function getValueBySymbol(symbolName, source) {
  const ownSymbols = Object.getOwnPropertySymbols(source);
  const symbol = ownSymbols.find(symbol2 => {
    return symbol2.description === symbolName;
  });
  if (symbol) {
    return Reflect.get(source, symbol);
  }
  return;
}

// src/utils/fetchUtils.ts
var _FetchResponse = class extends Response {
  static isConfigurableStatusCode(status) {
    return status >= 200 && status <= 599;
  }
  static isRedirectResponse(status) {
    return _FetchResponse.STATUS_CODES_WITH_REDIRECT.includes(status);
  }
  /**
   * Returns a boolean indicating whether the given response status
   * code represents a response that can have a body.
   */
  static isResponseWithBody(status) {
    return !_FetchResponse.STATUS_CODES_WITHOUT_BODY.includes(status);
  }
  static setUrl(url, response) {
    if (!url || url === "about:" || !canParseUrl(url)) {
      return;
    }
    const state = getValueBySymbol("state", response);
    if (state) {
      state.urlList.push(new URL(url));
    } else {
      Object.defineProperty(response, "url", {
        value: url,
        enumerable: true,
        configurable: true,
        writable: false
      });
    }
  }
  /**
   * Parses the given raw HTTP headers into a Fetch API `Headers` instance.
   */
  static parseRawHeaders(rawHeaders) {
    const headers = new Headers();
    for (let line = 0; line < rawHeaders.length; line += 2) {
      headers.append(rawHeaders[line], rawHeaders[line + 1]);
    }
    return headers;
  }
  constructor(body, init = {}) {
    var _a;
    const status = (_a = init.status) != null ? _a : 200;
    const safeStatus = _FetchResponse.isConfigurableStatusCode(status) ? status : 200;
    const finalBody = _FetchResponse.isResponseWithBody(status) ? body : null;
    super(finalBody, {
      status: safeStatus,
      statusText: init.statusText,
      headers: init.headers
    });
    if (status !== safeStatus) {
      const state = getValueBySymbol("state", this);
      if (state) {
        state.status = status;
      } else {
        Object.defineProperty(this, "status", {
          value: status,
          enumerable: true,
          configurable: true,
          writable: false
        });
      }
    }
    _FetchResponse.setUrl(init.url, this);
  }
};
var FetchResponse = _FetchResponse;
/**
 * Response status codes for responses that cannot have body.
 * @see https://fetch.spec.whatwg.org/#statuses
 */
FetchResponse.STATUS_CODES_WITHOUT_BODY = [101, 103, 204, 205, 304];
FetchResponse.STATUS_CODES_WITH_REDIRECT = [301, 302, 303, 307, 308];
exports.INTERNAL_REQUEST_ID_HEADER_NAME = INTERNAL_REQUEST_ID_HEADER_NAME;
exports.getGlobalSymbol = getGlobalSymbol;
exports.deleteGlobalSymbol = deleteGlobalSymbol;
exports.InterceptorReadyState = InterceptorReadyState;
exports.Interceptor = Interceptor;
exports.createRequestId = createRequestId;
exports.canParseUrl = canParseUrl;
exports.FetchResponse = FetchResponse;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbG9nZ2VyIiwicmVxdWlyZSIsIl9zdHJpY3RldmVudGVtaXR0ZXIiLCJJTlRFUk5BTF9SRVFVRVNUX0lEX0hFQURFUl9OQU1FIiwiZ2V0R2xvYmFsU3ltYm9sIiwic3ltYm9sIiwiZ2xvYmFsVGhpcyIsInNldEdsb2JhbFN5bWJvbCIsInZhbHVlIiwiZGVsZXRlR2xvYmFsU3ltYm9sIiwiSW50ZXJjZXB0b3JSZWFkeVN0YXRlIiwiSW50ZXJjZXB0b3JSZWFkeVN0YXRlMiIsIkludGVyY2VwdG9yIiwiY29uc3RydWN0b3IiLCJyZWFkeVN0YXRlIiwiZW1pdHRlciIsIkVtaXR0ZXIiLCJzdWJzY3JpcHRpb25zIiwibG9nZ2VyIiwiTG9nZ2VyIiwiZGVzY3JpcHRpb24iLCJzZXRNYXhMaXN0ZW5lcnMiLCJpbmZvIiwiY2hlY2tFbnZpcm9ubWVudCIsImFwcGx5IiwiZXh0ZW5kIiwic2hvdWxkQXBwbHkiLCJydW5uaW5nSW5zdGFuY2UiLCJnZXRJbnN0YW5jZSIsIm9uIiwiZXZlbnQiLCJsaXN0ZW5lciIsImFkZExpc3RlbmVyIiwicHVzaCIsInJlbW92ZUxpc3RlbmVyIiwic2V0dXAiLCJzZXRJbnN0YW5jZSIsIm9uY2UiLCJvZmYiLCJyZW1vdmVBbGxMaXN0ZW5lcnMiLCJkaXNwb3NlIiwiY2xlYXJJbnN0YW5jZSIsImxlbmd0aCIsIl9hIiwiaW5zdGFuY2UiLCJuYW1lIiwiY3JlYXRlUmVxdWVzdElkIiwiTWF0aCIsInJhbmRvbSIsInRvU3RyaW5nIiwic2xpY2UiLCJjYW5QYXJzZVVybCIsInVybCIsIlVSTCIsIl9lcnJvciIsImdldFZhbHVlQnlTeW1ib2wiLCJzeW1ib2xOYW1lIiwic291cmNlIiwib3duU3ltYm9scyIsIk9iamVjdCIsImdldE93blByb3BlcnR5U3ltYm9scyIsImZpbmQiLCJzeW1ib2wyIiwiUmVmbGVjdCIsImdldCIsIl9GZXRjaFJlc3BvbnNlIiwiUmVzcG9uc2UiLCJpc0NvbmZpZ3VyYWJsZVN0YXR1c0NvZGUiLCJzdGF0dXMiLCJpc1JlZGlyZWN0UmVzcG9uc2UiLCJTVEFUVVNfQ09ERVNfV0lUSF9SRURJUkVDVCIsImluY2x1ZGVzIiwiaXNSZXNwb25zZVdpdGhCb2R5IiwiU1RBVFVTX0NPREVTX1dJVEhPVVRfQk9EWSIsInNldFVybCIsInJlc3BvbnNlIiwic3RhdGUiLCJ1cmxMaXN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiY29uZmlndXJhYmxlIiwid3JpdGFibGUiLCJwYXJzZVJhd0hlYWRlcnMiLCJyYXdIZWFkZXJzIiwiaGVhZGVycyIsIkhlYWRlcnMiLCJsaW5lIiwiYXBwZW5kIiwiYm9keSIsImluaXQiLCJzYWZlU3RhdHVzIiwiZmluYWxCb2R5Iiwic3RhdHVzVGV4dCIsIkZldGNoUmVzcG9uc2UiXSwic291cmNlcyI6WyIuLi8uLi9zcmMvSW50ZXJjZXB0b3IudHMiLCIuLi8uLi9zcmMvY3JlYXRlUmVxdWVzdElkLnRzIiwiLi4vLi4vc3JjL3V0aWxzL2NhblBhcnNlVXJsLnRzIiwiLi4vLi4vc3JjL3V0aWxzL2dldFZhbHVlQnlTeW1ib2wudHMiLCIuLi8uLi9zcmMvdXRpbHMvZmV0Y2hVdGlscy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBMb2dnZXIgfSBmcm9tICdAb3Blbi1kcmFmdC9sb2dnZXInXG5pbXBvcnQgeyBFbWl0dGVyLCBMaXN0ZW5lciB9IGZyb20gJ3N0cmljdC1ldmVudC1lbWl0dGVyJ1xuXG5leHBvcnQgdHlwZSBJbnRlcmNlcHRvckV2ZW50TWFwID0gUmVjb3JkPHN0cmluZywgYW55PlxuZXhwb3J0IHR5cGUgSW50ZXJjZXB0b3JTdWJzY3JpcHRpb24gPSAoKSA9PiB2b2lkXG5cbi8qKlxuICogUmVxdWVzdCBoZWFkZXIgbmFtZSB0byBkZXRlY3Qgd2hlbiBhIHNpbmdsZSByZXF1ZXN0XG4gKiBpcyBiZWluZyBoYW5kbGVkIGJ5IG5lc3RlZCBpbnRlcmNlcHRvcnMgKFhIUiAtPiBDbGllbnRSZXF1ZXN0KS5cbiAqIE9ic2N1cmUgYnkgZGVzaWduIHRvIHByZXZlbnQgY29sbGlzaW9ucyB3aXRoIHVzZXItZGVmaW5lZCBoZWFkZXJzLlxuICogSWRlYWxseSwgY29tZSB1cCB3aXRoIHRoZSBJbnRlcmNlcHRvci1sZXZlbCBtZWNoYW5pc20gZm9yIHRoaXMuXG4gKiBAc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9tc3dqcy9pbnRlcmNlcHRvcnMvaXNzdWVzLzM3OFxuICovXG5leHBvcnQgY29uc3QgSU5URVJOQUxfUkVRVUVTVF9JRF9IRUFERVJfTkFNRSA9XG4gICd4LWludGVyY2VwdG9ycy1pbnRlcm5hbC1yZXF1ZXN0LWlkJ1xuXG5leHBvcnQgZnVuY3Rpb24gZ2V0R2xvYmFsU3ltYm9sPFY+KHN5bWJvbDogU3ltYm9sKTogViB8IHVuZGVmaW5lZCB7XG4gIHJldHVybiAoXG4gICAgLy8gQHRzLWlnbm9yZSBodHRwczovL2dpdGh1Yi5jb20vTWljcm9zb2Z0L1R5cGVTY3JpcHQvaXNzdWVzLzI0NTg3XG4gICAgZ2xvYmFsVGhpc1tzeW1ib2xdIHx8IHVuZGVmaW5lZFxuICApXG59XG5cbmZ1bmN0aW9uIHNldEdsb2JhbFN5bWJvbChzeW1ib2w6IFN5bWJvbCwgdmFsdWU6IGFueSk6IHZvaWQge1xuICAvLyBAdHMtaWdub3JlXG4gIGdsb2JhbFRoaXNbc3ltYm9sXSA9IHZhbHVlXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkZWxldGVHbG9iYWxTeW1ib2woc3ltYm9sOiBTeW1ib2wpOiB2b2lkIHtcbiAgLy8gQHRzLWlnbm9yZVxuICBkZWxldGUgZ2xvYmFsVGhpc1tzeW1ib2xdXG59XG5cbmV4cG9ydCBlbnVtIEludGVyY2VwdG9yUmVhZHlTdGF0ZSB7XG4gIElOQUNUSVZFID0gJ0lOQUNUSVZFJyxcbiAgQVBQTFlJTkcgPSAnQVBQTFlJTkcnLFxuICBBUFBMSUVEID0gJ0FQUExJRUQnLFxuICBESVNQT1NJTkcgPSAnRElTUE9TSU5HJyxcbiAgRElTUE9TRUQgPSAnRElTUE9TRUQnLFxufVxuXG5leHBvcnQgdHlwZSBFeHRyYWN0RXZlbnROYW1lczxFdmVudHMgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCBhbnk+PiA9XG4gIEV2ZW50cyBleHRlbmRzIFJlY29yZDxpbmZlciBFdmVudE5hbWUsIGFueT4gPyBFdmVudE5hbWUgOiBuZXZlclxuXG5leHBvcnQgY2xhc3MgSW50ZXJjZXB0b3I8RXZlbnRzIGV4dGVuZHMgSW50ZXJjZXB0b3JFdmVudE1hcD4ge1xuICBwcm90ZWN0ZWQgZW1pdHRlcjogRW1pdHRlcjxFdmVudHM+XG4gIHByb3RlY3RlZCBzdWJzY3JpcHRpb25zOiBBcnJheTxJbnRlcmNlcHRvclN1YnNjcmlwdGlvbj5cbiAgcHJvdGVjdGVkIGxvZ2dlcjogTG9nZ2VyXG5cbiAgcHVibGljIHJlYWR5U3RhdGU6IEludGVyY2VwdG9yUmVhZHlTdGF0ZVxuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgc3ltYm9sOiBzeW1ib2wpIHtcbiAgICB0aGlzLnJlYWR5U3RhdGUgPSBJbnRlcmNlcHRvclJlYWR5U3RhdGUuSU5BQ1RJVkVcblxuICAgIHRoaXMuZW1pdHRlciA9IG5ldyBFbWl0dGVyKClcbiAgICB0aGlzLnN1YnNjcmlwdGlvbnMgPSBbXVxuICAgIHRoaXMubG9nZ2VyID0gbmV3IExvZ2dlcihzeW1ib2wuZGVzY3JpcHRpb24hKVxuXG4gICAgLy8gRG8gbm90IGxpbWl0IHRoZSBtYXhpbXVtIG51bWJlciBvZiBsaXN0ZW5lcnNcbiAgICAvLyBzbyBub3QgdG8gbGltaXQgdGhlIG1heGltdW0gYW1vdW50IG9mIHBhcmFsbGVsIGV2ZW50cyBlbWl0dGVkLlxuICAgIHRoaXMuZW1pdHRlci5zZXRNYXhMaXN0ZW5lcnMoMClcblxuICAgIHRoaXMubG9nZ2VyLmluZm8oJ2NvbnN0cnVjdGluZyB0aGUgaW50ZXJjZXB0b3IuLi4nKVxuICB9XG5cbiAgLyoqXG4gICAqIERldGVybWluZSBpZiB0aGlzIGludGVyY2VwdG9yIGNhbiBiZSBhcHBsaWVkXG4gICAqIGluIHRoZSBjdXJyZW50IGVudmlyb25tZW50LlxuICAgKi9cbiAgcHJvdGVjdGVkIGNoZWNrRW52aXJvbm1lbnQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRydWVcbiAgfVxuXG4gIC8qKlxuICAgKiBBcHBseSB0aGlzIGludGVyY2VwdG9yIHRvIHRoZSBjdXJyZW50IHByb2Nlc3MuXG4gICAqIFJldHVybnMgYW4gYWxyZWFkeSBydW5uaW5nIGludGVyY2VwdG9yIGluc3RhbmNlIGlmIGl0J3MgcHJlc2VudC5cbiAgICovXG4gIHB1YmxpYyBhcHBseSgpOiB2b2lkIHtcbiAgICBjb25zdCBsb2dnZXIgPSB0aGlzLmxvZ2dlci5leHRlbmQoJ2FwcGx5JylcbiAgICBsb2dnZXIuaW5mbygnYXBwbHlpbmcgdGhlIGludGVyY2VwdG9yLi4uJylcblxuICAgIGlmICh0aGlzLnJlYWR5U3RhdGUgPT09IEludGVyY2VwdG9yUmVhZHlTdGF0ZS5BUFBMSUVEKSB7XG4gICAgICBsb2dnZXIuaW5mbygnaW50ZXJjZXB0ZWQgYWxyZWFkeSBhcHBsaWVkIScpXG4gICAgICByZXR1cm5cbiAgICB9XG5cbiAgICBjb25zdCBzaG91bGRBcHBseSA9IHRoaXMuY2hlY2tFbnZpcm9ubWVudCgpXG5cbiAgICBpZiAoIXNob3VsZEFwcGx5KSB7XG4gICAgICBsb2dnZXIuaW5mbygndGhlIGludGVyY2VwdG9yIGNhbm5vdCBiZSBhcHBsaWVkIGluIHRoaXMgZW52aXJvbm1lbnQhJylcbiAgICAgIHJldHVyblxuICAgIH1cblxuICAgIHRoaXMucmVhZHlTdGF0ZSA9IEludGVyY2VwdG9yUmVhZHlTdGF0ZS5BUFBMWUlOR1xuXG4gICAgLy8gV2hlbmV2ZXIgYXBwbHlpbmcgYSBuZXcgaW50ZXJjZXB0b3IsIGNoZWNrIGlmIGl0IGhhc24ndCBiZWVuIGFwcGxpZWQgYWxyZWFkeS5cbiAgICAvLyBUaGlzIGVuYWJsZXMgdG8gYXBwbHkgdGhlIHNhbWUgaW50ZXJjZXB0b3IgbXVsdGlwbGUgdGltZXMsIGZvciBleGFtcGxlIGZyb20gYSBkaWZmZXJlbnRcbiAgICAvLyBpbnRlcmNlcHRvciwgb25seSBwcm94eWluZyBldmVudHMgYnV0IGtlZXBpbmcgdGhlIHN0dWJzIGluIGEgc2luZ2xlIHBsYWNlLlxuICAgIGNvbnN0IHJ1bm5pbmdJbnN0YW5jZSA9IHRoaXMuZ2V0SW5zdGFuY2UoKVxuXG4gICAgaWYgKHJ1bm5pbmdJbnN0YW5jZSkge1xuICAgICAgbG9nZ2VyLmluZm8oJ2ZvdW5kIGEgcnVubmluZyBpbnN0YW5jZSwgcmV1c2luZy4uLicpXG5cbiAgICAgIC8vIFByb3h5IGFueSBsaXN0ZW5lcnMgeW91IHNldCBvbiB0aGlzIGluc3RhbmNlIHRvIHRoZSBydW5uaW5nIGluc3RhbmNlLlxuICAgICAgdGhpcy5vbiA9IChldmVudCwgbGlzdGVuZXIpID0+IHtcbiAgICAgICAgbG9nZ2VyLmluZm8oJ3Byb3h5aW5nIHRoZSBcIiVzXCIgbGlzdGVuZXInLCBldmVudClcblxuICAgICAgICAvLyBBZGQgbGlzdGVuZXJzIHRvIHRoZSBydW5uaW5nIGluc3RhbmNlIHNvIHRoZXkgYXBwZWFyXG4gICAgICAgIC8vIGF0IHRoZSB0b3Agb2YgdGhlIGV2ZW50IGxpc3RlbmVycyBsaXN0IGFuZCBhcmUgZXhlY3V0ZWQgZmlyc3QuXG4gICAgICAgIHJ1bm5pbmdJbnN0YW5jZS5lbWl0dGVyLmFkZExpc3RlbmVyKGV2ZW50LCBsaXN0ZW5lcilcblxuICAgICAgICAvLyBFbnN1cmUgdGhhdCBvbmNlIHRoaXMgaW50ZXJjZXB0b3IgaW5zdGFuY2UgaXMgZGlzcG9zZWQsXG4gICAgICAgIC8vIGl0IHJlbW92ZXMgYWxsIGxpc3RlbmVycyBpdCBoYXMgYXBwZW5kZWQgdG8gdGhlIHJ1bm5pbmcgaW50ZXJjZXB0b3IgaW5zdGFuY2UuXG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5wdXNoKCgpID0+IHtcbiAgICAgICAgICBydW5uaW5nSW5zdGFuY2UuZW1pdHRlci5yZW1vdmVMaXN0ZW5lcihldmVudCwgbGlzdGVuZXIpXG4gICAgICAgICAgbG9nZ2VyLmluZm8oJ3JlbW92ZWQgcHJveGllZCBcIiVzXCIgbGlzdGVuZXIhJywgZXZlbnQpXG4gICAgICAgIH0pXG5cbiAgICAgICAgcmV0dXJuIHRoaXNcbiAgICAgIH1cblxuICAgICAgdGhpcy5yZWFkeVN0YXRlID0gSW50ZXJjZXB0b3JSZWFkeVN0YXRlLkFQUExJRURcblxuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgbG9nZ2VyLmluZm8oJ25vIHJ1bm5pbmcgaW5zdGFuY2UgZm91bmQsIHNldHRpbmcgdXAgYSBuZXcgaW5zdGFuY2UuLi4nKVxuXG4gICAgLy8gU2V0dXAgdGhlIGludGVyY2VwdG9yLlxuICAgIHRoaXMuc2V0dXAoKVxuXG4gICAgLy8gU3RvcmUgdGhlIG5ld2x5IGFwcGxpZWQgaW50ZXJjZXB0b3IgaW5zdGFuY2UgZ2xvYmFsbHkuXG4gICAgdGhpcy5zZXRJbnN0YW5jZSgpXG5cbiAgICB0aGlzLnJlYWR5U3RhdGUgPSBJbnRlcmNlcHRvclJlYWR5U3RhdGUuQVBQTElFRFxuICB9XG5cbiAgLyoqXG4gICAqIFNldHVwIHRoZSBtb2R1bGUgYXVnbWVudHMgYW5kIHN0dWJzIG5lY2Vzc2FyeSBmb3IgdGhpcyBpbnRlcmNlcHRvci5cbiAgICogVGhpcyBtZXRob2QgaXMgbm90IHJ1biBpZiB0aGVyZSdzIGEgcnVubmluZyBpbnRlcmNlcHRvciBpbnN0YW5jZVxuICAgKiB0byBwcmV2ZW50IGluc3RhbnRpYXRpbmcgYW4gaW50ZXJjZXB0b3IgbXVsdGlwbGUgdGltZXMuXG4gICAqL1xuICBwcm90ZWN0ZWQgc2V0dXAoKTogdm9pZCB7fVxuXG4gIC8qKlxuICAgKiBMaXN0ZW4gdG8gdGhlIGludGVyY2VwdG9yJ3MgcHVibGljIGV2ZW50cy5cbiAgICovXG4gIHB1YmxpYyBvbjxFdmVudE5hbWUgZXh0ZW5kcyBFeHRyYWN0RXZlbnROYW1lczxFdmVudHM+PihcbiAgICBldmVudDogRXZlbnROYW1lLFxuICAgIGxpc3RlbmVyOiBMaXN0ZW5lcjxFdmVudHNbRXZlbnROYW1lXT5cbiAgKTogdGhpcyB7XG4gICAgY29uc3QgbG9nZ2VyID0gdGhpcy5sb2dnZXIuZXh0ZW5kKCdvbicpXG5cbiAgICBpZiAoXG4gICAgICB0aGlzLnJlYWR5U3RhdGUgPT09IEludGVyY2VwdG9yUmVhZHlTdGF0ZS5ESVNQT1NJTkcgfHxcbiAgICAgIHRoaXMucmVhZHlTdGF0ZSA9PT0gSW50ZXJjZXB0b3JSZWFkeVN0YXRlLkRJU1BPU0VEXG4gICAgKSB7XG4gICAgICBsb2dnZXIuaW5mbygnY2Fubm90IGxpc3RlbiB0byBldmVudHMsIGFscmVhZHkgZGlzcG9zZWQhJylcbiAgICAgIHJldHVybiB0aGlzXG4gICAgfVxuXG4gICAgbG9nZ2VyLmluZm8oJ2FkZGluZyBcIiVzXCIgZXZlbnQgbGlzdGVuZXI6JywgZXZlbnQsIGxpc3RlbmVyKVxuXG4gICAgdGhpcy5lbWl0dGVyLm9uKGV2ZW50LCBsaXN0ZW5lcilcbiAgICByZXR1cm4gdGhpc1xuICB9XG5cbiAgcHVibGljIG9uY2U8RXZlbnROYW1lIGV4dGVuZHMgRXh0cmFjdEV2ZW50TmFtZXM8RXZlbnRzPj4oXG4gICAgZXZlbnQ6IEV2ZW50TmFtZSxcbiAgICBsaXN0ZW5lcjogTGlzdGVuZXI8RXZlbnRzW0V2ZW50TmFtZV0+XG4gICk6IHRoaXMge1xuICAgIHRoaXMuZW1pdHRlci5vbmNlKGV2ZW50LCBsaXN0ZW5lcilcbiAgICByZXR1cm4gdGhpc1xuICB9XG5cbiAgcHVibGljIG9mZjxFdmVudE5hbWUgZXh0ZW5kcyBFeHRyYWN0RXZlbnROYW1lczxFdmVudHM+PihcbiAgICBldmVudDogRXZlbnROYW1lLFxuICAgIGxpc3RlbmVyOiBMaXN0ZW5lcjxFdmVudHNbRXZlbnROYW1lXT5cbiAgKTogdGhpcyB7XG4gICAgdGhpcy5lbWl0dGVyLm9mZihldmVudCwgbGlzdGVuZXIpXG4gICAgcmV0dXJuIHRoaXNcbiAgfVxuXG4gIHB1YmxpYyByZW1vdmVBbGxMaXN0ZW5lcnM8RXZlbnROYW1lIGV4dGVuZHMgRXh0cmFjdEV2ZW50TmFtZXM8RXZlbnRzPj4oXG4gICAgZXZlbnQ/OiBFdmVudE5hbWVcbiAgKTogdGhpcyB7XG4gICAgdGhpcy5lbWl0dGVyLnJlbW92ZUFsbExpc3RlbmVycyhldmVudClcbiAgICByZXR1cm4gdGhpc1xuICB9XG5cbiAgLyoqXG4gICAqIERpc3Bvc2VzIG9mIGFueSBzaWRlLWVmZmVjdHMgdGhpcyBpbnRlcmNlcHRvciBoYXMgaW50cm9kdWNlZC5cbiAgICovXG4gIHB1YmxpYyBkaXNwb3NlKCk6IHZvaWQge1xuICAgIGNvbnN0IGxvZ2dlciA9IHRoaXMubG9nZ2VyLmV4dGVuZCgnZGlzcG9zZScpXG5cbiAgICBpZiAodGhpcy5yZWFkeVN0YXRlID09PSBJbnRlcmNlcHRvclJlYWR5U3RhdGUuRElTUE9TRUQpIHtcbiAgICAgIGxvZ2dlci5pbmZvKCdjYW5ub3QgZGlzcG9zZSwgYWxyZWFkeSBkaXNwb3NlZCEnKVxuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgbG9nZ2VyLmluZm8oJ2Rpc3Bvc2luZyB0aGUgaW50ZXJjZXB0b3IuLi4nKVxuICAgIHRoaXMucmVhZHlTdGF0ZSA9IEludGVyY2VwdG9yUmVhZHlTdGF0ZS5ESVNQT1NJTkdcblxuICAgIGlmICghdGhpcy5nZXRJbnN0YW5jZSgpKSB7XG4gICAgICBsb2dnZXIuaW5mbygnbm8gaW50ZXJjZXB0b3JzIHJ1bm5pbmcsIHNraXBwaW5nIGRpc3Bvc2UuLi4nKVxuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgLy8gRGVsZXRlIHRoZSBnbG9iYWwgc3ltYm9sIGFzIHNvb24gYXMgcG9zc2libGUsXG4gICAgLy8gaW5kaWNhdGluZyB0aGF0IHRoZSBpbnRlcmNlcHRvciBpcyBubyBsb25nZXIgcnVubmluZy5cbiAgICB0aGlzLmNsZWFySW5zdGFuY2UoKVxuXG4gICAgbG9nZ2VyLmluZm8oJ2dsb2JhbCBzeW1ib2wgZGVsZXRlZDonLCBnZXRHbG9iYWxTeW1ib2wodGhpcy5zeW1ib2wpKVxuXG4gICAgaWYgKHRoaXMuc3Vic2NyaXB0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICBsb2dnZXIuaW5mbygnZGlzcG9zaW5nIG9mICVkIHN1YnNjcmlwdGlvbnMuLi4nLCB0aGlzLnN1YnNjcmlwdGlvbnMubGVuZ3RoKVxuXG4gICAgICBmb3IgKGNvbnN0IGRpc3Bvc2Ugb2YgdGhpcy5zdWJzY3JpcHRpb25zKSB7XG4gICAgICAgIGRpc3Bvc2UoKVxuICAgICAgfVxuXG4gICAgICB0aGlzLnN1YnNjcmlwdGlvbnMgPSBbXVxuXG4gICAgICBsb2dnZXIuaW5mbygnZGlzcG9zZWQgb2YgYWxsIHN1YnNjcmlwdGlvbnMhJywgdGhpcy5zdWJzY3JpcHRpb25zLmxlbmd0aClcbiAgICB9XG5cbiAgICB0aGlzLmVtaXR0ZXIucmVtb3ZlQWxsTGlzdGVuZXJzKClcbiAgICBsb2dnZXIuaW5mbygnZGVzdHJveWVkIHRoZSBsaXN0ZW5lciEnKVxuXG4gICAgdGhpcy5yZWFkeVN0YXRlID0gSW50ZXJjZXB0b3JSZWFkeVN0YXRlLkRJU1BPU0VEXG4gIH1cblxuICBwcml2YXRlIGdldEluc3RhbmNlKCk6IHRoaXMgfCB1bmRlZmluZWQge1xuICAgIGNvbnN0IGluc3RhbmNlID0gZ2V0R2xvYmFsU3ltYm9sPHRoaXM+KHRoaXMuc3ltYm9sKVxuICAgIHRoaXMubG9nZ2VyLmluZm8oJ3JldHJpZXZlZCBnbG9iYWwgaW5zdGFuY2U6JywgaW5zdGFuY2U/LmNvbnN0cnVjdG9yPy5uYW1lKVxuICAgIHJldHVybiBpbnN0YW5jZVxuICB9XG5cbiAgcHJpdmF0ZSBzZXRJbnN0YW5jZSgpOiB2b2lkIHtcbiAgICBzZXRHbG9iYWxTeW1ib2wodGhpcy5zeW1ib2wsIHRoaXMpXG4gICAgdGhpcy5sb2dnZXIuaW5mbygnc2V0IGdsb2JhbCBpbnN0YW5jZSEnLCB0aGlzLnN5bWJvbC5kZXNjcmlwdGlvbilcbiAgfVxuXG4gIHByaXZhdGUgY2xlYXJJbnN0YW5jZSgpOiB2b2lkIHtcbiAgICBkZWxldGVHbG9iYWxTeW1ib2wodGhpcy5zeW1ib2wpXG4gICAgdGhpcy5sb2dnZXIuaW5mbygnY2xlYXJlZCBnbG9iYWwgaW5zdGFuY2UhJywgdGhpcy5zeW1ib2wuZGVzY3JpcHRpb24pXG4gIH1cbn1cbiIsIi8qKlxuICogR2VuZXJhdGUgYSByYW5kb20gSUQgc3RyaW5nIHRvIHJlcHJlc2VudCBhIHJlcXVlc3QuXG4gKiBAZXhhbXBsZVxuICogY3JlYXRlUmVxdWVzdElkKClcbiAqIC8vIFwiZjc3NGI2YzljNjAwZlwiXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVSZXF1ZXN0SWQoKTogc3RyaW5nIHtcbiAgcmV0dXJuIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMTYpLnNsaWNlKDIpXG59XG4iLCIvKipcbiAqIFJldHVybnMgYSBib29sZWFuIGluZGljYXRpbmcgd2hldGhlciB0aGUgZ2l2ZW4gVVJMIHN0cmluZ1xuICogY2FuIGJlIHBhcnNlZCBpbnRvIGEgYFVSTGAgaW5zdGFuY2UuXG4gKiBBIHN1YnN0aXR1dGUgZm9yIGBVUkwuY2FuUGFyc2UoKWAgZm9yIE5vZGUuanMgMTguXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjYW5QYXJzZVVybCh1cmw6IHN0cmluZyk6IGJvb2xlYW4ge1xuICB0cnkge1xuICAgIG5ldyBVUkwodXJsKVxuICAgIHJldHVybiB0cnVlXG4gIH0gY2F0Y2ggKF9lcnJvcikge1xuICAgIHJldHVybiBmYWxzZVxuICB9XG59XG4iLCIvKipcbiAqIFJldHVybnMgdGhlIHZhbHVlIGJlaGluZCB0aGUgc3ltYm9sIHdpdGggdGhlIGdpdmVuIG5hbWUuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRWYWx1ZUJ5U3ltYm9sPFQ+KFxuICBzeW1ib2xOYW1lOiBzdHJpbmcsXG4gIHNvdXJjZTogb2JqZWN0XG4pOiBUIHwgdW5kZWZpbmVkIHtcbiAgY29uc3Qgb3duU3ltYm9scyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMoc291cmNlKVxuXG4gIGNvbnN0IHN5bWJvbCA9IG93blN5bWJvbHMuZmluZCgoc3ltYm9sKSA9PiB7XG4gICAgcmV0dXJuIHN5bWJvbC5kZXNjcmlwdGlvbiA9PT0gc3ltYm9sTmFtZVxuICB9KVxuXG4gIGlmIChzeW1ib2wpIHtcbiAgICByZXR1cm4gUmVmbGVjdC5nZXQoc291cmNlLCBzeW1ib2wpXG4gIH1cblxuICByZXR1cm5cbn1cbiIsImltcG9ydCB7IGNhblBhcnNlVXJsIH0gZnJvbSAnLi9jYW5QYXJzZVVybCdcbmltcG9ydCB7IGdldFZhbHVlQnlTeW1ib2wgfSBmcm9tICcuL2dldFZhbHVlQnlTeW1ib2wnXG5cbmV4cG9ydCBpbnRlcmZhY2UgRmV0Y2hSZXNwb25zZUluaXQgZXh0ZW5kcyBSZXNwb25zZUluaXQge1xuICB1cmw/OiBzdHJpbmdcbn1cblxuaW50ZXJmYWNlIFVuZGljaUZldGNoSW50ZXJuYWxTdGF0ZSB7XG4gIGFib3J0ZWQ6IGJvb2xlYW5cbiAgcmFuZ2VSZXF1ZXN0ZWQ6IGJvb2xlYW5cbiAgdGltaW5nQWxsb3dQYXNzZWQ6IGJvb2xlYW5cbiAgcmVxdWVzdEluY2x1ZGVzQ3JlZGVudGlhbHM6IGJvb2xlYW5cbiAgdHlwZTogUmVzcG9uc2VUeXBlXG4gIHN0YXR1czogbnVtYmVyXG4gIHN0YXR1c1RleHQ6IHN0cmluZ1xuICB0aW1pbmdJbmZvOiB1bmtub3duXG4gIGNhY2hlU3RhdGU6IHVua25vd25cbiAgaGVhZGVyc0xpc3Q6IFJlY29yZDxzeW1ib2wsIE1hcDxzdHJpbmcsIHVua25vd24+PlxuICB1cmxMaXN0OiBBcnJheTxVUkw+XG4gIGJvZHk/OiB7XG4gICAgc3RyZWFtOiBSZWFkYWJsZVN0cmVhbVxuICAgIHNvdXJjZTogdW5rbm93blxuICAgIGxlbmd0aDogbnVtYmVyXG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIEZldGNoUmVzcG9uc2UgZXh0ZW5kcyBSZXNwb25zZSB7XG4gIC8qKlxuICAgKiBSZXNwb25zZSBzdGF0dXMgY29kZXMgZm9yIHJlc3BvbnNlcyB0aGF0IGNhbm5vdCBoYXZlIGJvZHkuXG4gICAqIEBzZWUgaHR0cHM6Ly9mZXRjaC5zcGVjLndoYXR3Zy5vcmcvI3N0YXR1c2VzXG4gICAqL1xuICBzdGF0aWMgcmVhZG9ubHkgU1RBVFVTX0NPREVTX1dJVEhPVVRfQk9EWSA9IFsxMDEsIDEwMywgMjA0LCAyMDUsIDMwNF1cblxuICBzdGF0aWMgcmVhZG9ubHkgU1RBVFVTX0NPREVTX1dJVEhfUkVESVJFQ1QgPSBbMzAxLCAzMDIsIDMwMywgMzA3LCAzMDhdXG5cbiAgc3RhdGljIGlzQ29uZmlndXJhYmxlU3RhdHVzQ29kZShzdGF0dXM6IG51bWJlcik6IGJvb2xlYW4ge1xuICAgIHJldHVybiBzdGF0dXMgPj0gMjAwICYmIHN0YXR1cyA8PSA1OTlcbiAgfVxuXG4gIHN0YXRpYyBpc1JlZGlyZWN0UmVzcG9uc2Uoc3RhdHVzOiBudW1iZXIpOiBib29sZWFuIHtcbiAgICByZXR1cm4gRmV0Y2hSZXNwb25zZS5TVEFUVVNfQ09ERVNfV0lUSF9SRURJUkVDVC5pbmNsdWRlcyhzdGF0dXMpXG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBhIGJvb2xlYW4gaW5kaWNhdGluZyB3aGV0aGVyIHRoZSBnaXZlbiByZXNwb25zZSBzdGF0dXNcbiAgICogY29kZSByZXByZXNlbnRzIGEgcmVzcG9uc2UgdGhhdCBjYW4gaGF2ZSBhIGJvZHkuXG4gICAqL1xuICBzdGF0aWMgaXNSZXNwb25zZVdpdGhCb2R5KHN0YXR1czogbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICFGZXRjaFJlc3BvbnNlLlNUQVRVU19DT0RFU19XSVRIT1VUX0JPRFkuaW5jbHVkZXMoc3RhdHVzKVxuICB9XG5cbiAgc3RhdGljIHNldFVybCh1cmw6IHN0cmluZyB8IHVuZGVmaW5lZCwgcmVzcG9uc2U6IFJlc3BvbnNlKTogdm9pZCB7XG4gICAgaWYgKCF1cmwgfHwgdXJsID09PSAnYWJvdXQ6JyB8fCAhY2FuUGFyc2VVcmwodXJsKSkge1xuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgY29uc3Qgc3RhdGUgPSBnZXRWYWx1ZUJ5U3ltYm9sPFVuZGljaUZldGNoSW50ZXJuYWxTdGF0ZT4oJ3N0YXRlJywgcmVzcG9uc2UpXG5cbiAgICBpZiAoc3RhdGUpIHtcbiAgICAgIC8vIEluIFVuZGljaSwgcHVzaCB0aGUgVVJMIHRvIHRoZSBpbnRlcm5hbCBsaXN0IG9mIFVSTHMuXG4gICAgICAvLyBUaGlzIHdpbGwgcmVzcGVjdCB0aGUgYHJlc3BvbnNlLnVybGAgZ2V0dGVyIGxvZ2ljIGNvcnJlY3RseS5cbiAgICAgIHN0YXRlLnVybExpc3QucHVzaChuZXcgVVJMKHVybCkpXG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIEluIG90aGVyIGxpYnJhcmllcywgcmVkZWZpbmUgdGhlIGB1cmxgIHByb3BlcnR5IGRpcmVjdGx5LlxuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHJlc3BvbnNlLCAndXJsJywge1xuICAgICAgICB2YWx1ZTogdXJsLFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgIHdyaXRhYmxlOiBmYWxzZSxcbiAgICAgIH0pXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFBhcnNlcyB0aGUgZ2l2ZW4gcmF3IEhUVFAgaGVhZGVycyBpbnRvIGEgRmV0Y2ggQVBJIGBIZWFkZXJzYCBpbnN0YW5jZS5cbiAgICovXG4gIHN0YXRpYyBwYXJzZVJhd0hlYWRlcnMocmF3SGVhZGVyczogQXJyYXk8c3RyaW5nPik6IEhlYWRlcnMge1xuICAgIGNvbnN0IGhlYWRlcnMgPSBuZXcgSGVhZGVycygpXG4gICAgZm9yIChsZXQgbGluZSA9IDA7IGxpbmUgPCByYXdIZWFkZXJzLmxlbmd0aDsgbGluZSArPSAyKSB7XG4gICAgICBoZWFkZXJzLmFwcGVuZChyYXdIZWFkZXJzW2xpbmVdLCByYXdIZWFkZXJzW2xpbmUgKyAxXSlcbiAgICB9XG4gICAgcmV0dXJuIGhlYWRlcnNcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKGJvZHk/OiBCb2R5SW5pdCB8IG51bGwsIGluaXQ6IEZldGNoUmVzcG9uc2VJbml0ID0ge30pIHtcbiAgICBjb25zdCBzdGF0dXMgPSBpbml0LnN0YXR1cyA/PyAyMDBcbiAgICBjb25zdCBzYWZlU3RhdHVzID0gRmV0Y2hSZXNwb25zZS5pc0NvbmZpZ3VyYWJsZVN0YXR1c0NvZGUoc3RhdHVzKVxuICAgICAgPyBzdGF0dXNcbiAgICAgIDogMjAwXG4gICAgY29uc3QgZmluYWxCb2R5ID0gRmV0Y2hSZXNwb25zZS5pc1Jlc3BvbnNlV2l0aEJvZHkoc3RhdHVzKSA/IGJvZHkgOiBudWxsXG5cbiAgICBzdXBlcihmaW5hbEJvZHksIHtcbiAgICAgIHN0YXR1czogc2FmZVN0YXR1cyxcbiAgICAgIHN0YXR1c1RleHQ6IGluaXQuc3RhdHVzVGV4dCxcbiAgICAgIGhlYWRlcnM6IGluaXQuaGVhZGVycyxcbiAgICB9KVxuXG4gICAgaWYgKHN0YXR1cyAhPT0gc2FmZVN0YXR1cykge1xuICAgICAgLyoqXG4gICAgICAgKiBAbm90ZSBVbmRpY2kga2VlcHMgYW4gaW50ZXJuYWwgXCJTeW1ib2woc3RhdGUpXCIgdGhhdCBob2xkc1xuICAgICAgICogdGhlIGFjdHVhbCB2YWx1ZSBvZiByZXNwb25zZSBzdGF0dXMuIFVwZGF0ZSB0aGF0IGluIE5vZGUuanMuXG4gICAgICAgKi9cbiAgICAgIGNvbnN0IHN0YXRlID0gZ2V0VmFsdWVCeVN5bWJvbDxVbmRpY2lGZXRjaEludGVybmFsU3RhdGU+KCdzdGF0ZScsIHRoaXMpXG5cbiAgICAgIGlmIChzdGF0ZSkge1xuICAgICAgICBzdGF0ZS5zdGF0dXMgPSBzdGF0dXNcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAnc3RhdHVzJywge1xuICAgICAgICAgIHZhbHVlOiBzdGF0dXMsXG4gICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgICAgd3JpdGFibGU6IGZhbHNlLFxuICAgICAgICB9KVxuICAgICAgfVxuICAgIH1cblxuICAgIEZldGNoUmVzcG9uc2Uuc2V0VXJsKGluaXQudXJsLCB0aGlzKVxuICB9XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsSUFBQUEsT0FBUyxHQUFBQyxPQUFBLHFCQUFjO0FB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