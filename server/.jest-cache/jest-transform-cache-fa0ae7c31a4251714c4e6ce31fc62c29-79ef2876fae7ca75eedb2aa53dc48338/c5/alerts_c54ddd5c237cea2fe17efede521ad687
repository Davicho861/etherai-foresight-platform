717bcbaad6caba32970aaeb5757d6bfc
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _express = _interopRequireDefault(require("express"));
var _cache = _interopRequireDefault(require("../cache.js"));
function _interopRequireDefault(e) { return e && e.__esModule ? e : { default: e }; }
const router = _express.default.Router();

// Mock data for alerts - in production, this would come from database
const mockAlerts = [{
  id: 1,
  title: 'Riesgo Clim치tico Extremo en Colombia',
  description: 'Aumento significativo en precipitaciones en la regi칩n andina, potencial para deslizamientos de tierra.',
  severity: 'HIGH',
  region: 'Colombia',
  type: 'CLIMATE',
  timestamp: '2025-10-05T02:00:00Z',
  status: 'ACTIVE'
}, {
  id: 2,
  title: 'Volatilidad Cripto-Econ칩mica en Argentina',
  description: 'Fluctuaciones extremas en el mercado de criptomonedas locales, riesgo de p치nico financiero.',
  severity: 'MEDIUM',
  region: 'Argentina',
  type: 'ECONOMIC',
  timestamp: '2025-10-04T18:30:00Z',
  status: 'MONITORING'
}];

// GET /api/alerts - List all alerts with caching optimization
router.get('/', (req, res) => {
  const {
    region,
    severity,
    type
  } = req.query;

  // Create cache key based on query parameters
  const cacheKey = `alerts:${region || 'all'}:${severity || 'all'}:${type || 'all'}`;

  // Check cache first
  const cachedResult = _cache.default.get(cacheKey);
  if (cachedResult) {
    return res.json(cachedResult);
  }
  let filteredAlerts = mockAlerts;
  if (region) {
    filteredAlerts = filteredAlerts.filter(alert => alert.region.toLowerCase() === region.toLowerCase());
  }
  if (severity) {
    filteredAlerts = filteredAlerts.filter(alert => alert.severity === severity);
  }
  if (type) {
    filteredAlerts = filteredAlerts.filter(alert => alert.type === type);
  }
  const result = {
    alerts: filteredAlerts,
    total: filteredAlerts.length,
    filters: {
      region,
      severity,
      type
    }
  };

  // Cache result for 5 minutes (300,000 ms)
  _cache.default.set(cacheKey, result, 300000);
  res.json(result);
});

// GET /api/alerts/:id - Get specific alert
router.get('/:id', (req, res) => {
  const alert = mockAlerts.find(a => a.id === parseInt(req.params.id));
  if (!alert) {
    return res.status(404).json({
      error: 'Alert not found'
    });
  }
  res.json(alert);
});

// POST /api/alerts - Create new alert (requires authentication in production)
router.post('/', (req, res) => {
  const {
    title,
    description,
    severity,
    region,
    type
  } = req.body;
  if (!title || !description || !severity || !region || !type) {
    return res.status(400).json({
      error: 'Missing required fields'
    });
  }
  const newAlert = {
    id: mockAlerts.length + 1,
    title,
    description,
    severity: severity.toUpperCase(),
    region,
    type: type.toUpperCase(),
    timestamp: new Date().toISOString(),
    status: 'ACTIVE'
  };
  mockAlerts.push(newAlert);
  res.status(201).json(newAlert);
});
var _default = exports.default = router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZXhwcmVzcyIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX2NhY2hlIiwiZSIsIl9fZXNNb2R1bGUiLCJkZWZhdWx0Iiwicm91dGVyIiwiZXhwcmVzcyIsIlJvdXRlciIsIm1vY2tBbGVydHMiLCJpZCIsInRpdGxlIiwiZGVzY3JpcHRpb24iLCJzZXZlcml0eSIsInJlZ2lvbiIsInR5cGUiLCJ0aW1lc3RhbXAiLCJzdGF0dXMiLCJnZXQiLCJyZXEiLCJyZXMiLCJxdWVyeSIsImNhY2hlS2V5IiwiY2FjaGVkUmVzdWx0IiwiY2FjaGUiLCJqc29uIiwiZmlsdGVyZWRBbGVydHMiLCJmaWx0ZXIiLCJhbGVydCIsInRvTG93ZXJDYXNlIiwicmVzdWx0IiwiYWxlcnRzIiwidG90YWwiLCJsZW5ndGgiLCJmaWx0ZXJzIiwic2V0IiwiZmluZCIsImEiLCJwYXJzZUludCIsInBhcmFtcyIsImVycm9yIiwicG9zdCIsImJvZHkiLCJuZXdBbGVydCIsInRvVXBwZXJDYXNlIiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwicHVzaCIsIl9kZWZhdWx0IiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbImFsZXJ0cy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZXhwcmVzcyBmcm9tICdleHByZXNzJztcbmltcG9ydCBjYWNoZSBmcm9tICcuLi9jYWNoZS5qcyc7XG5jb25zdCByb3V0ZXIgPSBleHByZXNzLlJvdXRlcigpO1xuXG4vLyBNb2NrIGRhdGEgZm9yIGFsZXJ0cyAtIGluIHByb2R1Y3Rpb24sIHRoaXMgd291bGQgY29tZSBmcm9tIGRhdGFiYXNlXG5jb25zdCBtb2NrQWxlcnRzID0gW1xuICB7XG4gICAgaWQ6IDEsXG4gICAgdGl0bGU6ICdSaWVzZ28gQ2xpbcOhdGljbyBFeHRyZW1vIGVuIENvbG9tYmlhJyxcbiAgICBkZXNjcmlwdGlvbjogJ0F1bWVudG8gc2lnbmlmaWNhdGl2byBlbiBwcmVjaXBpdGFjaW9uZXMgZW4gbGEgcmVnacOzbiBhbmRpbmEsIHBvdGVuY2lhbCBwYXJhIGRlc2xpemFtaWVudG9zIGRlIHRpZXJyYS4nLFxuICAgIHNldmVyaXR5OiAnSElHSCcsXG4gICAgcmVnaW9uOiAnQ29sb21iaWEnLFxuICAgIHR5cGU6ICdDTElNQVRFJyxcbiAgICB0aW1lc3RhbXA6ICcyMDI1LTEwLTA1VDAyOjAwOjAwWicsXG4gICAgc3RhdHVzOiAnQUNUSVZFJ1xuICB9LFxuICB7XG4gICAgaWQ6IDIsXG4gICAgdGl0bGU6ICdWb2xhdGlsaWRhZCBDcmlwdG8tRWNvbsOzbWljYSBlbiBBcmdlbnRpbmEnLFxuICAgIGRlc2NyaXB0aW9uOiAnRmx1Y3R1YWNpb25lcyBleHRyZW1hcyBlbiBlbCBtZXJjYWRvIGRlIGNyaXB0b21vbmVkYXMgbG9jYWxlcywgcmllc2dvIGRlIHDDoW5pY28gZmluYW5jaWVyby4nLFxuICAgIHNldmVyaXR5OiAnTUVESVVNJyxcbiAgICByZWdpb246ICdBcmdlbnRpbmEnLFxuICAgIHR5cGU6ICdFQ09OT01JQycsXG4gICAgdGltZXN0YW1wOiAnMjAyNS0xMC0wNFQxODozMDowMFonLFxuICAgIHN0YXR1czogJ01PTklUT1JJTkcnXG4gIH1cbl07XG5cbi8vIEdFVCAvYXBpL2FsZXJ0cyAtIExpc3QgYWxsIGFsZXJ0cyB3aXRoIGNhY2hpbmcgb3B0aW1pemF0aW9uXG5yb3V0ZXIuZ2V0KCcvJywgKHJlcSwgcmVzKSA9PiB7XG4gIGNvbnN0IHsgcmVnaW9uLCBzZXZlcml0eSwgdHlwZSB9ID0gcmVxLnF1ZXJ5O1xuXG4gIC8vIENyZWF0ZSBjYWNoZSBrZXkgYmFzZWQgb24gcXVlcnkgcGFyYW1ldGVyc1xuICBjb25zdCBjYWNoZUtleSA9IGBhbGVydHM6JHtyZWdpb24gfHwgJ2FsbCd9OiR7c2V2ZXJpdHkgfHwgJ2FsbCd9OiR7dHlwZSB8fCAnYWxsJ31gO1xuXG4gIC8vIENoZWNrIGNhY2hlIGZpcnN0XG4gIGNvbnN0IGNhY2hlZFJlc3VsdCA9IGNhY2hlLmdldChjYWNoZUtleSk7XG4gIGlmIChjYWNoZWRSZXN1bHQpIHtcbiAgICByZXR1cm4gcmVzLmpzb24oY2FjaGVkUmVzdWx0KTtcbiAgfVxuXG4gIGxldCBmaWx0ZXJlZEFsZXJ0cyA9IG1vY2tBbGVydHM7XG5cbiAgaWYgKHJlZ2lvbikge1xuICAgIGZpbHRlcmVkQWxlcnRzID0gZmlsdGVyZWRBbGVydHMuZmlsdGVyKGFsZXJ0ID0+IGFsZXJ0LnJlZ2lvbi50b0xvd2VyQ2FzZSgpID09PSByZWdpb24udG9Mb3dlckNhc2UoKSk7XG4gIH1cbiAgaWYgKHNldmVyaXR5KSB7XG4gICAgZmlsdGVyZWRBbGVydHMgPSBmaWx0ZXJlZEFsZXJ0cy5maWx0ZXIoYWxlcnQgPT4gYWxlcnQuc2V2ZXJpdHkgPT09IHNldmVyaXR5KTtcbiAgfVxuICBpZiAodHlwZSkge1xuICAgIGZpbHRlcmVkQWxlcnRzID0gZmlsdGVyZWRBbGVydHMuZmlsdGVyKGFsZXJ0ID0+IGFsZXJ0LnR5cGUgPT09IHR5cGUpO1xuICB9XG5cbiAgY29uc3QgcmVzdWx0ID0ge1xuICAgIGFsZXJ0czogZmlsdGVyZWRBbGVydHMsXG4gICAgdG90YWw6IGZpbHRlcmVkQWxlcnRzLmxlbmd0aCxcbiAgICBmaWx0ZXJzOiB7IHJlZ2lvbiwgc2V2ZXJpdHksIHR5cGUgfVxuICB9O1xuXG4gIC8vIENhY2hlIHJlc3VsdCBmb3IgNSBtaW51dGVzICgzMDAsMDAwIG1zKVxuICBjYWNoZS5zZXQoY2FjaGVLZXksIHJlc3VsdCwgMzAwMDAwKTtcblxuICByZXMuanNvbihyZXN1bHQpO1xufSk7XG5cbi8vIEdFVCAvYXBpL2FsZXJ0cy86aWQgLSBHZXQgc3BlY2lmaWMgYWxlcnRcbnJvdXRlci5nZXQoJy86aWQnLCAocmVxLCByZXMpID0+IHtcbiAgY29uc3QgYWxlcnQgPSBtb2NrQWxlcnRzLmZpbmQoYSA9PiBhLmlkID09PSBwYXJzZUludChyZXEucGFyYW1zLmlkKSk7XG4gIGlmICghYWxlcnQpIHtcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBlcnJvcjogJ0FsZXJ0IG5vdCBmb3VuZCcgfSk7XG4gIH1cbiAgcmVzLmpzb24oYWxlcnQpO1xufSk7XG5cbi8vIFBPU1QgL2FwaS9hbGVydHMgLSBDcmVhdGUgbmV3IGFsZXJ0IChyZXF1aXJlcyBhdXRoZW50aWNhdGlvbiBpbiBwcm9kdWN0aW9uKVxucm91dGVyLnBvc3QoJy8nLCAocmVxLCByZXMpID0+IHtcbiAgY29uc3QgeyB0aXRsZSwgZGVzY3JpcHRpb24sIHNldmVyaXR5LCByZWdpb24sIHR5cGUgfSA9IHJlcS5ib2R5O1xuXG4gIGlmICghdGl0bGUgfHwgIWRlc2NyaXB0aW9uIHx8ICFzZXZlcml0eSB8fCAhcmVnaW9uIHx8ICF0eXBlKSB7XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6ICdNaXNzaW5nIHJlcXVpcmVkIGZpZWxkcycgfSk7XG4gIH1cblxuICBjb25zdCBuZXdBbGVydCA9IHtcbiAgICBpZDogbW9ja0FsZXJ0cy5sZW5ndGggKyAxLFxuICAgIHRpdGxlLFxuICAgIGRlc2NyaXB0aW9uLFxuICAgIHNldmVyaXR5OiBzZXZlcml0eS50b1VwcGVyQ2FzZSgpLFxuICAgIHJlZ2lvbixcbiAgICB0eXBlOiB0eXBlLnRvVXBwZXJDYXNlKCksXG4gICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgc3RhdHVzOiAnQUNUSVZFJ1xuICB9O1xuXG4gIG1vY2tBbGVydHMucHVzaChuZXdBbGVydCk7XG4gIHJlcy5zdGF0dXMoMjAxKS5qc29uKG5ld0FsZXJ0KTtcbn0pO1xuXG5leHBvcnQgZGVmYXVsdCByb3V0ZXI7Il0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFBQSxRQUFBLEdBQUFDLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBQyxNQUFBLEdBQUFGLHNCQUFBLENBQUFDLE9BQUE7QUFBZ0MsU0FBQUQsdUJBQUFHLENBQUEsV0FBQUEsQ0FBQSxJQUFBQSxDQUFBLENBQUFDLFVBQUEsR0FBQUQsQ0FBQSxLQUFBRSxPQUFBLEVBQUFGLENBQUE7QUFDaEMsTUFBTUcsTUFBTSxHQUFHQyxnQkFBTyxDQUFDQyxNQUFNLENBQUMsQ0FBQzs7QUFFL0I7QUFDQSxNQUFNQyxVQUFVLEdBQUcsQ0FDakI7RUFDRUMsRUFBRSxFQUFFLENBQUM7RUFDTEMsS0FBSyxFQUFFLHNDQUFzQztFQUM3Q0MsV0FBVyxFQUFFLHdHQUF3RztFQUNySEMsUUFBUSxFQUFFLE1BQU07RUFDaEJDLE1BQU0sRUFBRSxVQUFVO0VBQ2xCQyxJQUFJLEVBQUUsU0FBUztFQUNmQyxTQUFTLEVBQUUsc0JBQXNCO0VBQ2pDQyxNQUFNLEVBQUU7QUFDVixDQUFDLEVBQ0Q7RUFDRVAsRUFBRSxFQUFFLENBQUM7RUFDTEMsS0FBSyxFQUFFLDJDQUEyQztFQUNsREMsV0FBVyxFQUFFLDZGQUE2RjtFQUMxR0MsUUFBUSxFQUFFLFFBQVE7RUFDbEJDLE1BQU0sRUFBRSxXQUFXO0VBQ25CQyxJQUFJLEVBQUUsVUFBVTtFQUNoQkMsU0FBUyxFQUFFLHNCQUFzQjtFQUNqQ0MsTUFBTSxFQUFFO0FBQ1YsQ0FBQyxDQUNGOztBQUVEO0FBQ0FYLE1BQU0sQ0FBQ1ksR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFDQyxHQUFHLEVBQUVDLEdBQUcsS0FBSztFQUM1QixNQUFNO0lBQUVOLE1BQU07SUFBRUQsUUFBUTtJQUFFRTtFQUFLLENBQUMsR0FBR0ksR0FBRyxDQUFDRSxLQUFLOztFQUU1QztFQUNBLE1BQU1DLFFBQVEsR0FBRyxVQUFVUixNQUFNLElBQUksS0FBSyxJQUFJRCxRQUFRLElBQUksS0FBSyxJQUFJRSxJQUFJLElBQUksS0FBSyxFQUFFOztFQUVsRjtFQUNBLE1BQU1RLFlBQVksR0FBR0MsY0FBSyxDQUFDTixHQUFHLENBQUNJLFFBQVEsQ0FBQztFQUN4QyxJQUFJQyxZQUFZLEVBQUU7SUFDaEIsT0FBT0gsR0FBRyxDQUFDSyxJQUFJLENBQUNGLFlBQVksQ0FBQztFQUMvQjtFQUVBLElBQUlHLGNBQWMsR0FBR2pCLFVBQVU7RUFFL0IsSUFBSUssTUFBTSxFQUFFO0lBQ1ZZLGNBQWMsR0FBR0EsY0FBYyxDQUFDQyxNQUFNLENBQUNDLEtBQUssSUFBSUEsS0FBSyxDQUFDZCxNQUFNLENBQUNlLFdBQVcsQ0FBQyxDQUFDLEtBQUtmLE1BQU0sQ0FBQ2UsV0FBVyxDQUFDLENBQUMsQ0FBQztFQUN0RztFQUNBLElBQUloQixRQUFRLEVBQUU7SUFDWmEsY0FBYyxHQUFHQSxjQUFjLENBQUNDLE1BQU0sQ0FBQ0MsS0FBSyxJQUFJQSxLQUFLLENBQUNmLFFBQVEsS0FBS0EsUUFBUSxDQUFDO0VBQzlFO0VBQ0EsSUFBSUUsSUFBSSxFQUFFO0lBQ1JXLGNBQWMsR0FBR0EsY0FBYyxDQUFDQyxNQUFNLENBQUNDLEtBQUssSUFBSUEsS0FBSyxDQUFDYixJQUFJLEtBQUtBLElBQUksQ0FBQztFQUN0RTtFQUVBLE1BQU1lLE1BQU0sR0FBRztJQUNiQyxNQUFNLEVBQUVMLGNBQWM7SUFDdEJNLEtBQUssRUFBRU4sY0FBYyxDQUFDTyxNQUFNO0lBQzVCQyxPQUFPLEVBQUU7TUFBRXBCLE1BQU07TUFBRUQsUUFBUTtNQUFFRTtJQUFLO0VBQ3BDLENBQUM7O0VBRUQ7RUFDQVMsY0FBSyxDQUFDVyxHQUFHLENBQUNiLFFBQVEsRUFBRVEsTUFBTSxFQUFFLE1BQU0sQ0FBQztFQUVuQ1YsR0FBRyxDQUFDSyxJQUFJLENBQUNLLE1BQU0sQ0FBQztBQUNsQixDQUFDLENBQUM7O0FBRUY7QUFDQXhCLE1BQU0sQ0FBQ1ksR0FBRyxDQUFDLE1BQU0sRUFBRSxDQUFDQyxHQUFHLEVBQUVDLEdBQUcsS0FBSztFQUMvQixNQUFNUSxLQUFLLEdBQUduQixVQUFVLENBQUMyQixJQUFJLENBQUNDLENBQUMsSUFBSUEsQ0FBQyxDQUFDM0IsRUFBRSxLQUFLNEIsUUFBUSxDQUFDbkIsR0FBRyxDQUFDb0IsTUFBTSxDQUFDN0IsRUFBRSxDQUFDLENBQUM7RUFDcEUsSUFBSSxDQUFDa0IsS0FBSyxFQUFFO0lBQ1YsT0FBT1IsR0FBRyxDQUFDSCxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNRLElBQUksQ0FBQztNQUFFZSxLQUFLLEVBQUU7SUFBa0IsQ0FBQyxDQUFDO0VBQzNEO0VBQ0FwQixHQUFHLENBQUNLLElBQUksQ0FBQ0csS0FBSyxDQUFDO0FBQ2pCLENBQUMsQ0FBQzs7QUFFRjtBQUNBdEIsTUFBTSxDQUFDbUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDdEIsR0FBRyxFQUFFQyxHQUFHLEtBQUs7RUFDN0IsTUFBTTtJQUFFVCxLQUFLO0lBQUVDLFdBQVc7SUFBRUMsUUFBUTtJQUFFQyxNQUFNO0lBQUVDO0VBQUssQ0FBQyxHQUFHSSxHQUFHLENBQUN1QixJQUFJO0VBRS9ELElBQUksQ0FBQy9CLEtBQUssSUFBSSxDQUFDQyxXQUFXLElBQUksQ0FBQ0MsUUFBUSxJQUFJLENBQUNDLE1BQU0sSUFBSSxDQUFDQyxJQUFJLEVBQUU7SUFDM0QsT0FBT0ssR0FBRyxDQUFDSCxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNRLElBQUksQ0FBQztNQUFFZSxLQUFLLEVBQUU7SUFBMEIsQ0FBQyxDQUFDO0VBQ25FO0VBRUEsTUFBTUcsUUFBUSxHQUFHO0lBQ2ZqQyxFQUFFLEVBQUVELFVBQVUsQ0FBQ3dCLE1BQU0sR0FBRyxDQUFDO0lBQ3pCdEIsS0FBSztJQUNMQyxXQUFXO0lBQ1hDLFFBQVEsRUFBRUEsUUFBUSxDQUFDK0IsV0FBVyxDQUFDLENBQUM7SUFDaEM5QixNQUFNO0lBQ05DLElBQUksRUFBRUEsSUFBSSxDQUFDNkIsV0FBVyxDQUFDLENBQUM7SUFDeEI1QixTQUFTLEVBQUUsSUFBSTZCLElBQUksQ0FBQyxDQUFDLENBQUNDLFdBQVcsQ0FBQyxDQUFDO0lBQ25DN0IsTUFBTSxFQUFFO0VBQ1YsQ0FBQztFQUVEUixVQUFVLENBQUNzQyxJQUFJLENBQUNKLFFBQVEsQ0FBQztFQUN6QnZCLEdBQUcsQ0FBQ0gsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDUSxJQUFJLENBQUNrQixRQUFRLENBQUM7QUFDaEMsQ0FBQyxDQUFDO0FBQUMsSUFBQUssUUFBQSxHQUFBQyxPQUFBLENBQUE1QyxPQUFBLEdBRVlDLE1BQU0iLCJpZ25vcmVMaXN0IjpbXX0=