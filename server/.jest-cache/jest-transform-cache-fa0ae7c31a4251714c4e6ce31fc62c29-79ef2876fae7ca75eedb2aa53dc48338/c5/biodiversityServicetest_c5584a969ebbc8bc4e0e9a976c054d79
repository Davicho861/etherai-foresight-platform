e0eb3235667f42bb35189a15ad44c024
"use strict";

// Mock the integration
_getJestObj().mock('../../src/integrations/BiodiversityIntegration.js');
var _biodiversityService = _interopRequireDefault(require("../../src/services/biodiversityService.js"));
var _BiodiversityIntegration = _interopRequireDefault(require("../../src/integrations/BiodiversityIntegration.js"));
function _interopRequireDefault(e) { return e && e.__esModule ? e : { default: e }; }
function _getJestObj() {
  const {
    jest
  } = require("@jest/globals");
  _getJestObj = () => jest;
  return jest;
}
describe('BiodiversityService', () => {
  let biodiversityService;
  let mockIntegration;
  beforeEach(() => {
    // Clear all mocks
    jest.clearAllMocks();

    // Create mock integration
    mockIntegration = {
      getBiodiversityData: jest.fn(),
      getSpeciesThreatData: jest.fn()
    };

    // Mock the constructor to return our mock
    _BiodiversityIntegration.default.mockImplementation(() => mockIntegration);

    // Create service instance
    biodiversityService = new _biodiversityService.default();
  });
  describe('getBiodiversityRiskIndex', () => {
    test('should calculate risk index correctly with valid data', async () => {
      const mockBiodiversityData = {
        globalSummary: {
          totalSpecies: 10000,
          totalThreatened: 2000
        }
      };
      const mockThreatData = {
        threatCategories: {
          habitatLoss: {
            count: 500
          },
          climateChange: {
            count: 300
          },
          pollution: {
            count: 200
          },
          invasiveSpecies: {
            count: 100
          },
          overexploitation: {
            count: 150
          },
          other: {
            count: 50
          }
        }
      };
      mockIntegration.getBiodiversityData.mockResolvedValue(mockBiodiversityData);
      mockIntegration.getSpeciesThreatData.mockResolvedValue(mockThreatData);
      const result = await biodiversityService.getBiodiversityRiskIndex();
      expect(result).toBeGreaterThanOrEqual(0);
      expect(result).toBeLessThanOrEqual(100);
      expect(mockIntegration.getBiodiversityData).toHaveBeenCalledWith(['americas', 'africa', 'asia', 'europe', 'oceania']);
      expect(mockIntegration.getSpeciesThreatData).toHaveBeenCalled();
    });
    test('should return default risk when data is invalid', async () => {
      mockIntegration.getBiodiversityData.mockResolvedValue(null);
      mockIntegration.getSpeciesThreatData.mockResolvedValue(null);
      const result = await biodiversityService.getBiodiversityRiskIndex();
      expect(result).toBe(30); // Default moderate risk
    });
    test('should handle errors gracefully', async () => {
      mockIntegration.getBiodiversityData.mockRejectedValue(new Error('API Error'));
      const result = await biodiversityService.getBiodiversityRiskIndex();
      expect(result).toBe(30); // Default moderate risk
    });
    test('should accept custom regions parameter', async () => {
      const customRegions = ['asia', 'europe'];
      const mockBiodiversityData = {
        globalSummary: {
          totalSpecies: 5000,
          totalThreatened: 500
        }
      };
      mockIntegration.getBiodiversityData.mockResolvedValue(mockBiodiversityData);
      mockIntegration.getSpeciesThreatData.mockResolvedValue({
        threatCategories: {
          habitatLoss: {
            count: 100
          },
          climateChange: {
            count: 50
          },
          pollution: {
            count: 30
          },
          invasiveSpecies: {
            count: 20
          },
          overexploitation: {
            count: 25
          },
          other: {
            count: 10
          }
        }
      });
      const result = await biodiversityService.getBiodiversityRiskIndex(customRegions);
      expect(result).toBeGreaterThanOrEqual(0);
      expect(result).toBeLessThanOrEqual(100);
      expect(mockIntegration.getBiodiversityData).toHaveBeenCalledWith(customRegions);
    });
  });
  describe('getBiodiversityAnalysis', () => {
    test('should return complete analysis with valid data', async () => {
      const mockBiodiversityData = {
        timestamp: '2025-10-13T19:30:00.000Z',
        regions: {
          americas: {
            totalSpecies: 5000,
            threatenedSpecies: 1000
          },
          africa: {
            totalSpecies: 4000,
            threatenedSpecies: 800
          }
        },
        globalSummary: {
          totalSpecies: 9000,
          totalThreatened: 1800
        }
      };
      const mockThreatData = {
        threatCategories: {
          habitatLoss: {
            count: 500
          },
          climateChange: {
            count: 300
          },
          pollution: {
            count: 200
          },
          invasiveSpecies: {
            count: 100
          },
          overexploitation: {
            count: 150
          },
          other: {
            count: 50
          }
        }
      };
      mockIntegration.getBiodiversityData.mockResolvedValue(mockBiodiversityData);
      mockIntegration.getSpeciesThreatData.mockResolvedValue(mockThreatData);
      const result = await biodiversityService.getBiodiversityAnalysis();
      expect(result).toHaveProperty('timestamp');
      expect(result).toHaveProperty('riskIndex');
      expect(result).toHaveProperty('biodiversityData');
      expect(result).toHaveProperty('threatData');
      expect(result).toHaveProperty('analysis');
      expect(result.analysis).toHaveProperty('totalRegions');
      expect(result.analysis).toHaveProperty('globalThreatPercentage');
      expect(result.analysis).toHaveProperty('majorThreatCategories');
      expect(result.analysis).toHaveProperty('riskAssessment');
      expect(result.source).toBe('BiodiversityService');
    });
    test('should return fallback analysis when data is invalid', async () => {
      mockIntegration.getBiodiversityData.mockResolvedValue(null);
      mockIntegration.getSpeciesThreatData.mockResolvedValue(null);
      const result = await biodiversityService.getBiodiversityAnalysis();
      expect(result.riskIndex).toBe(30);
      expect(result.biodiversityData).toBeNull();
      expect(result.threatData).toBeNull();
      expect(result.analysis.totalRegions).toBe(0);
      expect(result.source).toBe('BiodiversityService - Error Fallback');
      expect(result.error).toBeDefined();
    });
    test('should handle errors gracefully in analysis', async () => {
      mockIntegration.getBiodiversityData.mockRejectedValue(new Error('Network Error'));
      const result = await biodiversityService.getBiodiversityAnalysis();
      expect(result.riskIndex).toBe(30);
      expect(result.source).toBe('BiodiversityService - Error Fallback');
      expect(result.error).toBe('Network Error');
    });
  });
  describe('_assessRiskLevel', () => {
    test('should assess risk levels correctly', () => {
      expect(biodiversityService._assessRiskLevel(20)).toBe('Low');
      expect(biodiversityService._assessRiskLevel(35)).toBe('Moderate');
      expect(biodiversityService._assessRiskLevel(55)).toBe('High');
      expect(biodiversityService._assessRiskLevel(75)).toBe('Critical');
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZ2V0SmVzdE9iaiIsIm1vY2siLCJfYmlvZGl2ZXJzaXR5U2VydmljZSIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX0Jpb2RpdmVyc2l0eUludGVncmF0aW9uIiwiZSIsIl9fZXNNb2R1bGUiLCJkZWZhdWx0IiwiamVzdCIsImRlc2NyaWJlIiwiYmlvZGl2ZXJzaXR5U2VydmljZSIsIm1vY2tJbnRlZ3JhdGlvbiIsImJlZm9yZUVhY2giLCJjbGVhckFsbE1vY2tzIiwiZ2V0QmlvZGl2ZXJzaXR5RGF0YSIsImZuIiwiZ2V0U3BlY2llc1RocmVhdERhdGEiLCJCaW9kaXZlcnNpdHlJbnRlZ3JhdGlvbiIsIm1vY2tJbXBsZW1lbnRhdGlvbiIsIkJpb2RpdmVyc2l0eVNlcnZpY2UiLCJ0ZXN0IiwibW9ja0Jpb2RpdmVyc2l0eURhdGEiLCJnbG9iYWxTdW1tYXJ5IiwidG90YWxTcGVjaWVzIiwidG90YWxUaHJlYXRlbmVkIiwibW9ja1RocmVhdERhdGEiLCJ0aHJlYXRDYXRlZ29yaWVzIiwiaGFiaXRhdExvc3MiLCJjb3VudCIsImNsaW1hdGVDaGFuZ2UiLCJwb2xsdXRpb24iLCJpbnZhc2l2ZVNwZWNpZXMiLCJvdmVyZXhwbG9pdGF0aW9uIiwib3RoZXIiLCJtb2NrUmVzb2x2ZWRWYWx1ZSIsInJlc3VsdCIsImdldEJpb2RpdmVyc2l0eVJpc2tJbmRleCIsImV4cGVjdCIsInRvQmVHcmVhdGVyVGhhbk9yRXF1YWwiLCJ0b0JlTGVzc1RoYW5PckVxdWFsIiwidG9IYXZlQmVlbkNhbGxlZFdpdGgiLCJ0b0hhdmVCZWVuQ2FsbGVkIiwidG9CZSIsIm1vY2tSZWplY3RlZFZhbHVlIiwiRXJyb3IiLCJjdXN0b21SZWdpb25zIiwidGltZXN0YW1wIiwicmVnaW9ucyIsImFtZXJpY2FzIiwidGhyZWF0ZW5lZFNwZWNpZXMiLCJhZnJpY2EiLCJnZXRCaW9kaXZlcnNpdHlBbmFseXNpcyIsInRvSGF2ZVByb3BlcnR5IiwiYW5hbHlzaXMiLCJzb3VyY2UiLCJyaXNrSW5kZXgiLCJiaW9kaXZlcnNpdHlEYXRhIiwidG9CZU51bGwiLCJ0aHJlYXREYXRhIiwidG90YWxSZWdpb25zIiwiZXJyb3IiLCJ0b0JlRGVmaW5lZCIsIl9hc3Nlc3NSaXNrTGV2ZWwiXSwic291cmNlcyI6WyJiaW9kaXZlcnNpdHlTZXJ2aWNlLnRlc3QuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEJpb2RpdmVyc2l0eVNlcnZpY2UgZnJvbSAnLi4vLi4vc3JjL3NlcnZpY2VzL2Jpb2RpdmVyc2l0eVNlcnZpY2UuanMnO1xuaW1wb3J0IEJpb2RpdmVyc2l0eUludGVncmF0aW9uIGZyb20gJy4uLy4uL3NyYy9pbnRlZ3JhdGlvbnMvQmlvZGl2ZXJzaXR5SW50ZWdyYXRpb24uanMnO1xuXG4vLyBNb2NrIHRoZSBpbnRlZ3JhdGlvblxuamVzdC5tb2NrKCcuLi8uLi9zcmMvaW50ZWdyYXRpb25zL0Jpb2RpdmVyc2l0eUludGVncmF0aW9uLmpzJyk7XG5cbmRlc2NyaWJlKCdCaW9kaXZlcnNpdHlTZXJ2aWNlJywgKCkgPT4ge1xuICBsZXQgYmlvZGl2ZXJzaXR5U2VydmljZTtcbiAgbGV0IG1vY2tJbnRlZ3JhdGlvbjtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAvLyBDbGVhciBhbGwgbW9ja3NcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcblxuICAgIC8vIENyZWF0ZSBtb2NrIGludGVncmF0aW9uXG4gICAgbW9ja0ludGVncmF0aW9uID0ge1xuICAgICAgZ2V0QmlvZGl2ZXJzaXR5RGF0YTogamVzdC5mbigpLFxuICAgICAgZ2V0U3BlY2llc1RocmVhdERhdGE6IGplc3QuZm4oKVxuICAgIH07XG5cbiAgICAvLyBNb2NrIHRoZSBjb25zdHJ1Y3RvciB0byByZXR1cm4gb3VyIG1vY2tcbiAgICBCaW9kaXZlcnNpdHlJbnRlZ3JhdGlvbi5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gbW9ja0ludGVncmF0aW9uKTtcblxuICAgIC8vIENyZWF0ZSBzZXJ2aWNlIGluc3RhbmNlXG4gICAgYmlvZGl2ZXJzaXR5U2VydmljZSA9IG5ldyBCaW9kaXZlcnNpdHlTZXJ2aWNlKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRCaW9kaXZlcnNpdHlSaXNrSW5kZXgnLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIGNhbGN1bGF0ZSByaXNrIGluZGV4IGNvcnJlY3RseSB3aXRoIHZhbGlkIGRhdGEnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrQmlvZGl2ZXJzaXR5RGF0YSA9IHtcbiAgICAgICAgZ2xvYmFsU3VtbWFyeToge1xuICAgICAgICAgIHRvdGFsU3BlY2llczogMTAwMDAsXG4gICAgICAgICAgdG90YWxUaHJlYXRlbmVkOiAyMDAwXG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG1vY2tUaHJlYXREYXRhID0ge1xuICAgICAgICB0aHJlYXRDYXRlZ29yaWVzOiB7XG4gICAgICAgICAgaGFiaXRhdExvc3M6IHsgY291bnQ6IDUwMCB9LFxuICAgICAgICAgIGNsaW1hdGVDaGFuZ2U6IHsgY291bnQ6IDMwMCB9LFxuICAgICAgICAgIHBvbGx1dGlvbjogeyBjb3VudDogMjAwIH0sXG4gICAgICAgICAgaW52YXNpdmVTcGVjaWVzOiB7IGNvdW50OiAxMDAgfSxcbiAgICAgICAgICBvdmVyZXhwbG9pdGF0aW9uOiB7IGNvdW50OiAxNTAgfSxcbiAgICAgICAgICBvdGhlcjogeyBjb3VudDogNTAgfVxuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBtb2NrSW50ZWdyYXRpb24uZ2V0QmlvZGl2ZXJzaXR5RGF0YS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQmlvZGl2ZXJzaXR5RGF0YSk7XG4gICAgICBtb2NrSW50ZWdyYXRpb24uZ2V0U3BlY2llc1RocmVhdERhdGEubW9ja1Jlc29sdmVkVmFsdWUobW9ja1RocmVhdERhdGEpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBiaW9kaXZlcnNpdHlTZXJ2aWNlLmdldEJpb2RpdmVyc2l0eVJpc2tJbmRleCgpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDApO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZUxlc3NUaGFuT3JFcXVhbCgxMDApO1xuICAgICAgZXhwZWN0KG1vY2tJbnRlZ3JhdGlvbi5nZXRCaW9kaXZlcnNpdHlEYXRhKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChbJ2FtZXJpY2FzJywgJ2FmcmljYScsICdhc2lhJywgJ2V1cm9wZScsICdvY2VhbmlhJ10pO1xuICAgICAgZXhwZWN0KG1vY2tJbnRlZ3JhdGlvbi5nZXRTcGVjaWVzVGhyZWF0RGF0YSkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIHJldHVybiBkZWZhdWx0IHJpc2sgd2hlbiBkYXRhIGlzIGludmFsaWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrSW50ZWdyYXRpb24uZ2V0QmlvZGl2ZXJzaXR5RGF0YS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcbiAgICAgIG1vY2tJbnRlZ3JhdGlvbi5nZXRTcGVjaWVzVGhyZWF0RGF0YS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYmlvZGl2ZXJzaXR5U2VydmljZS5nZXRCaW9kaXZlcnNpdHlSaXNrSW5kZXgoKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZSgzMCk7IC8vIERlZmF1bHQgbW9kZXJhdGUgcmlza1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBlcnJvcnMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tJbnRlZ3JhdGlvbi5nZXRCaW9kaXZlcnNpdHlEYXRhLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignQVBJIEVycm9yJykpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBiaW9kaXZlcnNpdHlTZXJ2aWNlLmdldEJpb2RpdmVyc2l0eVJpc2tJbmRleCgpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKDMwKTsgLy8gRGVmYXVsdCBtb2RlcmF0ZSByaXNrXG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgYWNjZXB0IGN1c3RvbSByZWdpb25zIHBhcmFtZXRlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGN1c3RvbVJlZ2lvbnMgPSBbJ2FzaWEnLCAnZXVyb3BlJ107XG4gICAgICBjb25zdCBtb2NrQmlvZGl2ZXJzaXR5RGF0YSA9IHtcbiAgICAgICAgZ2xvYmFsU3VtbWFyeToge1xuICAgICAgICAgIHRvdGFsU3BlY2llczogNTAwMCxcbiAgICAgICAgICB0b3RhbFRocmVhdGVuZWQ6IDUwMFxuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBtb2NrSW50ZWdyYXRpb24uZ2V0QmlvZGl2ZXJzaXR5RGF0YS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrQmlvZGl2ZXJzaXR5RGF0YSk7XG4gICAgICBtb2NrSW50ZWdyYXRpb24uZ2V0U3BlY2llc1RocmVhdERhdGEubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICB0aHJlYXRDYXRlZ29yaWVzOiB7XG4gICAgICAgICAgaGFiaXRhdExvc3M6IHsgY291bnQ6IDEwMCB9LFxuICAgICAgICAgIGNsaW1hdGVDaGFuZ2U6IHsgY291bnQ6IDUwIH0sXG4gICAgICAgICAgcG9sbHV0aW9uOiB7IGNvdW50OiAzMCB9LFxuICAgICAgICAgIGludmFzaXZlU3BlY2llczogeyBjb3VudDogMjAgfSxcbiAgICAgICAgICBvdmVyZXhwbG9pdGF0aW9uOiB7IGNvdW50OiAyNSB9LFxuICAgICAgICAgIG90aGVyOiB7IGNvdW50OiAxMCB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBiaW9kaXZlcnNpdHlTZXJ2aWNlLmdldEJpb2RpdmVyc2l0eVJpc2tJbmRleChjdXN0b21SZWdpb25zKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgwKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVMZXNzVGhhbk9yRXF1YWwoMTAwKTtcbiAgICAgIGV4cGVjdChtb2NrSW50ZWdyYXRpb24uZ2V0QmlvZGl2ZXJzaXR5RGF0YSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoY3VzdG9tUmVnaW9ucyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZXRCaW9kaXZlcnNpdHlBbmFseXNpcycsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgcmV0dXJuIGNvbXBsZXRlIGFuYWx5c2lzIHdpdGggdmFsaWQgZGF0YScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tCaW9kaXZlcnNpdHlEYXRhID0ge1xuICAgICAgICB0aW1lc3RhbXA6ICcyMDI1LTEwLTEzVDE5OjMwOjAwLjAwMFonLFxuICAgICAgICByZWdpb25zOiB7XG4gICAgICAgICAgYW1lcmljYXM6IHsgdG90YWxTcGVjaWVzOiA1MDAwLCB0aHJlYXRlbmVkU3BlY2llczogMTAwMCB9LFxuICAgICAgICAgIGFmcmljYTogeyB0b3RhbFNwZWNpZXM6IDQwMDAsIHRocmVhdGVuZWRTcGVjaWVzOiA4MDAgfVxuICAgICAgICB9LFxuICAgICAgICBnbG9iYWxTdW1tYXJ5OiB7XG4gICAgICAgICAgdG90YWxTcGVjaWVzOiA5MDAwLFxuICAgICAgICAgIHRvdGFsVGhyZWF0ZW5lZDogMTgwMFxuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBjb25zdCBtb2NrVGhyZWF0RGF0YSA9IHtcbiAgICAgICAgdGhyZWF0Q2F0ZWdvcmllczoge1xuICAgICAgICAgIGhhYml0YXRMb3NzOiB7IGNvdW50OiA1MDAgfSxcbiAgICAgICAgICBjbGltYXRlQ2hhbmdlOiB7IGNvdW50OiAzMDAgfSxcbiAgICAgICAgICBwb2xsdXRpb246IHsgY291bnQ6IDIwMCB9LFxuICAgICAgICAgIGludmFzaXZlU3BlY2llczogeyBjb3VudDogMTAwIH0sXG4gICAgICAgICAgb3ZlcmV4cGxvaXRhdGlvbjogeyBjb3VudDogMTUwIH0sXG4gICAgICAgICAgb3RoZXI6IHsgY291bnQ6IDUwIH1cbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgbW9ja0ludGVncmF0aW9uLmdldEJpb2RpdmVyc2l0eURhdGEubW9ja1Jlc29sdmVkVmFsdWUobW9ja0Jpb2RpdmVyc2l0eURhdGEpO1xuICAgICAgbW9ja0ludGVncmF0aW9uLmdldFNwZWNpZXNUaHJlYXREYXRhLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tUaHJlYXREYXRhKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYmlvZGl2ZXJzaXR5U2VydmljZS5nZXRCaW9kaXZlcnNpdHlBbmFseXNpcygpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgndGltZXN0YW1wJyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgncmlza0luZGV4Jyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgnYmlvZGl2ZXJzaXR5RGF0YScpO1xuICAgICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlUHJvcGVydHkoJ3RocmVhdERhdGEnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvSGF2ZVByb3BlcnR5KCdhbmFseXNpcycpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5hbmFseXNpcykudG9IYXZlUHJvcGVydHkoJ3RvdGFsUmVnaW9ucycpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5hbmFseXNpcykudG9IYXZlUHJvcGVydHkoJ2dsb2JhbFRocmVhdFBlcmNlbnRhZ2UnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuYW5hbHlzaXMpLnRvSGF2ZVByb3BlcnR5KCdtYWpvclRocmVhdENhdGVnb3JpZXMnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuYW5hbHlzaXMpLnRvSGF2ZVByb3BlcnR5KCdyaXNrQXNzZXNzbWVudCcpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zb3VyY2UpLnRvQmUoJ0Jpb2RpdmVyc2l0eVNlcnZpY2UnKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCByZXR1cm4gZmFsbGJhY2sgYW5hbHlzaXMgd2hlbiBkYXRhIGlzIGludmFsaWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrSW50ZWdyYXRpb24uZ2V0QmlvZGl2ZXJzaXR5RGF0YS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcbiAgICAgIG1vY2tJbnRlZ3JhdGlvbi5nZXRTcGVjaWVzVGhyZWF0RGF0YS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYmlvZGl2ZXJzaXR5U2VydmljZS5nZXRCaW9kaXZlcnNpdHlBbmFseXNpcygpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnJpc2tJbmRleCkudG9CZSgzMCk7XG4gICAgICBleHBlY3QocmVzdWx0LmJpb2RpdmVyc2l0eURhdGEpLnRvQmVOdWxsKCk7XG4gICAgICBleHBlY3QocmVzdWx0LnRocmVhdERhdGEpLnRvQmVOdWxsKCk7XG4gICAgICBleHBlY3QocmVzdWx0LmFuYWx5c2lzLnRvdGFsUmVnaW9ucykudG9CZSgwKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuc291cmNlKS50b0JlKCdCaW9kaXZlcnNpdHlTZXJ2aWNlIC0gRXJyb3IgRmFsbGJhY2snKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3IpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgaGFuZGxlIGVycm9ycyBncmFjZWZ1bGx5IGluIGFuYWx5c2lzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0ludGVncmF0aW9uLmdldEJpb2RpdmVyc2l0eURhdGEubW9ja1JlamVjdGVkVmFsdWUobmV3IEVycm9yKCdOZXR3b3JrIEVycm9yJykpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBiaW9kaXZlcnNpdHlTZXJ2aWNlLmdldEJpb2RpdmVyc2l0eUFuYWx5c2lzKCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQucmlza0luZGV4KS50b0JlKDMwKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuc291cmNlKS50b0JlKCdCaW9kaXZlcnNpdHlTZXJ2aWNlIC0gRXJyb3IgRmFsbGJhY2snKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZXJyb3IpLnRvQmUoJ05ldHdvcmsgRXJyb3InKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ19hc3Nlc3NSaXNrTGV2ZWwnLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIGFzc2VzcyByaXNrIGxldmVscyBjb3JyZWN0bHknLCAoKSA9PiB7XG4gICAgICBleHBlY3QoYmlvZGl2ZXJzaXR5U2VydmljZS5fYXNzZXNzUmlza0xldmVsKDIwKSkudG9CZSgnTG93Jyk7XG4gICAgICBleHBlY3QoYmlvZGl2ZXJzaXR5U2VydmljZS5fYXNzZXNzUmlza0xldmVsKDM1KSkudG9CZSgnTW9kZXJhdGUnKTtcbiAgICAgIGV4cGVjdChiaW9kaXZlcnNpdHlTZXJ2aWNlLl9hc3Nlc3NSaXNrTGV2ZWwoNTUpKS50b0JlKCdIaWdoJyk7XG4gICAgICBleHBlY3QoYmlvZGl2ZXJzaXR5U2VydmljZS5fYXNzZXNzUmlza0xldmVsKDc1KSkudG9CZSgnQ3JpdGljYWwnKTtcbiAgICB9KTtcbiAgfSk7XG59KTsiXSwibWFwcGluZ3MiOiI7O0FBR0E7QUFDQUEsV0FBQSxHQUFLQyxJQUFJLENBQUMsbURBQW1ELENBQUM7QUFKOUQsSUFBQUMsb0JBQUEsR0FBQUMsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFDLHdCQUFBLEdBQUFGLHNCQUFBLENBQUFDLE9BQUE7QUFBd0YsU0FBQUQsdUJBQUFHLENBQUEsV0FBQUEsQ0FBQSxJQUFBQSxDQUFBLENBQUFDLFVBQUEsR0FBQUQsQ0FBQSxLQUFBRSxPQUFBLEVBQUFGLENBQUE7QUFBQSxTQUFBTixZQUFBO0VBQUE7SUFBQVM7RUFBQSxJQUFBTCxPQUFBO0VBQUFKLFdBQUEsR0FBQUEsQ0FBQSxLQUFBUyxJQUFBO0VBQUEsT0FBQUEsSUFB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