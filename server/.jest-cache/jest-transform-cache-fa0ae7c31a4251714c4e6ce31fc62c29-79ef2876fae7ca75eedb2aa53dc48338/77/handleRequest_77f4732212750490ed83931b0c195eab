d89ff1834ff059dac360fe6ce76ca27c
"use strict";

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all) __defProp(target, name, {
    get: all[name],
    enumerable: true
  });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from)) if (!__hasOwnProp.call(to, key) && key !== except) __defProp(to, key, {
      get: () => from[key],
      enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable
    });
  }
  return to;
};
var __toCommonJS = mod => __copyProps(__defProp({}, "__esModule", {
  value: true
}), mod);
var handleRequest_exports = {};
__export(handleRequest_exports, {
  handleRequest: () => handleRequest
});
module.exports = __toCommonJS(handleRequest_exports);
var import_until_async = require("until-async");
var import_executeHandlers = require("./executeHandlers");
var import_onUnhandledRequest = require("./request/onUnhandledRequest");
var import_storeResponseCookies = require("./request/storeResponseCookies");
async function handleRequest(request, requestId, handlers, options, emitter, handleRequestOptions) {
  emitter.emit("request:start", {
    request,
    requestId
  });
  if (request.headers.get("accept")?.includes("msw/passthrough")) {
    emitter.emit("request:end", {
      request,
      requestId
    });
    handleRequestOptions?.onPassthroughResponse?.(request);
    return;
  }
  const [lookupError, lookupResult] = await (0, import_until_async.until)(() => {
    return (0, import_executeHandlers.executeHandlers)({
      request,
      requestId,
      handlers,
      resolutionContext: handleRequestOptions?.resolutionContext
    });
  });
  if (lookupError) {
    emitter.emit("unhandledException", {
      error: lookupError,
      request,
      requestId
    });
    throw lookupError;
  }
  if (!lookupResult) {
    await (0, import_onUnhandledRequest.onUnhandledRequest)(request, options.onUnhandledRequest);
    emitter.emit("request:unhandled", {
      request,
      requestId
    });
    emitter.emit("request:end", {
      request,
      requestId
    });
    handleRequestOptions?.onPassthroughResponse?.(request);
    return;
  }
  const {
    response
  } = lookupResult;
  if (!response) {
    emitter.emit("request:end", {
      request,
      requestId
    });
    handleRequestOptions?.onPassthroughResponse?.(request);
    return;
  }
  if (response.status === 302 && response.headers.get("x-msw-intention") === "passthrough") {
    emitter.emit("request:end", {
      request,
      requestId
    });
    handleRequestOptions?.onPassthroughResponse?.(request);
    return;
  }
  await (0, import_storeResponseCookies.storeResponseCookies)(request, response);
  emitter.emit("request:match", {
    request,
    requestId
  });
  const requiredLookupResult = lookupResult;
  handleRequestOptions?.onMockedResponse?.(response, requiredLookupResult);
  emitter.emit("request:end", {
    request,
    requestId
  });
  return response;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJoYW5kbGVSZXF1ZXN0X2V4cG9ydHMiLCJfX2V4cG9ydCIsImhhbmRsZVJlcXVlc3QiLCJtb2R1bGUiLCJleHBvcnRzIiwiX190b0NvbW1vbkpTIiwiaW1wb3J0X3VudGlsX2FzeW5jIiwicmVxdWlyZSIsImltcG9ydF9leGVjdXRlSGFuZGxlcnMiLCJpbXBvcnRfb25VbmhhbmRsZWRSZXF1ZXN0IiwiaW1wb3J0X3N0b3JlUmVzcG9uc2VDb29raWVzIiwicmVxdWVzdCIsInJlcXVlc3RJZCIsImhhbmRsZXJzIiwib3B0aW9ucyIsImVtaXR0ZXIiLCJoYW5kbGVSZXF1ZXN0T3B0aW9ucyIsImVtaXQiLCJoZWFkZXJzIiwiZ2V0IiwiaW5jbHVkZXMiLCJvblBhc3N0aHJvdWdoUmVzcG9uc2UiLCJsb29rdXBFcnJvciIsImxvb2t1cFJlc3VsdCIsInVudGlsIiwiZXhlY3V0ZUhhbmRsZXJzIiwicmVzb2x1dGlvbkNvbnRleHQiLCJlcnJvciIsIm9uVW5oYW5kbGVkUmVxdWVzdCIsInJlc3BvbnNlIiwic3RhdHVzIiwic3RvcmVSZXNwb25zZUNvb2tpZXMiLCJyZXF1aXJlZExvb2t1cFJlc3VsdCIsIm9uTW9ja2VkUmVzcG9uc2UiXSwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvY29yZS91dGlscy9oYW5kbGVSZXF1ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHVudGlsIH0gZnJvbSAndW50aWwtYXN5bmMnXG5pbXBvcnQgeyBFbWl0dGVyIH0gZnJvbSAnc3RyaWN0LWV2ZW50LWVtaXR0ZXInXG5pbXBvcnQgeyBMaWZlQ3ljbGVFdmVudHNNYXAsIFNoYXJlZE9wdGlvbnMgfSBmcm9tICcuLi9zaGFyZWRPcHRpb25zJ1xuaW1wb3J0IHsgUmVxdWlyZWREZWVwIH0gZnJvbSAnLi4vdHlwZVV0aWxzJ1xuaW1wb3J0IHR5cGUgeyBSZXF1ZXN0SGFuZGxlciB9IGZyb20gJy4uL2hhbmRsZXJzL1JlcXVlc3RIYW5kbGVyJ1xuaW1wb3J0IHsgSGFuZGxlcnNFeGVjdXRpb25SZXN1bHQsIGV4ZWN1dGVIYW5kbGVycyB9IGZyb20gJy4vZXhlY3V0ZUhhbmRsZXJzJ1xuaW1wb3J0IHsgb25VbmhhbmRsZWRSZXF1ZXN0IH0gZnJvbSAnLi9yZXF1ZXN0L29uVW5oYW5kbGVkUmVxdWVzdCdcbmltcG9ydCB7IHN0b3JlUmVzcG9uc2VDb29raWVzIH0gZnJvbSAnLi9yZXF1ZXN0L3N0b3JlUmVzcG9uc2VDb29raWVzJ1xuXG5leHBvcnQgaW50ZXJmYWNlIEhhbmRsZVJlcXVlc3RPcHRpb25zIHtcbiAgLyoqXG4gICAqIGByZXNvbHV0aW9uQ29udGV4dGAgaXMgbm90IHBhcnQgb2YgdGhlIGdlbmVyYWwgcHVibGljIGFwaVxuICAgKiBidXQgaXMgZXhwb3NlZCB0byBhaWQgaW4gY3JlYXRpbmcgZXh0ZW5zaW9ucyBsaWtlXG4gICAqIGBAbXN3anMvaHR0cC1taWRkbGV3YXJlYC5cbiAgICovXG4gIHJlc29sdXRpb25Db250ZXh0Pzoge1xuICAgIC8qKlxuICAgICAqIEEgYmFzZSB1cmwgdG8gdXNlIHdoZW4gcmVzb2x2aW5nIHJlbGF0aXZlIHVybHMuXG4gICAgICogQG5vdGUgVGhpcyBpcyBwcmltYXJpbHkgdXNlZCBieSB0aGUgYEBtc3dqcy9odHRwLW1pZGRsZXdhcmVgXG4gICAgICogdG8gcmVzb2x2ZSByZWxhdGl2ZSB1cmxzIGluIHRoZSBjb250ZXh0IG9mIHRoZSBydW5uaW5nIHNlcnZlclxuICAgICAqL1xuICAgIGJhc2VVcmw/OiBzdHJpbmdcbiAgfVxuXG4gIC8qKlxuICAgKiBJbnZva2VkIHdoZW5ldmVyIGEgcmVxdWVzdCBpcyBwZXJmb3JtZWQgYXMtaXMuXG4gICAqL1xuICBvblBhc3N0aHJvdWdoUmVzcG9uc2U/KHJlcXVlc3Q6IFJlcXVlc3QpOiB2b2lkXG5cbiAgLyoqXG4gICAqIEludm9rZWQgd2hlbiB0aGUgbW9ja2VkIHJlc3BvbnNlIGlzIHJlYWR5IHRvIGJlIHNlbnQuXG4gICAqL1xuICBvbk1vY2tlZFJlc3BvbnNlPyhcbiAgICByZXNwb25zZTogUmVzcG9uc2UsXG4gICAgaGFuZGxlcjogUmVxdWlyZWREZWVwPEhhbmRsZXJzRXhlY3V0aW9uUmVzdWx0PixcbiAgKTogdm9pZFxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlUmVxdWVzdChcbiAgcmVxdWVzdDogUmVxdWVzdCxcbiAgcmVxdWVzdElkOiBzdHJpbmcsXG4gIGhhbmRsZXJzOiBBcnJheTxSZXF1ZXN0SGFuZGxlcj4sXG4gIG9wdGlvbnM6IFJlcXVpcmVkRGVlcDxTaGFyZWRPcHRpb25zPixcbiAgZW1pdHRlcjogRW1pdHRlcjxMaWZlQ3ljbGVFdmVudHNNYXA+LFxuICBoYW5kbGVSZXF1ZXN0T3B0aW9ucz86IEhhbmRsZVJlcXVlc3RPcHRpb25zLFxuKTogUHJvbWlzZTxSZXNwb25zZSB8IHVuZGVmaW5lZD4ge1xuICBlbWl0dGVyLmVtaXQoJ3JlcXVlc3Q6c3RhcnQnLCB7IHJlcXVlc3QsIHJlcXVlc3RJZCB9KVxuXG4gIC8vIFBlcmZvcm0gcmVxdWVzdHMgd3JhcHBlZCBpbiBcImJ5cGFzcygpXCIgYXMtaXMuXG4gIGlmIChyZXF1ZXN0LmhlYWRlcnMuZ2V0KCdhY2NlcHQnKT8uaW5jbHVkZXMoJ21zdy9wYXNzdGhyb3VnaCcpKSB7XG4gICAgZW1pdHRlci5lbWl0KCdyZXF1ZXN0OmVuZCcsIHsgcmVxdWVzdCwgcmVxdWVzdElkIH0pXG4gICAgaGFuZGxlUmVxdWVzdE9wdGlvbnM/Lm9uUGFzc3Rocm91Z2hSZXNwb25zZT8uKHJlcXVlc3QpXG4gICAgcmV0dXJuXG4gIH1cblxuICAvLyBSZXNvbHZlIGEgbW9ja2VkIHJlc3BvbnNlIGZyb20gdGhlIGxpc3Qgb2YgcmVxdWVzdCBoYW5kbGVycy5cbiAgY29uc3QgW2xvb2t1cEVycm9yLCBsb29rdXBSZXN1bHRdID0gYXdhaXQgdW50aWwoKCkgPT4ge1xuICAgIHJldHVybiBleGVjdXRlSGFuZGxlcnMoe1xuICAgICAgcmVxdWVzdCxcbiAgICAgIHJlcXVlc3RJZCxcbiAgICAgIGhhbmRsZXJzLFxuICAgICAgcmVzb2x1dGlvbkNvbnRleHQ6IGhhbmRsZVJlcXVlc3RPcHRpb25zPy5yZXNvbHV0aW9uQ29udGV4dCxcbiAgICB9KVxuICB9KVxuXG4gIGlmIChsb29rdXBFcnJvcikge1xuICAgIC8vIEFsbG93IGRldmVsb3BlcnMgdG8gcmVhY3QgdG8gdW5oYW5kbGVkIGV4Y2VwdGlvbnMgaW4gcmVxdWVzdCBoYW5kbGVycy5cbiAgICBlbWl0dGVyLmVtaXQoJ3VuaGFuZGxlZEV4Y2VwdGlvbicsIHtcbiAgICAgIGVycm9yOiBsb29rdXBFcnJvcixcbiAgICAgIHJlcXVlc3QsXG4gICAgICByZXF1ZXN0SWQsXG4gICAgfSlcbiAgICB0aHJvdyBsb29rdXBFcnJvclxuICB9XG5cbiAgLy8gSWYgdGhlIGhhbmRsZXIgbG9va3VwIHJldHVybmVkIG5vdGhpbmcsIG5vIHJlcXVlc3QgaGFuZGxlciB3YXMgZm91bmRcbiAgLy8gbWF0Y2hpbmcgdGhpcyByZXF1ZXN0LiBSZXBvcnQgdGhlIHJlcXVlc3QgYXMgdW5oYW5kbGVkLlxuICBpZiAoIWxvb2t1cFJlc3VsdCkge1xuICAgIGF3YWl0IG9uVW5oYW5kbGVkUmVxdWVzdChyZXF1ZXN0LCBvcHRpb25zLm9uVW5oYW5kbGVkUmVxdWVzdClcbiAgICBlbWl0dGVyLmVtaXQoJ3JlcXVlc3Q6dW5oYW5kbGVkJywgeyByZXF1ZXN0LCByZXF1ZXN0SWQgfSlcbiAgICBlbWl0dGVyLmVtaXQoJ3JlcXVlc3Q6ZW5kJywgeyByZXF1ZXN0LCByZXF1ZXN0SWQgfSlcbiAgICBoYW5kbGVSZXF1ZXN0T3B0aW9ucz8ub25QYXNzdGhyb3VnaFJlc3BvbnNlPy4ocmVxdWVzdClcbiAgICByZXR1cm5cbiAgfVxuXG4gIGNvbnN0IHsgcmVzcG9uc2UgfSA9IGxvb2t1cFJlc3VsdFxuXG4gIC8vIFdoZW4gdGhlIGhhbmRsZWQgcmVxdWVzdCByZXR1cm5lZCBubyBtb2NrZWQgcmVzcG9uc2UsIHdhcm4gdGhlIGRldmVsb3BlcixcbiAgLy8gYXMgaXQgbWF5IGJlIGFuIG92ZXJzaWdodCBvbiB0aGVpciBwYXJ0LiBQZXJmb3JtIHRoZSByZXF1ZXN0IGFzLWlzLlxuICBpZiAoIXJlc3BvbnNlKSB7XG4gICAgZW1pdHRlci5lbWl0KCdyZXF1ZXN0OmVuZCcsIHsgcmVxdWVzdCwgcmVxdWVzdElkIH0pXG4gICAgaGFuZGxlUmVxdWVzdE9wdGlvbnM/Lm9uUGFzc3Rocm91Z2hSZXNwb25zZT8uKHJlcXVlc3QpXG4gICAgcmV0dXJuXG4gIH1cblxuICAvLyBQZXJmb3JtIHRoZSByZXF1ZXN0IGFzLWlzIHdoZW4gdGhlIGRldmVsb3BlciBleHBsaWNpdGx5IHJldHVybmVkIFwicmVxLnBhc3N0aHJvdWdoKClcIi5cbiAgLy8gVGhpcyBwcm9kdWNlcyBubyB3YXJuaW5nIGFzIHRoZSByZXF1ZXN0IHdhcyBoYW5kbGVkLlxuICBpZiAoXG4gICAgcmVzcG9uc2Uuc3RhdHVzID09PSAzMDIgJiZcbiAgICByZXNwb25zZS5oZWFkZXJzLmdldCgneC1tc3ctaW50ZW50aW9uJykgPT09ICdwYXNzdGhyb3VnaCdcbiAgKSB7XG4gICAgZW1pdHRlci5lbWl0KCdyZXF1ZXN0OmVuZCcsIHsgcmVxdWVzdCwgcmVxdWVzdElkIH0pXG4gICAgaGFuZGxlUmVxdWVzdE9wdGlvbnM/Lm9uUGFzc3Rocm91Z2hSZXNwb25zZT8uKHJlcXVlc3QpXG4gICAgcmV0dXJuXG4gIH1cblxuICAvLyBTdG9yZSBhbGwgdGhlIHJlY2VpdmVkIHJlc3BvbnNlIGNvb2tpZXMgaW4gdGhlIGNvb2tpZSBqYXIuXG4gIGF3YWl0IHN0b3JlUmVzcG9uc2VDb29raWVzKHJlcXVlc3QsIHJlc3BvbnNlKVxuXG4gIGVtaXR0ZXIuZW1pdCgncmVxdWVzdDptYXRjaCcsIHsgcmVxdWVzdCwgcmVxdWVzdElkIH0pXG5cbiAgY29uc3QgcmVxdWlyZWRMb29rdXBSZXN1bHQgPVxuICAgIGxvb2t1cFJlc3VsdCBhcyBSZXF1aXJlZERlZXA8SGFuZGxlcnNFeGVjdXRpb25SZXN1bHQ+XG5cbiAgaGFuZGxlUmVxdWVzdE9wdGlvbnM/Lm9uTW9ja2VkUmVzcG9uc2U/LihyZXNwb25zZSwgcmVxdWlyZWRMb29rdXBSZXN1bHQpXG5cbiAgZW1pdHRlci5lbWl0KCdyZXF1ZXN0OmVuZCcsIHsgcmVxdWVzdCwgcmVxdWVzdElkIH0pXG5cbiAgcmV0dXJuIHJlc3BvbnNlXG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLElBQUFBLHFCQUFBO0FBQUFDLFFBQUEsQ0FBQUQscUJBQUE7RUFBQUUsYUFBQSxFQUFBQSxDQUFBLEtBQUFBO0FBQUE7QUFBQUMsTUFBQSxDQUFBQyxPQUFBLEdBQUFDLFlBQUEsQ0FBQUwscUJBQUE7QUFBQSxJQUFBTSxrQkFBQSxHQUFzQkMsT0FBQTtBQUt0QixJQUFBQyxzQkFBQSxHQUF5REQsT0FBQTtBQUN6RCxJQUFBRSx5QkFBQSxHQUFtQ0YsT0FBQTtBQUNuQyxJQUFBRywyQkFBQSxHQUFxQ0gsT0FBQTtBQStCckMsZUFBc0JMLGNBQ3BCUyxPQUFBLEVBQ0FDLFNBQUEsRUFDQUMsUUFBQSxFQUNBQyxPQUFBLEVBQ0FDLE9BQUEsRUFDQUMsb0JBQUEsRUFDK0I7RUFDL0JELE9BQUEsQ0FBUUUsSUFBQSxDQUFLLGlCQUFpQjtJQUFFTixPQUFBO0lBQVNDO0VBQVUsQ0FBQztFQUdwRCxJQUFJRCxPQUFBLENBQVFPLE9BQUEsQ0FBUUMsR0FBQSxDQUFJLFFBQVEsR0FBR0MsUUFBQSxDQUFTLGlCQUFpQixHQUFHO0lBQzlETCxPQUFBLENBQVFFLElBQUEsQ0FBSyxlQUFlO01BQUVOLE9BQUE7TUFBU0M7SUFBVSxDQUFDO0lBQ2xESSxvQkFBQSxFQUFzQksscUJBQUEsR0FBd0JWLE9BQU87SUFDckQ7RUFDRjtFQUdBLE1BQU0sQ0FBQ1csV0FBQSxFQUFhQyxZQUFZLElBQUksVUFBTWpCLGtCQUFBLENBQUFrQixLQUFBLEVBQU0sTUFBTTtJQUNwRCxXQUFPaEIsc0JBQUEsQ0FBQWlCLGVBQUEsRUFBZ0I7TUFDckJkLE9BQUE7TUFDQUMsU0FBQTtNQUNBQyxRQUFBO01BQ0FhLGlCQUFBLEVBQW1CVixvQkFBQSxFQUFzQlU7SUFDM0MsQ0FBQztFQUNILENBQUM7RUFFRCxJQUFJSixXQUFBLEVBQWE7SUFFZlAsT0FBQSxDQUFRRSxJQUFBLENBQUssc0JBQXNCO01BQ2pDVSxLQUFBLEVBQU9MLFdBQUE7TUFDUFgsT0FBQTtNQUNBQztJQUNGLENBQUM7SUFDRCxNQUFNVSxXQUFBO0VBQ1I7RUFJQSxJQUFJLENBQUNDLFlBQUEsRUFBYztJQUNqQixVQUFNZCx5QkFBQSxDQUFBbUIsa0JBQUEsRUFBbUJqQixPQUFBLEVBQVNHLE9BQUEsQ0FBUWMsa0JBQWtCO0lBQzVEYixPQUFBLENBQVFFLElBQUEsQ0FBSyxxQkFBcUI7TUFBRU4sT0FBQTtNQUFTQztJQUFVLENBQUM7SUFDeERHLE9BQUEsQ0FBUUUsSUFBQSxDQUFLLGVBQWU7TUFBRU4sT0FBQTtNQUFTQztJQUFVLENBQUM7SUFDbERJLG9CQUFBLEVBQXNCSyxxQkFBQSxHQUF3QlYsT0FBTztJQUNyRDtFQUNGO0VBRUEsTUFBTTtJQUFFa0I7RUFBUyxJQUFJTixZQUFBO0VBSXJCLElBQUksQ0FBQ00sUUFBQSxFQUFVO0lBQ2JkLE9BQUEsQ0FBUUUsSUFBQSxDQUFLLGVBQWU7TUFBRU4sT0FBQTtNQUFTQztJQUFVLENBQUM7SUFDbERJLG9CQUFBLEVBQXNCSyxxQkFBQSxHQUF3QlYsT0FBTztJQUNyRDtFQUNGO0VBSUEsSUFDRWtCLFFBQUEsQ0FBU0MsTUFBQSxLQUFXLE9BQ3BCRCxRQUFBLENBQVNYLE9BQUEsQ0FBUUMsR0FBQSxDQUFJLGlCQUFpQixNQUFNLGVBQzVDO0lBQ0FKLE9BQUEsQ0FBUUUsSUFBQSxDQUFLLGVBQWU7TUFBRU4sT0FBQTtNQUFTQztJQUFVLENBQUM7SUFDbERJLG9CQUFBLEVBQXNCSyxxQkFBQSxHQUF3QlYsT0FBTztJQUNyRDtFQUNGO0VBR0EsVUFBTUQsMkJBQUEsQ0FBQXFCLG9CQUFBLEVBQXFCcEIsT0FBQSxFQUFTa0IsUUFBUTtFQUU1Q2QsT0FBQSxDQUFRRSxJQUFBLENBQUssaUJBQWlCO0lBQUVOLE9BQUE7SUFBU0M7RUFBVSxDQUFDO0VBRXBELE1BQU1vQixvQkFBQSxHQUNKVCxZQUFBO0VBRUZQLG9CQUFBLEVBQXNCaUIsZ0JBQUEsR0FBbUJKLFFBQUEsRUFBVUcsb0JBQW9CO0VBRXZFakIsT0FBQSxDQUFRRSxJQUFBLENBQUssZUFBZTtJQUFFTixPQUFBO0lBQVNDO0VBQVUsQ0FBQztFQUVsRCxPQUFPaUIsUUFBQTtBQUNUIiwiaWdub3JlTGlzdCI6W119