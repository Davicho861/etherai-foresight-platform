{"version":3,"names":["express","require","request","describe","beforeEach","jest","resetModules","test","router","default","app","use","res","get","expect","status","toBe","body","toHaveProperty","mockPrediction","probability","reason","doMock","fn","mockImplementation","predictFailure","mockResolvedValue"],"sources":["module_sacrifice.test.js"],"sourcesContent":["const express = require('express')\nconst request = require('supertest')\n\ndescribe('routes module and sacrifice', () => {\n  beforeEach(() => {\n    jest.resetModules()\n  })\n\n  test('GET /colombia/overview returns mock data', async () => {\n    const router = require('../../src/routes/module.js').default || require('../../src/routes/module.js')\n    const app = express()\n    app.use('/api/module', router)\n\n    const res = await request(app).get('/api/module/colombia/overview')\n    expect(res.status).toBe(200)\n    expect(res.body).toHaveProperty('country', 'Colombia')\n    expect(res.body).toHaveProperty('data')\n  })\n\n  test('GET /run returns blocked true when oracle predicts high probability', async () => {\n    const mockPrediction = { probability: 0.9, reason: 'high risk' }\n    jest.doMock('../../src/oracle.js', () => {\n      return jest.fn().mockImplementation(() => ({\n        predictFailure: jest.fn().mockResolvedValue(mockPrediction)\n      }))\n    })\n\n    const router = require('../../src/routes/sacrifice.js').default || require('../../src/routes/sacrifice.js')\n    const app = express()\n    app.use('/api/sacrifice', router)\n\n    const res = await request(app).get('/api/sacrifice/run')\n    expect(res.status).toBe(200)\n    expect(res.body).toHaveProperty('blocked', true)\n    expect(res.body).toHaveProperty('prediction')\n  })\n\n  test('GET /run returns blocked false when oracle predicts low probability', async () => {\n    const mockPrediction = { probability: 0.1, reason: 'low risk' }\n    jest.doMock('../../src/oracle.js', () => {\n      return jest.fn().mockImplementation(() => ({\n        predictFailure: jest.fn().mockResolvedValue(mockPrediction)\n      }))\n    })\n\n    const router = require('../../src/routes/sacrifice.js').default || require('../../src/routes/sacrifice.js')\n    const app = express()\n    app.use('/api/sacrifice', router)\n\n    const res = await request(app).get('/api/sacrifice/run')\n    expect(res.status).toBe(200)\n    expect(res.body).toHaveProperty('blocked', false)\n    expect(res.body).toHaveProperty('prediction')\n  })\n})\n"],"mappings":"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","ignoreList":[]}