{"version":3,"names":["_child_process","require","_axios","_interopRequireDefault","_net","e","__esModule","default","MOCK_PORT","waitForPort","port","host","timeout","Promise","resolve","reject","start","Date","now","tryConnect","sock","net","Socket","setTimeout","on","destroy","Error","connect","describe","proc","beforeAll","spawn","process","execPath","cwd","__dirname","env","USGS_MOCK_PORT","String","PORT","stdio","stdout","d","write","stderr","afterAll","killed","kill","test","url","res","axios","get","json","data","expect","toHaveProperty","Array","isArray","features","toBe","length","toBeGreaterThan"],"sources":["mockServer.integration.test.js"],"sourcesContent":["import { spawn } from 'child_process';\nimport axios from 'axios';\nimport net from 'net';\n\nconst MOCK_PORT = 45111; // use a non-default port to avoid collisions\n\nfunction waitForPort(port, host = '127.0.0.1', timeout = 5000) {\n  return new Promise((resolve, reject) => {\n    const start = Date.now();\n    (function tryConnect() {\n      const sock = new net.Socket();\n      sock.setTimeout(500);\n      sock.on('connect', () => {\n        sock.destroy();\n        resolve(true);\n      }).on('error', () => {\n        sock.destroy();\n        if (Date.now() - start > timeout) return reject(new Error('timeout'));\n        setTimeout(tryConnect, 100);\n      }).on('timeout', () => {\n        sock.destroy();\n        if (Date.now() - start > timeout) return reject(new Error('timeout'));\n        setTimeout(tryConnect, 100);\n      }).connect(port, host);\n    })();\n  });\n}\n\ndescribe('mock-server integration', () => {\n  let proc;\n\n  beforeAll(async () => {\n    // Start the mock server with a custom port\n    proc = spawn(process.execPath, ['./mocks/mock-server.js'], {\n      cwd: __dirname + '/../',\n      env: { ...process.env, USGS_MOCK_PORT: String(MOCK_PORT), PORT: String(MOCK_PORT) },\n      stdio: ['ignore', 'pipe', 'pipe']\n    });\n\n    // Pipe logs to console for easier debugging when tests fail\n    proc.stdout.on('data', (d) => process.stdout.write(`[mock-server] ${d}`));\n    proc.stderr.on('data', (d) => process.stderr.write(`[mock-server] ${d}`));\n\n    // Wait until port is listening\n    await waitForPort(MOCK_PORT, '127.0.0.1', 5000);\n  }, 15000);\n\n  afterAll(() => {\n    if (proc && !proc.killed) {\n      proc.kill();\n    }\n  });\n\n  test('usgs mock returns FeatureCollection with features array', async () => {\n  const url = `http://127.0.0.1:${MOCK_PORT}/usgs/significant_day.geojson`;\n  const res = await axios.get(url, { timeout: 3000 });\n  const json = res.data;\n    expect(json).toHaveProperty('type', 'FeatureCollection');\n    expect(Array.isArray(json.features)).toBe(true);\n    expect(json.features.length).toBeGreaterThan(0);\n    expect(json.features[0]).toHaveProperty('properties');\n  }, 10000);\n});\n"],"mappings":"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","ignoreList":[]}