f3c80047f87fba6bce76bb6fa3b01798
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _express = _interopRequireDefault(require("express"));
var _agents = _interopRequireDefault(require("../agents.js"));
function _interopRequireDefault(e) { return e && e.__esModule ? e : { default: e }; }
const router = _express.default.Router();

// GET /api/community-resilience - Get community resilience analysis
router.get('/', async (req, res) => {
  try {
    const {
      countries = 'COL,PER,ARG',
      days = 30
    } = req.query;
    const countriesArray = countries.split(',').map(c => c.trim().toUpperCase());
    const agent = new _agents.default('CommunityResilienceAgent');
    const result = await agent.run({
      countries: countriesArray,
      days: parseInt(days)
    });
    res.json({
      success: true,
      data: result,
      timestamp: new Date().toISOString()
    });
  } catch (error) {
    console.error('[CommunityResilience] Error:', error.message);
    res.status(500).json({
      error: 'Internal server error'
    });
  }
});

// GET /api/community-resilience/report - Generate and return resilience report
router.get('/report', async (req, res) => {
  try {
    const {
      countries = 'COL,PER,ARG',
      days = 30
    } = req.query;
    const countriesArray = countries.split(',').map(c => c.trim().toUpperCase());
    const agent = new _agents.default('CommunityResilienceAgent');
    const analysis = await agent.run({
      countries: countriesArray,
      days: parseInt(days)
    });

    // Generate report content
    const reportContent = `# COMMUNITY_RESILIENCE_REPORT.md

## Análisis de Resiliencia Comunitaria en LATAM

### Timestamp
${new Date().toISOString()}

### Análisis por País
${Object.entries(analysis.resilienceAnalysis).map(([country, data]) => `#### ${country}
- Eventos Sociales: ${data.socialEvents}
- Puntaje de Resiliencia: ${data.resilienceScore.toFixed(1)}/100
- Recomendaciones: ${data.recommendations.join(', ')}
- Período: ${data.period.startDate} a ${data.period.endDate}
`).join('\n')}

### Evaluación Global
- Resiliencia Promedio: ${analysis.globalResilienceAssessment.averageResilience.toFixed(1)}/100
- Países con Baja Resiliencia: ${analysis.globalResilienceAssessment.lowResilienceCountries}
- Evaluación: ${analysis.globalResilienceAssessment.assessment}
- Recomendaciones Globales: ${analysis.globalResilienceAssessment.globalRecommendations.join(', ')}

Generado por CommunityResilienceAgent - Praevisio AI
`;
    res.json({
      success: true,
      report: reportContent,
      data: analysis,
      timestamp: new Date().toISOString()
    });
  } catch (error) {
    console.error('[CommunityResilience Report] Error:', error.message);
    res.status(500).json({
      error: 'Internal server error'
    });
  }
});
var _default = exports.default = router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZXhwcmVzcyIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX2FnZW50cyIsImUiLCJfX2VzTW9kdWxlIiwiZGVmYXVsdCIsInJvdXRlciIsImV4cHJlc3MiLCJSb3V0ZXIiLCJnZXQiLCJyZXEiLCJyZXMiLCJjb3VudHJpZXMiLCJkYXlzIiwicXVlcnkiLCJjb3VudHJpZXNBcnJheSIsInNwbGl0IiwibWFwIiwiYyIsInRyaW0iLCJ0b1VwcGVyQ2FzZSIsImFnZW50IiwiTWV0YXRyb25BZ2VudCIsInJlc3VsdCIsInJ1biIsInBhcnNlSW50IiwianNvbiIsInN1Y2Nlc3MiLCJkYXRhIiwidGltZXN0YW1wIiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwiZXJyb3IiLCJjb25zb2xlIiwibWVzc2FnZSIsInN0YXR1cyIsImFuYWx5c2lzIiwicmVwb3J0Q29udGVudCIsIk9iamVjdCIsImVudHJpZXMiLCJyZXNpbGllbmNlQW5hbHlzaXMiLCJjb3VudHJ5Iiwic29jaWFsRXZlbnRzIiwicmVzaWxpZW5jZVNjb3JlIiwidG9GaXhlZCIsInJlY29tbWVuZGF0aW9ucyIsImpvaW4iLCJwZXJpb2QiLCJzdGFydERhdGUiLCJlbmREYXRlIiwiZ2xvYmFsUmVzaWxpZW5jZUFzc2Vzc21lbnQiLCJhdmVyYWdlUmVzaWxpZW5jZSIsImxvd1Jlc2lsaWVuY2VDb3VudHJpZXMiLCJhc3Nlc3NtZW50IiwiZ2xvYmFsUmVjb21tZW5kYXRpb25zIiwicmVwb3J0IiwiX2RlZmF1bHQiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiY29tbXVuaXR5LXJlc2lsaWVuY2UuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGV4cHJlc3MgZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgTWV0YXRyb25BZ2VudCBmcm9tICcuLi9hZ2VudHMuanMnO1xuXG5jb25zdCByb3V0ZXIgPSBleHByZXNzLlJvdXRlcigpO1xuXG4vLyBHRVQgL2FwaS9jb21tdW5pdHktcmVzaWxpZW5jZSAtIEdldCBjb21tdW5pdHkgcmVzaWxpZW5jZSBhbmFseXNpc1xucm91dGVyLmdldCgnLycsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHsgY291bnRyaWVzID0gJ0NPTCxQRVIsQVJHJywgZGF5cyA9IDMwIH0gPSByZXEucXVlcnk7XG4gICAgY29uc3QgY291bnRyaWVzQXJyYXkgPSBjb3VudHJpZXMuc3BsaXQoJywnKS5tYXAoYyA9PiBjLnRyaW0oKS50b1VwcGVyQ2FzZSgpKTtcblxuICAgIGNvbnN0IGFnZW50ID0gbmV3IE1ldGF0cm9uQWdlbnQoJ0NvbW11bml0eVJlc2lsaWVuY2VBZ2VudCcpO1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGFnZW50LnJ1bih7IGNvdW50cmllczogY291bnRyaWVzQXJyYXksIGRheXM6IHBhcnNlSW50KGRheXMpIH0pO1xuXG4gICAgcmVzLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGRhdGE6IHJlc3VsdCxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignW0NvbW11bml0eVJlc2lsaWVuY2VdIEVycm9yOicsIGVycm9yLm1lc3NhZ2UpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InIH0pO1xuICB9XG59KTtcblxuLy8gR0VUIC9hcGkvY29tbXVuaXR5LXJlc2lsaWVuY2UvcmVwb3J0IC0gR2VuZXJhdGUgYW5kIHJldHVybiByZXNpbGllbmNlIHJlcG9ydFxucm91dGVyLmdldCgnL3JlcG9ydCcsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHsgY291bnRyaWVzID0gJ0NPTCxQRVIsQVJHJywgZGF5cyA9IDMwIH0gPSByZXEucXVlcnk7XG4gICAgY29uc3QgY291bnRyaWVzQXJyYXkgPSBjb3VudHJpZXMuc3BsaXQoJywnKS5tYXAoYyA9PiBjLnRyaW0oKS50b1VwcGVyQ2FzZSgpKTtcblxuICAgIGNvbnN0IGFnZW50ID0gbmV3IE1ldGF0cm9uQWdlbnQoJ0NvbW11bml0eVJlc2lsaWVuY2VBZ2VudCcpO1xuICAgIGNvbnN0IGFuYWx5c2lzID0gYXdhaXQgYWdlbnQucnVuKHsgY291bnRyaWVzOiBjb3VudHJpZXNBcnJheSwgZGF5czogcGFyc2VJbnQoZGF5cykgfSk7XG5cbiAgICAvLyBHZW5lcmF0ZSByZXBvcnQgY29udGVudFxuICAgIGNvbnN0IHJlcG9ydENvbnRlbnQgPSBgIyBDT01NVU5JVFlfUkVTSUxJRU5DRV9SRVBPUlQubWRcblxuIyMgQW7DoWxpc2lzIGRlIFJlc2lsaWVuY2lhIENvbXVuaXRhcmlhIGVuIExBVEFNXG5cbiMjIyBUaW1lc3RhbXBcbiR7bmV3IERhdGUoKS50b0lTT1N0cmluZygpfVxuXG4jIyMgQW7DoWxpc2lzIHBvciBQYcOtc1xuJHtPYmplY3QuZW50cmllcyhhbmFseXNpcy5yZXNpbGllbmNlQW5hbHlzaXMpLm1hcCgoW2NvdW50cnksIGRhdGFdKSA9PiBgIyMjIyAke2NvdW50cnl9XG4tIEV2ZW50b3MgU29jaWFsZXM6ICR7ZGF0YS5zb2NpYWxFdmVudHN9XG4tIFB1bnRhamUgZGUgUmVzaWxpZW5jaWE6ICR7ZGF0YS5yZXNpbGllbmNlU2NvcmUudG9GaXhlZCgxKX0vMTAwXG4tIFJlY29tZW5kYWNpb25lczogJHtkYXRhLnJlY29tbWVuZGF0aW9ucy5qb2luKCcsICcpfVxuLSBQZXLDrW9kbzogJHtkYXRhLnBlcmlvZC5zdGFydERhdGV9IGEgJHtkYXRhLnBlcmlvZC5lbmREYXRlfVxuYCkuam9pbignXFxuJyl9XG5cbiMjIyBFdmFsdWFjacOzbiBHbG9iYWxcbi0gUmVzaWxpZW5jaWEgUHJvbWVkaW86ICR7YW5hbHlzaXMuZ2xvYmFsUmVzaWxpZW5jZUFzc2Vzc21lbnQuYXZlcmFnZVJlc2lsaWVuY2UudG9GaXhlZCgxKX0vMTAwXG4tIFBhw61zZXMgY29uIEJhamEgUmVzaWxpZW5jaWE6ICR7YW5hbHlzaXMuZ2xvYmFsUmVzaWxpZW5jZUFzc2Vzc21lbnQubG93UmVzaWxpZW5jZUNvdW50cmllc31cbi0gRXZhbHVhY2nDs246ICR7YW5hbHlzaXMuZ2xvYmFsUmVzaWxpZW5jZUFzc2Vzc21lbnQuYXNzZXNzbWVudH1cbi0gUmVjb21lbmRhY2lvbmVzIEdsb2JhbGVzOiAke2FuYWx5c2lzLmdsb2JhbFJlc2lsaWVuY2VBc3Nlc3NtZW50Lmdsb2JhbFJlY29tbWVuZGF0aW9ucy5qb2luKCcsICcpfVxuXG5HZW5lcmFkbyBwb3IgQ29tbXVuaXR5UmVzaWxpZW5jZUFnZW50IC0gUHJhZXZpc2lvIEFJXG5gO1xuXG4gICAgcmVzLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIHJlcG9ydDogcmVwb3J0Q29udGVudCxcbiAgICAgIGRhdGE6IGFuYWx5c2lzLFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdbQ29tbXVuaXR5UmVzaWxpZW5jZSBSZXBvcnRdIEVycm9yOicsIGVycm9yLm1lc3NhZ2UpO1xuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InIH0pO1xuICB9XG59KTtcblxuZXhwb3J0IGRlZmF1bHQgcm91dGVyOyJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsSUFBQUEsUUFBQSxHQUFBQyxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUMsT0FBQSxHQUFBRixzQkFBQSxDQUFBQyxPQUFBO0FBQXlDLFNBQUFELHVCQUFBRyxDQUFBLFdBQUFBLENBQUEsSUFBQUEsQ0FBQSxDQUFBQyxVQUFBLEdBQUFELENBQUEsS0FBQUUsT0FBQSxFQUFBRixDQUFBO0FBRXpDLE1BQU1HLE1BQU0sR0FBR0MsZ0JBQU8sQ0FBQ0MsTUFBTSxDQUFDLENBQUM7O0FBRS9CO0FBQ0FGLE1BQU0s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