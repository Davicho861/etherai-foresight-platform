{"version":3,"names":["delay_exports","__export","MAX_SERVER_RESPONSE_TIME","MIN_SERVER_RESPONSE_TIME","NODE_SERVER_RESPONSE_TIME","SET_TIMEOUT_MAX_ALLOWED_INT","delay","module","exports","__toCommonJS","import_is_node_process","require","getRealisticResponseTime","isNodeProcess","Math","floor","random","durationOrMode","delayTime","Error","Promise","resolve","setTimeout"],"sources":["../../src/core/delay.ts"],"sourcesContent":["import { isNodeProcess } from 'is-node-process'\n\nexport const SET_TIMEOUT_MAX_ALLOWED_INT = 2147483647\nexport const MIN_SERVER_RESPONSE_TIME = 100\nexport const MAX_SERVER_RESPONSE_TIME = 400\nexport const NODE_SERVER_RESPONSE_TIME = 5\n\nfunction getRealisticResponseTime(): number {\n  if (isNodeProcess()) {\n    return NODE_SERVER_RESPONSE_TIME\n  }\n\n  return Math.floor(\n    Math.random() * (MAX_SERVER_RESPONSE_TIME - MIN_SERVER_RESPONSE_TIME) +\n      MIN_SERVER_RESPONSE_TIME,\n  )\n}\n\nexport type DelayMode = 'real' | 'infinite'\n\n/**\n * Delays the response by the given duration (ms).\n *\n * @example\n * await delay() // emulate realistic server response time\n * await delay(1200) // delay response by 1200ms\n * await delay('infinite') // delay response infinitely\n *\n * @see {@link https://mswjs.io/docs/api/delay `delay()` API reference}\n */\nexport async function delay(\n  durationOrMode?: DelayMode | number,\n): Promise<void> {\n  let delayTime: number\n\n  if (typeof durationOrMode === 'string') {\n    switch (durationOrMode) {\n      case 'infinite': {\n        // Using `Infinity` as a delay value executes the response timeout immediately.\n        // Instead, use the maximum allowed integer for `setTimeout`.\n        delayTime = SET_TIMEOUT_MAX_ALLOWED_INT\n        break\n      }\n      case 'real': {\n        delayTime = getRealisticResponseTime()\n        break\n      }\n      default: {\n        throw new Error(\n          `Failed to delay a response: unknown delay mode \"${durationOrMode}\". Please make sure you provide one of the supported modes (\"real\", \"infinite\") or a number.`,\n        )\n      }\n    }\n  } else if (typeof durationOrMode === 'undefined') {\n    // Use random realistic server response time when no explicit delay duration was provided.\n    delayTime = getRealisticResponseTime()\n  } else {\n    // Guard against passing values like `Infinity` or `Number.MAX_VALUE`\n    // as the response delay duration. They don't produce the result you may expect.\n    if (durationOrMode > SET_TIMEOUT_MAX_ALLOWED_INT) {\n      throw new Error(\n        `Failed to delay a response: provided delay duration (${durationOrMode}) exceeds the maximum allowed duration for \"setTimeout\" (${SET_TIMEOUT_MAX_ALLOWED_INT}). This will cause the response to be returned immediately. Please use a number within the allowed range to delay the response by exact duration, or consider the \"infinite\" delay mode to delay the response indefinitely.`,\n      )\n    }\n\n    delayTime = durationOrMode\n  }\n\n  return new Promise((resolve) => setTimeout(resolve, delayTime))\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAAA,aAAA;AAAAC,QAAA,CAAAD,aAAA;EAAAE,wBAAA,EAAAA,CAAA,KAAAA,wBAAA;EAAAC,wBAAA,EAAAA,CAAA,KAAAA,wBAAA;EAAAC,yBAAA,EAAAA,CAAA,KAAAA,yBAAA;EAAAC,2BAAA,EAAAA,CAAA,KAAAA,2BAAA;EAAAC,KAAA,EAAAA,CAAA,KAAAA;AAAA;AAAAC,MAAA,CAAAC,OAAA,GAAAC,YAAA,CAAAT,aAAA;AAAA,IAAAU,sBAAA,GAA8BC,OAAA;AAEvB,MAAMN,2BAAA,GAA8B;AACpC,MAAMF,wBAAA,GAA2B;AACjC,MAAMD,wBAAA,GAA2B;AACjC,MAAME,yBAAA,GAA4B;AAEzC,SAASQ,yBAAA,EAAmC;EAC1C,QAAIF,sBAAA,CAAAG,aAAA,EAAc,GAAG;IACnB,OAAOT,yBAAA;EACT;EAEA,OAAOU,IAAA,CAAKC,KAAA,CACVD,IAAA,CAAKE,MAAA,CAAO,KAAKd,wBAAA,GAA2BC,wBAAA,IAC1CA,wBACJ;AACF;AAcA,eAAsBG,MACpBW,cAAA,EACe;EACf,IAAIC,SAAA;EAEJ,IAAI,OAAOD,cAAA,KAAmB,UAAU;IACtC,QAAQA,cAAA;MACN,KAAK;QAAY;UAGfC,SAAA,GAAYb,2BAAA;UACZ;QACF;MACA,KAAK;QAAQ;UACXa,SAAA,GAAYN,wBAAA,CAAyB;UACrC;QACF;MACA;QAAS;UACP,MAAM,IAAIO,KAAA,CACR,mDAAmDF,cAAc,8FACnE;QACF;IACF;EACF,WAAW,OAAOA,cAAA,KAAmB,aAAa;IAEhDC,SAAA,GAAYN,wBAAA,CAAyB;EACvC,OAAO;IAGL,IAAIK,cAAA,GAAiBZ,2BAAA,EAA6B;MAChD,MAAM,IAAIc,KAAA,CACR,wDAAwDF,cAAc,4DAA4DZ,2BAA2B,6NAC/J;IACF;IAEAa,SAAA,GAAYD,cAAA;EACd;EAEA,OAAO,IAAIG,OAAA,CAASC,OAAA,IAAYC,UAAA,CAAWD,OAAA,EAASH,SAAS,CAAC;AAChE","ignoreList":[]}