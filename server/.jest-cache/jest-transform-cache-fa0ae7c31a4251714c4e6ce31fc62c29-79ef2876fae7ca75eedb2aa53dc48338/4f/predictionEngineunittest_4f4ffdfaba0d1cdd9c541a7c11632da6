d408d8482915897d76fe3b289c43340a
process.env.FORCE_MOCKS = 'true';
process.env.NODE_ENV = 'test';
const cache = require('../../src/cache.js');
const {
  runProphecyCycle,
  getRiskIndices
} = require('../../src/services/predictionEngine.js');
describe('predictionEngine - runProphecyCycle with FORCE_MOCKS', () => {
  beforeEach(() => {
    jest.resetModules();
    // clear the cache singleton
    cache.default.clear();
  });
  test('updates famine, geophysical, supply chain, climate indices and ethical assessment', async () => {
    process.env.FORCE_MOCKS = 'true';
    const before = getRiskIndices();
    expect(before.multiDomainRiskIndex.value).toBeNull();
    await runProphecyCycle();
    const after = getRiskIndices();
    expect(after.multiDomainRiskIndex.value).not.toBeNull();
    expect(after.riskIndices.famineRisk.value).not.toBeNull();
    expect(after.riskIndices.geophysicalRisk.value).not.toBeNull();
    expect(after.riskIndices.supplyChainRisk.value).not.toBeNull();
    expect(after.riskIndices.climateExtremesRisk.value).not.toBeNull();
    expect(after.ethicalAssessment).toBeDefined();
    expect(after.lastUpdated).toBeDefined();
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJwcm9jZXNzIiwiZW52IiwiRk9SQ0VfTU9DS1MiLCJOT0RFX0VOViIsImNhY2hlIiwicmVxdWlyZSIsInJ1blByb3BoZWN5Q3ljbGUiLCJnZXRSaXNrSW5kaWNlcyIsImRlc2NyaWJlIiwiYmVmb3JlRWFjaCIsImplc3QiLCJyZXNldE1vZHVsZXMiLCJkZWZhdWx0IiwiY2xlYXIiLCJ0ZXN0IiwiYmVmb3JlIiwiZXhwZWN0IiwibXVsdGlEb21haW5SaXNrSW5kZXgiLCJ2YWx1ZSIsInRvQmVOdWxsIiwiYWZ0ZXIiLCJub3QiLCJyaXNrSW5kaWNlcyIsImZhbWluZVJpc2siLCJnZW9waHlzaWNhbFJpc2siLCJzdXBwbHlDaGFpblJpc2siLCJjbGltYXRlRXh0cmVtZXNSaXNrIiwiZXRoaWNhbEFzc2Vzc21lbnQiLCJ0b0JlRGVmaW5lZCIsImxhc3RVcGRhdGVkIl0sInNvdXJjZXMiOlsicHJlZGljdGlvbkVuZ2luZS51bml0LnRlc3QuanMiXSwic291cmNlc0NvbnRlbnQiOlsicHJvY2Vzcy5lbnYuRk9SQ0VfTU9DS1MgPSAndHJ1ZSc7XG5wcm9jZXNzLmVudi5OT0RFX0VOViA9ICd0ZXN0JztcblxuY29uc3QgY2FjaGUgPSByZXF1aXJlKCcuLi8uLi9zcmMvY2FjaGUuanMnKTtcblxuY29uc3QgeyBydW5Qcm9waGVjeUN5Y2xlLCBnZXRSaXNrSW5kaWNlcyB9ID0gcmVxdWlyZSgnLi4vLi4vc3JjL3NlcnZpY2VzL3ByZWRpY3Rpb25FbmdpbmUuanMnKTtcblxuZGVzY3JpYmUoJ3ByZWRpY3Rpb25FbmdpbmUgLSBydW5Qcm9waGVjeUN5Y2xlIHdpdGggRk9SQ0VfTU9DS1MnLCAoKSA9PiB7XG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGplc3QucmVzZXRNb2R1bGVzKCk7XG4gICAgLy8gY2xlYXIgdGhlIGNhY2hlIHNpbmdsZXRvblxuICAgIGNhY2hlLmRlZmF1bHQuY2xlYXIoKTtcbiAgfSk7XG5cbiAgdGVzdCgndXBkYXRlcyBmYW1pbmUsIGdlb3BoeXNpY2FsLCBzdXBwbHkgY2hhaW4sIGNsaW1hdGUgaW5kaWNlcyBhbmQgZXRoaWNhbCBhc3Nlc3NtZW50JywgYXN5bmMgKCkgPT4ge1xuICAgIHByb2Nlc3MuZW52LkZPUkNFX01PQ0tTID0gJ3RydWUnO1xuICAgIGNvbnN0IGJlZm9yZSA9IGdldFJpc2tJbmRpY2VzKCk7XG4gICAgZXhwZWN0KGJlZm9yZS5tdWx0aURvbWFpblJpc2tJbmRleC52YWx1ZSkudG9CZU51bGwoKTtcblxuICAgIGF3YWl0IHJ1blByb3BoZWN5Q3ljbGUoKTtcblxuICAgIGNvbnN0IGFmdGVyID0gZ2V0Umlza0luZGljZXMoKTtcbiAgICBleHBlY3QoYWZ0ZXIubXVsdGlEb21haW5SaXNrSW5kZXgudmFsdWUpLm5vdC50b0JlTnVsbCgpO1xuICAgIGV4cGVjdChhZnRlci5yaXNrSW5kaWNlcy5mYW1pbmVSaXNrLnZhbHVlKS5ub3QudG9CZU51bGwoKTtcbiAgICBleHBlY3QoYWZ0ZXIucmlza0luZGljZXMuZ2VvcGh5c2ljYWxSaXNrLnZhbHVlKS5ub3QudG9CZU51bGwoKTtcbiAgICBleHBlY3QoYWZ0ZXIucmlza0luZGljZXMuc3VwcGx5Q2hhaW5SaXNrLnZhbHVlKS5ub3QudG9CZU51bGwoKTtcbiAgICBleHBlY3QoYWZ0ZXIucmlza0luZGljZXMuY2xpbWF0ZUV4dHJlbWVzUmlzay52YWx1ZSkubm90LnRvQmVOdWxsKCk7XG4gICAgZXhwZWN0KGFmdGVyLmV0aGljYWxBc3Nlc3NtZW50KS50b0JlRGVmaW5lZCgpO1xuICAgIGV4cGVjdChhZnRlci5sYXN0VXBkYXRlZCkudG9CZURlZmluZWQoKTtcbiAgfSk7XG59KTtcbiJdLCJtYXBwaW5ncyI6IkFBQUFBLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDQyxXQUFXLEdBQUcsTUFBTTtBQUNoQ0YsT0FBTyxDQUFDQyxHQUFHLENBQUNFLFFBQVEsR0FBRyxNQUFNO0FBRTdCLE1BQU1DLEtBQUssR0FBR0MsT0FBTyxDQUFDLG9CQUFvQixDQUFDO0FBRTNDLE1BQU07RUFBRUMsZ0JBQWdCO0VBQUVDO0FBQWUsQ0FBQyxHQUFHRixPQUFPLENBQUMsd0NBQXdDLENBQUM7QUFFOUZHLFFBQVEsQ0FBQyxzREFBc0QsRUFBRSxNQUFNO0VBQ3JFQyxVQUFVLENBQUMsTUFBTTtJQUNmQyxJQUFJLENBQUNDLFlBQVksQ0FBQyxDQUFDO0lBQ25CO0lBQ0FQLEtBQUssQ0FBQ1EsT0FBTyxDQUFDQyxLQUFLLENBQUMsQ0FBQztFQUN2QixDQUFDLENBQUM7RUFFRkMsSUFBSSxDQUFDLG1GQUFtRixFQUFFLFlBQVk7SUFDcEdkLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDQyxXQUFXLEdBQUcsTUFBTTtJQUNoQyxNQUFNYSxNQUFNLEdBQUdSLGNBQWMsQ0FBQyxDQUFDO0lBQy9CUyxNQUFNLENBQUNELE1BQU0sQ0FBQ0Usb0JBQW9CLENBQUNDLEtBQUssQ0FBQyxDQUFDQyxRQUFRLENBQUMsQ0FBQztJQUVwRCxNQUFNYixnQkFBZ0IsQ0FBQyxDQUFDO0lBRXhCLE1BQU1jLEtBQUssR0FBR2IsY0FBYyxDQUFDLENBQUM7SUFDOUJTLE1BQU0sQ0FBQ0ksS0FBSyxDQUFDSCxvQkFBb0IsQ0FBQ0MsS0FBSyxDQUFDLENBQUNHLEdBQUcsQ0FBQ0YsUUFBUSxDQUFDLENBQUM7SUFDdkRILE1BQU0sQ0FBQ0ksS0FBSyxDQUFDRSxXQUFXLENBQUNDLFVBQVUsQ0FBQ0wsS0FBSyxDQUFDLENBQUNHLEdBQUcsQ0FBQ0YsUUFBUSxDQUFDLENBQUM7SUFDekRILE1BQU0sQ0FBQ0ksS0FBSyxDQUFDRSxXQUFXLENBQUNFLGVBQWUsQ0FBQ04sS0FBSyxDQUFDLENBQUNHLEdBQUcsQ0FBQ0YsUUFBUSxDQUFDLENBQUM7SUFDOURILE1BQU0sQ0FBQ0ksS0FBSyxDQUFDRSxXQUFXLENBQUNHLGVBQWUsQ0FBQ1AsS0FBSyxDQUFDLENBQUNHLEdBQUcsQ0FBQ0YsUUFBUSxDQUFDLENBQUM7SUFDOURILE1BQU0sQ0FBQ0ksS0FBSyxDQUFDRSxXQUFXLENBQUNJLG1CQUFtQixDQUFDUixLQUFLLENBQUMsQ0FBQ0csR0FBRyxDQUFDRixRQUFRLENBQUMsQ0FBQztJQUNsRUgsTUFBTSxDQUFDSSxLQUFLLENBQUNPLGlCQUFpQixDQUFDLENBQUNDLFdBQVcsQ0FBQyxDQUFDO0lBQzdDWixNQUFNLENBQUNJLEtBQUssQ0FBQ1MsV0FBVyxDQUFDLENBQUNELFdBQVcsQ0FBQyxDQUFDO0VBQ3pDLENBQUMsQ0FBQztBQUNKLENBQUMsQ0FBQyIsImlnbm9yZUxpc3QiOltdfQ==