ce853363b67fc4d324c4942ed5fd72db
"use strict";

_getJestObj().mock('../../src/agents.js', () => ({
  default: jest.fn().mockImplementation(type => ({
    run: jest.fn()
  }))
}));
function _getJestObj() {
  const {
    jest
  } = require("@jest/globals");
  _getJestObj = () => jest;
  return jest;
}
describe('communityResilienceService.getCommunityResilienceIndex', () => {
  afterEach(() => {
    jest.resetModules();
  });
  test('returns data from MetatronAgent successfully', async () => {
    const mockData = {
      timestamp: '2025-10-11T19:00:00.000Z',
      resilienceAnalysis: {
        COL: {
          socialEvents: 5,
          resilienceScore: 65,
          recommendations: ['Community programs']
        },
        PER: {
          socialEvents: 3,
          resilienceScore: 70,
          recommendations: ['Education initiatives']
        }
      },
      globalResilienceAssessment: {
        averageResilience: 67.5,
        lowResilienceCountries: [],
        assessment: 'Good community resilience',
        globalRecommendations: ['Continue monitoring']
      }
    };
    const {
      default: MetatronAgent
    } = require('../../src/agents.js');
    MetatronAgent.mockImplementation(type => ({
      run: jest.fn().mockResolvedValue(mockData)
    }));
    const svc = require('../../src/services/communityResilienceService.js');
    const result = await svc.getCommunityResilienceIndex(['COL', 'PER'], 30);
    expect(result).toHaveProperty('timestamp');
    expect(result).toHaveProperty('resilienceAnalysis');
    expect(result).toHaveProperty('globalResilienceAssessment');
    expect(result.source).toBe('Mock data - Agent unavailable');
  });
  test('falls back to mock data when agent fails', async () => {
    const agentsMockPath = require.resolve('../../src/agents.js');
    jest.doMock(agentsMockPath, () => ({
      MetatronAgent: jest.fn().mockImplementation(() => ({
        run: jest.fn().mockRejectedValue(new Error('Agent failure'))
      }))
    }));
    const svc = require('../../src/services/communityResilienceService.js');
    const result = await svc.getCommunityResilienceIndex(['COL', 'PER'], 30);
    expect(result).toHaveProperty('timestamp');
    expect(result).toHaveProperty('resilienceAnalysis');
    expect(result.resilienceAnalysis).toHaveProperty('COL');
    expect(result.resilienceAnalysis).toHaveProperty('PER');
    expect(result.globalResilienceAssessment).toHaveProperty('averageResilience');
    expect(result.source).toBe('Mock data - Agent unavailable');
  });
  test('uses default countries and days when not provided', async () => {
    const mockData = {
      timestamp: '2025-10-11T19:00:00.000Z',
      resilienceAnalysis: {},
      globalResilienceAssessment: {
        averageResilience: 0
      }
    };
    const agentsMockPath = require.resolve('../../src/agents.js');
    jest.doMock(agentsMockPath, () => ({
      MetatronAgent: jest.fn().mockImplementation(() => ({
        run: jest.fn().mockResolvedValue(mockData)
      }))
    }));
    const svc = require('../../src/services/communityResilienceService.js');
    await svc.getCommunityResilienceIndex();

    // Test passes if no error is thrown
    expect(true).toBe(true);
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZ2V0SmVzdE9iaiIsIm1vY2siLCJkZWZhdWx0IiwiamVzdCIsImZuIiwibW9ja0ltcGxlbWVudGF0aW9uIiwidHlwZSIsInJ1biIsInJlcXVpcmUiLCJkZXNjcmliZSIsImFmdGVyRWFjaCIsInJlc2V0TW9kdWxlcyIsInRlc3QiLCJtb2NrRGF0YSIsInRpbWVzdGFtcCIsInJlc2lsaWVuY2VBbmFseXNpcyIsIkNPTCIsInNvY2lhbEV2ZW50cyIsInJlc2lsaWVuY2VTY29yZSIsInJlY29tbWVuZGF0aW9ucyIsIlBFUiIsImdsb2JhbFJlc2lsaWVuY2VBc3Nlc3NtZW50IiwiYXZlcmFnZVJlc2lsaWVuY2UiLCJsb3dSZXNpbGllbmNlQ291bnRyaWVzIiwiYXNzZXNzbWVudCIsImdsb2JhbFJlY29tbWVuZGF0aW9ucyIsIk1ldGF0cm9uQWdlbnQiLCJtb2NrUmVzb2x2ZWRWYWx1ZSIsInN2YyIsInJlc3VsdCIsImdldENvbW11bml0eVJlc2lsaWVuY2VJbmRleCIsImV4cGVjdCIsInRvSGF2ZVByb3BlcnR5Iiwic291cmNlIiwidG9CZSIsImFnZW50c01vY2tQYXRoIiwicmVzb2x2ZSIsImRvTW9jayIsIm1vY2tSZWplY3RlZFZhbHVlIiwiRXJyb3IiXSwic291cmNlcyI6WyJjb21tdW5pdHlSZXNpbGllbmNlU2VydmljZS50ZXN0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImplc3QubW9jaygnLi4vLi4vc3JjL2FnZW50cy5qcycsICgpID0+ICh7XG4gIGRlZmF1bHQ6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKHR5cGUpID0+ICh7XG4gICAgcnVuOiBqZXN0LmZuKClcbiAgfSkpXG59KSlcblxuZGVzY3JpYmUoJ2NvbW11bml0eVJlc2lsaWVuY2VTZXJ2aWNlLmdldENvbW11bml0eVJlc2lsaWVuY2VJbmRleCcsICgpID0+IHtcbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBqZXN0LnJlc2V0TW9kdWxlcygpXG4gIH0pXG5cbiAgdGVzdCgncmV0dXJucyBkYXRhIGZyb20gTWV0YXRyb25BZ2VudCBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgbW9ja0RhdGEgPSB7XG4gICAgICB0aW1lc3RhbXA6ICcyMDI1LTEwLTExVDE5OjAwOjAwLjAwMFonLFxuICAgICAgcmVzaWxpZW5jZUFuYWx5c2lzOiB7XG4gICAgICAgIENPTDogeyBzb2NpYWxFdmVudHM6IDUsIHJlc2lsaWVuY2VTY29yZTogNjUsIHJlY29tbWVuZGF0aW9uczogWydDb21tdW5pdHkgcHJvZ3JhbXMnXSB9LFxuICAgICAgICBQRVI6IHsgc29jaWFsRXZlbnRzOiAzLCByZXNpbGllbmNlU2NvcmU6IDcwLCByZWNvbW1lbmRhdGlvbnM6IFsnRWR1Y2F0aW9uIGluaXRpYXRpdmVzJ10gfVxuICAgICAgfSxcbiAgICAgIGdsb2JhbFJlc2lsaWVuY2VBc3Nlc3NtZW50OiB7XG4gICAgICAgIGF2ZXJhZ2VSZXNpbGllbmNlOiA2Ny41LFxuICAgICAgICBsb3dSZXNpbGllbmNlQ291bnRyaWVzOiBbXSxcbiAgICAgICAgYXNzZXNzbWVudDogJ0dvb2QgY29tbXVuaXR5IHJlc2lsaWVuY2UnLFxuICAgICAgICBnbG9iYWxSZWNvbW1lbmRhdGlvbnM6IFsnQ29udGludWUgbW9uaXRvcmluZyddXG4gICAgICB9XG4gICAgfTtcblxuICAgIGNvbnN0IHsgZGVmYXVsdDogTWV0YXRyb25BZ2VudCB9ID0gcmVxdWlyZSgnLi4vLi4vc3JjL2FnZW50cy5qcycpXG4gICAgTWV0YXRyb25BZ2VudC5tb2NrSW1wbGVtZW50YXRpb24oKHR5cGUpID0+ICh7XG4gICAgICBydW46IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrRGF0YSlcbiAgICB9KSlcblxuICAgIGNvbnN0IHN2YyA9IHJlcXVpcmUoJy4uLy4uL3NyYy9zZXJ2aWNlcy9jb21tdW5pdHlSZXNpbGllbmNlU2VydmljZS5qcycpXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc3ZjLmdldENvbW11bml0eVJlc2lsaWVuY2VJbmRleChbJ0NPTCcsICdQRVInXSwgMzApXG5cbiAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgndGltZXN0YW1wJylcbiAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgncmVzaWxpZW5jZUFuYWx5c2lzJylcbiAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgnZ2xvYmFsUmVzaWxpZW5jZUFzc2Vzc21lbnQnKVxuICAgIGV4cGVjdChyZXN1bHQuc291cmNlKS50b0JlKCdNb2NrIGRhdGEgLSBBZ2VudCB1bmF2YWlsYWJsZScpXG4gIH0pXG5cbiAgdGVzdCgnZmFsbHMgYmFjayB0byBtb2NrIGRhdGEgd2hlbiBhZ2VudCBmYWlscycsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBhZ2VudHNNb2NrUGF0aCA9IHJlcXVpcmUucmVzb2x2ZSgnLi4vLi4vc3JjL2FnZW50cy5qcycpXG4gICAgamVzdC5kb01vY2soYWdlbnRzTW9ja1BhdGgsICgpID0+ICh7XG4gICAgICBNZXRhdHJvbkFnZW50OiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XG4gICAgICAgIHJ1bjogamVzdC5mbigpLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignQWdlbnQgZmFpbHVyZScpKVxuICAgICAgfSkpXG4gICAgfSkpXG5cbiAgICBjb25zdCBzdmMgPSByZXF1aXJlKCcuLi8uLi9zcmMvc2VydmljZXMvY29tbXVuaXR5UmVzaWxpZW5jZVNlcnZpY2UuanMnKVxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHN2Yy5nZXRDb21tdW5pdHlSZXNpbGllbmNlSW5kZXgoWydDT0wnLCAnUEVSJ10sIDMwKVxuXG4gICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlUHJvcGVydHkoJ3RpbWVzdGFtcCcpXG4gICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlUHJvcGVydHkoJ3Jlc2lsaWVuY2VBbmFseXNpcycpXG4gICAgZXhwZWN0KHJlc3VsdC5yZXNpbGllbmNlQW5hbHlzaXMpLnRvSGF2ZVByb3BlcnR5KCdDT0wnKVxuICAgIGV4cGVjdChyZXN1bHQucmVzaWxpZW5jZUFuYWx5c2lzKS50b0hhdmVQcm9wZXJ0eSgnUEVSJylcbiAgICBleHBlY3QocmVzdWx0Lmdsb2JhbFJlc2lsaWVuY2VBc3Nlc3NtZW50KS50b0hhdmVQcm9wZXJ0eSgnYXZlcmFnZVJlc2lsaWVuY2UnKVxuICAgIGV4cGVjdChyZXN1bHQuc291cmNlKS50b0JlKCdNb2NrIGRhdGEgLSBBZ2VudCB1bmF2YWlsYWJsZScpXG4gIH0pXG5cbiAgdGVzdCgndXNlcyBkZWZhdWx0IGNvdW50cmllcyBhbmQgZGF5cyB3aGVuIG5vdCBwcm92aWRlZCcsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBtb2NrRGF0YSA9IHtcbiAgICAgIHRpbWVzdGFtcDogJzIwMjUtMTAtMTFUMTk6MDA6MDAuMDAwWicsXG4gICAgICByZXNpbGllbmNlQW5hbHlzaXM6IHt9LFxuICAgICAgZ2xvYmFsUmVzaWxpZW5jZUFzc2Vzc21lbnQ6IHsgYXZlcmFnZVJlc2lsaWVuY2U6IDAgfVxuICAgIH07XG5cbiAgICBjb25zdCBhZ2VudHNNb2NrUGF0aCA9IHJlcXVpcmUucmVzb2x2ZSgnLi4vLi4vc3JjL2FnZW50cy5qcycpXG4gICAgamVzdC5kb01vY2soYWdlbnRzTW9ja1BhdGgsICgpID0+ICh7XG4gICAgICBNZXRhdHJvbkFnZW50OiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XG4gICAgICAgIHJ1bjogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tEYXRhKVxuICAgICAgfSkpXG4gICAgfSkpXG5cbiAgICBjb25zdCBzdmMgPSByZXF1aXJlKCcuLi8uLi9zcmMvc2VydmljZXMvY29tbXVuaXR5UmVzaWxpZW5jZVNlcnZpY2UuanMnKVxuICAgIGF3YWl0IHN2Yy5nZXRDb21tdW5pdHlSZXNpbGllbmNlSW5kZXgoKVxuXG4gICAgLy8gVGVzdCBwYXNzZXMgaWYgbm8gZXJyb3IgaXMgdGhyb3du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