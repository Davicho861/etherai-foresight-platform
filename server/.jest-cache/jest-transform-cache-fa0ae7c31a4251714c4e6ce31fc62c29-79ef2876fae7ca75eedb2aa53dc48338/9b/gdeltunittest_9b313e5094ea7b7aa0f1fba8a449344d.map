{"version":3,"names":["express","require","request","describe","beforeEach","jest","resetModules","process","env","NODE_ENV","afterEach","FORCE_MOCKS","clearAllMocks","test","gdeltRouter","default","app","use","res","get","expect","status","toBe","body","toHaveProperty","mockData","country","period","start","end","eventCount","socialIntensity","articles","title","url","isMock","doMock","fn","mockImplementation","getSocialEvents","mockResolvedValue","query","startDate","endDate","toMatchObject","Array","isArray"],"sources":["gdelt.unit.test.js"],"sourcesContent":["const express = require('express')\nconst request = require('supertest')\n\ndescribe('routes/gdelt.js - router', () => {\n  beforeEach(() => {\n    jest.resetModules()\n    process.env.NODE_ENV = 'test'\n  })\n\n  afterEach(() => {\n    delete process.env.FORCE_MOCKS\n    delete process.env.NODE_ENV\n    jest.clearAllMocks()\n  })\n\n  test('GET /api/gdelt/events returns 400 when missing params', async () => {\n    // No need to mock integration for validation failure\n    const gdeltRouter = require('../../src/routes/gdelt.js').default || require('../../src/routes/gdelt.js')\n    const app = express()\n    app.use('/api/gdelt', gdeltRouter)\n\n    const res = await request(app).get('/api/gdelt/events')\n    expect(res.status).toBe(400)\n    expect(res.body).toHaveProperty('error')\n  })\n\n  test('GET /api/gdelt/events returns data from GdeltIntegration', async () => {\n    const mockData = {\n      country: 'COL',\n      period: { start: '2025-01-01', end: '2025-01-02' },\n      eventCount: 2,\n      socialIntensity: 3.5,\n      articles: [{ title: 'A', url: 'u1' }, { title: 'B', url: 'u2' }],\n      isMock: true\n    }\n\n    // Mock the integration before importing the router\n    jest.doMock('../../src/integrations/GdeltIntegration.js', () => {\n      return jest.fn().mockImplementation(() => ({\n        getSocialEvents: jest.fn().mockResolvedValue(mockData)\n      }))\n    })\n\n    const gdeltRouter = require('../../src/routes/gdelt.js').default || require('../../src/routes/gdelt.js')\n    const app = express()\n    app.use('/api/gdelt', gdeltRouter)\n\n    const res = await request(app)\n      .get('/api/gdelt/events')\n      .query({ country: 'COL', startDate: '2025-01-01', endDate: '2025-01-02' })\n\n    expect(res.status).toBe(200)\n    expect(res.body).toMatchObject({ country: 'COL' })\n    expect(res.body).toHaveProperty('articles')\n    expect(Array.isArray(res.body.articles)).toBe(true)\n  })\n})\n"],"mappings":"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","ignoreList":[]}