fd093fc79e6d0bbf241f3faf327221a4
"use strict";

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all) __defProp(target, name, {
    get: all[name],
    enumerable: true
  });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from)) if (!__hasOwnProp.call(to, key) && key !== except) __defProp(to, key, {
      get: () => from[key],
      enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable
    });
  }
  return to;
};
var __toCommonJS = mod => __copyProps(__defProp({}, "__esModule", {
  value: true
}), mod);
var HttpHandler_exports = {};
__export(HttpHandler_exports, {
  HttpHandler: () => HttpHandler,
  HttpMethods: () => HttpMethods
});
module.exports = __toCommonJS(HttpHandler_exports);
var import_devUtils = require("../utils/internal/devUtils");
var import_isStringEqual = require("../utils/internal/isStringEqual");
var import_getStatusCodeColor = require("../utils/logging/getStatusCodeColor");
var import_getTimestamp = require("../utils/logging/getTimestamp");
var import_serializeRequest = require("../utils/logging/serializeRequest");
var import_serializeResponse = require("../utils/logging/serializeResponse");
var import_matchRequestUrl = require("../utils/matching/matchRequestUrl");
var import_toPublicUrl = require("../utils/request/toPublicUrl");
var import_getRequestCookies = require("../utils/request/getRequestCookies");
var import_cleanUrl = require("../utils/url/cleanUrl");
var import_RequestHandler = require("./RequestHandler");
var HttpMethods = /* @__PURE__ */(HttpMethods2 => {
  HttpMethods2["HEAD"] = "HEAD";
  HttpMethods2["GET"] = "GET";
  HttpMethods2["POST"] = "POST";
  HttpMethods2["PUT"] = "PUT";
  HttpMethods2["PATCH"] = "PATCH";
  HttpMethods2["OPTIONS"] = "OPTIONS";
  HttpMethods2["DELETE"] = "DELETE";
  return HttpMethods2;
})(HttpMethods || {});
class HttpHandler extends import_RequestHandler.RequestHandler {
  constructor(method, predicate, resolver, options) {
    const displayPath = typeof predicate === "function" ? "[custom predicate]" : predicate;
    super({
      info: {
        header: `${method}${displayPath ? ` ${displayPath}` : ""}`,
        path: predicate,
        method
      },
      resolver,
      options
    });
    this.checkRedundantQueryParameters();
  }
  checkRedundantQueryParameters() {
    const {
      method,
      path
    } = this.info;
    if (!path || path instanceof RegExp || typeof path === "function") {
      return;
    }
    const url = (0, import_cleanUrl.cleanUrl)(path);
    if (url === path) {
      return;
    }
    import_devUtils.devUtils.warn(`Found a redundant usage of query parameters in the request handler URL for "${method} ${path}". Please match against a path instead and access query parameters using "new URL(request.url).searchParams" instead. Learn more: https://mswjs.io/docs/http/intercepting-requests#querysearch-parameters`);
  }
  async parse(args) {
    const url = new URL(args.request.url);
    const cookies = (0, import_getRequestCookies.getAllRequestCookies)(args.request);
    if (typeof this.info.path === "function") {
      const customPredicateResult = await this.info.path({
        request: args.request,
        cookies
      });
      const match2 = typeof customPredicateResult === "boolean" ? {
        matches: customPredicateResult,
        params: {}
      } : customPredicateResult;
      return {
        match: match2,
        cookies
      };
    }
    const match = this.info.path ? (0, import_matchRequestUrl.matchRequestUrl)(url, this.info.path, args.resolutionContext?.baseUrl) : {
      matches: false,
      params: {}
    };
    return {
      match,
      cookies
    };
  }
  async predicate(args) {
    const hasMatchingMethod = this.matchMethod(args.request.method);
    const hasMatchingUrl = args.parsedResult.match.matches;
    return hasMatchingMethod && hasMatchingUrl;
  }
  matchMethod(actualMethod) {
    return this.info.method instanceof RegExp ? this.info.method.test(actualMethod) : (0, import_isStringEqual.isStringEqual)(this.info.method, actualMethod);
  }
  extendResolverArgs(args) {
    return {
      params: args.parsedResult.match?.params || {},
      cookies: args.parsedResult.cookies
    };
  }
  async log(args) {
    const publicUrl = (0, import_toPublicUrl.toPublicUrl)(args.request.url);
    const loggedRequest = await (0, import_serializeRequest.serializeRequest)(args.request);
    const loggedResponse = await (0, import_serializeResponse.serializeResponse)(args.response);
    const statusColor = (0, import_getStatusCodeColor.getStatusCodeColor)(loggedResponse.status);
    console.groupCollapsed(import_devUtils.devUtils.formatMessage(`${(0, import_getTimestamp.getTimestamp)()} ${args.request.method} ${publicUrl} (%c${loggedResponse.status} ${loggedResponse.statusText}%c)`), `color:${statusColor}`, "color:inherit");
    console.log("Request", loggedRequest);
    console.log("Handler:", this);
    console.log("Response", loggedResponse);
    console.groupEnd();
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJIdHRwSGFuZGxlcl9leHBvcnRzIiwiX19leHBvcnQiLCJIdHRwSGFuZGxlciIsIkh0dHBNZXRob2RzIiwibW9kdWxlIiwiZXhwb3J0cyIsIl9fdG9Db21tb25KUyIsImltcG9ydF9kZXZVdGlscyIsInJlcXVpcmUiLCJpbXBvcnRfaXNTdHJpbmdFcXVhbCIsImltcG9ydF9nZXRTdGF0dXNDb2RlQ29sb3IiLCJpbXBvcnRfZ2V0VGltZXN0YW1wIiwiaW1wb3J0X3NlcmlhbGl6ZVJlcXVlc3QiLCJpbXBvcnRfc2VyaWFsaXplUmVzcG9uc2UiLCJpbXBvcnRfbWF0Y2hSZXF1ZXN0VXJsIiwiaW1wb3J0X3RvUHVibGljVXJsIiwiaW1wb3J0X2dldFJlcXVlc3RDb29raWVzIiwiaW1wb3J0X2NsZWFuVXJsIiwiaW1wb3J0X1JlcXVlc3RIYW5kbGVyIiwiSHR0cE1ldGhvZHMyIiwiUmVxdWVzdEhhbmRsZXIiLCJjb25zdHJ1Y3RvciIsIm1ldGhvZCIsInByZWRpY2F0ZSIsInJlc29sdmVyIiwib3B0aW9ucyIsImRpc3BsYXlQYXRoIiwiaW5mbyIsImhlYWRlciIsInBhdGgiLCJjaGVja1JlZHVuZGFudFF1ZXJ5UGFyYW1ldGVycyIsIlJlZ0V4cCIsInVybCIsImNsZWFuVXJsIiwiZGV2VXRpbHMiLCJ3YXJuIiwicGFyc2UiLCJhcmdzIiwiVVJMIiwicmVxdWVzdCIsImNvb2tpZXMiLCJnZXRBbGxSZXF1ZXN0Q29va2llcyIsImN1c3RvbVByZWRpY2F0ZVJlc3VsdCIsIm1hdGNoMiIsIm1hdGNoZXMiLCJwYXJhbXMiLCJtYXRjaCIsIm1hdGNoUmVxdWVzdFVybCIsInJlc29sdXRpb25Db250ZXh0IiwiYmFzZVVybCIsImhhc01hdGNoaW5nTWV0aG9kIiwibWF0Y2hNZXRob2QiLCJoYXNNYXRjaGluZ1VybCIsInBhcnNlZFJlc3VsdCIsImFjdHVhbE1ldGhvZCIsInRlc3QiLCJpc1N0cmluZ0VxdWFsIiwiZXh0ZW5kUmVzb2x2ZXJBcmdzIiwibG9nIiwicHVibGljVXJsIiwidG9QdWJsaWNVcmwiLCJsb2dnZWRSZXF1ZXN0Iiwic2VyaWFsaXplUmVxdWVzdCIsImxvZ2dlZFJlc3BvbnNlIiwic2VyaWFsaXplUmVzcG9uc2UiLCJyZXNwb25zZSIsInN0YXR1c0NvbG9yIiwiZ2V0U3RhdHVzQ29kZUNvbG9yIiwic3RhdHVzIiwiY29uc29sZSIsImdyb3VwQ29sbGFwc2VkIiwiZm9ybWF0TWVzc2FnZSIsImdldFRpbWVzdGFtcCIsInN0YXR1c1RleHQiLCJncm91cEVuZCJdLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb3JlL2hhbmRsZXJzL0h0dHBIYW5kbGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJlc3BvbnNlUmVzb2x1dGlvbkNvbnRleHQgfSBmcm9tICcuLi91dGlscy9leGVjdXRlSGFuZGxlcnMnXG5pbXBvcnQgeyBkZXZVdGlscyB9IGZyb20gJy4uL3V0aWxzL2ludGVybmFsL2RldlV0aWxzJ1xuaW1wb3J0IHsgaXNTdHJpbmdFcXVhbCB9IGZyb20gJy4uL3V0aWxzL2ludGVybmFsL2lzU3RyaW5nRXF1YWwnXG5pbXBvcnQgeyBnZXRTdGF0dXNDb2RlQ29sb3IgfSBmcm9tICcuLi91dGlscy9sb2dnaW5nL2dldFN0YXR1c0NvZGVDb2xvcidcbmltcG9ydCB7IGdldFRpbWVzdGFtcCB9IGZyb20gJy4uL3V0aWxzL2xvZ2dpbmcvZ2V0VGltZXN0YW1wJ1xuaW1wb3J0IHsgc2VyaWFsaXplUmVxdWVzdCB9IGZyb20gJy4uL3V0aWxzL2xvZ2dpbmcvc2VyaWFsaXplUmVxdWVzdCdcbmltcG9ydCB7IHNlcmlhbGl6ZVJlc3BvbnNlIH0gZnJvbSAnLi4vdXRpbHMvbG9nZ2luZy9zZXJpYWxpemVSZXNwb25zZSdcbmltcG9ydCB7XG4gIG1hdGNoUmVxdWVzdFVybCxcbiAgTWF0Y2gsXG4gIFBhdGgsXG4gIFBhdGhQYXJhbXMsXG59IGZyb20gJy4uL3V0aWxzL21hdGNoaW5nL21hdGNoUmVxdWVzdFVybCdcbmltcG9ydCB7IHRvUHVibGljVXJsIH0gZnJvbSAnLi4vdXRpbHMvcmVxdWVzdC90b1B1YmxpY1VybCdcbmltcG9ydCB7IGdldEFsbFJlcXVlc3RDb29raWVzIH0gZnJvbSAnLi4vdXRpbHMvcmVxdWVzdC9nZXRSZXF1ZXN0Q29va2llcydcbmltcG9ydCB7IGNsZWFuVXJsIH0gZnJvbSAnLi4vdXRpbHMvdXJsL2NsZWFuVXJsJ1xuaW1wb3J0IHtcbiAgUmVxdWVzdEhhbmRsZXIsXG4gIFJlcXVlc3RIYW5kbGVyRGVmYXVsdEluZm8sXG4gIFJlcXVlc3RIYW5kbGVyT3B0aW9ucyxcbiAgUmVzcG9uc2VSZXNvbHZlcixcbn0gZnJvbSAnLi9SZXF1ZXN0SGFuZGxlcidcblxudHlwZSBIdHRwSGFuZGxlck1ldGhvZCA9IHN0cmluZyB8IFJlZ0V4cFxuXG5leHBvcnQgaW50ZXJmYWNlIEh0dHBIYW5kbGVySW5mbyBleHRlbmRzIFJlcXVlc3RIYW5kbGVyRGVmYXVsdEluZm8ge1xuICBtZXRob2Q6IEh0dHBIYW5kbGVyTWV0aG9kXG4gIHBhdGg6IEh0dHBSZXF1ZXN0UHJlZGljYXRlPFBhdGhQYXJhbXM+XG59XG5cbmV4cG9ydCBlbnVtIEh0dHBNZXRob2RzIHtcbiAgSEVBRCA9ICdIRUFEJyxcbiAgR0VUID0gJ0dFVCcsXG4gIFBPU1QgPSAnUE9TVCcsXG4gIFBVVCA9ICdQVVQnLFxuICBQQVRDSCA9ICdQQVRDSCcsXG4gIE9QVElPTlMgPSAnT1BUSU9OUycsXG4gIERFTEVURSA9ICdERUxFVEUnLFxufVxuXG5leHBvcnQgdHlwZSBSZXF1ZXN0UXVlcnkgPSB7XG4gIFtxdWVyeU5hbWU6IHN0cmluZ106IHN0cmluZ1xufVxuXG5leHBvcnQgdHlwZSBIdHRwUmVxdWVzdFBhcnNlZFJlc3VsdCA9IHtcbiAgbWF0Y2g6IE1hdGNoXG4gIGNvb2tpZXM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz5cbn1cblxuZXhwb3J0IHR5cGUgSHR0cFJlcXVlc3RSZXNvbHZlckV4dHJhczxQYXJhbXMgZXh0ZW5kcyBQYXRoUGFyYW1zPiA9IHtcbiAgcGFyYW1zOiBQYXJhbXNcbiAgY29va2llczogUmVjb3JkPHN0cmluZywgc3RyaW5nPlxufVxuXG5leHBvcnQgdHlwZSBIdHRwQ3VzdG9tUHJlZGljYXRlPFBhcmFtcyBleHRlbmRzIFBhdGhQYXJhbXM+ID0gKGFyZ3M6IHtcbiAgcmVxdWVzdDogUmVxdWVzdFxuICBjb29raWVzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+XG59KSA9PlxuICB8IEh0dHBDdXN0b21QcmVkaWNhdGVSZXN1bHQ8UGFyYW1zPlxuICB8IFByb21pc2U8SHR0cEN1c3RvbVByZWRpY2F0ZVJlc3VsdDxQYXJhbXM+PlxuXG5leHBvcnQgdHlwZSBIdHRwQ3VzdG9tUHJlZGljYXRlUmVzdWx0PFBhcmFtcyBleHRlbmRzIFBhdGhQYXJhbXM+ID1cbiAgfCBib29sZWFuXG4gIHwge1xuICAgICAgbWF0Y2hlczogYm9vbGVhblxuICAgICAgcGFyYW1zOiBQYXJhbXNcbiAgICB9XG5cbmV4cG9ydCB0eXBlIEh0dHBSZXF1ZXN0UHJlZGljYXRlPFBhcmFtcyBleHRlbmRzIFBhdGhQYXJhbXM+ID1cbiAgfCBQYXRoXG4gIHwgSHR0cEN1c3RvbVByZWRpY2F0ZTxQYXJhbXM+XG5cbi8qKlxuICogUmVxdWVzdCBoYW5kbGVyIGZvciBIVFRQIHJlcXVlc3RzLlxuICogUHJvdmlkZXMgcmVxdWVzdCBtYXRjaGluZyBiYXNlZCBvbiBtZXRob2QgYW5kIFVSTC5cbiAqL1xuZXhwb3J0IGNsYXNzIEh0dHBIYW5kbGVyIGV4dGVuZHMgUmVxdWVzdEhhbmRsZXI8XG4gIEh0dHBIYW5kbGVySW5mbyxcbiAgSHR0cFJlcXVlc3RQYXJzZWRSZXN1bHQsXG4gIEh0dHBSZXF1ZXN0UmVzb2x2ZXJFeHRyYXM8YW55PlxuPiB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIG1ldGhvZDogSHR0cEhhbmRsZXJNZXRob2QsXG4gICAgcHJlZGljYXRlOiBIdHRwUmVxdWVzdFByZWRpY2F0ZTxQYXRoUGFyYW1zPixcbiAgICByZXNvbHZlcjogUmVzcG9uc2VSZXNvbHZlcjxIdHRwUmVxdWVzdFJlc29sdmVyRXh0cmFzPGFueT4sIGFueSwgYW55PixcbiAgICBvcHRpb25zPzogUmVxdWVzdEhhbmRsZXJPcHRpb25zLFxuICApIHtcbiAgICBjb25zdCBkaXNwbGF5UGF0aCA9XG4gICAgICB0eXBlb2YgcHJlZGljYXRlID09PSAnZnVuY3Rpb24nID8gJ1tjdXN0b20gcHJlZGljYXRlXScgOiBwcmVkaWNhdGVcblxuICAgIHN1cGVyKHtcbiAgICAgIGluZm86IHtcbiAgICAgICAgaGVhZGVyOiBgJHttZXRob2R9JHtkaXNwbGF5UGF0aCA/IGAgJHtkaXNwbGF5UGF0aH1gIDogJyd9YCxcbiAgICAgICAgcGF0aDogcHJlZGljYXRlLFxuICAgICAgICBtZXRob2QsXG4gICAgICB9LFxuICAgICAgcmVzb2x2ZXIsXG4gICAgICBvcHRpb25zLFxuICAgIH0pXG5cbiAgICB0aGlzLmNoZWNrUmVkdW5kYW50UXVlcnlQYXJhbWV0ZXJzKClcbiAgfVxuXG4gIHByaXZhdGUgY2hlY2tSZWR1bmRhbnRRdWVyeVBhcmFtZXRlcnMoKSB7XG4gICAgY29uc3QgeyBtZXRob2QsIHBhdGggfSA9IHRoaXMuaW5mb1xuXG4gICAgaWYgKCFwYXRoIHx8IHBhdGggaW5zdGFuY2VvZiBSZWdFeHAgfHwgdHlwZW9mIHBhdGggPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIHJldHVyblxuICAgIH1cblxuICAgIGNvbnN0IHVybCA9IGNsZWFuVXJsKHBhdGgpXG5cbiAgICAvLyBCeXBhc3MgcmVxdWVzdCBoYW5kbGVyIFVSTHMgdGhhdCBoYXZlIG5vIHJlZHVuZGFudCBjaGFyYWN0ZXJzLlxuICAgIGlmICh1cmwgPT09IHBhdGgpIHtcbiAgICAgIHJldHVyblxuICAgIH1cblxuICAgIGRldlV0aWxzLndhcm4oXG4gICAgICBgRm91bmQgYSByZWR1bmRhbnQgdXNhZ2Ugb2YgcXVlcnkgcGFyYW1ldGVycyBpbiB0aGUgcmVxdWVzdCBoYW5kbGVyIFVSTCBmb3IgXCIke21ldGhvZH0gJHtwYXRofVwiLiBQbGVhc2UgbWF0Y2ggYWdhaW5zdCBhIHBhdGggaW5zdGVhZCBhbmQgYWNjZXNzIHF1ZXJ5IHBhcmFtZXRlcnMgdXNpbmcgXCJuZXcgVVJMKHJlcXVlc3QudXJsKS5zZWFyY2hQYXJhbXNcIiBpbnN0ZWFkLiBMZWFybiBtb3JlOiBodHRwczovL21zd2pzLmlvL2RvY3MvaHR0cC9pbnRlcmNlcHRpbmctcmVxdWVzdHMjcXVlcnlzZWFyY2gtcGFyYW1ldGVyc2AsXG4gICAgKVxuICB9XG5cbiAgYXN5bmMgcGFyc2UoYXJnczoge1xuICAgIHJlcXVlc3Q6IFJlcXVlc3RcbiAgICByZXNvbHV0aW9uQ29udGV4dD86IFJlc3BvbnNlUmVzb2x1dGlvbkNvbnRleHRcbiAgfSkge1xuICAgIGNvbnN0IHVybCA9IG5ldyBVUkwoYXJncy5yZXF1ZXN0LnVybClcbiAgICBjb25zdCBjb29raWVzID0gZ2V0QWxsUmVxdWVzdENvb2tpZXMoYXJncy5yZXF1ZXN0KVxuXG4gICAgLyoqXG4gICAgICogSGFuZGxlIGN1c3RvbSBwcmVkaWNhdGUgZnVuY3Rpb25zLlxuICAgICAqIEBub3RlIEludm9rZSB0aGlzIGR1cmluZyBwYXJzaW5nIHNvIHRoZSB1c2VyIGNhbiBwYXJzZSB0aGUgcGF0aCBwYXJhbWV0ZXJzXG4gICAgICogbWFudWFsbHkuIE90aGVyd2lzZSwgYHBhcmFtc2AgaXMgYWx3YXlzIGFuIGVtcHR5IG9iamVjdCwgd2hpY2ggaXNuJ3QgbmljZS5cbiAgICAgKi9cbiAgICBpZiAodHlwZW9mIHRoaXMuaW5mby5wYXRoID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICBjb25zdCBjdXN0b21QcmVkaWNhdGVSZXN1bHQgPSBhd2FpdCB0aGlzLmluZm8ucGF0aCh7XG4gICAgICAgIHJlcXVlc3Q6IGFyZ3MucmVxdWVzdCxcbiAgICAgICAgY29va2llcyxcbiAgICAgIH0pXG5cbiAgICAgIGNvbnN0IG1hdGNoID1cbiAgICAgICAgdHlwZW9mIGN1c3RvbVByZWRpY2F0ZVJlc3VsdCA9PT0gJ2Jvb2xlYW4nXG4gICAgICAgICAgPyB7XG4gICAgICAgICAgICAgIG1hdGNoZXM6IGN1c3RvbVByZWRpY2F0ZVJlc3VsdCxcbiAgICAgICAgICAgICAgcGFyYW1zOiB7fSxcbiAgICAgICAgICAgIH1cbiAgICAgICAgICA6IGN1c3RvbVByZWRpY2F0ZVJlc3VsdFxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBtYXRjaCxcbiAgICAgICAgY29va2llcyxcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBtYXRjaCA9IHRoaXMuaW5mby5wYXRoXG4gICAgICA/IG1hdGNoUmVxdWVzdFVybCh1cmwsIHRoaXMuaW5mby5wYXRoLCBhcmdzLnJlc29sdXRpb25Db250ZXh0Py5iYXNlVXJsKVxuICAgICAgOiB7IG1hdGNoZXM6IGZhbHNlLCBwYXJhbXM6IHt9IH1cblxuICAgIHJldHVybiB7XG4gICAgICBtYXRjaCxcbiAgICAgIGNvb2tpZXMsXG4gICAgfVxuICB9XG5cbiAgYXN5bmMgcHJlZGljYXRlKGFyZ3M6IHtcbiAgICByZXF1ZXN0OiBSZXF1ZXN0XG4gICAgcGFyc2VkUmVzdWx0OiBIdHRwUmVxdWVzdFBhcnNlZFJlc3VsdFxuICAgIHJlc29sdXRpb25Db250ZXh0PzogUmVzcG9uc2VSZXNvbHV0aW9uQ29udGV4dFxuICB9KSB7XG4gICAgY29uc3QgaGFzTWF0Y2hpbmdNZXRob2QgPSB0aGlzLm1hdGNoTWV0aG9kKGFyZ3MucmVxdWVzdC5tZXRob2QpXG4gICAgY29uc3QgaGFzTWF0Y2hpbmdVcmwgPSBhcmdzLnBhcnNlZFJlc3VsdC5tYXRjaC5tYXRjaGVzXG4gICAgcmV0dXJuIGhhc01hdGNoaW5nTWV0aG9kICYmIGhhc01hdGNoaW5nVXJsXG4gIH1cblxuICBwcml2YXRlIG1hdGNoTWV0aG9kKGFjdHVhbE1ldGhvZDogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuaW5mby5tZXRob2QgaW5zdGFuY2VvZiBSZWdFeHBcbiAgICAgID8gdGhpcy5pbmZvLm1ldGhvZC50ZXN0KGFjdHVhbE1ldGhvZClcbiAgICAgIDogaXNTdHJpbmdFcXVhbCh0aGlzLmluZm8ubWV0aG9kLCBhY3R1YWxNZXRob2QpXG4gIH1cblxuICBwcm90ZWN0ZWQgZXh0ZW5kUmVzb2x2ZXJBcmdzKGFyZ3M6IHtcbiAgICByZXF1ZXN0OiBSZXF1ZXN0XG4gICAgcGFyc2VkUmVzdWx0OiBIdHRwUmVxdWVzdFBhcnNlZFJlc3VsdFxuICB9KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHBhcmFtczogYXJncy5wYXJzZWRSZXN1bHQubWF0Y2g/LnBhcmFtcyB8fCB7fSxcbiAgICAgIGNvb2tpZXM6IGFyZ3MucGFyc2VkUmVzdWx0LmNvb2tpZXMsXG4gICAgfVxuICB9XG5cbiAgYXN5bmMgbG9nKGFyZ3M6IHsgcmVxdWVzdDogUmVxdWVzdDsgcmVzcG9uc2U6IFJlc3BvbnNlIH0pIHtcbiAgICBjb25zdCBwdWJsaWNVcmwgPSB0b1B1YmxpY1VybChhcmdzLnJlcXVlc3QudXJsKVxuICAgIGNvbnN0IGxvZ2dlZFJlcXVlc3QgPSBhd2FpdCBzZXJpYWxpemVSZXF1ZXN0KGFyZ3MucmVxdWVzdClcbiAgICBjb25zdCBsb2dnZWRSZXNwb25zZSA9IGF3YWl0IHNlcmlhbGl6ZVJlc3BvbnNlKGFyZ3MucmVzcG9uc2UpXG4gICAgY29uc3Qgc3RhdHVzQ29sb3IgPSBnZXRTdGF0dXNDb2RlQ29sb3IobG9nZ2VkUmVzcG9uc2Uuc3RhdHVzKVxuXG4gICAgY29uc29sZS5ncm91cENvbGxhcHNlZChcbiAgICAgIGRldlV0aWxzLmZvcm1hdE1lc3NhZ2UoXG4gICAgICAgIGAke2dldFRpbWVzdGFtcCgpfSAke2FyZ3MucmVxdWVzdC5tZXRob2R9ICR7cHVibGljVXJsfSAoJWMke1xuICAgICAgICAgIGxvZ2dlZFJlc3BvbnNlLnN0YXR1c1xuICAgICAgICB9ICR7bG9nZ2VkUmVzcG9uc2Uuc3RhdHVzVGV4dH0lYylgLFxuICAgICAgKSxcbiAgICAgIGBjb2xvcjoke3N0YXR1c0NvbG9yfWAsXG4gICAgICAnY29sb3I6aW5oZXJpdCcsXG4gICAgKVxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlXG4gICAgY29uc29sZS5sb2coJ1JlcXVlc3QnLCBsb2dnZWRSZXF1ZXN0KVxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlXG4gICAgY29uc29sZS5sb2coJ0hhbmRsZXI6JywgdGhpcylcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZVxuICAgIGNvbnNvbGUubG9nKCdSZXNwb25zZScsIGxvZ2dlZFJlc3BvbnNlKVxuICAgIGNvbnNvbGUuZ3JvdXBFbmQoKVxuICB9XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLElBQUFBLG1CQUFBO0FBQUFDLFFBQUEsQ0FBQUQsbUJBQUE7RUFBQUUsV0FBQSxFQUFBQSxDQUFBLEtBQUFBLFdBQUE7RUFBQUMsV0FBQSxFQUFBQSxDQUFBLEtBQUFBO0FBQUE7QUFBQUMsTUFBQSxDQUFBQyxPQUFBLEdBQUFDLFlBQUEsQ0FBQU4sbUJBQUE7QUFDQSxJQUFBTyxlQUFBLEdBQXlCQyxPQUFBO0FBQ3pCLElBQUFDLG9CQUFBLEdBQThCRCxPQUFBO0FBQzlCLElBQUFFLHlCQUFBLEdBQW1DRixPQUFBO0FBQ25DLElBQUFHLG1CQUFBLEdBQTZCSCxPQUFBO0FBQzdCLElBQUFJLHVCQUFBLEdBQWlDSixPQUFBO0FBQ2pDLElBQUFLLHdCQUFBLEdBQWtDTCxPQUFBO0FBQ2xDLElBQUFNLHNCQUFBLEdBS09OLE9BQUE7QUFDUCxJQUFBTyxrQkFBQSxHQUE0QlAsT0FBQTtBQUM1QixJQUFBUSx3QkFBQSxHQUFxQ1IsT0FBQTtBQUNyQyxJQUFBUyxlQUFBLEdBQXlCVCxPQUFBO0FBQ3pCLElBQUFVLHFCQUFBLEdBS09WLE9BQUE7QUFTQSxJQUFLTCxXQUFBLEdBQUwsZ0JBQUtnQixZQUFBLElBQUw7RUFDTEEsWUFBQSxXQUFPO0VBQ1BBLFlBQUEsVUFBTTtFQUNOQSxZQUFBLFdBQU87RUFDUEEsWUFBQSxVQUFNO0VBQ05BLFlBQUEsWUFBUTtFQUNS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