{"version":3,"names":["_getJestObj","mock","default","jest","fn","mockImplementation","type","run","require","describe","afterEach","resetModules","test","mockData","timestamp","resilienceAnalysis","COL","socialEvents","resilienceScore","recommendations","PER","globalResilienceAssessment","averageResilience","lowResilienceCountries","assessment","globalRecommendations","MetatronAgent","mockResolvedValue","svc","result","getCommunityResilienceIndex","expect","toHaveProperty","source","toBe","agentsMockPath","resolve","doMock","mockRejectedValue","Error"],"sources":["communityResilienceService.test.js"],"sourcesContent":["jest.mock('../../src/agents.js', () => ({\n  default: jest.fn().mockImplementation((type) => ({\n    run: jest.fn()\n  }))\n}))\n\ndescribe('communityResilienceService.getCommunityResilienceIndex', () => {\n  afterEach(() => {\n    jest.resetModules()\n  })\n\n  test('returns data from MetatronAgent successfully', async () => {\n    const mockData = {\n      timestamp: '2025-10-11T19:00:00.000Z',\n      resilienceAnalysis: {\n        COL: { socialEvents: 5, resilienceScore: 65, recommendations: ['Community programs'] },\n        PER: { socialEvents: 3, resilienceScore: 70, recommendations: ['Education initiatives'] }\n      },\n      globalResilienceAssessment: {\n        averageResilience: 67.5,\n        lowResilienceCountries: [],\n        assessment: 'Good community resilience',\n        globalRecommendations: ['Continue monitoring']\n      }\n    };\n\n    const { default: MetatronAgent } = require('../../src/agents.js')\n    MetatronAgent.mockImplementation((type) => ({\n      run: jest.fn().mockResolvedValue(mockData)\n    }))\n\n    const svc = require('../../src/services/communityResilienceService.js')\n    const result = await svc.getCommunityResilienceIndex(['COL', 'PER'], 30)\n\n    expect(result).toHaveProperty('timestamp')\n    expect(result).toHaveProperty('resilienceAnalysis')\n    expect(result).toHaveProperty('globalResilienceAssessment')\n    expect(result.source).toBe('Mock data - Agent unavailable')\n  })\n\n  test('falls back to mock data when agent fails', async () => {\n    const agentsMockPath = require.resolve('../../src/agents.js')\n    jest.doMock(agentsMockPath, () => ({\n      MetatronAgent: jest.fn().mockImplementation(() => ({\n        run: jest.fn().mockRejectedValue(new Error('Agent failure'))\n      }))\n    }))\n\n    const svc = require('../../src/services/communityResilienceService.js')\n    const result = await svc.getCommunityResilienceIndex(['COL', 'PER'], 30)\n\n    expect(result).toHaveProperty('timestamp')\n    expect(result).toHaveProperty('resilienceAnalysis')\n    expect(result.resilienceAnalysis).toHaveProperty('COL')\n    expect(result.resilienceAnalysis).toHaveProperty('PER')\n    expect(result.globalResilienceAssessment).toHaveProperty('averageResilience')\n    expect(result.source).toBe('Mock data - Agent unavailable')\n  })\n\n  test('uses default countries and days when not provided', async () => {\n    const mockData = {\n      timestamp: '2025-10-11T19:00:00.000Z',\n      resilienceAnalysis: {},\n      globalResilienceAssessment: { averageResilience: 0 }\n    };\n\n    const agentsMockPath = require.resolve('../../src/agents.js')\n    jest.doMock(agentsMockPath, () => ({\n      MetatronAgent: jest.fn().mockImplementation(() => ({\n        run: jest.fn().mockResolvedValue(mockData)\n      }))\n    }))\n\n    const svc = require('../../src/services/communityResilienceService.js')\n    await svc.getCommunityResilienceIndex()\n\n    // Test passes if no error is thrown\n    expect(true).toBe(true)\n  })\n})"],"mappings":"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","ignoreList":[]}