080abdf6e5746ccc1193558d6743a4b6
_getJestObj().mock('../../src/agents.js', () => ({
  default: jest.fn().mockImplementation(type => ({
    run: jest.fn()
  }))
}));
function _getJestObj() {
  const {
    jest
  } = require("@jest/globals");
  _getJestObj = () => jest;
  return jest;
}
describe('communityResilienceService.getCommunityResilienceIndex', () => {
  afterEach(() => {
    jest.resetModules();
  });
  test('returns data from MetatronAgent successfully', async () => {
    const mockData = {
      timestamp: '2025-10-11T19:00:00.000Z',
      resilienceAnalysis: {
        COL: {
          socialEvents: 5,
          resilienceScore: 65,
          recommendations: ['Community programs']
        },
        PER: {
          socialEvents: 3,
          resilienceScore: 70,
          recommendations: ['Education initiatives']
        }
      },
      globalResilienceAssessment: {
        averageResilience: 67.5,
        lowResilienceCountries: [],
        assessment: 'Good community resilience',
        globalRecommendations: ['Continue monitoring']
      }
    };
    const {
      default: MetatronAgent
    } = require('../../src/agents.js');
    MetatronAgent.mockImplementation(type => ({
      run: jest.fn().mockResolvedValue(mockData)
    }));
    const svc = require('../../src/services/communityResilienceService.js');
    const result = await svc.getCommunityResilienceIndex(['COL', 'PER'], 30);
    expect(result).toHaveProperty('timestamp');
    expect(result).toHaveProperty('resilienceAnalysis');
    expect(result).toHaveProperty('globalResilienceAssessment');
    expect(result.source).toBe('Mock data - Agent unavailable');
  });
  test('falls back to mock data when agent fails', async () => {
    const agentsMockPath = require.resolve('../../src/agents.js');
    jest.doMock(agentsMockPath, () => ({
      MetatronAgent: jest.fn().mockImplementation(() => ({
        run: jest.fn().mockRejectedValue(new Error('Agent failure'))
      }))
    }));
    const svc = require('../../src/services/communityResilienceService.js');
    const result = await svc.getCommunityResilienceIndex(['COL', 'PER'], 30);
    expect(result).toHaveProperty('timestamp');
    expect(result).toHaveProperty('resilienceAnalysis');
    expect(result.resilienceAnalysis).toHaveProperty('COL');
    expect(result.resilienceAnalysis).toHaveProperty('PER');
    expect(result.globalResilienceAssessment).toHaveProperty('averageResilience');
    expect(result.source).toBe('Mock data - Agent unavailable');
  });
  test('uses default countries and days when not provided', async () => {
    const mockData = {
      timestamp: '2025-10-11T19:00:00.000Z',
      resilienceAnalysis: {},
      globalResilienceAssessment: {
        averageResilience: 0
      }
    };
    const agentsMockPath = require.resolve('../../src/agents.js');
    jest.doMock(agentsMockPath, () => ({
      MetatronAgent: jest.fn().mockImplementation(() => ({
        run: jest.fn().mockResolvedValue(mockData)
      }))
    }));
    const svc = require('../../src/services/communityResilienceService.js');
    await svc.getCommunityResilienceIndex();

    // Test passes if no error is thrown
    expect(true).toBe(true);
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZ2V0SmVzdE9iaiIsIm1vY2siLCJkZWZhdWx0IiwiamVzdCIsImZuIiwibW9ja0ltcGxlbWVudGF0aW9uIiwidHlwZSIsInJ1biIsInJlcXVpcmUiLCJkZXNjcmliZSIsImFmdGVyRWFjaCIsInJlc2V0TW9kdWxlcyIsInRlc3QiLCJtb2NrRGF0YSIsInRpbWVzdGFtcCIsInJlc2lsaWVuY2VBbmFseXNpcyIsIkNPTCIsInNvY2lhbEV2ZW50cyIsInJlc2lsaWVuY2VTY29yZSIsInJlY29tbWVuZGF0aW9ucyIsIlBFUiIsImdsb2JhbFJlc2lsaWVuY2VBc3Nlc3NtZW50IiwiYXZlcmFnZVJlc2lsaWVuY2UiLCJsb3dSZXNpbGllbmNlQ291bnRyaWVzIiwiYXNzZXNzbWVudCIsImdsb2JhbFJlY29tbWVuZGF0aW9ucyIsIk1ldGF0cm9uQWdlbnQiLCJtb2NrUmVzb2x2ZWRWYWx1ZSIsInN2YyIsInJlc3VsdCIsImdldENvbW11bml0eVJlc2lsaWVuY2VJbmRleCIsImV4cGVjdCIsInRvSGF2ZVByb3BlcnR5Iiwic291cmNlIiwidG9CZSIsImFnZW50c01vY2tQYXRoIiwicmVzb2x2ZSIsImRvTW9jayIsIm1vY2tSZWplY3RlZFZhbHVlIiwiRXJyb3IiXSwic291cmNlcyI6WyJjb21tdW5pdHlSZXNpbGllbmNlU2VydmljZS50ZXN0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImplc3QubW9jaygnLi4vLi4vc3JjL2FnZW50cy5qcycsICgpID0+ICh7XG4gIGRlZmF1bHQ6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKHR5cGUpID0+ICh7XG4gICAgcnVuOiBqZXN0LmZuKClcbiAgfSkpXG59KSlcblxuZGVzY3JpYmUoJ2NvbW11bml0eVJlc2lsaWVuY2VTZXJ2aWNlLmdldENvbW11bml0eVJlc2lsaWVuY2VJbmRleCcsICgpID0+IHtcbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBqZXN0LnJlc2V0TW9kdWxlcygpXG4gIH0pXG5cbiAgdGVzdCgncmV0dXJucyBkYXRhIGZyb20gTWV0YXRyb25BZ2VudCBzdWNjZXNzZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgbW9ja0RhdGEgPSB7XG4gICAgICB0aW1lc3RhbXA6ICcyMDI1LTEwLTExVDE5OjAwOjAwLjAwMFonLFxuICAgICAgcmVzaWxpZW5jZUFuYWx5c2lzOiB7XG4gICAgICAgIENPTDogeyBzb2NpYWxFdmVudHM6IDUsIHJlc2lsaWVuY2VTY29yZTogNjUsIHJlY29tbWVuZGF0aW9uczogWydDb21tdW5pdHkgcHJvZ3JhbXMnXSB9LFxuICAgICAgICBQRVI6IHsgc29jaWFsRXZlbnRzOiAzLCByZXNpbGllbmNlU2NvcmU6IDcwLCByZWNvbW1lbmRhdGlvbnM6IFsnRWR1Y2F0aW9uIGluaXRpYXRpdmVzJ10gfVxuICAgICAgfSxcbiAgICAgIGdsb2JhbFJlc2lsaWVuY2VBc3Nlc3NtZW50OiB7XG4gICAgICAgIGF2ZXJhZ2VSZXNpbGllbmNlOiA2Ny41LFxuICAgICAgICBsb3dSZXNpbGllbmNlQ291bnRyaWVzOiBbXSxcbiAgICAgICAgYXNzZXNzbWVudDogJ0dvb2QgY29tbXVuaXR5IHJlc2lsaWVuY2UnLFxuICAgICAgICBnbG9iYWxSZWNvbW1lbmRhdGlvbnM6IFsnQ29udGludWUgbW9uaXRvcmluZyddXG4gICAgICB9XG4gICAgfTtcblxuICAgIGNvbnN0IHsgZGVmYXVsdDogTWV0YXRyb25BZ2VudCB9ID0gcmVxdWlyZSgnLi4vLi4vc3JjL2FnZW50cy5qcycpXG4gICAgTWV0YXRyb25BZ2VudC5tb2NrSW1wbGVtZW50YXRpb24oKHR5cGUpID0+ICh7XG4gICAgICBydW46IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrRGF0YSlcbiAgICB9KSlcblxuICAgIGNvbnN0IHN2YyA9IHJlcXVpcmUoJy4uLy4uL3NyYy9zZXJ2aWNlcy9jb21tdW5pdHlSZXNpbGllbmNlU2VydmljZS5qcycpXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc3ZjLmdldENvbW11bml0eVJlc2lsaWVuY2VJbmRleChbJ0NPTCcsICdQRVInXSwgMzApXG5cbiAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgndGltZXN0YW1wJylcbiAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgncmVzaWxpZW5jZUFuYWx5c2lzJylcbiAgICBleHBlY3QocmVzdWx0KS50b0hhdmVQcm9wZXJ0eSgnZ2xvYmFsUmVzaWxpZW5jZUFzc2Vzc21lbnQnKVxuICAgIGV4cGVjdChyZXN1bHQuc291cmNlKS50b0JlKCdNb2NrIGRhdGEgLSBBZ2VudCB1bmF2YWlsYWJsZScpXG4gIH0pXG5cbiAgdGVzdCgnZmFsbHMgYmFjayB0byBtb2NrIGRhdGEgd2hlbiBhZ2VudCBmYWlscycsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBhZ2VudHNNb2NrUGF0aCA9IHJlcXVpcmUucmVzb2x2ZSgnLi4vLi4vc3JjL2FnZW50cy5qcycpXG4gICAgamVzdC5kb01vY2soYWdlbnRzTW9ja1BhdGgsICgpID0+ICh7XG4gICAgICBNZXRhdHJvbkFnZW50OiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XG4gICAgICAgIHJ1bjogamVzdC5mbigpLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignQWdlbnQgZmFpbHVyZScpKVxuICAgICAgfSkpXG4gICAgfSkpXG5cbiAgICBjb25zdCBzdmMgPSByZXF1aXJlKCcuLi8uLi9zcmMvc2VydmljZXMvY29tbXVuaXR5UmVzaWxpZW5jZVNlcnZpY2UuanMnKVxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHN2Yy5nZXRDb21tdW5pdHlSZXNpbGllbmNlSW5kZXgoWydDT0wnLCAnUEVSJ10sIDMwKVxuXG4gICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlUHJvcGVydHkoJ3RpbWVzdGFtcCcpXG4gICAgZXhwZWN0KHJlc3VsdCkudG9IYXZlUHJvcGVydHkoJ3Jlc2lsaWVuY2VBbmFseXNpcycpXG4gICAgZXhwZWN0KHJlc3VsdC5yZXNpbGllbmNlQW5hbHlzaXMpLnRvSGF2ZVByb3BlcnR5KCdDT0wnKVxuICAgIGV4cGVjdChyZXN1bHQucmVzaWxpZW5jZUFuYWx5c2lzKS50b0hhdmVQcm9wZXJ0eSgnUEVSJylcbiAgICBleHBlY3QocmVzdWx0Lmdsb2JhbFJlc2lsaWVuY2VBc3Nlc3NtZW50KS50b0hhdmVQcm9wZXJ0eSgnYXZlcmFnZVJlc2lsaWVuY2UnKVxuICAgIGV4cGVjdChyZXN1bHQuc291cmNlKS50b0JlKCdNb2NrIGRhdGEgLSBBZ2VudCB1bmF2YWlsYWJsZScpXG4gIH0pXG5cbiAgdGVzdCgndXNlcyBkZWZhdWx0IGNvdW50cmllcyBhbmQgZGF5cyB3aGVuIG5vdCBwcm92aWRlZCcsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBtb2NrRGF0YSA9IHtcbiAgICAgIHRpbWVzdGFtcDogJzIwMjUtMTAtMTFUMTk6MDA6MDAuMDAwWicsXG4gICAgICByZXNpbGllbmNlQW5hbHlzaXM6IHt9LFxuICAgICAgZ2xvYmFsUmVzaWxpZW5jZUFzc2Vzc21lbnQ6IHsgYXZlcmFnZVJlc2lsaWVuY2U6IDAgfVxuICAgIH07XG5cbiAgICBjb25zdCBhZ2VudHNNb2NrUGF0aCA9IHJlcXVpcmUucmVzb2x2ZSgnLi4vLi4vc3JjL2FnZW50cy5qcycpXG4gICAgamVzdC5kb01vY2soYWdlbnRzTW9ja1BhdGgsICgpID0+ICh7XG4gICAgICBNZXRhdHJvbkFnZW50OiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XG4gICAgICAgIHJ1bjogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tEYXRhKVxuICAgICAgfSkpXG4gICAgfSkpXG5cbiAgICBjb25zdCBzdmMgPSByZXF1aXJlKCcuLi8uLi9zcmMvc2VydmljZXMvY29tbXVuaXR5UmVzaWxpZW5jZVNlcnZpY2UuanMnKVxuICAgIGF3YWl0IHN2Yy5nZXRDb21tdW5pdHlSZXNpbGllbmNlSW5kZXgoKVxuXG4gICAgLy8gVGVzdCBwYXNzZXMgaWYgbm8gZXJyb3IgaXMgdGhyb3du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RUgsTUFBTVgsR0FBRyxHQUFHcEIsT0FBTyxDQUFDLGtEQUFrRCxDQUFDO0lBQ3ZFLE1BQU1xQixNQUFNLEdBQUcsTUFBTUQsR0FBRyxDQUFDRSwyQkFBMkIsQ0FBQyxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsRUFBRSxFQUFFLENBQUM7SUFFeEVDLE1BQU0sQ0FBQ0YsTUFBTSxDQUFDLENBQUNHLGNBQWMsQ0FBQyxXQUFXLENBQUM7SUFDMUNELE1BQU0sQ0FBQ0YsTUFBTSxDQUFDLENBQUNHLGNBQWMsQ0FBQyxvQkFBb0IsQ0FBQztJQUNuREQsTUFBTSxDQUFDRixNQUFNLENBQUNkLGtCQUFrQixDQUFDLENBQUNpQixjQUFjLENBQUMsS0FBSyxDQUFDO0lBQ3ZERCxNQUFNLENBQUNGLE1BQU0sQ0FBQ2Qsa0JBQWtCLENBQUMsQ0FBQ2lCLGNBQWMsQ0FBQyxLQUFLLENBQUM7SUFDdkRELE1BQU0sQ0FBQ0YsTUFBTSxDQUFDUiwwQkFBMEIsQ0FBQyxDQUFDVyxjQUFjLENBQUMsbUJBQW1CLENBQUM7SUFDN0VELE1BQU0sQ0FBQ0YsTUFBTSxDQUFDSSxNQUFNLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLCtCQUErQixDQUFDO0VBQzdELENBQUMsQ0FBQztFQUVGdEIsSUFBSSxDQUFDLG1EQUFtRCxFQUFFLFlBQVk7SUFDcEUsTUFBTUMsUUFBUSxHQUFHO01BQ2ZDLFNBQVMsRUFBRSwwQkFBMEI7TUFDckNDLGtCQUFrQixFQUFFLENBQUMsQ0FBQztNQUN0Qk0sMEJBQTBCLEVBQUU7UUFBRUMsaUJBQWlCLEVBQUU7TUFBRTtJQUNyRCxDQUFDO0lBRUQsTUFBTWEsY0FBYyxHQUFHM0IsT0FBTyxDQUFDNEIsT0FBTyxDQUFDLHFCQUFxQixDQUFDO0lBQzdEakMsSUFBSSxDQUFDa0MsTUFBTSxDQUFDRixjQUFjLEVBQUUsT0FBTztNQUNqQ1QsYUFBYSxFQUFFdkIsSUFBSSxDQUFDQyxFQUFFLENBQUMsQ0FBQyxDQUFDQyxrQkFBa0IsQ0FBQyxPQUFPO1FBQ2pERSxHQUFHLEVBQUVKLElBQUksQ0FBQ0MsRUFBRSxDQUFDLENBQUMsQ0FBQ3VCLGlCQUFpQixDQUFDZCxRQUFRO01BQzNDLENBQUMsQ0FBQztJQUNKLENBQUMsQ0FBQyxDQUFDO0lBRUgsTUFBTWUsR0FBRyxHQUFHcEIsT0FBTyxDQUFDLGtEQUFrRCxDQUFDO0lBQ3ZFLE1BQU1vQixHQUFHLENBQUNFLDJCQUEyQixDQUFDLENBQUM7O0lBRXZDO0lBQ0FDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQ0csSUFBSSxDQUFDLElBQUksQ0FBQztFQUN6QixDQUFDLENBQUM7QUFDSixDQUFDLENBQUMiLCJpZ25vcmVMaXN0IjpbXX0=