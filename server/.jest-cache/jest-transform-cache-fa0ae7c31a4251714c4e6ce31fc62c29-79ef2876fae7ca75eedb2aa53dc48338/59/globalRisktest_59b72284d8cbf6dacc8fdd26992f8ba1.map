{"version":3,"names":["_getJestObj","mock","_server","require","_supertest","data","_interopRequireDefault","_express","_globalRiskRoutes","_worldBankService","_climateService","_communityResilienceService","e","__esModule","default","jest","app","express","use","json","globalRiskRouter","describe","beforeAll","server","listen","afterAll","close","it","mockData","countries","year","source","COL","value","country","PER","ARG","globalAverage","getFoodSecurityIndex","mockResolvedValue","response","request","get","expect","status","toBe","body","success","toEqual","toHaveBeenCalledTimes","errorMessage","mockRejectedValue","Error","message","toContain","countryCode","avgMaxTemp","avgMinTemp","totalPrecipitation","avgHumidity","extremeEvents","riskLevel","period","timestamp","getClimateExtremesIndex","resilienceAnalysis","socialEvents","resilienceScore","recommendations","globalResilienceAssessment","averageResilience","lowResilienceCountries","assessment","globalRecommendations","getCommunityResilienceIndex","toHaveBeenCalledWith"],"sources":["globalRisk.test.js"],"sourcesContent":["import { server } from '../mocks/server.js';\nimport request from 'supertest';\nimport express from 'express';\nimport globalRiskRouter from '../../src/routes/globalRiskRoutes.js';\nimport { getFoodSecurityIndex } from '../../src/services/worldBankService.js';\nimport { getClimateExtremesIndex } from '../../src/services/climateService.js';\nimport { getCommunityResilienceIndex } from '../../src/services/communityResilienceService.js';\n\n// Mock the service layer\njest.mock('../../src/services/worldBankService.js');\njest.mock('../../src/services/climateService.js');\njest.mock('../../src/services/communityResilienceService.js');\n\nconst app = express();\napp.use(express.json());\napp.use('/api/global-risk', globalRiskRouter);\n\ndescribe('Global Risk Routes', () => {\n  beforeAll(() => {\n    server.listen();\n  });\n\n  afterAll(() => {\n    server.close();\n  });\n\ndescribe('GET /api/global-risk/food-security', () => {\n  it('should return a 200 OK status and the food security data for LATAM countries', async () => {\n    const mockData = {\n      countries: ['COL', 'PER', 'ARG'],\n      year: 2024,\n      source: \"World Bank API - SN.ITK.DEFC.ZS\",\n      data: {\n        COL: { value: 5.2, year: '2024', country: 'Colombia' },\n        PER: { value: 7.1, year: '2024', country: 'Peru' },\n        ARG: { value: 4.8, year: '2024', country: 'Argentina' }\n      },\n      globalAverage: 5.7\n    };\n\n    getFoodSecurityIndex.mockResolvedValue(mockData);\n\n    const response = await request(app).get('/api/global-risk/food-security');\n\n    expect(response.status).toBe(200);\n    expect(response.body.success).toBe(true);\n    expect(response.body.source).toBe('Praevisio-Aion-Simulated-WorldBank');\n    expect(response.body.data).toEqual(mockData);\n    expect(getFoodSecurityIndex).toHaveBeenCalledTimes(1);\n  });\n\n  it('should handle errors and return a 500 status', async () => {\n    const errorMessage = 'Failed to fetch data';\n    getFoodSecurityIndex.mockRejectedValue(new Error(errorMessage));\n\n    const response = await request(app).get('/api/global-risk/food-security');\n\n    expect(response.status).toBe(500);\n    expect(response.body.success).toBe(false);\n    expect(response.body.message).toContain('Could not retrieve food security data.');\n  });\n});\n\ndescribe('GET /api/global-risk/climate-extremes', () => {\n  it('should return a 200 OK status and the climate extremes data for LATAM countries', async () => {\n    const mockData = [\n      {\n        country: 'Colombia',\n        countryCode: 'COL',\n        avgMaxTemp: 28.5,\n        avgMinTemp: 18.2,\n        totalPrecipitation: 150.3,\n        avgHumidity: 75.2,\n        extremeEvents: 3,\n        riskLevel: 'medium',\n        period: 'Last 30 days',\n        timestamp: '2025-10-10T18:00:00.000Z'\n      },\n      {\n        country: 'Peru',\n        countryCode: 'PER',\n        avgMaxTemp: 25.8,\n        avgMinTemp: 15.6,\n        totalPrecipitation: 85.7,\n        avgHumidity: 68.9,\n        extremeEvents: 2,\n        riskLevel: 'low',\n        period: 'Last 30 days',\n        timestamp: '2025-10-10T18:00:00.000Z'\n      }\n    ];\n\n    getClimateExtremesIndex.mockResolvedValue(mockData);\n\n    const response = await request(app).get('/api/global-risk/climate-extremes');\n\n    expect(response.status).toBe(200);\n    expect(response.body.success).toBe(true);\n    expect(response.body.source).toBe('Praevisio-Aion-NASA-POWER-Integration');\n    expect(response.body.data).toEqual(mockData);\n    expect(getClimateExtremesIndex).toHaveBeenCalledTimes(1);\n  });\n\n  it('should handle errors and return a 500 status', async () => {\n    const errorMessage = 'Failed to fetch climate data';\n    getClimateExtremesIndex.mockRejectedValue(new Error(errorMessage));\n\n    const response = await request(app).get('/api/global-risk/climate-extremes');\n\n    expect(response.status).toBe(500);\n    expect(response.body.success).toBe(false);\n    expect(response.body.message).toContain('Could not retrieve climate extremes data.');\n  });\n});\n});\n\ndescribe('GET /api/global-risk/community-resilience', () => {\n  it('should return a 200 OK status and the community resilience data for LATAM countries', async () => {\n    const mockData = {\n      timestamp: '2025-10-11T19:00:00.000Z',\n      resilienceAnalysis: {\n        COL: { socialEvents: 5, resilienceScore: 65, recommendations: ['Community programs'] },\n        PER: { socialEvents: 3, resilienceScore: 70, recommendations: ['Education initiatives'] },\n        ARG: { socialEvents: 7, resilienceScore: 55, recommendations: ['Social services'] }\n      },\n      globalResilienceAssessment: {\n        averageResilience: 63.3,\n        lowResilienceCountries: ['ARG'],\n        assessment: 'Moderate community resilience with some vulnerabilities',\n        globalRecommendations: ['Strengthen social networks', 'Improve access to resources']\n      },\n      source: 'CommunityResilienceAgent'\n    };\n\n    getCommunityResilienceIndex.mockResolvedValue(mockData);\n\n    const response = await request(app).get('/api/global-risk/community-resilience');\n\n    expect(response.status).toBe(200);\n    expect(response.body.success).toBe(true);\n    expect(response.body.source).toBe('Praevisio-Aion-CommunityResilienceAgent');\n    expect(response.body.data).toEqual(mockData);\n    expect(getCommunityResilienceIndex).toHaveBeenCalledWith(['COL', 'PER', 'ARG'], 30);\n  });\n\n  it('should accept custom countries and days parameters', async () => {\n    const mockData = {\n      timestamp: '2025-10-11T19:00:00.000Z',\n      resilienceAnalysis: {\n        COL: { socialEvents: 5, resilienceScore: 65, recommendations: ['Community programs'] }\n      },\n      globalResilienceAssessment: {\n        averageResilience: 65,\n        lowResilienceCountries: [],\n        assessment: 'Good community resilience',\n        globalRecommendations: ['Continue monitoring']\n      },\n      source: 'CommunityResilienceAgent'\n    };\n\n    getCommunityResilienceIndex.mockResolvedValue(mockData);\n\n    const response = await request(app).get('/api/global-risk/community-resilience?countries=COL&days=60');\n\n    expect(response.status).toBe(200);\n    expect(getCommunityResilienceIndex).toHaveBeenCalledWith(['COL'], 60);\n  });\n\n  it('should handle errors and return a 500 status', async () => {\n    const errorMessage = 'Failed to fetch community resilience data';\n    getCommunityResilienceIndex.mockRejectedValue(new Error(errorMessage));\n\n    const response = await request(app).get('/api/global-risk/community-resilience');\n\n    expect(response.status).toBe(500);\n    expect(response.body.success).toBe(false);\n    expect(response.body.message).toContain('Could not retrieve community resilience data.');\n  });\n});\n"],"mappings":"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","ignoreList":[]}