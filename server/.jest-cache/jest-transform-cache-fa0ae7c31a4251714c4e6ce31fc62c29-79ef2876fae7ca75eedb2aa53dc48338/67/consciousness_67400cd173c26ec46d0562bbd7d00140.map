{"version":3,"names":["_express","_interopRequireDefault","require","_database","_promises","_path","e","__esModule","default","router","express","Router","get","req","res","client","getChromaClient","clientUsable","getOrCreateCollection","mock","collection","name","all","docs","documents","metadatas","ids","result","map","id","i","error","metadata","json","source","items","p","path","join","process","cwd","exists","fs","access","then","catch","txt","readFile","lines","split","filter","Boolean","l","JSON","parse","raw","console","status","_default","exports"],"sources":["consciousness.js"],"sourcesContent":["import express from 'express';\nimport { getChromaClient } from '../database.js';\nimport fs from 'fs/promises';\nimport path from 'path';\n\nconst router = express.Router();\n\n// GET /api/consciousness\nrouter.get('/', async (req, res) => {\n  try {\n    const client = getChromaClient();\n    const clientUsable = client && typeof client.getOrCreateCollection === 'function' && !client.mock;\n    if (clientUsable) {\n      const collection = await client.getOrCreateCollection({ name: 'failure_patterns' });\n      const all = await collection.get();\n      const docs = (all || {}).documents || [];\n      const metadatas = (all || {}).metadatas || [];\n      const ids = (all || {}).ids || [];\n      const result = ids.map((id, i) => ({ id, error: docs[i], metadata: metadatas[i] }));\n      return res.json({ source: 'chroma', items: result });\n    }\n\n    // Fallback: read local JSONL\n    const p = path.join(process.cwd(), 'server', 'data', 'failure_patterns.jsonl');\n    const exists = await fs.access(p).then(() => true).catch(() => false);\n    if (!exists) return res.json({ source: 'local', items: [] });\n    const txt = await fs.readFile(p, 'utf8');\n    const lines = txt.split('\\n').filter(Boolean);\n    const items = lines.map(l => { try { return JSON.parse(l); } catch { return { raw: l }; } });\n    return res.json({ source: 'local', items });\n  } catch (e) {\n    console.error('consciousness route error', e);\n    return res.status(500).json({ error: 'Internal server error' });\n  }\n});\n\nexport default router;\n"],"mappings":"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","ignoreList":[]}